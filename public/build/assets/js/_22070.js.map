{"version":3,"sources":["_22070.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_22070.js","sourcesContent":["\n(function($) {\n    \n    /**\n     * Xml Htpp Request Scope\n     * @param {type} param\n     * @returns {Promise}\n     */\n    var xhr = function(param)\n    {\n        param        = param || {};\n        param.method = param.method || 'POST';\n        \n        return new Promise(function(resolve, reject) {\n            execAjax1(param.method,param.url,param.dados,\n            function(data) {\n                resolve(data);\n            },\n            function() {\n                reject(false);\n               \n            });\n        });  \n    };\n    \n    \n    function objIndex()\n    {\n        this.paramByInput           = paramByInput;       \n        this.filtrar                = filtrar;       \n        this.inicializarDataTable   = inicializarDataTable;  \n        this.dragDrop               = dragDrop;  \n        this.menuLateral            = menuLateral;\n        this.menuLateralContainer   = menuLateralContainer;\n        this.reprogramarPara        = reprogramarPara;\n        \n        /**\n         * Definir os parâmetros de um campo a partir de outro.\n         */\n        function paramByInput()\n        {\n\n            /**\n             * Define o GP selecionado como parâmetro para a UP.\n             */\n            function gpParamUp() {\n\n                $('._gp_id')\n                    .change(function() {\n                        var _this = $(this);\n\n                        //Seta GP na UP\n                        $('.consulta_up_group')\n                            .siblings('._consulta_parametros')\n                            .children('._consulta_filtro[objcampo=\"GP\"]')\n                            .val( $(this).val() )\n                        ;\n                        \n                    })\n                ;\n            }\n\n            /**\n             * Define o UP selecionado como parâmetro para a Estação.\n             */\n            function upParamEstacao() {\n\n                $('._up_id')\n                    .change(function() {\n\n                        //Seta UP na Estacao\n                        $('.consulta_estacao_group')\n                            .siblings('._consulta_parametros')\n                            .children('._consulta_filtro[objcampo=\"UP\"]')\n                            .val( $(this).val() )\n                        ;\n\n                    })\n                ;\n            }\n\n            gpParamUp();\n            upParamEstacao();\n        }\n        \n        function filtrar()\n        {            \n            $('.form-filtrar').submit(function(e)\n            {\n                return new Promise(function(resolve, reject) {\n                    e.preventDefault();\n                    \n                    var scroll_left_before_filter = $('.up-container').scrollLeft();\n                    var scroll_top_before_filter  = $('.up-container').scrollTop();\n\n                    xhr({\n                        url   : '/_22070/filtrar',\n                        dados : {\n                            estabelecimento_id : $('.estab'      ).val(),\n                            gp_id              : $('._gp_id'     ).val(),\n                            up_id              : $('._up_id'     ).val(),\n                            estacao            : $('._estacao_id').val(),\n                            datahora_inicio    : $('#data-ini'   ).val(),\n                            datahora_fim       : $('#data-fim'   ).val()\n                        }\n                    })\n                    .then(function(data){\n                        $('.taloes-container').html(data);\n\n                        var index = new objIndex();\n                            index.inicializarDataTable();\n                            index.dragDrop();\n                            index.reprogramarPara();\n                            index.menuLateralContainer();\n                            \n                        $('.up-container').scrollLeft(scroll_left_before_filter);\n                        $('.up-container').scrollTop(scroll_top_before_filter);\n                        \n                        //$('.menu-lateral').trigger('hide').fadeIn();\n                        resolve(true);\n                    })\n                    .catch(function(){\n                        reject(false);\n                    });\n                });\n            });\n        }\n        \n        function inicializarDataTable(param)\n        {\n            var param                   = param || {};\n\t\t\tvar data_table_def\t\t\t= $.extend({}, table_default);\n                data_table_def.sScrollY = '100%'; \n\t\t\t\t\n            $('table.estacao').DataTable(data_table_def);\n            \n            ativarSelecLinhaCheckbox();     \n\n            //Só permite que uma tabela tenha itens selecionados por vez\n            $('tr')\n                .click(function(){\n                    $(this)\n                        .closest('.up-bloco')\n                        .siblings()\n                        .find('.selected')\n                        .removeClass('selected')\n                    ;\n                })\n            ;            \n        }\n        \n        function dragDrop()\n        {\n            var dados = {};\n            \n            function TaloesOrigem(itens_selecionado_origem) {\n                \n                var item_selecionado_first = $(itens_selecionado_origem).first();\n                \n                dados.origem_datahora_inicio = item_selecionado_first.find('._data-inicio'     ).val();\n                dados.origem_up_id           = item_selecionado_first.find('._up-id'           ).val();\n                dados.origem_estacao         = item_selecionado_first.find('._estacao'         ).val();\n                dados.origem_data            = item_selecionado_first.find('._data-programacao').val();\n            }\n            \n            /**\n             * Realiza todos os tratamentos do servidor<br/>\n             * Atualiza as informações dos itens\n             */\n            function TaloesDestino() {\n                \n                var itens_selecionados = $('.selected');\n                \n                var capturaTaloes = function() {\n                    dados.estabelecimento_id = $('.estab'        ).val();\n                    dados.gp_descricao       = $('._gp_descricao').val();\n                    dados.gp_id              = $('._gp_id'       ).val();\n                    dados.up_id              = $('._up_id'       ).val();\n                    dados.estacao            = $('._estacao_id'  ).val();\n                    dados.datahora_inicio    = $('#data-ini'     ).val();\n                    dados.datahora_fim       = $('#data-fim'     ).val();\n                    dados.destino_up_id      = itens_selecionados.first().closest('.up-bloco'     ).data('up'     );\n                    dados.destino_estacao    = itens_selecionados.first().closest('.estacao-bloco').data('estacao');\n                    dados.destino_taloes     = [];\n                    \n                    itens_selecionados\n                        .each(function(){\n                            dados.destino_taloes.push({\n                                talao_id       : $(this).find('._talao-id'      ).val(),\n                                programacao_id : $(this).find('._programacao-id').val()\n                            });\n                        })\n                    ;\n                    \n                    var scroll_left_before_filter = $('.up-container').scrollLeft();\n                    var scroll_top_before_filter  = $('.up-container').scrollTop();\n                    \n                    xhr({\n                        url   : '/_22070/reprogramar',\n                        dados : dados\n                    })\n                    .then(function(data){\n                        $('.taloes-container').html(data);\n\n                        var index = new objIndex();\n                            index.inicializarDataTable();\n                            index.dragDrop();\n                            index.reprogramarPara();\n                            \n                        $('.up-container').scrollLeft(scroll_left_before_filter);\n                        $('.up-container').scrollTop(scroll_top_before_filter);\n                        \n                    })\n                    .catch(function(){\n                        $('.form-filtrar').submit();\n                    });\n                };\n                \n                var capturaDataInicio = function() {\n                    \n                    var data_inicio_anterior       = itens_selecionados.first().prev().find('._data-inicio').data('data-inicial');\n                    var data_programacao_anterior  = itens_selecionados.first().prev().find('._data-programacao').val();\n                    var data_inicio_posterior      = itens_selecionados.last().next().find('._data-inicio').val();\n                    var data_programacao_posterior = itens_selecionados.last().next().find('._data-programacao').val();\n                    \n                    dados.destino_datahora_inicio = ( data_inicio_anterior      === undefined ) ? data_inicio_posterior      : data_inicio_anterior; \n                    dados.destino_data            = ( data_programacao_anterior === undefined ) ? data_programacao_posterior : data_programacao_anterior; \n\n                    if ( dados.destino_datahora_inicio === undefined ) {\n\n                        var now          = new Date();\n                        var now1         = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),  now.getUTCHours(), now.getUTCMinutes(), 0);\n                        var datetime_now = new Date(now1.getTime()-now1.getTimezoneOffset()*60000).toISOString().substring(0,19);\n\n                        addConfirme(\n                            '<h4>Reprogramar Talões</h4>',\n                            ' A Unidade Produtiva/Estação selecionada ainda não possui talões programados.<br />'+\n                            ' Informe uma data para início do primeiro talão:<br/>'+\n                            '<input type=\"datetime-local\" class=\"form-control input-datetime\" value=\"' + datetime_now + '\">',\n                            [obtn_ok,obtn_cancelar],\n                            [\n                                {ret:1,func:function(){\n                                    \n                                    if ( $('.input-datetime').val() == '' ) {\n                                        throw new Error('Oooops! ocorreu um falha');\n                                    }\n\n                                    dados.destino_datahora_inicio = $('.input-datetime').val();\n                                    dados.destino_data            = $('.input-datetime').val();\n                                    capturaTaloes();\n                                }},\n                                {ret:2,func:function(){\n                                    $('.form-filtrar').submit();     \n                                }}\n                            ] \n                        );\n                    } else {\n                        capturaTaloes();\n                    }\n                };\n                    \n                capturaDataInicio();\n            }\n            \n            /**\n             * Realiza todos os tratamentos visuais<br/>\n             * Realiza a chamada dos eventos de backend\n             */\n            function frontEnd() {\n                $('tbody')\n                    .sortable({\n//                        cancel      : 'tr:not(.selected)',  //Quais itens não podem ser selecionados\n                        items       : 'tr',                 //Quais os itens que podem ser selecionados\n                        appendTo    : \".up-container\",      //Por onde os itens selecionados podem percorrer\n                        connectWith : 'tbody',              //Onde poderá ser soltado os itens selecionados\n                        cursor      : 'move',               //Cursor enquanto arrasta itens\n                        tolerance   : 'pointer',            //Em que ponto poderá ser soltados os itens\n                        delay       : 150,                  //Tempo em milisegundos que demora para começar a arrastar os itens\n                        distance    : 5,    \n                        revert      : true,                 //Ativa o efeito ao soltar suavisado\n                        cursorAt    : { left: 5 },          //Posição do cursor em relação ao item que está sendo arrastado\n                        //Item flutuante\n                        helper: function(e, item){\n                            if(!item.hasClass('selected')){\n                               item.addClass('selected').siblings().removeClass('selected');\n                            }\n\n                            var elements = item.parent().children('.selected').clone();\n                            item.data('multidrag', elements).siblings('.selected').remove();\n                            \n                            TaloesOrigem(elements);\n\n                            var helper = $('<tr/>');\n                            return helper.append(elements);\n                        },\n                        beforeStop: function(e, ui){\n                            $('tbody')\n                                .each(function(){\n                                    var tr    = $(this).find('tr.ui-sortable-handle');\n                                    var empty = $(this).find('.dataTables_empty');\n                                    \n                                    if( tr.length >= 1 && empty.length == 1 ) {\n                                        empty.remove();\n                                    }\n                                    \n                                    if ( tr.length < 1 && empty.length == 0 ) {\n                                        $(this).append('<tr><td colspan=\"10\" class=\"dataTables_empty\">Não há registros para listar</td></tr>');\n                                    }\n                                })\n                            ;  \n                        },\n                        //Ação ao soltar itens\n                        stop: function(e, ui){\n\n                            var elements = ui.item.data('multidrag');\n                            ui.item.after(elements).remove();\n                                                        \n                            addConfirme(\n                                '<h4>Reprogramar Talões</h4>',\n                                ' Confirma a reprogramação dos itens selecionados?<br />',\n                                [obtn_sim,obtn_nao],\n                                [\n                                    {ret:1,func:function(){\n                                        TaloesDestino();\n                                    }},\n                                    {ret:2,func:function(){\n                                        $('.form-filtrar').submit();     \n                                    }}\n                                ]     \n                            );\n                        },\n                        //Abertura onde será soltado os itens\n                        placeholder: {\n                            element: function(currentItem) {\n                                return $('<tr><td colspan=\"10\" class=\"reprogramar-aqui\">Reprogramar aqui</td></tr>')[0];\n                            },\n                            update: function(container, p) {\n                                return;\n                            }\n                        }\n                    })\n                ;\n            }\n                        \n            frontEnd();\n        }\n        \n        function menuLateral()\n        {\n\n            // Redimensiona o menu lateral\n            var menu = $('.menu-lateral');\n            var button = menu.find('.btn-toggle');\n            \n            menu\n                .on('hide',function(){\n                    $(this).css({left : -($(this).width()+4)});\n                    $(this).addClass('ocultar');\n                    button.addClass('glyphicon-option-vertical');\n                    button.removeClass('glyphicon-remove');\n                })\n                .on('show',function(){\n                    $(this).css({left : 0});\n                    $(this).removeClass('ocultar');\n                    button.removeClass('glyphicon-option-vertical');\n                    button.addClass('glyphicon-remove');\n                })\n                .on('toggle',function(){\n                    \n                    if ( $(this).hasClass('ocultar') ) {\n                        $(this).css({left : 0});\n                    } else {\n                        $(this).css({left : -($(this).width()+4)});\n                    }\n            \n                    $(this).toggleClass('ocultar');\n                    button.toggleClass('glyphicon-option-vertical');\n                    button.toggleClass('glyphicon-remove');\n                })\n            ;\n            \n            button\n                .click(function(){\n                    menu.trigger('toggle');\n                })\n            ;\n            button.click();\n        }\n        \n        function menuLateralContainer()\n        {\n            \n            function carregaItens()\n            {\n                var menu_center = $('.menu-lateral .treeview-container');\n\n                menu_center.empty();\n\n                var insertElement = function(param) {\n                        var param = param || {};\n                        var id = param.class_element +'-dinamic-'+parseInt(Math.random() * 10000);\n\n                    return $(\n                        '<div class=\"treeview-element ' + param.class_element + '\" data-' + param.class_element + '=\"' + param.data_id +'\">\\n\\\n                            <div class=\"form-group\">\\n\\\n                                <input type=\"checkbox\" id=\"' + id + '\" class=\"form-control treeview-checkbox ' + param.class_element + '-checkbox\" checked />\\n\\\n                                <label class=\"treeview-label\" for=\"' + id + '\">\\n\\\n                                    ' + param.label_text + '\\n\\\n                                </label>\\n\\\n                            </div>\\n\\\n                        </div>'\n                    ).appendTo(param.append_to);\n                };\n\n                $('.up-bloco')\n                    .each(function(){\n                        var div_up = insertElement({\n                            data_id       : $(this).data('up'),\n                            class_element : 'up',\n                            append_to     : menu_center,\n                            label_text    : $(this).data('up') + ' - ' + $(this).data('up-descricao')\n                        });\n\n                        $(this)\n                            .find('.estacao-bloco')\n                            .each(function(){\n                                insertElement({\n                                    data_id       : $(this).data('estacao'),\n                                    class_element : 'estacao',\n                                    append_to     : div_up,\n                                    label_text    : $(this).data('estacao') + ' - ' + $(this).data('estacao-descricao')\n                                });\n                            })\n                        ;\n\n                    })\n                ;\n            }\n            \n            function bloqueios()\n            {     \n                $('.treeview-element')\n                    .each(function(){\n                        var _this_checked = $(this).find('.form-group .treeview-checkbox').prop('checked');\n                        var count_children = $(this).children('.treeview-element').length;\n                        if ( _this_checked && count_children < 2 ) {\n                            $(this)\n                                .children('.treeview-element').find('.treeview-checkbox, .treeview-label')\n                                .prop('disabled', true )\n                            ;\n                        }\n                    })\n                ;\n            }\n\n            function eventos()\n            {\n                $('.up-marcar-todos')\n                    .change(function(){\n                        var all_container = $(this).closest('.center');\n                        if($(this).prop( 'checked' )) {\n                            all_container.find('.up-checkbox').prop('checked',true).trigger('change');\n                        } else {\n                            all_container.find('.up-checkbox').prop('checked',false).trigger('change');\n                        }\n                    })\n                ;\n                \n                $('.up-checkbox')\n                    .change(function() {\n                        \n                        var up = $(this).closest('.up');\n                        var estacoes = up.find('.estacao input');\n                        \n                        if($(this).prop( 'checked' )) {\n                            estacoes\n                                .prop('checked', true )\n                                .trigger('change')\n                            ;\n                            \n                            bloqueios();\n                            \n                            $('.taloes-container [data-up=\"' + up.data('up') + '\"]').show();\n                        } else {\n                            estacoes\n                                .prop('checked', false )\n                                .prop('disabled', false )\n                                .trigger('change')\n                            ;\n                            \n                            $('.taloes-container [data-up=\"' + up.data('up') + '\"]').hide();\n                        }\n                    }\n                );\n        \n                $('.estacao-checkbox')\n                    .change(function() {\n                        \n                        var up = $(this)\n                            .closest('.up')\n                        ;\n                        var estacao = $(this)\n                            .closest('.estacao')\n                        ;\n                        \n                        if($(this).prop( 'checked' )) {\n                            \n                            var up_checkbox = up.find('.up-checkbox');\n                            if ( !up_checkbox.prop('checked') ) {\n                                up_checkbox\n                                    .prop('checked', true )\n                                    .trigger('change')\n                                ;\n                            }\n                    \n                            $('.taloes-container [data-up=\"' + up.data('up') + '\"] [data-estacao=\"' + estacao.data('estacao') + '\"]').show();\n                        } else {\n                            \n                            $('.taloes-container [data-up=\"' + up.data('up') + '\"] [data-estacao=\"' + estacao.data('estacao') + '\"]').hide();\n                        }\n                    }\n                );\n            }\n            \n            carregaItens();\n            bloqueios();\n            eventos();\n        }\n    \n        function reprogramarPara()\n        {\n            $('tr').on('trSelectedChanged',function(){\n                \n                $('.btn-reprogramar-para').prop('disabled', true );\n                \n                var btn_reprogramar = $(this).closest('.estacao-bloco').find('.btn-reprogramar-para');\n\n                if ( $(this).closest('tbody').find('.selected').length > 0 ) {\n                    btn_reprogramar.prop('disabled', false );\n                } else {\n                    btn_reprogramar.prop('disabled', true );\n                }\n            });\n            \n            $('.btn-reprogramar-para').click(function(){\n                \n                var dados = {};\n\n                function TaloesOrigem(itens_selecionado_origem) {\n\n                    var item_selecionado_first = $(itens_selecionado_origem).first();\n\n                    dados.origem_datahora_inicio = item_selecionado_first.find('._data-inicio'     ).val();\n                    dados.origem_up_id           = item_selecionado_first.find('._up-id'           ).val();\n                    dados.origem_estacao         = item_selecionado_first.find('._estacao'         ).val();\n                    dados.origem_data            = item_selecionado_first.find('._data-programacao').val();\n                }\n\n                /**\n                 * Realiza todos os tratamentos do servidor<br/>\n                 * Atualiza as informações dos itens\n                 */\n                function TaloesDestino() {\n\n                    var itens_selecionados = $('.selected');\n\n                    var capturaTaloes = function() {\n                        dados.estabelecimento_id = $('.estab'        ).val();\n                        dados.gp_descricao       = $('._gp_descricao').val();\n                        dados.gp_id              = $('._gp_id'       ).val();\n                        dados.up_id              = $('._up_id'       ).val();\n                        dados.estacao            = $('._estacao_id'  ).val();\n                        dados.datahora_inicio    = $('#data-ini'     ).val();\n                        dados.datahora_fim       = $('#data-fim'     ).val();\n                        dados.destino_up_id      = itens_selecionados.first().closest('.up-bloco'     ).data('up'     );\n                        dados.destino_estacao    = itens_selecionados.first().closest('.estacao-bloco').data('estacao');\n                        dados.destino_taloes     = [];\n\n                        itens_selecionados\n                            .each(function(){\n                                dados.destino_taloes.push({\n                                    talao_id       : $(this).find('._talao-id'      ).val(),\n                                    programacao_id : $(this).find('._programacao-id').val()\n                                });\n                            })\n                        ;\n\n                        var scroll_left_before_filter = $('.up-container').scrollLeft();\n                        var scroll_top_before_filter  = $('.up-container').scrollTop();\n\n                        xhr({\n                            url   : '/_22070/reprogramar',\n                            dados : dados\n                        })\n                        .then(function(data){\n                            $('.taloes-container').html(data);\n\n                            var index = new objIndex();\n                                index.inicializarDataTable();\n                                index.dragDrop();\n                                index.reprogramarPara();\n\n                            $('.up-container').scrollLeft(scroll_left_before_filter);\n                            $('.up-container').scrollTop(scroll_top_before_filter);\n\n                        })\n                        .catch(function(){\n                            $('.form-filtrar').submit();\n                        });\n                    };\n\n                    var capturaDataInicio = function() {\n\n                        var data_inicio_anterior       = itens_selecionados.first().prev().find('._data-inicio').data('data-inicial');\n                        var data_programacao_anterior  = itens_selecionados.first().prev().find('._data-programacao').val();\n                        var data_inicio_posterior      = itens_selecionados.last().next().find('._data-inicio').val();\n                        var data_programacao_posterior = itens_selecionados.last().next().find('._data-programacao').val();\n\n\n\n                        var now          = new Date();\n                        var now1         = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),  now.getUTCHours(), now.getUTCMinutes(), 0);\n                        var datetime_now = new Date(now1.getTime()-now1.getTimezoneOffset()*60000).toISOString().substring(0,19);\n\n                        addConfirme(\n                            '<h4>Reprogramar Talões</h4>',\n                            ' Informe a data/hora para o primeiro talão selecionado:<br/>'+\n                            '<input type=\"datetime-local\" class=\"form-control input-datetime\" value=\"' + datetime_now + '\">',\n                            [obtn_ok,obtn_cancelar],\n                            [\n                                {ret:1,func:function(){\n                                    \n                                    if ( $('.input-datetime').val() == '' ) {\n                                        throw new Error('Oooops! ocorreu um falha');\n                                    }\n\n                                    dados.destino_datahora_inicio = $('.input-datetime').val();\n                                    dados.destino_data            = $('.input-datetime').val();\n                                    capturaTaloes();\n                                }}\n                            ] \n                        );\n                    };\n\n                    capturaDataInicio();\n                }\n                \n                TaloesOrigem($('.selected'));\n                TaloesDestino();\n            });\n        }\n    }\n    \n    function loadIndex()\n    {\n        function clearData()\n        {\n            $('.estab, ._gp_id, ._up_id, ._estacao_id, #data-ini, #data-fim')\n                .change(function(){\n                    $('.taloes-container').empty();\n                    $('.menu-lateral .treeview-container').empty();\n                    //$('.menu-lateral').trigger('hide');\n                })\n            ;\n        }\n        \n        clearData();\n        var index = new objIndex();\n            index.paramByInput();\n            index.filtrar();\n            //index.menuLateral();\n    }\n\n    /**\n     * Document Ready\n     */\n\t$(function() {\n        loadIndex();\n\t});\n    \n})(jQuery);\n\n"]}