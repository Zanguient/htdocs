{"version":3,"sources":["_12100.app.js","_12100.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_12100.app.js","sourcesContent":["/**\r\n * _11140 - Cadastro de paineis de Casos\r\n */\r\n'use strict';\r\n\r\nangular\r\n\t.module('app', [\r\n\t\t'vs-repeat', \r\n\t\t'gc-ajax',\r\n\t\t'gc-transform',\r\n\t\t'gc-form',\r\n\t\t'gc-utils',\r\n\t\t'gc-find'\r\n\t]);","angular\r\n    .module('app')\r\n    .value('gScope', {\r\n        indexOfAttr : function(array,attr, value) {\r\n            for(var i in array) {\r\n                if(array[i][attr] === value) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        }\r\n    })\r\n    .controller('Ctrl', Ctrl);\r\n\r\n    Ctrl.$inject = [\r\n        '$ajax',\r\n        '$scope',\r\n        '$window',\r\n        '$timeout',\r\n        'gScope',\r\n        '$consulta',\r\n        '$rootScope',\r\n        '$sce'\r\n    ];\r\n\r\n    function Ctrl($ajax, $scope, $window, $timeout, gScope, $consulta,$rootScope, $sce) {\r\n\r\n        var vm = this;\r\n\r\n        $scope.trustAsHtml = function(string) {\r\n            return $sce.trustAsHtml(string);\r\n        };\r\n\r\n        vm.filtroItens  = '';\r\n        vm.Consulta     = new $consulta();\r\n        gScope.Consulta = vm.Consulta;\r\n        vm.ordem        = '-NUMERO_NOTAFISCAL';\r\n\r\n        vm.Etiqueta = {\r\n            Modelos:[]\r\n        };\r\n\r\n        function dataInicio(){\r\n            var data = new Date();\r\n            var dia = data.getDate();\r\n            if (dia.toString().length == 1)\r\n              dia = \"0\"+dia;\r\n            var mes = data.getMonth()+1;\r\n            if (mes.toString().length == 1)\r\n              mes = \"0\"+mes;\r\n            var ano = data.getFullYear();  \r\n            return mes+\"/01/\"+ano;\r\n        }\r\n\r\n        function dataFim(){\r\n            var data = new Date();\r\n            var dia = data.getDate();\r\n            if (dia.toString().length == 1)\r\n              dia = \"0\"+dia;\r\n            var mes = data.getMonth()+1;\r\n            if (mes.toString().length == 1)\r\n              mes = \"0\"+mes;\r\n            var ano = data.getFullYear();  \r\n            return mes+\"/\"+dia+\"/\"+ano;\r\n        }\r\n\r\n        vm.TratarOrdem = function(filtro){\r\n            if(vm.ordem == filtro){\r\n                vm.ordem = '-'+filtro;\r\n            }else{\r\n                vm.ordem = filtro;\r\n            }\r\n        };\r\n\r\n        vm.DataInicio = moment(dataInicio()).toDate();\r\n        vm.DataFim    = moment(dataFim()).toDate();\r\n        vm.NOTAS      = [];\r\n        vm.NUMERO_NOTA = 0;\r\n        vm.SERIE_NOTA  = 0;\r\n        vm.PEDIDO      = 0;\r\n\r\n        vm.NOTA = {\r\n            ITENS : [],\r\n            INFO  : [],\r\n            XML   : {VER: false},\r\n            PDF   : {VER: false}\r\n        };\r\n\r\n        vm.Consulta_Representante  = vm.Consulta.getNew();\r\n        vm.Consulta_Cliente        = vm.Consulta.getNew();\r\n\r\n        vm.Consulta_Representante.componente             = '.Consulta_Representante',\r\n        vm.Consulta_Representante.model                  = 'vm.Consulta_Representante',\r\n        vm.Consulta_Representante.option.label_descricao = 'Representante:',\r\n        vm.Consulta_Representante.option.obj_consulta    = '/_12100/consultarRepresentante',\r\n        vm.Consulta_Representante.option.tamanho_input   = 'input-maior';\r\n        vm.Consulta_Representante.option.class           = 'Consulta_Representante';\r\n        vm.Consulta_Representante.option.tamanho_tabela  = 500;\r\n        vm.Consulta_Representante.option.obj_ret         = ['ID','DESCRICAO'];\r\n        vm.Consulta_Representante.option.campos_tabela   = [['ID','ID'],['UF','UF'],['DESCRICAO','RAZÃO SOCIAL']];\r\n\r\n        vm.Consulta_Cliente.componente             = '.Consulta_Cliente',\r\n        vm.Consulta_Cliente.model                  = 'vm.Consulta_Cliente',\r\n        vm.Consulta_Cliente.option.label_descricao = 'Cliente:',\r\n        vm.Consulta_Cliente.option.obj_consulta    = '/_12100/consultarCliente',\r\n        vm.Consulta_Cliente.option.tamanho_input   = 'input-maior';\r\n        vm.Consulta_Cliente.option.class           = 'Consulta_Cliente';\r\n        vm.Consulta_Cliente.option.tamanho_tabela  = 600;\r\n        vm.Consulta_Cliente.option.obj_ret         = ['ID','DESCRICAO'];\r\n        vm.Consulta_Cliente.option.campos_tabela   = [['ID','ID'],['NOMEFANTASIA','NOME FANTASIA'],['DESCRICAO','CLIENTE']];\r\n\r\n        vm.Consulta_Representante.compile();\r\n        vm.Consulta_Cliente.compile();\r\n\r\n        vm.Consulta_Cliente.require    = vm.Consulta_Representante;\r\n        vm.Consulta_Cliente.vincular();\r\n\r\n        vm.ngWinPopUp = function (url,id,params) {\r\n            winPopUp(url,id,params);\r\n        };\r\n\r\n\r\n        vm.Etiqueta.MudarMarcado = function(item){\r\n            if(item.MARCADO == 1){\r\n                item.MARCADO = 0;\r\n            }else{\r\n                item.MARCADO = 1;\r\n            }\r\n        };\r\n\r\n        vm.Etiqueta.MarcarTodos = function(item){\r\n            angular.forEach(vm.Etiqueta.NOTA, function(item, key) {\r\n                item.MARCADO = 1;\r\n            });\r\n\r\n            vm.Etiqueta.ValidarImprimir();\r\n        };\r\n\r\n        vm.Etiqueta.DesmarcarTodos = function(item){\r\n            angular.forEach(vm.Etiqueta.NOTA, function(item, key) {\r\n                item.MARCADO = 0;\r\n            });\r\n\r\n            vm.Etiqueta.ValidarImprimir();\r\n        };        \r\n\r\n        vm.Etiqueta.AbilitarImprimir = 0;\r\n\r\n        vm.Etiqueta.ValidarImprimir = function(){\r\n            vm.Etiqueta.AbilitarImprimir = 0;\r\n\r\n            var v1 = 0;\r\n            var v2 = 0;\r\n\r\n            angular.forEach(vm.Etiqueta.Modelos, function(item, key) {\r\n                if(vm.Etiqueta.SELECT == item){\r\n                    v1 = 1;\r\n                }\r\n            });\r\n\r\n            angular.forEach(vm.Etiqueta.NOTA, function(item, key) {\r\n                if(item.MARCADO == 1 && item.VOLUMES1 > 0 && item.VOLUMES1 <= item.VOLUMES2){\r\n                    v2 = 1;\r\n                }\r\n            });\r\n\r\n            if(v1 == 1 && v2 == 1){\r\n                vm.Etiqueta.AbilitarImprimir = 1;\r\n            }\r\n        }\r\n\r\n        vm.Etiqueta.Imprimir = function(modelo){\r\n\r\n            modelo = vm.Etiqueta.SELECT;\r\n\r\n            var dados = {\r\n                NOTA_FISCAL: vm.NOTA\r\n            };\r\n\r\n            String.prototype.replaceAll = String.prototype.replaceAll || function(needle, replacement) {\r\n                return this.split(needle).join(replacement);\r\n            };\r\n\r\n            $ajax.post('/_12100/DadosEtiqueta', dados)\r\n                .then(function(response) {\r\n\r\n                    var string = '';\r\n                    var script = modelo.SCRIPT;\r\n                    var produto_item = null;\r\n                    vm.Etiqueta.Dados = response;\r\n\r\n                    angular.forEach(vm.Etiqueta.Dados, function(nota, key) {\r\n\r\n                        produto_item = null;\r\n\r\n                        angular.forEach(vm.Etiqueta.NOTA, function(item, key) {\r\n                            if(item.ID == nota.ID && item.MARCADO == 1){\r\n                                produto_item = item;\r\n                            }\r\n                        });\r\n\r\n                        if(produto_item != null){\r\n\r\n                            if(nota.MULTIPLO       == 0){nota.MULTIPLO = 1;}\r\n                            if(nota.COTA_EMBALAGEM == 0){nota.COTA_EMBALAGEM = 1;}\r\n                            if(nota.COTA_EMBALAGEM == 0){nota.COTA_EMBALAGEM = 1;}\r\n\r\n                            nota.MULTIPLO       = Number(nota.MULTIPLO);\r\n                            nota.COTA_EMBALAGEM = Number(nota.COTA_EMBALAGEM);\r\n                            nota.PESO_BRUTO     = Number(nota.PESO_BRUTO);\r\n                            nota.PESO_LIQUIDO   = Number(nota.PESO_LIQUIDO);\r\n                            nota.QUANTIDADE     = Number(produto_item.VOLUMES1) * nota.COTA_EMBALAGEM;\r\n\r\n                            nota.QUANTIDADE_SUBEMBALAGEM = nota.COTA_EMBALAGEM  / nota.MULTIPLO;\r\n                            nota.VOLUMES                 = nota.QUANTIDADE      / nota.COTA_EMBALAGEM ; \r\n                            nota.PESO_BRUTO_VOLUME       = nota.PESO_BRUTO      / produto_item.VOLUMES2;\r\n                            nota.PESO_LIQUIDO_VOLUME     = nota.PESO_LIQUIDO    / produto_item.VOLUMES2;\r\n                            nota.VOLUMES2                = Number(produto_item.VOLUMES1) * (nota.VOLUMES2 / Number(produto_item.VOLUMES2));\r\n\r\n                            nota.MULTIPLO                = nota.MULTIPLO.toLocaleString('pt-BR');\r\n                            nota.COTA_EMBALAGEM          = nota.COTA_EMBALAGEM.toLocaleString('pt-BR');\r\n                            nota.PESO_BRUTO              = nota.PESO_BRUTO.toLocaleString('pt-BR');\r\n                            nota.PESO_LIQUIDO            = nota.PESO_LIQUIDO.toLocaleString('pt-BR');\r\n                            nota.QUANTIDADE              = nota.QUANTIDADE.toLocaleString('pt-BR');\r\n                            nota.VOLUMES                 = nota.VOLUMES.toLocaleString('pt-BR');\r\n                            nota.VOLUMES2                = nota.VOLUMES2.toLocaleString('pt-BR');\r\n                            nota.PESO_BRUTO_VOLUME       = nota.PESO_BRUTO_VOLUME.toLocaleString('pt-BR');\r\n                            nota.PESO_LIQUIDO_VOLUME     = nota.PESO_LIQUIDO_VOLUME.toLocaleString('pt-BR');\r\n                            nota.QUANTIDADE_SUBEMBALAGEM = nota.QUANTIDADE_SUBEMBALAGEM.toLocaleString('pt-BR');\r\n\r\n                            var str_temp = script + '';\r\n\r\n                            str_temp = str_temp.replaceAll('#NR_ETIQUETAS#',           '1');\r\n                            str_temp = str_temp.replaceAll('#NUMERO_NOTAFISCAL#',      nota.NUMERO_NOTAFISCAL);      \r\n                            str_temp = str_temp.replaceAll('#DATA_EMISSAO#',           nota.DATA_EMISSAO);\r\n                            str_temp = str_temp.replaceAll('#PEDIDO#',                 nota.PEDIDO);\r\n                            str_temp = str_temp.replaceAll('#PEDIDO_CLIENTE#',         nota.PEDIDO_CLIENTE);\r\n                            str_temp = str_temp.replaceAll('#PRODUTO_ID#',             nota.PRODUTO_ID);\r\n                            str_temp = str_temp.replaceAll('#MODELO_ID#',              nota.MODELO_ID);\r\n                            str_temp = str_temp.replaceAll('#MODELO_DESCRICAO#',       nota.MODELO_DESCRICAO);\r\n                            str_temp = str_temp.replaceAll('#DESCRICAO_NF#',           nota.DESCRICAO_NF);\r\n                            str_temp = str_temp.replaceAll('#COR_ID#',                 nota.COR_ID);\r\n                            str_temp = str_temp.replaceAll('#COR_DESCRICAO#',          nota.COR_DESCRICAO);\r\n                            str_temp = str_temp.replaceAll('#TAMANHO_ID#',             nota.TAMANHO_ID);\r\n                            str_temp = str_temp.replaceAll('#TAMANHO#',                nota.TAMANHO);\r\n                            str_temp = str_temp.replaceAll('#CODIGO_EDI#',             nota.CODIGO_EDI);\r\n                            str_temp = str_temp.replaceAll('#MULTIPLO#',               nota.MULTIPLO);\r\n                            str_temp = str_temp.replaceAll('#COTA_EMBALAGEM#',         nota.COTA_EMBALAGEM);\r\n                            str_temp = str_temp.replaceAll('#QUANTIDADE#',             nota.QUANTIDADE);\r\n                            str_temp = str_temp.replaceAll('#PESO_LIQUIDO#',           nota.PESO_LIQUIDO);\r\n                            str_temp = str_temp.replaceAll('#PESO_BRUTO#',             nota.PESO_BRUTO);\r\n                            str_temp = str_temp.replaceAll('#MEDIDAS#',                nota.MEDIDAS);\r\n                            str_temp = str_temp.replaceAll('#QUANTIDADE_SUBEMBALAGEM#',nota.QUANTIDADE_SUBEMBALAGEM);\r\n                            str_temp = str_temp.replaceAll('#VOLUMES#',                nota.VOLUMES);\r\n                            str_temp = str_temp.replaceAll('#PESO_BRUTO_VOLUME#',      nota.PESO_BRUTO_VOLUME);\r\n                            str_temp = str_temp.replaceAll('#PESO_LIQUIDO_VOLUME#',    nota.PESO_LIQUIDO_VOLUME);\r\n                            str_temp = str_temp.replaceAll('#VOLUMES_SUBEMBALAGEM#',   nota.VOLUMES2);\r\n\r\n                            string = string + str_temp;\r\n                        }\r\n                    });\r\n\r\n                    if(string != ''){\r\n                        postprint(string);\r\n                    }else{\r\n                        showErro('Sem dados para impressão');\r\n                    }\r\n                }\r\n            );\r\n        };\r\n\r\n        vm.Acoes = {\r\n            imprimir : function(){\r\n                var valido = true;\r\n                var cliente = '' ;\r\n                var representante = '' ;\r\n\r\n                if(vm.Consulta_Cliente.item.selected == true){\r\n                    cliente = 'Cli.: ' + vm.Consulta_Cliente.item.dados.ID + '-' + vm.Consulta_Cliente.item.dados.DESCRICAO + '    ' ;\r\n                }\r\n\r\n                if(vm.Consulta_Representante.item.selected == true){\r\n                    representante = 'Rep.: ' + vm.Consulta_Representante.item.dados.ID + '-' + vm.Consulta_Representante.item.dados.DESCRICAO + '    ' ;\r\n                }\r\n\r\n                var user = $('#usuario-descricao').val();\r\n                var filtro = cliente + representante + ' Data:' + moment(vm.DataInicio).format('L') +' a '+ moment(vm.DataFim).format('L');\r\n                printHtml('container-de-notas', 'Relatório de Notas Fiscais', filtro, user, '1.0.0',1,'');\r\n\r\n            },\r\n            export1 : function(){\r\n                exportTableToCsv('notas.csv', 'itens-de-notas');\r\n            },\r\n            export2 : function(){\r\n                exportTableToXls('notas.xls', 'tabela-de-notas');\r\n            },\r\n            ModalEtiqueta: function(){\r\n                var dados = {\r\n                    NOTA_FISCAL: vm.NOTA\r\n                };\r\n\r\n                $ajax.post('/_12100/modeloEtiqueta', dados)\r\n                    .then(function(response) {\r\n\r\n                        vm.Etiqueta.Modelos = response;\r\n\r\n                        vm.Etiqueta.NOTA = angular.copy(vm.NOTA.ITENS);\r\n\r\n                        console.log(vm.NOTA.ITENS);\r\n\r\n                        angular.forEach(vm.Etiqueta.NOTA, function(item, key) {\r\n                            item.MARCADO = 1;\r\n\r\n                            var qtd = (item.VOLUMES + '').replace(\".\", \"\");\r\n                            qtd = qtd.replace(\".\", \"\");\r\n                            qtd = qtd.replace(\",\", \".\");\r\n                            item.VOLUMES2 = Number(qtd);\r\n                            item.VOLUMES1 = Number(qtd);\r\n                        });\r\n\r\n                        $('#modal-etiqueta').modal();\r\n                    }\r\n                );\r\n            },\r\n            BaixarNota: function(){\r\n                var dados = {\r\n                    FILE: vm.NOTA.XML.BINARIO,\r\n                    NOME: vm.NOTA.XML.NOME,\r\n                    DIR : vm.NOTA.XML.DIR,\r\n                    CAMINHO : vm.NOTA.XML.CAMINHO\r\n                };\r\n\r\n                $ajax.post('/_12100/pdf', dados)\r\n                    .then(function(response) {\r\n                        vm.NOTA.PDF.NOME = '';\r\n                        vm.NOTA.PDF.VER  = true;\r\n                        $('.conteudoPDF').html(response);\r\n\r\n                        setTimeout(function(){\r\n                           var caminho = $('._caminhoPDF').val();\r\n                           $('.pdf-ver').find('.download-arquivo').attr('href', caminho );\r\n                        },300); \r\n                    }\r\n                );\r\n            },\r\n            BaixarXML: function(){\r\n\r\n            },\r\n            tratarPedidosNota: function(){\r\n                var cliente = vm.Consulta_Cliente.item.dados.ID;\r\n                var representante = vm.Consulta_Representante.item.dados.ID;\r\n                var link = '';\r\n\r\n                angular.forEach(vm.NOTAS, function(nota, key) {\r\n                    link = '';\r\n                    var pedidos = (nota.PEDIDO + '').split(\", \");\r\n                    var representante = nota.REPRESENTANTE_CODIGO\r\n                    var cliente = nota.CLIENTE_CODIGO\r\n\r\n                    angular.forEach(pedidos, function(pedido, index) {\r\n                        if(pedido > 0){\r\n                            link = link + '<a href=\"'+urlhost+'/_12040?pedidoId='+pedido+'&clienteId='+cliente+'&representanteId='+representante+'\" target=\"_blank\" >'+pedido+'</a>,';\r\n                        }\r\n                    });\r\n\r\n                    if(link.length > 0){\r\n                        nota.PEDIDO = link.substring(0, link.length -1);\r\n                    }\r\n                });\r\n                \r\n            },\r\n            tratarPedidosItens: function(){\r\n                var cliente = vm.Consulta_Cliente.item.dados.ID;\r\n                var representante = vm.Consulta_Representante.item.dados.ID;\r\n                var link = '';\r\n\r\n                angular.forEach(vm.NOTA.ITENS, function(nota, key) {\r\n                    link = '';\r\n                    var pedidos = (nota.PEDIDO + '').split(\", \");\r\n                    var representante = nota.REPRESENTANTE_CODIGO\r\n                    var cliente = nota.CLIENTE_CODIGO\r\n\r\n                    angular.forEach(pedidos, function(pedido, index) {\r\n                        if(pedido > 0){\r\n                            link = link + '<a href=\"'+urlhost+'/_12040?pedidoId='+pedido+'&clienteId='+cliente+'&representanteId='+representante+'\" target=\"_blank\" >'+pedido+'</a>,';\r\n                        }\r\n                    });\r\n\r\n                    if(link.length > 0){\r\n                        nota.PEDIDO = link.substring(0, link.length -1);\r\n                    }\r\n                });\r\n                \r\n            },\r\n            consultarNotas: function(flag){\r\n                var that = this;\r\n                var valido = 0;\r\n\r\n                if( vm.Consulta_Cliente.item.selected == false){\r\n                    //vm.Consulta_Cliente.setErro();\r\n                    //valido = 1;\r\n                }\r\n\r\n                if( vm.Consulta_Representante.item.selected == false){\r\n                    //vm.Consulta_Representante.setErro();\r\n                    //valido = 1\r\n                }\r\n\r\n                if(valido == 0){\r\n\r\n                    var dados = {\r\n                        DATA_NICIO: vm.DataInicio,\r\n                        DATA_FIM  : vm.DataFim,\r\n                        CLIENTE   : vm.Consulta_Cliente.item.dados.ID,\r\n                        NOTA      : vm.NUMERO_NOTA,\r\n                        SERIE     : vm.SERIE_NOTA,\r\n                        PEDIDO    : vm.PEDIDO,\r\n                        FLAG      : flag\r\n                    };\r\n\r\n                    $ajax.post('/_12100/consultarNotas', dados)\r\n                        .then(function(response) {\r\n                            vm.NOTAS =  response.RETORNO;\r\n\r\n                            that.listaFocus = 0;\r\n                            //vm.NUMERO_NOTA  = 0;\r\n                            //vm.SERIE_NOTA   = 0;\r\n                            //vm.PEDIDO       = 0;\r\n\r\n                            that.tratarPedidosNota();\r\n\r\n                            setTimeout(function(){\r\n\r\n                                var linhas = $('tr');\r\n\r\n                                if($(linhas).length > 1){\r\n                                    $(linhas[1]).focus();\r\n\r\n                                    if(response.RETORNO.length == 1){\r\n                                       var td = $(linhas[1]).find('td');\r\n                                        $(td[0]).trigger('click');\r\n                                    }\r\n                                }\r\n                                \r\n                            },300);     \r\n                        }\r\n                    );\r\n                }\r\n            },\r\n            abrirNota: function(nota,$event){\r\n\r\n                var that = this;\r\n\r\n                var dados = {\r\n                        ID : nota.ID\r\n                    };\r\n\r\n                $ajax.post('/_12100/consultarItens', dados)\r\n                    .then(function(response) {\r\n                        vm.NOTA.ITENS =  response.RETORNO;\r\n                        vm.NOTA.XML   =  response.XML;\r\n\r\n                        vm.NOTA.XML.VER = false;\r\n\r\n                        that.tratarPedidosItens();\r\n\r\n                        vm.NOTA.INFO  = angular.copy(nota);\r\n                        $('#modal-nota').modal();   \r\n                    },function(e){\r\n                        console.log(e);\r\n                    }\r\n                );\r\n\r\n            },\r\n\r\n            time  : null,\r\n            class : '.tabela-nota',\r\n            listaFocus: 0,\r\n            listaKeydown: function($event){\r\n                var that = this;\r\n\r\n                if($event.keyCode == 40){\r\n                    clearTimeout(that.time);\r\n                    var itens = $(that.class).find('.lista-itens');\r\n                    \r\n                    that.listaFocus = that.listaFocus + 1;\r\n\r\n                    if(itens.length >= that.listaFocus){\r\n                        $(itens[that.listaFocus - 1]).focus();\r\n                    }\r\n\r\n                    if(that.listaFocus > itens.length){\r\n                        that.listaFocus = itens.length;\r\n                    }                \r\n                }\r\n\r\n                if($event.keyCode == 38){\r\n                    var itens = $(that.class).find('.lista-itens');\r\n                    \r\n                    that.listaFocus = that.listaFocus - 1;\r\n\r\n                    if(itens.length >= that.listaFocus && that.listaFocus > 0){\r\n                        clearTimeout(that.time);\r\n                        $(itens[that.listaFocus - 1]).focus();\r\n                    }\r\n\r\n                    if(that.listaFocus < 0){\r\n\r\n                        that.listaFocus = 1;\r\n                    }         \r\n                }\r\n            },\r\n            keypress : function(nota, $event){\r\n                var that = this;\r\n                if($event.keyCode == 13){\r\n                   that.abrirNota(nota); \r\n                }\r\n            },\r\n            btnVoltar: function(){\r\n                $('#modal-nota').modal('hide');\r\n            }\r\n        };\r\n\r\n        function init(){\r\n\r\n            var representante = $('._representante').val();\r\n            var representante2= $('._representante2').val();\r\n            var cliente       = $('._cliente').val();\r\n            var nota          = $('._nota').val();\r\n            var serie         = $('._serie').val();\r\n            var pedido        = $('._pedido').val();\r\n\r\n            vm.NUMERO_NOTA = nota; \r\n            vm.SERIE_NOTA  = serie; \r\n            vm.PEDIDO      = pedido; \r\n\r\n            vm.Consulta_Representante.option.paran = {REPRESENTANTE_CODIGO : representante};\r\n            vm.Consulta_Cliente.option.paran = {CLIENTE_CODIGO : cliente};\r\n\r\n            if(representante > 0){\r\n                vm.Consulta_Representante.filtrar();\r\n            }else{\r\n                if(representante2 > 0){\r\n                    vm.Consulta_Representante.filtrar();\r\n                }\r\n            }\r\n\r\n            vm.Consulta_Cliente.onFilter = function(){\r\n                vm.Consulta_Cliente.option.paran = {CLIENTE_CODIGO : 0};\r\n            }\r\n\r\n            vm.Consulta_Representante.onFilter = function(){\r\n                vm.Consulta_Representante.option.paran = {REPRESENTANTE_CODIGO : 0};\r\n            }\r\n\r\n            vm.Consulta_Cliente.onSelect = function(){\r\n\r\n                if(representante > 0 && cliente > 0){\r\n                    vm.Acoes.consultarNotas(0);\r\n                }\r\n\r\n                vm.Consulta_Cliente.onSelect = function(){\r\n                    if(representante > 0 && cliente > 0){\r\n                        vm.Acoes.consultarNotas(1);\r\n                    }\r\n                };\r\n\r\n            };\r\n\r\n            vm.Consulta_Cliente.onClear = function(){\r\n                \r\n                var linhas = $('.notas-itens-linha');\r\n\r\n                if($(linhas).length > 0){\r\n                    $(linhas).each(function( index ) {\r\n                        $(this).remove();\r\n                    });\r\n                }\r\n\r\n            };\r\n\r\n        }\r\n\r\n        init();\r\n\t}\r\n      \r\n    "]}