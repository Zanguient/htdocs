{"version":3,"sources":["_12090.app.js","_12090.factory.empresa.js","_12090.factory.empresas.js","_12090.factory.filtro.js","_12090.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_12090.js","sourcesContent":["'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n        'gc-find',\n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils',\n        'infinite-scroll'\n\t])\n;\n     ","angular\n    .module('app')\n    .factory('Empresa', Empresa);\n    \n\n\tEmpresa.$inject = [\n        '$ajax',\n        '$q',\n        '$rootScope',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Empresa($ajax, $q, $rootScope, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Empresa(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Empresa = this; \n        \n        this.DADOS = [];\n        this.SELECTED = {};\n        this.ITENS = [];\n        this.ALTERANDO = false;\n        this.COTA_BACKUP = {};\n        \n        this.events();\n    }\n    \n    Empresa.prototype.consultar = function() {\n        \n        var that = this;\n        \n        return $q(function(resolve, reject){\n            $ajax.post('/_12090/api/empresa',that.SELECTED).then(function(response){\n\n                angular.extend(that.SELECTED, response);\n                \n                resolve(that.SELECTED);\n            },function(erro){\n                reject(erro);\n            });\n        });\n    };\n        \n    Empresa.prototype.open = function(empresa) {\n          \n        var that = this;\n        \n        this.consultar().then(function(){\n            \n            window.history.replaceState('', '', encodeURI(urlhost + '/_12090?EMPRESA_ID='+that.SELECTED.EMPRESA_ID));\n            \n            that.modalOpen(null,function(){\n                \n                window.history.replaceState('', '', encodeURI(urlhost + '/_12090'));\n                \n            });\n        },function(erro){\n            showErro('Ocorreu uma falha ao consultar as informações. ' + erro);\n        });\n    };    \n    \n    \n    Empresa.prototype.consultarModelosPreco = function() {\n        var that = this;\n    \n        $ajax.post('/_12090/api/modelos/preco',that.SELECTED).then(function(response){\n\n            if ( that.SELECTED.MODELOS_PRECO == undefined ) {\n                that.SELECTED.MODELOS_PRECO = [];\n            }\n            gcCollection.merge(that.SELECTED.MODELOS_PRECO,response,['TIPO','ID','TAMANHO']);\n            \n        });        \n    };    \n    \n    Empresa.prototype.empresaRepresentate = function() {\n        \n        var that = this;\n        \n        var ret = true;\n        \n        if ( gScope.REPRESENTANTE_ID > 0 ) {\n            if ( parseInt(that.SELECTED.REPRESENTANTE_ID) != parseInt(gScope.REPRESENTANTE_ID) ) {\n                ret = false;\n            }\n        }\n        \n        return ret;\n    };    \n    \n    Empresa.prototype.cancelar = function() {\n        \n        var that = this;\n        addConfirme('<h4>Confirmação</h4>',\n            'Deseja realmente cancelar esta operação?',\n            [obtn_sim,obtn_nao],\n            [{ret:1,func:function(){\n                $rootScope.$apply(function(){        \n        \n                    that.ALTERANDO = false;\n                    angular.extend(that.SELECTED, that.COTA_BACKUP);\n\n                });\n            }}]     \n        );      \n    };\n\n    Empresa.prototype.alterar = function() {\n        this.ALTERANDO = true;\n        angular.copy(this.SELECTED, this.COTA_BACKUP);\n    };\n    \n    Empresa.prototype.excluir = function() {\n        \n        var that = this;\n        \n        addConfirme('<h4>Confirmação</h4>',\n            'Deseja realmente excluir esta empresa?',\n            [obtn_sim,obtn_nao],\n            [{ret:1,func:function(){\n                $rootScope.$apply(function(){\n\n                    var dados = {\n                        DADOS : {\n                            ITENS : [that.SELECTED]\n                        },\n                        FILTRO : gScope.Filtro,\n                        FILTRO_COTA : that.SELECTED\n                    };\n\n                    $ajax.post('/_13030/api/empresa/delete',dados).then(function(response){\n\n                        gScope.Filtro.merge(response.DATA_RETURN.DADOS);\n                        angular.extend(that.SELECTED, response.DATA_RETURN.COTA);\n\n                        that.ModalClose();\n                    });\n\n                });\n            }}]     \n        );        \n        \n    };\n    \n    Empresa.prototype.dblPick = function(item,action) {\n        \n        var that = this;\n\n        if ( item != undefined ) {\n        \n            this.SELECTED = item;\n            \n            gScope.Filtro.COTA_ID = item.ID;\n            gScope.Filtro.COTA_OPEN = 1;\n            gScope.Filtro.uriHistory();\n            \n            that.consultar();\n            that.ModalShow(null,function(){   \n                that.ALTERANDO = false;\n                delete gScope.Filtro.COTA_OPEN;\n                gScope.Filtro.uriHistory();\n            });\n\n        }\n\n    };    \n\n    \n    Empresa.prototype.pick = function(empresa,setfocus) {\n        \n        var that = this;\n\n        if ( empresa != undefined ) {\n        \n            this.SELECTED = empresa;\n\n            gScope.Filtro.COTA_ID = empresa.ID;\n            gScope.Filtro.uriHistory();\n            \n            if ( setfocus ) {\n                that.setFocus();\n            }\n        }\n\n    };  \n    \n    var modal = $('#modal-empresa');\n    \n    Empresa.prototype.modalOpen = function(shown,hidden) {\n\n        modal\n            .modal('show')\n        ;                         \n        \n        if ( shown ) {\n            modal\n                .one('shown.bs.modal', function(){\n                    shown();\n                })\n            ;     \n        }\n        \n        if ( hidden ) {\n            modal\n                .one('hidden.bs.modal', function(){\n                    hidden();\n                })\n            ;              \n        }\n    };\n\n    Empresa.prototype.modalClose = function(hidden) {\n\n        modal\n            .modal('hide')\n        ;\n        \n        if ( hidden ) {\n            modal\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;                      \n        }\n    };\n    \n    Empresa.prototype.inputKeydown = function($event) {\n         \n        if ( this.PESO_AUTOMATICO ) {\n            if ( isNumber($event.key) || $event.key == 'Backspace' || $event.key == 'Delete' ) {\n                $event.preventDefault();\n            }\n        }\n    };\n    \n    Empresa.prototype.events = function($event) {\n        var that = this;\n        var cancel_bf_unload = false;\n        //\n        $(document).on('click','[type=\"submit\"]',function(e) {\n            var form = $(this).closest('form');\n            var action = $(form).attr('action') == undefined ? '' : $(form).attr('action');\n\n            if ( action != '' ) {\n                cancel_bf_unload = true;\n            }\n        });\n\n        var bf_load_timeout;\n\n        function warning() {\n            if ( that.ALTERANDO && cancel_bf_unload == false ) {\n                return 'oi';\n            }\n        }\n\n        function noTimeout() {\n            clearTimeout(bf_load_timeout);\n        }\n\n        window.onbeforeunload = warning;\n        window.unload = noTimeout;         \n         \n    };\n        \n    \n    /**\n     * Return the constructor function\n     */\n    return Empresa;\n};","angular\n    .module('app')\n    .factory('Empresas', Empresas);\n    \n\n\tEmpresas.$inject = [\n        '$ajax',\n        '$filter',\n        '$q',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Empresas($ajax, $filter, $q, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Empresas(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Empresas = this; \n          \n        this.AJAX_LOCKED = true;\n        this.DADOS = [];\n        this.SELECTED = {};\n        \n        this.CONF_PAGE = {\n            FIRST : 50,\n            SKIP: 0\n        };\n        \n        this.FILTRO = {\n            HABILITA_CLIENTE : '1',\n            STATUS : '1'\n        };\n        \n        this.CONSULTAS = [];\n        \n        this.events();\n    }\n    \n    Empresas.prototype.consultar = function(def_page) {\n        \n        var that = this;\n        \n        var options = {};\n        \n        if ( def_page ) {\n            angular.extend(that.FILTRO,that.CONF_PAGE);\n        } else {\n            options.progress = false;            \n        }\n        \n        that.AJAX_LOCKED = true;\n        var consulta = $ajax;\n                \n        that.CONSULTAS.push(consulta);\n        \n        return $q(function(resolve,reject){\n            consulta.post('/_12090/api/empresas',that.FILTRO,options).then(function(response){\n\n                that.merge(response,def_page);\n\n                if ( def_page ) {\n                    $('.table-ec').scrollTop(0);                \n                }\n\n                if ( response.length >= that.CONF_PAGE.FIRST ) {\n                    that.AJAX_LOCKED = false;\n                }\n                resolve(response);\n            },function(e){\n                reject(e);\n            });            \n        }); \n        \n        \n    };\n        \n    Empresas.prototype.getMoreData = function(empresa,setfocus) {\n        \n        this.FILTRO.SKIP   = this.FILTRO.SKIP || 0;\n        this.FILTRO.SKIP  += this.CONF_PAGE.FIRST;\n        this.FILTRO.FIRST  = this.CONF_PAGE.FIRST;\n        \n        this.consultar();\n    };   \n    \n    Empresas.prototype.merge = function(response,def_page) {\n        function isNumber(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        for ( var i in response ) {\n            var item = response[i];\n            \n            for (var k in item){\n                if (item.hasOwnProperty(k)) {\n                    \n                    if ( isNumber(item[k]) && (String(item[k]).substr(0, 1) !== '0' || String(item[k]).indexOf('.') !== -1) ) {               \n                        item[k] = parseFloat(item[k]);\n                    }\n                }\n            }            \n        }\n\n        response = $filter('orderBy')(response,'EMPRESA_RAZAO_SOCIAL');\n        \n        var preserve_main = def_page == true ? false : true;\n        gcCollection.merge(this.DADOS, response, 'EMPRESA_ID',preserve_main);     \n        \n        \n    };\n    \n    \n    \n    Empresas.prototype.emptyData = function(newvalue,oldvalue) {\n        \n        this.AJAX_LOCKED = true;\n\n        for ( var i in this.CONSULTAS ) {\n            var consulta = this.CONSULTAS[i];\n\n            consulta.abort();\n        }\n\n        this.CONSULTAS = [];\n\n        this.DADOS = [];\n    };     \n    \n    \n    \n    Empresas.prototype.virifyChange = function(newvalue,oldvalue) {\n        \n        if ( newvalue.toUpperCase() != oldvalue.toUpperCase() ) {\n            \n            this.emptyData();\n        }\n    };     \n\n    \n    Empresas.prototype.pick = function(empresa,setfocus) {\n        \n        \n        if ( this.SELECTED != empresa && empresa != undefined ) {\n            \n            this.SELECTED = empresa;\n            gScope.Empresa.SELECTED = this.SELECTED;\n\n            if ( setfocus ) {\n                this.setFocus();\n            }\n        }\n    };  \n\n         \n    \n    Empresas.prototype.dblPick = function(item,action) {\n        \n        var that = this;\n\n        if ( item != undefined ) {\n        \n            this.SELECTED = item;\n            \n            gScope.Filtro.COTA_ID = item.ID;\n            gScope.Filtro.COTA_OPEN = 1;\n            gScope.Filtro.uriHistory();\n            \n            that.consultar();\n            that.ModalShow(null,function(){   \n                that.ALTERANDO = false;\n                delete gScope.Filtro.COTA_OPEN;\n                gScope.Filtro.uriHistory();\n            });\n\n        }\n\n    };    \n\n    \n    var modal = $('#modal-empresa');\n    \n    Empresas.prototype.ModalShow = function(shown,hidden) {\n\n        modal\n            .modal('show')\n        ;                         \n        \n        if ( shown ) {\n            modal\n                .one('shown.bs.modal', function(){\n                    shown();\n                })\n            ;     \n        }\n        \n        if ( hidden ) {\n            modal\n                .one('hidden.bs.modal', function(){\n                    hidden();\n                })\n            ;              \n        }\n    };\n\n    Empresas.prototype.ModalClose = function(hidden) {\n\n        modal\n            .modal('hide')\n        ;\n        \n        if ( hidden ) {\n            modal\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;                      \n        }\n    };\n    \n    Empresas.prototype.inputKeydown = function($event) {\n         \n        if ( this.PESO_AUTOMATICO ) {\n            if ( isNumber($event.key) || $event.key == 'Backspace' || $event.key == 'Delete' ) {\n                $event.preventDefault();\n            }\n        }\n    };\n    \n    Empresas.prototype.events = function($event) {\n//        var that = this;\n//        var cancel_bf_unload = false;\n//        //\n//        $(document).on('click','[type=\"submit\"]',function(e) {\n//            var form = $(this).closest('form');\n//            var action = $(form).attr('action') == undefined ? '' : $(form).attr('action');\n//\n//            if ( action != '' ) {\n//                cancel_bf_unload = true;\n//            }\n//        });\n//\n//        var bf_load_timeout;\n//\n//        function warning() {\n//            if ( that.ALTERANDO && cancel_bf_unload == false ) {\n//                return 'oi';\n//            }\n//        }\n//\n//        function noTimeout() {\n//            clearTimeout(bf_load_timeout);\n//        }\n//\n//        window.onbeforeunload = warning;\n//        window.unload = noTimeout;         \n         \n    };\n        \n    \n    /**\n     * Return the constructor function\n     */\n    return Empresas;\n};","angular\n    .module('app')\n    .factory('Filtro', Filtro);\n    \n\n\tFiltro.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$rootScope',\n        '$timeout',\n        '$q',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Filtro($ajax, $httpParamSerializer, $rootScope, $timeout, $q, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Filtro(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n        \n//        this.DATA_1 = new Date(Clock.DATETIME_SERVER);\n//        this.DATA_2 = new Date(Clock.DATETIME_SERVER);\n\n\t\tgScope.Filtro = this; \n        \n    }\n    \n    Filtro.prototype.consultar = function(progress) {\n        \n        var that = this;\n        \n        return $q(function(resolve){\n    //        loading('.main-ctrl');     \n\n//            this.DATAHORA = {\n//                DATAHORA_1 : moment(this.DATA_1).format('YYYY.MM.DD 00:00:00'),\n//                DATAHORA_2 : moment(this.DATA_2).format('YYYY.MM.DD 23:59:59')\n//            };\n\n            $ajax.post('/_13030/api/cotas',that,{progress: progress == undefined ? false : progress}).then(function(response){\n\n                that.merge(response);\n                resolve(response);\n    //            loading('hide');\n\n            });\n        });\n    };\n   \n    \n    Filtro.prototype.merge = function(response) {\n        \n        function isNumber(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        for ( var i in response ) {\n            var item = response[i];\n            \n            for (var k in item){\n                if (item.hasOwnProperty(k)) {\n                    \n                    if ( isNumber(item[k]) && (String(item[k]).substr(0, 1) !== '0' || String(item[k]).indexOf('.') !== -1) ) {               \n                        item[k] = parseFloat(item[k]);\n                    }\n                }\n            }            \n        }\n\n        gcCollection.merge(gScope.Cota.DADOS, response, 'ID');      \n        \n        \n        \n        /**\n         * Vinculo dos ConsumoBaixadoProdutos - Incio\n         */\n        var periodos = gcCollection.groupBy(gScope.Cota.DADOS, [\n            'CCUSTO',\n            'CCUSTO_MASK',\n            'CCUSTO_DESCRICAO',\n            'MES',\n            'ANO',\n            'PERIODO_DESCRICAO'\n        ], 'CCONTABEIS',function(periodo,ccontabil){\n\n            periodo.VALOR     == undefined ? periodo.VALOR     = 0 : '';\n            periodo.EXTRA     == undefined ? periodo.EXTRA     = 0 : '';\n            periodo.TOTAL     == undefined ? periodo.TOTAL     = 0 : '';\n            periodo.OUTROS    == undefined ? periodo.OUTROS    = 0 : '';\n            periodo.UTIL      == undefined ? periodo.UTIL      = 0 : '';\n//            periodo.PERC_UTIL == undefined ? periodo.PERC_UTIL = 0 : '';\n            periodo.SALDO     == undefined ? periodo.SALDO     = 0 : '';\n\n            periodo.VALOR     += ccontabil.VALOR    ;\n            periodo.EXTRA     += ccontabil.EXTRA    ;\n            periodo.TOTAL     += ccontabil.TOTAL    ;\n            periodo.OUTROS    += ccontabil.OUTROS   ;\n            periodo.UTIL      += ccontabil.UTIL     ;\n//            periodo.PERC_UTIL += ccontabil.PERC_UTIL;\n            periodo.SALDO     += ccontabil.SALDO    ;        \n\n\n            if ( periodo.TOTAL > 0 ) {\n                periodo.PERC_UTIL = ((1-(periodo.SALDO/periodo.TOTAL))*100);\n            } else {\n                if ( periodo.TOTAL == 0 && periodo.SALDO < 0 ) {\n                    periodo.PERC_UTIL = 100;\n                } else {\n                    periodo.PERC_UTIL = 0;  \n                }\n            }\n\n//            if ( (periodo.VALOR + periodo.EXTRA) = 0 && periodo.SALDO )\n//            IIF(A.VALOR+A.EXTRA = 0 AND A.SALDO < 0, 100, 0))\n\n        });\n        \n        gcCollection.merge(gScope.CotaPeriodo.DADOS, periodos, ['CCUSTO','MES','ANO']);\n        \n        /////\n        \n        \n        /**\n         * Vinculo dos ConsumoBaixadoProdutos - Incio\n         */\n        var ccustos = gcCollection.groupBy(gScope.CotaPeriodo.DADOS, [\n            'CCUSTO',\n            'CCUSTO_MASK',\n            'CCUSTO_DESCRICAO'\n        ], 'PERIODOS',function(ccusto,periodo){\n\n            ccusto.VALOR     == undefined ? ccusto.VALOR     = 0 : '';\n            ccusto.EXTRA     == undefined ? ccusto.EXTRA     = 0 : '';\n            ccusto.TOTAL     == undefined ? ccusto.TOTAL     = 0 : '';\n            ccusto.OUTROS    == undefined ? ccusto.OUTROS    = 0 : '';\n            ccusto.UTIL      == undefined ? ccusto.UTIL      = 0 : '';\n//            ccusto.PERC_UTIL == undefined ? ccusto.PERC_UTIL = 0 : '';\n            ccusto.SALDO     == undefined ? ccusto.SALDO     = 0 : '';     \n\n            ccusto.VALOR     += periodo.VALOR    ;\n            ccusto.EXTRA     += periodo.EXTRA    ;\n            ccusto.TOTAL     += periodo.TOTAL    ;\n            ccusto.OUTROS    += periodo.OUTROS   ;\n            ccusto.UTIL      += periodo.UTIL     ;\n//            ccusto.PERC_UTIL += periodo.PERC_UTIL;\n            ccusto.SALDO     += periodo.SALDO    ;        \n\n            if ( ccusto.TOTAL > 0 ) {\n                ccusto.PERC_UTIL = ((1-(ccusto.SALDO/ccusto.TOTAL))*100);\n            } else {\n                if ( ccusto.TOTAL == 0 && ccusto.SALDO < 0 ) {\n                    ccusto.PERC_UTIL = 100;\n                } else {\n                    ccusto.PERC_UTIL = 0;  \n                }\n            }\n        });\n        \n        gcCollection.merge(gScope.CotaCcusto.DADOS, ccustos, ['CCUSTO','MES','ANO','CCONTABIL']);\n        \n        /////\n                \n        \n//        console.log(gScope.CotaCcusto.DADOS);\n    };\n    \n    Filtro.prototype.uriHistory = function() { \n        window.history.replaceState('', '', encodeURI(urlhost + '/_13030/ng?'+$httpParamSerializer(this)));        \n    };    \n\n    /**\n     * Return the constructor function\n     */\n    return Filtro;\n};","angular\n    .module('app')\n    .value('gScope', {\n        REPRESENTANTE_ID : $('#usuario-representante-id').first().val()\n    })\n    .controller('Ctrl', Ctrl);\n    \n    \n\tCtrl.$inject = [\n        '$scope',\n        '$timeout',\n        '$consulta',\n        'gScope',\n        'Filtro',\n        'Empresa',\n        'Empresas',\n        'Historico'\n    ];\n\n\tfunction Ctrl( \n        $scope, \n        $timeout, \n        $consulta,\n        gScope, \n        Filtro, \n        Empresa,\n        Empresas,\n        Historico\n    ) {\n\n\t\tvar vm = this;\n\n\t\tvm.Filtro     = new Filtro();\n\t\tvm.Empresa    = new Empresa();\n\t\tvm.Empresas   = new Empresas();\n\t\tvm.Historico  = new Historico();\n        vm.Consulta   = new $consulta();\n        \n        \n        loading('.main-ctrl');    \n        \n        var usuario_representante_id = gScope.REPRESENTANTE_ID;\n        \n        var representante_args = {\n            HABILITA_REPRESENTANTE: '1'\n        };\n        \n\n        if ( usuario_representante_id > 0 ) {\n            representante_args.EMPRESA_ID = usuario_representante_id;\n        }\n        \n        vm.ConsultaRepresentante                        = vm.Consulta.getNew(true);\n        vm.ConsultaRepresentante.componente             = '.consulta-representante';\n        vm.ConsultaRepresentante.model                  = 'vm.ConsultaRepresentante';\n        vm.ConsultaRepresentante.option.label_descricao = 'Representante:';\n        vm.ConsultaRepresentante.option.obj_consulta    = '/_12090/api/empresas';\n        vm.ConsultaRepresentante.option.tamanho_input   = 'input-maior';\n        vm.ConsultaRepresentante.option.campos_tabela   = [['EMPRESA_ID','ID'],['EMPRESA_CNPJ_MASK', 'CNPJ/CPF'],['EMPRESA_NOMEFANTASIA','Nome Fantasia'],['EMPRESA_RAZAO_SOCIAL','Razão Social'],['EMPRESA_UF','UF'],['EMPRESA_CIDADE','Cidade']];\n        vm.ConsultaRepresentante.option.obj_ret         = ['EMPRESA_CNPJ_MASK', 'EMPRESA_NOMEFANTASIA'];\n        vm.ConsultaRepresentante.option.required        = false;        \n        vm.ConsultaRepresentante.compile();\n        vm.ConsultaRepresentante.setDataRequest(representante_args);\n        gScope.ConsultaRepresentante = vm.ConsultaRepresentante;\n        \n        \n        if ( usuario_representante_id > 0 ) {\n            vm.ConsultaRepresentante.Input.disabled             = true;\n            vm.ConsultaRepresentante.btn_apagar_filtro.disabled = true;\n            vm.ConsultaRepresentante.filtrar();\n\n        } else {\n            vm.Empresas.consultar(true).then(function(){\n                loading('hide');\n            });        \n        }\n        \n\n        vm.ConsultaRepresentante.onSelect = function(){\n\n            vm.Empresas.emptyData();                \n            \n            vm.Empresas.FILTRO.REPRESENTANTE_ID = vm.ConsultaRepresentante.EMPRESA_ID;\n\n            if ( usuario_representante_id > 0 ) {\n                vm.ConsultaRepresentante.btn_apagar_filtro.disabled = true;\n                vm.Empresas.consultar(true).then(function(){\n                    loading('hide');\n                });                \n            } \n        };\n\n        vm.ConsultaRepresentante.onClear = function (){\n            \n            delete vm.Empresas.FILTRO.REPRESENTANTE_ID;\n            \n            vm.Empresas.emptyData();    \n        };\n\n        vm.export1 = function(tabela,nome){\n            exportTableToCsv(nome, tabela);\n        };\n\n        vm.export2 = function(tabela,nome){\n            exportTableToXls(nome, tabela);\n        };\n\n        vm.export3 = function(div,descricao){\n            var user = $('#usuario-descricao').val();\n            var filtro = '' + vm.Empresa.MODELO_PRECO_FILTRO;\n            printPDF('preco_modelos',div, 'Preço por Modelo - ' + descricao, filtro, user, '1.0.0',1,'');\n        };\n\n        vm.Imprimir = function(div,descricao){\n            var user = $('#usuario-descricao').val();\n            var filtro = '' + vm.Empresa.MODELO_PRECO_FILTRO;\n            printHtml(div, 'Preço por Modelo - ' + descricao, filtro, user, '1.0.0',1,'');\n        }           \n        \n        \n        $timeout(function(){\n            if ( vm.Empresa.SELECTED.EMPRESA_ID > 0 ) {\n                vm.Empresa.open();\n            }\n        });\n\n//        $timeout(function(){\n//            vm.Filtro.consultar().then(function(){\n//\n//                loading('hide');\n//                $timeout(function(){\n//                    if ( vm.Filtro.COTA_ID > 0 ) {\n//                        var cota = $('[data-cota-id=\"' + vm.Filtro.COTA_ID + '\"]:focusable');\n//\n//                        cota.focus();\n//\n//                        $timeout(function(){\n//                            if ( vm.Filtro.COTA_OPEN == 1 && gScope.Cota.SELECTED.ID != undefined ) {\n//                                vm.Cota.dblPick(vm.Cota.SELECTED);\n//                            }\n//                        },100);\n//                    }\n//                },50);\n//\n//            });\n//\n//        },50);\n//        \n\t}   \n  "]}