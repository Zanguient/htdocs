{"version":3,"sources":["_12040.app.js","_12040-pedido-index.component.js","_12040-pedido-index.service.js","_12040-pedido-index.controller.js","_12060-consultar.component.js","_12060-consultar.service.js","_12060-consultar.controller.js","_12070-por-representante.component.js","_12070-por-representante.service.js","_12070-por-representante.controller.js","_12040-pedido-create.component.js","_12040-pedido-create.service.js","_12040-pedido-create.controller.js","_12040-info-geral.component.js","_12040-info-geral.service.js","_12040-info-geral.controller.js","_12040-pedido-item-escolhido.component.js","_12040-pedido-item-escolhido.service.js","_12040-pedido-item-escolhido.controller.js","_12040-pedido-item.component.js","_12040-pedido-item.service.js","_12040-pedido-item.controller.js","_27020-por-cliente.component.js","_27020-por-cliente.service.js","_27020-por-cliente.controller.js","_27030-por-modelo.component.js","_27030-por-modelo.service.js","_27030-por-modelo.controller.js","_27050-por-modelo-e-cor.service.js","_27030-consultar-cor.component.js","_27030-consultar-cor.service.js","_27030-consultar-cor.controller.js","_12040-liberacao.component.js","_12040-liberacao.service.js","_12040-liberacao.controller.js","chat.component.js","chat.service.js","chat.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/eA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACznBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_12040.js","sourcesContent":["/**\n * _12040 - Registro de Pedidos\n */\n'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-find'\n\t])\n;","\t\t\r\nangular\r\n\t.module('app')\r\n\t.service('PedidoIndexService', PedidoIndexService)\r\n\t.controller('PedidoIndexController', PedidoIndexController)\r\n\t.component('pedidoIndex12040', {\r\n\t\ttemplateUrl: '/_12040/viewPedidoIndex',\r\n\t\tcontroller: 'PedidoIndexController'\r\n\t})\r\n;","\r\n    PedidoIndexService.$inject = ['$ajax', '$filter'];\r\n\r\n    function PedidoIndexService($ajax, $filter) {\r\n\r\n    \t// MÉTODOS (REFERÊNCIAS)\r\n        this.verificarUsuarioEhRepresentante    = verificarUsuarioEhRepresentante;\r\n        this.consultarRepresentanteDoCliente    = consultarRepresentanteDoCliente;\r\n        this.consultarPedido                    = consultarPedido;\r\n        this.consultarPedido2                   = consultarPedido2;\r\n    \tthis.consultarPedidoItem                = consultarPedidoItem;\r\n\r\n\r\n    \t// MÉTODOS\r\n\r\n    \t/**\r\n         * Verificar se usuário é representante.\r\n         */\r\n        function verificarUsuarioEhRepresentante() {\r\n\r\n            var url = '/_12040/verificarUsuarioEhRepresentante';\r\n\r\n            return $ajax.post(url, null, {contentType: 'application/json'});\r\n\r\n        }\r\n\r\n        /**\r\n         * Consultar representante do cliente.\r\n         */\r\n        function consultarRepresentanteDoCliente() {\r\n\r\n            var url = '/_12040/consultarRepresentanteDoCliente';\r\n\r\n            return $ajax.post(url, null, {contentType: 'application/json'});\r\n\r\n        }\r\n\r\n        /**\r\n         * Consultar pedido.\r\n         */\r\n        function consultarPedido(filtro) {\r\n\r\n            var url = '/_12040/consultarPedido';\r\n\r\n            return $ajax.post(url, JSON.stringify(filtro), {contentType: 'application/json'});\r\n\r\n        }\r\n\r\n        /**\r\n         * Consultar pedido.\r\n         */\r\n        function consultarPedido2(filtro) {\r\n\r\n            var url = '/_12040/consultarPedido2';\r\n\r\n            return $ajax.post(url, JSON.stringify(filtro), {contentType: 'application/json'});\r\n\r\n        }\r\n\r\n        /**\r\n         * Consultar item de pedido.\r\n         */\r\n        function consultarPedidoItem(filtro) {\r\n\r\n            var url = '/_12040/consultarPedidoItem';\r\n\r\n            return $ajax.post(url, JSON.stringify(filtro), {contentType: 'application/json'});\r\n\r\n        }\r\n\r\n\t}\r\n","\r\n\tPedidoIndexController.$inject = ['PedidoIndexService', '$scope', '$timeout', '$q'];\r\n\r\n\tfunction PedidoIndexController(PedidoIndexService, $scope, $timeout, $q) {\r\n\r\n\t\tvar ctrl = this;\r\n\r\n\t\t// MÉTODOS (REFERÊNCIAS).\r\n\t\tctrl.verificarUsuarioEhRepresentante \t= verificarUsuarioEhRepresentante;\r\n\t\tctrl.consultarRepresentanteDoCliente \t= consultarRepresentanteDoCliente;\r\n\t\tctrl.alterarRepresentante \t\t\t\t= alterarRepresentante;\r\n\t\tctrl.alterarCliente\t\t \t\t\t\t= alterarCliente;\r\n\t\tctrl.consultarPedido \t\t\t\t\t= consultarPedido;\r\n\t\tctrl.consultarPedidoPorUrl\t\t\t\t= consultarPedidoPorUrl;\r\n\t\tctrl.exibirPedido \t \t\t\t\t\t= exibirPedido;\r\n\t\tctrl.ativarIncluir \t\t\t\t\t\t= ativarIncluir;\r\n\t\tctrl.ativarLiberacao\t\t\t\t\t= ativarLiberacao;\r\n\t\tctrl.limparTelaEdit\t \t\t\t\t\t= limparTelaEdit;\r\n\t\tctrl.fecharModal  \t \t\t\t\t\t= fecharModal;\r\n\t\tctrl.export = exportDados;\r\n\r\n\t\t// VARIÁVEIS\r\n\t\tctrl.dataIni \t\t\t= moment().subtract(1, \"month\").toDate();\r\n\t\tctrl.dataFim \t\t\t= moment().toDate();\r\n\t\tctrl.tipoTela \t\t\t= 'incluir';\r\n\t\tctrl.situacaoPedido \t= '0';\t\t// Situação do pedido (confirmado ou não)\r\n\t\tctrl.representanteId \t= null;\r\n\t\tctrl.represDoCliente \t= null;\r\n\t\tctrl.pedidoIdUrl        = '';\r\n\t\tctrl.pedidoCliente      = '';\r\n\t\tctrl.faturado           = true;\r\n\t\tctrl.tipo_data          = 1;\r\n\r\n\t\tthis.$onInit = function() {\r\n\r\n\t\t\tctrl.verificarUsuarioEhRepresentante();\r\n\t\t\tctrl.consultarRepresentanteDoCliente();\r\n\r\n\t\t\t// representanteId=3495&clienteId=2309&pedidoId=166223\r\n\t\t\t// ids para filtro na url são utilizados em 12060 e 12070\r\n\t\t\tctrl.pedidoIdUrl = parseInt(getURLParameter('pedidoId'));\r\n\t\t};\r\n\r\n\r\n\r\n\t\t// MÉTODOS\r\n\r\n\t\t/**\r\n\t\t * Verificar se o usuário é um representante.\r\n\t\t */\r\n\t\tfunction verificarUsuarioEhRepresentante() {\r\n\r\n\t\t\tPedidoIndexService\r\n\t\t\t\t.verificarUsuarioEhRepresentante()\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tctrl.representanteId = response.length === 0 ? null : response[0].REPRESENTANTE_CODIGO;\r\n\t\t\t\t})\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Consultar representante do cliente.\r\n\t\t */\r\n\t\tfunction consultarRepresentanteDoCliente() {\r\n\r\n\t\t\tPedidoIndexService\r\n\t\t\t\t.consultarRepresentanteDoCliente()\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tctrl.represDoCliente = response.length === 0 ? null : response[0].REPRESENTANTE_CODIGO;\r\n\t\t\t\t})\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Alterar representante.\r\n\t\t */\r\n\t\tfunction alterarRepresentante() {\r\n\r\n\t\t\tctrl.pedido = null;\r\n\t\t\tctrl.filtroCliente.cliente = null;\r\n\t\t\tctrl.filtro.consultarRepresentante();\r\n\t\t\t$('#modal-consultar-representante').modal('show');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Alterar cliente.\r\n\t\t */\r\n\t\tfunction alterarCliente() {\r\n\r\n\t\t\tctrl.pedido = null;\r\n\r\n\t\t\t// Se o usuário não é um representante e não foi escolhido um representante para a filtragem.\r\n\t\t\tif (ctrl.representanteId === null && ctrl.filtro.representante === undefined)\r\n\t\t\t\tshowErro('Selecione um representante.');\r\n\t\t\telse {\r\n\t\t\t\tctrl.filtroCliente.consultarClientePorRepresentante();\r\n\t\t\t\t$('#modal-por-representante').modal('show');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Consultar pedidos.\r\n\t\t */\r\n\t\tfunction consultarPedido() {\r\n           var filtro = {\r\n                    filtro : {\r\n                        REPRESENTANTE   : (ctrl.filtro.representante  !== undefined && ctrl.filtro.representante  !== null) ? ctrl.filtro.representante.CODIGO  : 0,\r\n                        CLIENTE_ID\t\t: (ctrl.filtroCliente.cliente !== undefined && ctrl.filtroCliente.cliente !== null) ? ctrl.filtroCliente.cliente.CODIGO : 0,\r\n                        PEDIDO\t\t\t: ctrl.pedidoIdUrl,\r\n                        PEDIDO_CLIENTE\t: ctrl.pedidoCliente,\r\n                        FATURADO    \t: ctrl.faturado,\r\n                        TIPO_DATA       : ctrl.tipo_data,\r\n                        DATA_INI \t\t: moment(ctrl.dataIni).format('DD.MM.YYYY'),\r\n                        DATA_FIM \t\t: moment(ctrl.dataFim).format('DD.MM.YYYY')\r\n                    }\r\n                };\r\n                \r\n            return $q(function(resolve,reject){\r\n     \r\n\r\n                PedidoIndexService\r\n                    .consultarPedido(filtro)\r\n                    .then(function(response) {\r\n                        ctrl.pedido = response;\r\n                \r\n                        resolve(response);\r\n                    \r\n                },function(err){\r\n                    reject(err);\r\n                });\r\n            });\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Consultar pedido por parâmetros da url.\r\n\t\t */\r\n\t\tfunction consultarPedidoPorUrl() {\r\n\r\n\t\t\tvar filtro = {\r\n\t\t\t\tfiltro : {\r\n\t\t\t\t\tCLIENTE_ID\t: ctrl.filtroCliente.cliente.CODIGO,\r\n\t\t\t\t\tPEDIDO\t\t: ctrl.pedidoIdUrl,\r\n\t\t\t\t\tDATA_INI \t: null,\r\n\t\t\t\t\tDATA_FIM \t: null\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tPedidoIndexService\r\n\t\t\t\t.consultarPedido(filtro)\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tctrl.pedido = response;\r\n\t\t\t\t\tctrl.exibirPedido(ctrl.pedido[0]);\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction exportDados(tipo) {\r\n\r\n\t\t\tvar dados = [];\r\n\r\n\t\t\tvar filtro = {\r\n\t\t\t\tfiltro : {\r\n\t\t\t\t\tREPRESENTANTE   : (ctrl.filtro.representante  !== undefined && ctrl.filtro.representante  !== null) ? ctrl.filtro.representante.CODIGO  : 0,\r\n\t\t\t\t\tCLIENTE_ID\t\t: (ctrl.filtroCliente.cliente !== undefined && ctrl.filtroCliente.cliente !== null) ? ctrl.filtroCliente.cliente.CODIGO : 0,\r\n\t\t\t\t\tPEDIDO\t\t\t: ctrl.pedidoIdUrl,\r\n\t\t\t\t\tPEDIDO_CLIENTE\t: ctrl.pedidoCliente,\r\n\t\t\t\t\tFATURADO    \t: ctrl.faturado,\r\n\t\t\t\t\tTIPO_DATA       : ctrl.tipo_data,\r\n\t\t\t\t\tDATA_INI \t\t: moment(ctrl.dataIni).format('DD.MM.YYYY'),\r\n\t\t\t\t\tDATA_FIM \t\t: moment(ctrl.dataFim).format('DD.MM.YYYY')\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tPedidoIndexService\r\n\t\t\t\t.consultarPedido2(filtro)\r\n\t\t\t\t.then(function(response) {\r\n\t\t\t\t\tdados = response;\r\n\r\n\t\t\t\t\tvar coll = [\r\n\t\t\t            {COLUNA: 'PEDIDO', \t\t\t\tDESCRICAO:'Pedido', \t\tTIPO: 'INTEIRO' },\r\n\t\t\t\t\t\t{COLUNA: 'NFS', \t\t\t\tDESCRICAO:'N. Fiscal', \t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'PEDIDO_CLIENTE', \t\tDESCRICAO:'Ped. Cli.', \t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'CLIENTE_RAZAOSOCIAL', DESCRICAO:'Cliente', \t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'TIPO', \t\t\t\tDESCRICAO:'Tipo', \t\t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'DATA', \t\t\t\tDESCRICAO:'Dt. Emissão', \tTIPO: 'DATA'    },\r\n\t\t\t\t\t\t{COLUNA: 'DATA_CLIENTE', \t\tDESCRICAO:'Dt. Cliente', \tTIPO: 'DATA'    },\r\n\t\t\t\t\t\t{COLUNA: 'PROGRAMADO', \t\t\tDESCRICAO:'Prog.?', \t\tTIPO: 'INTEIRO' },\r\n\t\t\t\t\t\t{COLUNA: 'FORMA_ANALISE', \t\tDESCRICAO:'Form. Analise', \tTIPO: 'INTEIRO' },\r\n\t\t\t\t\t\t{COLUNA: 'SITUACAO', \t\t\tDESCRICAO:'Situação', \t\tTIPO: 'INTEIRO' },\r\n\t\t\t\t\t\t{COLUNA: 'QUANTIDADE_TOTAL', \tDESCRICAO:'Qtd.  Tot.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'FATURADO', \t\t\tDESCRICAO:'Faturado Tot.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'SALDO_FATURAR', \t\tDESCRICAO:'Saldo Tot.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'PRODUZIR', \t\t\tDESCRICAO:'A Prod. Tot.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'EMPRODUCAO', \t\t\tDESCRICAO:'Em Prod. Tot.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'ALOCADO', \t\t\tDESCRICAO:'Alocado Tot.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'ENCERRADO', \t\t\tDESCRICAO:'Encerrado Tot.', TIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'VALOR_ST', \t\t\tDESCRICAO:'Valor ST  Tot.', TIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'VALOR_TOTAL', \t\tDESCRICAO:'Valor  Tot.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'MODELO', \t\t\t\tDESCRICAO:'Modelo', \t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'OBSERVACAO', \t\t\tDESCRICAO:'Observação', \tTIPO: 'STRING'  },\r\n\r\n\t\t\t\t\t\t{COLUNA: 'SEQUENCIA', \t\t\tDESCRICAO:'Seq.', \t\t\tTIPO: 'INTEIRO' },\r\n\t\t\t\t\t\t{COLUNA: 'PRODUTO_CODIGO', \t \tDESCRICAO:'Pord. ID', \t\tTIPO: 'INTEIRO' },\r\n\t\t\t\t\t\t{COLUNA: 'PRODUTO_DESCRICAO',\tDESCRICAO:'Produto', \t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'PERFIL_DESCRICAO', \tDESCRICAO:'Perfil', \t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'TAMANHO_DESCRICAO',\tDESCRICAO:'Tam.', \t\t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'QUANTIDADE', \t\t\tDESCRICAO:'Qtd.', \t\t\tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'FATURADO2', \t\t\tDESCRICAO:'Faturado', \t\tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'SALDO_FATURAR2', \t\tDESCRICAO:'Saldo', \t\t\tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'PRODUZIR2', \t\t\tDESCRICAO:'A Produzir', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'EMPRODUCAO2', \t\tDESCRICAO:'Em Produção',\tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'ALOCADO2', \t\t\tDESCRICAO:'Alocado', \t\tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'ENCERRADO2', \t\t\tDESCRICAO:'Encerrado', \t\tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'VALOR_SBT', \t\t\tDESCRICAO:'Valor ST', \t\tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'PRODUTO_UM', \t\t\tDESCRICAO:'UM', \t\t\tTIPO: 'STRING'  },\r\n\t\t\t\t\t\t{COLUNA: 'VALOR', \t\t\t\tDESCRICAO:'Vlr. Unit.', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'TOTAL_ITEM', \t\t\tDESCRICAO:'Valor Total', \tTIPO: 'NUMERICO'},\r\n\t\t\t\t\t\t{COLUNA: 'DATA_CLIENTE2', \t\tDESCRICAO:'Prev. Fat.', \tTIPO: 'STRING'  },\r\n\t\t\t        ];\r\n\r\n\t\t\t        if(tipo == 1){\r\n\t\t\t\t\t\texportToXls('Pedidos.xls', dados, coll);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\texportToCsv('Pedidos.csv', dados, coll);\t\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t;\r\n\r\n\t\t\t\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Exibir pedido.\r\n\t\t */\r\n\t\tfunction exibirPedido(pedido) {\r\n\r\n\t\t\tvar pedidoItem = {};\r\n\r\n//\t\t\t$('#detalhe-cliente-toggle').click();\t// exibir 'mais informações'.\r\n\t\t\tctrl.tipoTela = 'exibir';\r\n\t\t\tctrl.situacaoPedido = pedido.SITUACAO;\r\n\t\t\tctrl.limparTelaEdit();\r\n\r\n\t\t\tfunction consultarPedidoItem(pedido) {\r\n\r\n                return $q(function(resolve,reject){\r\n                    var filtro = {\r\n                        filtro: {\r\n                            PEDIDO \t: pedido.PEDIDO,\r\n                            CHAVE \t: pedido.CHAVE_LIBERACAO,\r\n                            OBJ     : pedido\r\n                        }\r\n                    };\r\n\r\n                    PedidoIndexService\r\n                        .consultarPedidoItem(filtro)\r\n                        .then(function(response) {\r\n\r\n                            pedidoItem = response;\r\n                            carregarInfoGeral();\r\n                            carregarPedidoItem();\r\n                            exibirModal();\r\n                            \r\n                            resolve(response);\r\n                            \r\n                        },function(err){\r\n                            reject(err);\r\n                        })\r\n                    ;\r\n                });\r\n\t\t\t}\r\n\r\n\t\t\tfunction carregarInfoGeral() {\r\n\r\n\t\t\t\tvar infoGeral = ctrl.infoGeral.infoGeral;\r\n\r\n\t\t\t\tinfoGeral.PEDIDO \t\t\t\t\t= pedido.PEDIDO;\r\n\t\t\t\tinfoGeral.RAZAOSOCIAL\t\t\t\t= pedido.CLIENTE_RAZAOSOCIAL;\r\n\t\t\t\tinfoGeral.REPRESENTANTE_CODIGO\t\t= pedido.REPRESENTANTE_CODIGO;\r\n\t\t\t\tinfoGeral.CLIENTE_CODIGO\t\t\t= pedido.CLIENTE_CODIGO;\r\n\t\t\t\tinfoGeral.REPRESENTANTE_DESCRICAO\t= pedido.REPRESENTANTE_DESCRICAO;\r\n\t\t\t\tinfoGeral.PROGRAMADO\t\t\t\t= pedido.PROGRAMADO;\r\n\t\t\t\tinfoGeral.NFS\t\t\t\t        = pedido.NFS;\r\n\t\t\t\t\r\n\t\t\t\t// if (pedido.PROGRAMADO == '1') {\r\n\r\n\t\t\t\t\tinfoGeral.DATA_CLIENTE\t\t= moment(pedido.DATA_CLIENTE).toDate();\r\n\t\t\t\t\t\r\n\t\t\t\t\tinfoGeral.DATA_MIN_CLIENTE\t= (pedido.DATA_CLIENTE != undefined) \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? moment(pedido.DATA_CLIENTE).format('YYYY-MM-DD')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: moment().add(1, \"month\").format('YYYY-MM-DD');\r\n\t\t\t\t// }\r\n\t\t\t\t// else {\r\n\r\n\t\t\t\t// \tinfoGeral.DATA_CLIENTE \t\t= '';\r\n\t\t\t\t// \tinfoGeral.DATA_MIN_CLIENTE \t= '';\r\n\t\t\t\t// }\r\n\r\n\t\t\t\tinfoGeral.PEDIDO_CLIENTE \t\t\t\t= pedido.PEDIDO_CLIENTE;\r\n\t\t\t\tinfoGeral.OBSERVACAO \t\t\t\t\t= pedido.OBSERVACAO;\r\n\t\t\t\tinfoGeral.EMAIL_XML \t\t\t\t\t= pedido.EMAIL_XML;\r\n\t\t\t\tinfoGeral.TRANSPORTADORA_CODIGO  \t\t= pedido.TRANSPORTADORA_CODIGO;\r\n\t\t\t\tinfoGeral.TRANSPORTADORA_DESCRICAO \t\t= pedido.TRANSPORTADORA_DESCRICAO;\r\n\t\t\t\tinfoGeral.FRETE \t\t\t \t\t\t= pedido.FRETE;\r\n\t\t\t\tinfoGeral.FRETE_DESCRICAO \t\t\t\t= pedido.FRETE_DESCRICAO;\r\n\t\t\t\tinfoGeral.PAGAMENTO_FORMA \t\t\t\t= pedido.PAGAMENTO_FORMA;\r\n\t\t\t\tinfoGeral.PAGAMENTO_FORMA_DESCRICAO \t= pedido.PAGAMENTO_FORMA_DESCRICAO;\r\n\t\t\t\tinfoGeral.PAGAMENTO_CONDICAO \t\t\t= pedido.PAGAMENTO_CONDICAO;\r\n\t\t\t\tinfoGeral.PAGAMENTO_CONDICAO_DESCRICAO\t= pedido.PAGAMENTO_CONDICAO_DESCRICAO;\r\n\t\t\t\tinfoGeral.FORMA_ANALISE\t\t\t\t\t= pedido.FORMA_ANALISE;\r\n\t\t\t\tinfoGeral.CHAVE \t\t\t\t\t\t= pedido.CHAVE_LIBERACAO;\r\n\r\n\t\t\t\tinfoGeral.CNPJ \t\t\t\t\t\t\t= pedido.CNPJ;\r\n\t\t\t\tinfoGeral.IE \t\t\t\t\t\t\t= pedido.IE;\r\n\t\t\t\tinfoGeral.CIDADE \t\t\t\t\t\t= pedido.CIDADE;\r\n\t\t\t\tinfoGeral.BAIRRO\t\t\t\t\t\t= pedido.BAIRRO;\r\n\t\t\t\tinfoGeral.EMAIL\t\t\t\t\t\t\t= pedido.EMAIL;\r\n\t\t\t\tinfoGeral.FONE \t\t\t\t\t\t\t= pedido.FONE;\r\n\t\t\t\tinfoGeral.FAX \t\t\t\t\t\t\t= pedido.FAX;\r\n\t\t\t\tinfoGeral.NUMERO \t\t\t\t\t\t= pedido.NUMERO;\r\n\t\t\t\tinfoGeral.ENDERECO\t\t\t\t\t\t= pedido.ENDERECO;\r\n\t\t\t\tinfoGeral.CEP\t\t\t\t\t\t    = pedido.CEP;\r\n\t\t\t\tinfoGeral.VALOR_FRETE                   = pedido.VALOR_FRETE;\r\n\t\t\t\tinfoGeral.MENSAGEM\t\t\t\t\t\t= pedido.MENSAGEM;\r\n\t\t\t\tinfoGeral.PREVFAT \t\t\t\t\t\t= pedido.PREVFAT;\r\n\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction carregarPedidoItem() {\r\n\r\n\t\t\t\tvar item \t= {},\r\n\t\t\t\t\tmodelo \t= {},\r\n\t\t\t\t\tproduto\t= {},\r\n\t\t\t\t\tcor \t= {},\r\n\t\t\t\t\tvalor \t= 0,\r\n\t\t\t\t\tqtd \t= 0\r\n\t\t\t\t;\r\n\r\n\t\t\t\tfor (var i in pedidoItem) {\r\n\r\n\t\t\t\t\titem \t= pedidoItem[i];\r\n\t\t\t\t\tmodelo \t= {};\r\n\t\t\t\t\tproduto\t= {};\r\n\t\t\t\t\tcor \t= {};\r\n\r\n\t\t\t\t\tmodelo.MODELO_CODIGO\t= item.MODELO_CODIGO;\r\n\t\t\t\t\tmodelo.MODELO_DESCRICAO\t= item.MODELO_DESCRICAO;\r\n\t\t\t\t\tmodelo.FAMILIA_CODIGO \t= item.FAMILIA_CODIGO;\r\n\t\t\t\t\tproduto.CODIGO \t\t\t= item.PRODUTO_CODIGO;\r\n\t\t\t\t\tproduto.DESCRICAO \t\t= item.PRODUTO_DESCRICAO;\r\n\t\t\t\t\tproduto.UM \t\t\t\t= item.PRODUTO_UM;\r\n\t\t\t\t\tcor.CODIGO \t\t\t\t= item.COR_ID;\r\n\t\t\t\t\tcor.DESCRICAO \t\t\t= item.COR_DESCRICAO;\r\n\r\n\t\t\t\t\tqtd \t= parseFloat(item.QUANTIDADE);\r\n\t\t\t\t\tvalor \t= parseFloat(item.VALOR);\r\n\r\n\t\t\t\t\tctrl.pedidoItemEscolhido.pedidoItemEscolhido.push({\r\n\t\t\t\t\t\tsequencia \t\t: item.SEQUENCIA,\r\n\t\t\t\t\t\tmodelo \t \t\t: modelo,\r\n\t\t\t\t\t\tproduto \t\t: produto,\r\n\t\t\t\t\t\tcor \t\t\t: cor,\r\n\t\t\t\t\t\ttamanhoId\t\t: item.TAMANHO,\r\n\t\t\t\t\t\ttamanhoDescricao: item.TAMANHO_DESCRICAO,\r\n\t\t\t\t\t\tvalor_st        : item.VALOR_SBT,\r\n\t\t\t\t\t\tquantidade \t\t: qtd,\r\n\t\t\t\t\t\tvalorUnitario\t: valor,\r\n\t\t\t\t\t\tvalorTotal\t\t: valor * qtd,\r\n\t\t\t\t\t\tperfilId \t\t: item.PERFIL,\r\n\t\t\t\t\t\tperfilDescricao\t: item.PERFIL_DESCRICAO,\r\n\t\t\t\t\t\testMin \t\t\t: item.EST_MIN,\r\n\t\t\t\t\t\tdataIdeal \t\t: moment(item.DATA_CLIENTE).format('DD/MM/YYYY'),\r\n\t\t\t\t\t\tgravado \t\t: true,\t\t// indicar que o item já está gravado na base de dados\r\n\t\t\t\t\t\tFATURADO        : item.FATURADO,\r\n\t\t\t\t\t\tSALDO_FATURAR\t: item.SALDO_FATURAR,\r\n\t\t\t\t\t\tPRODUZIR\t\t: item.PRODUZIR,\r\n\t\t\t\t\t\tEMPRODUCAO\t\t: item.EMPRODUCAO,\r\n\t\t\t\t\t\tAGRUPAMENTO\t\t: item.AGRUPAMENTO,\r\n\t\t\t\t\t\tALOCADO\t\t    : item.ALOCADO,\r\n\t\t\t\t\t\tENCERRADO\t\t: item.ENCERRADO,\r\n\t\t\t\t\t\tVALOR_SBT\t\t: item.VALOR_SBT\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tctrl.pedidoItem.calcularTabelaQtdMinima(item);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctrl.pedidoItemEscolhido.somaQuantidadeGeral();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction exibirModal() {\r\n\r\n\t\t\t\t$('#modal-create').modal('show');\r\n\t\t\t}\r\n\r\n\t\t\tconsultarPedidoItem(pedido);\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Ativar comportamento padrão da tela de Incluir.\r\n\t\t */\r\n\t\tfunction ativarIncluir() {\r\n\r\n\t\t\tctrl.tipoTela \t\t= 'incluir';\r\n\t\t\tctrl.situacaoPedido = '0';\r\n\t\t\tctrl.limparTelaEdit();\r\n\r\n\t\t\tctrl.infoGeral.consultarInfoGeral();\r\n\t\t\t// angular.copy(ctrl.infoGeral.infoGeralPadrao, ctrl.infoGeral.infoGeral);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Ativar comportamento padrão da tela de liberação de quantidade mínima para cor.\r\n\t\t */\r\n\t\tfunction ativarLiberacao() {\r\n\r\n\t\t\t$('#modal-liberacao').modal('show');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Limpar campos do modal.\r\n\t\t */\r\n\t\tfunction limparTelaEdit() {\r\n\r\n\t\t\tctrl.infoGeral.infoGeral \t\t\t\t\t\t= {};\r\n\t\t\tctrl.pedidoItemEscolhido.pedidoItemEscolhido \t= [];\r\n\t\t\tctrl.pedidoItemEscolhido.corEscolhida \t\t\t= [];\r\n\t\t\tctrl.pedidoItemEscolhido.quantidadeGeralTotal \t= 0;\r\n\t\t\tctrl.pedidoItemEscolhido.valorGeralTotal \t\t= 0;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Fechar modal.\r\n\t\t */\r\n\t\tfunction fecharModal() {\r\n\r\n\t\t\tvar confirmar = (ctrl.tipoTela == 'exibir') ? false : true;\r\n\r\n\t\t\tif (confirmar && verificarCampoAlterado()) {\r\n\r\n\t\t\t\taddConfirme(\r\n\t\t\t\t\t'<h4>Confirmação</h4>',\r\n\t\t        \t'Os dados serão perdidos. Deseja continuar?',\r\n\t\t        \t[obtn_sim, obtn_nao],\r\n\t\t        \t[\r\n\t\t            \t{\r\n\t\t            \t\tret: 1,\r\n\t\t            \t\tfunc: function() {\r\n\r\n\t\t            \t\t\tfechar();\r\n\t\t            \t\t\tctrl.limparTelaEdit();\r\n\t\t            \t\t}\r\n\t\t            \t},\r\n\t\t            \t{\r\n\t\t            \t\tret: 2,\r\n\t\t            \t\tfunc: function() {}\r\n\t\t            \t}\r\n\t\t        \t]\r\n\t\t        );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfechar();\r\n\t\t\t\tctrl.limparTelaEdit();\r\n\t\t\t}\r\n\r\n\r\n\t\t\t/**\r\n\t\t\t * Verificar se algum campo foi alterado.\r\n\t\t\t */\r\n\t\t\tfunction verificarCampoAlterado() {\r\n\r\n\t\t\t\tvar ret = false;\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t \t(ctrl.infoGeral.infoGeral.PEDIDO_CLIENTE !== undefined && ctrl.infoGeral.infoGeral.PEDIDO_CLIENTE !== '')\r\n\t\t\t\t ||\t(ctrl.infoGeral.infoGeral.OBSERVACAO \t !== undefined && ctrl.infoGeral.infoGeral.OBSERVACAO \t  !== '')\r\n\t\t\t\t ||\tctrl.pedidoItemEscolhido.pedidoItemEscolhido.length > 0\r\n\t\t\t\t)\r\n\t\t\t\t\tret = true;\r\n\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\r\n\t\t\tfunction fechar() {\r\n\t\t\t\r\n\t\t\t\t$('#modal-create')\r\n\t\t\t\t\t.modal('hide')\r\n\t\t\t\t\t.find('.modal-body')\r\n\t\t\t\t\t.animate({ scrollTop: 0 }, 'fast')\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}","angular\r\n\t.module('app')\r\n\t.service('RepresentanteService', RepresentanteService)\r\n\t.controller('RepresentanteController', RepresentanteController)\r\n\t.component('representante12060', {\r\n\t\ttemplateUrl: '/_12060/modalConsultarRepresentante',\r\n\t\trequire: {\r\n\t\t\tpedidoIndex12040: '^pedidoIndex12040'\r\n\t\t},\r\n\t\tcontroller: 'RepresentanteController'\r\n\t})\r\n;","RepresentanteService.$inject = ['$ajax', '$filter'];\r\n\r\nfunction RepresentanteService($ajax, $filter) {\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tthis.consultarRepresentante = consultarRepresentante;\r\n\t\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar representante.\r\n\t */\r\n    function consultarRepresentante() {\r\n\r\n\t\tvar url = '/_12060/consultarRepresentante';\r\n\r\n\t\treturn $ajax.post(url, null, {contentType: 'application/json'});\r\n\r\n\t}\r\n\r\n}\r\n","RepresentanteController.$inject = ['RepresentanteService', '$scope'];\n\nfunction RepresentanteController(RepresentanteService, $scope) {\n\n\tvar ctrl = this;\n\n\t// MÉTODOS (REFERÊNCIAS)\n\tctrl.consultarRepresentantePorUrl  \t= consultarRepresentantePorUrl;\n\tctrl.consultarRepresentante  \t\t= consultarRepresentante;\n\tctrl.selecionarRepresentante \t\t= selecionarRepresentante;\n\tctrl.fecharModal\t\t\t \t\t= fecharModal;\n\n\t// VARIÁVEIS\n\tctrl.listaRepresentante\t= [];\n\n\tthis.$onInit = function() {\n\n\t\tctrl.pedidoIndex12040.filtro = this;\n\n\t\tctrl.representanteIdUrl = parseInt(getURLParameter('representanteId'));\n\t\tctrl.consultarRepresentantePorUrl();\n\t};\n\n\n\t// MÉTODOS\n\n\t/**\n\t * Consultar e selecionar representante através de parâmetro na URL.\n\t */\n\tfunction consultarRepresentantePorUrl() {\n\n\t\tRepresentanteService\n\t\t\t.consultarRepresentante()\n\t\t\t.then(function(response) {\n\n\t\t\t\tctrl.listaRepresentante = response;\n\n\t\t\t\tvar rep = null;\n\n\t\t\t\tfor (var i in ctrl.listaRepresentante) {\n\n\t\t\t\t\trep = ctrl.listaRepresentante[i];\n\n\t\t\t\t\tif (rep.CODIGO == ctrl.representanteIdUrl) {\n\n\t\t\t\t\t\tctrl.pedidoIndex12040.filtro.representante = rep;\n\t\t\t\t\t\tctrl.pedidoIndex12040.filtroCliente.consultarClientePorRepresentantePorUrl();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Consultar representante.\n\t */\n\tfunction consultarRepresentante() {\n\n\t\t// Verificação para consultar apenas uma vez.\n\t\tif ( ctrl.listaRepresentante.length == 0 ) {\n\n\t\t\tRepresentanteService\n\t\t\t\t.consultarRepresentante()\n\t\t\t\t.then(function(response) { \n\t\t\t\t\tctrl.listaRepresentante = response; \n\t\t\t\t})\n\t\t\t;\n\n\t\t}\n\n\t\tsetTimeout(function() {\n\n\t\t\t// Fix para vs-repeat.\n\t\t\t$('.table-container-representante')\n\t\t\t\t.find('.scroll-table')\n\t\t\t\t.trigger('resize')\n\t\t\t\t.scrollTop(0);\n\n\t\t\t// Foco no input para filtrar.\n\t\t\t$('.input-filtrar-representante').select();\n\n\t\t}, 500);\n\n\t}\n\n\t/**\n\t * Selecionar representante.\n\t */\n\tfunction selecionarRepresentante(representante) {\n\n\t\tctrl.pedidoIndex12040.filtro.representante = representante;\n\t\tctrl.fecharModal();\n\t}\n\n\t/**\n\t * Fechar modal.\n\t */\n\tfunction fecharModal() {\n\n\t\t$('#modal-consultar-representante')\n\t\t\t.modal('hide')\n\t\t\t.find('.modal-body')\n\t\t\t.animate({ scrollTop: 0 }, 'fast')\n\t\t;\n\n\t\tctrl.filtrarRepresentante = '';\n\t}\n\n}","angular\r\n\t.module('app')\r\n\t.service('ClientePorRepresentanteService', ClientePorRepresentanteService)\r\n\t.controller('ClientePorRepresentanteController', ClientePorRepresentanteController)\r\n\t.component('clientePorRepresentante12070', {\r\n\t\ttemplateUrl: '/_12070/modalConsultarClientePorRepresentante',\r\n\t\trequire: {\r\n\t\t\tpedidoIndex12040: '^pedidoIndex12040'\r\n\t\t},\r\n\t\tcontroller: 'ClientePorRepresentanteController'\r\n\t})\r\n;","ClientePorRepresentanteService.$inject = ['$ajax', '$filter'];\r\n\r\nfunction ClientePorRepresentanteService($ajax, $filter) {\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tthis.consultarClientePorRepresentante = consultarClientePorRepresentante;\r\n\t\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar cliente por representante.\r\n\t */\r\n    function consultarClientePorRepresentante(representanteId) {\r\n\r\n\t\tvar url = '/_12070/consultarClientePorRepresentante',\r\n\t\t\tdata = {\r\n\t\t\t\trepresentanteId: representanteId\r\n\t\t\t}\r\n\t\t;\r\n\r\n\t\treturn $ajax.post(url, JSON.stringify(data), {contentType: 'application/json'});\r\n\r\n\t}\r\n\r\n}\r\n","ClientePorRepresentanteController.$inject = ['ClientePorRepresentanteService'];\r\n\r\nfunction ClientePorRepresentanteController(ClientePorRepresentanteService) {\r\n\r\n\tvar ctrl = this;\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tctrl.consultarClientePorRepresentantePorUrl\t= consultarClientePorRepresentantePorUrl;\r\n\tctrl.consultarClientePorRepresentante  \t\t= consultarClientePorRepresentante;\r\n\tctrl.selecionarClientePorRepresentante \t\t= selecionarClientePorRepresentante;\r\n\tctrl.fecharModal\t\t\t \t\t\t\t= fecharModal;\r\n\r\n\t// VARIÁVEIS\r\n\tctrl.listaClientePorRepresentante\t= [];\r\n\r\n\tthis.$onInit = function() {\r\n\r\n\t\tctrl.pedidoIndex12040.filtroCliente = this;\r\n\r\n\t\tctrl.clienteIdUrl = parseInt(getURLParameter('clienteId'));\r\n\t};\r\n\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar e selecionar cliente por representante através de parâmetro na URL.\r\n\t */\r\n\tfunction consultarClientePorRepresentantePorUrl() {\r\n\r\n\t\tvar representanteId = ctrl.pedidoIndex12040.filtro.representante.CODIGO;\r\n\r\n\t\tClientePorRepresentanteService\r\n\t\t\t.consultarClientePorRepresentante(representanteId)\r\n\t\t\t.then(function(response) {\r\n\r\n\t\t\t\tctrl.listaClientePorRepresentante = response;\r\n\r\n\t\t\t\tvar cli = null;\r\n\r\n\t\t\t\tfor (var i in ctrl.listaClientePorRepresentante) {\r\n\r\n\t\t\t\t\tcli = ctrl.listaClientePorRepresentante[i];\r\n\r\n\t\t\t\t\tif (cli.CODIGO == ctrl.clienteIdUrl) {\r\n\r\n\t\t\t\t\t\tctrl.pedidoIndex12040.filtroCliente.cliente = cli;\r\n\t\t\t\t\t\tctrl.pedidoIndex12040.consultarPedidoPorUrl();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Consultar cliente por representante.\r\n\t */\r\n\tfunction consultarClientePorRepresentante() {\r\n\r\n\t\tvar representanteId = (ctrl.pedidoIndex12040.representanteId === null)\r\n\t\t\t\t\t\t\t\t? parseInt(ctrl.pedidoIndex12040.filtro.representante.CODIGO) \r\n\t\t\t\t\t\t\t\t: parseInt(ctrl.pedidoIndex12040.representanteId)\r\n\t\t;\r\n\r\n\t\tClientePorRepresentanteService\r\n\t\t\t.consultarClientePorRepresentante(representanteId)\r\n\t\t\t.then(function(response) { \r\n\t\t\t\tctrl.listaClientePorRepresentante = response; \r\n\t\t\t})\r\n\t\t;\r\n\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\t// Fix para vs-repeat.\r\n\t\t\t$('.table-container-por-representante')\r\n\t\t\t\t.find('.scroll-table')\r\n\t\t\t\t.trigger('resize')\r\n\t\t\t\t.scrollTop(0);\r\n\r\n\t\t\t// Foco no input para filtrar.\r\n\t\t\t$('.input-filtrar-cliente').select();\r\n\r\n\t\t}, 500);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Selecionar cliente por representante.\r\n\t */\r\n\tfunction selecionarClientePorRepresentante(cliente) {\r\n\r\n\t\tctrl.pedidoIndex12040.filtroCliente.cliente = cliente;\r\n\t\tctrl.fecharModal();\r\n\t}\r\n\r\n\t/**\r\n\t * Fechar modal.\r\n\t */\r\n\tfunction fecharModal() {\r\n\r\n\t\t$('#modal-por-representante')\r\n\t\t\t.modal('hide')\r\n\t\t\t.find('.modal-body')\r\n\t\t\t.animate({ scrollTop: 0 }, 'fast')\r\n\t\t;\r\n\r\n\t\tctrl.filtrarCliente = '';\r\n\t}\r\n\r\n}","\t\t\r\nangular\r\n\t.module('app')\r\n\t.service('PedidoCreateService', PedidoCreateService)\r\n\t.controller('PedidoCreateController', PedidoCreateController)\r\n\t.component('pedidoCreate12040', {\r\n\t\ttemplateUrl: '/_12040/viewPedidoCreate',\r\n\t\trequire: {\r\n\t\t\tpedidoIndex12040: '^pedidoIndex12040'\r\n\t\t},\r\n\t\tbindings: {\r\n\t\t\tpermissaoMenu: '=',\r\n\t\t\ttipoTela: '=',\r\n\t\t\tsituacaoPedido: '=',\r\n\t\t\tconsultarPedido: '&',\r\n\t\t\tfecharModal: '&'\r\n\t\t},\r\n\t\tcontroller: 'PedidoCreateController'\r\n\t})\r\n;","\r\n    PedidoCreateService.$inject = ['$ajax', '$filter'];\r\n\r\n    function PedidoCreateService($ajax, $filter) {\r\n\r\n    \t// MÉTODOS (REFERÊNCIAS)\r\n        this.store   = store;\r\n    \tthis.excluir = excluir;\r\n\r\n\r\n    \t// MÉTODOS\r\n\r\n    \t/**\r\n    \t * Gravar.\r\n    \t */\r\n\t    function store(dados) {\r\n\r\n\t\t\tvar url = '/_12040/store';\r\n\r\n\t\t\treturn $ajax.post(url, JSON.stringify(dados), {contentType: 'application/json'});\r\n\r\n\t\t}\r\n\r\n        /**\r\n         * Excluir.\r\n         */\r\n        function excluir(dados) {\r\n\r\n            var url = '/_12040/excluir';\r\n\r\n            return $ajax.post(url, JSON.stringify(dados), {contentType: 'application/json'});\r\n\r\n        }\r\n\r\n\t}\r\n","\r\n\tPedidoCreateController.$inject = ['PedidoCreateService', '$scope'];\r\n\r\n\tfunction PedidoCreateController(PedidoCreateService, $scope) {\r\n\r\n\t\tvar ctrl = this;\r\n\r\n\t\t// MÉTODOS (REFERÊNCIAS).\r\n\t\tctrl.ativarAlterar \t\t\t = ativarAlterar;\r\n\t\tctrl.verificarSituacaoPedido = verificarSituacaoPedido;\r\n\t\tctrl.store\t\t \t\t\t = store;\r\n\t\tctrl.verificarExisteItem \t = verificarExisteItem;\r\n\t\tctrl.excluir\t \t\t\t = excluir;\r\n\r\n\t\t// VARIÁVEIS\r\n\t\t\r\n\r\n\r\n\t\t// MÉTODOS\r\n\r\n\t\t/**\r\n\t\t * Ativar comportamento padrão da tela de Alterar.\r\n\t\t */\r\n\t\tfunction ativarAlterar() {\r\n\r\n\t\t\tctrl.verificarSituacaoPedido();\r\n\t\t\tctrl.tipoTela = 'alterar';\r\n\t\t\t// ctrl.infoGeral.gerarChave();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Verificar situação do pedido (confirmado ou não) e a forma de análise (imediata ou não).\r\n\t\t * Se confirmado ou análise imediata, o pedido não pode ser alterado.\r\n\t\t */\r\n\t\tfunction verificarSituacaoPedido() {\r\n\r\n\t\t\tvar res = true;\r\n\r\n\t\t\tif (ctrl.infoGeral.infoGeral.FORMA_ANALISE == '0')\r\n\t\t\t\tres = false;\r\n\t\t\telse if (ctrl.situacaoPedido == '1')\r\n\t\t\t\tres = false;\r\n\r\n\t\t\tif (!res)\r\n\t\t\t\tthrow 'Pedido não pode ser alterado.';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Gravar.\r\n\t\t */\r\n\t\tfunction store() {\r\n\r\n\t\t\tif (!ctrl.verificarExisteItem())\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tvar pedidoItem \t\t\t\t\t= [],\r\n\t\t\t\tpedidoItemEscolhido \t\t= ctrl.pedidoItemEscolhido.pedidoItemEscolhido,\r\n\t\t\t\tpedidoItemEscolhidoExcluir \t= ctrl.pedidoItemEscolhido.pedidoItemEscolhidoExcluir,\r\n\t\t\t\tpedItemEsc \t\t\t\t\t= {},\r\n\t\t\t\tinfoGeral  \t\t\t\t\t= ctrl.infoGeral.infoGeral,\r\n\t\t\t\tdataIdeal \t\t\t\t\t= '',\r\n\t\t\t\tbtnImediatam \t\t\t\t= { desc: 'Imediatamente', class: 'btn-primary', ret: '1', hotkey: 'alt+m', glyphicon: '' },\r\n\t\t\t\tbtnAguardar \t\t\t\t= { desc: 'Aguardar 24h', class: 'btn-warning', ret: '3', hotkey: 'alt+g', glyphicon: '' }\r\n\t\t\t;\r\n\r\n\t\t\tconfirmarFormaAnalise();\r\n\r\n\t\t\t/**\r\n\t\t\t * Confirmar escolha da forma de análise.\r\n\t\t\t */\r\n\t\t\tfunction confirmarFormaAnalise() {\r\n\r\n\t\t\t\taddConfirme(\r\n\t\t\t\t\t'<h4>Confirmação</h4>',\r\n\t\t        \t'Como deseja que esse pedido seja analisado e confirmado?',\r\n\t\t        \t[obtn_cancelar, btnImediatam, btnAguardar],\r\n\t\t        \t[\r\n\t\t            \t{\r\n\t\t            \t\tret: 1,\r\n\t\t            \t\tfunc: function() {\r\n\r\n\t\t            \t\t\treconfirmarFormaImediatam();\r\n\t\t            \t\t}\r\n\t\t            \t},\r\n\t\t            \t{\r\n\t\t            \t\tret: 2,\t\t// padrão para botão cancelar (popup.js)\r\n\t\t            \t\tfunc: function() {\t            \t\t\t\r\n\t\t            \t\t}\r\n\t\t            \t},\r\n\t\t            \t{\r\n\t\t            \t\tret: 3,\r\n\t\t            \t\tfunc: function() {\r\n\r\n\t\t            \t\t\tprocessarGravacao(1);\r\n\t\t            \t\t}\r\n\t\t            \t}\r\n\t\t        \t]\r\n\t\t        );\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Reconfirmar caso a forma de análise escolhida seja imediatamente.\r\n\t\t\t */\r\n\t        function reconfirmarFormaImediatam() {\r\n\r\n\t        \taddConfirme(\r\n\t\t\t\t\t'<h4>Confirmação</h4>',\r\n\t\t        \t'Após a gravação, esse pedido será imediatamente processado, não podendo mais ser alterado ou cancelado. Confirma?',\r\n\t\t        \t[obtn_nao, obtn_sim],\r\n\t\t        \t[\r\n\t\t        \t\t{\r\n\t\t            \t\tret: 1,\r\n\t\t            \t\tfunc: function() {\r\n\r\n\t\t            \t\t\tprocessarGravacao(0);\r\n\t\t            \t\t}\r\n\t\t            \t},\r\n\t\t            \t{\r\n\t\t            \t\tret: 2,\r\n\t\t            \t\tfunc: function() {\r\n\t\t            \t\t\tconfirmarFormaAnalise();      \t\t\t\r\n\t\t            \t\t}\r\n\t\t            \t}\r\n\t\t        \t]\r\n\t\t        );\r\n\t        }\r\n\r\n\t\t\t/**\r\n\t\t\t * Processar dados e gravar.\r\n\t\t\t * @param {int} formaAnalise Forma de análise do pedido.\r\n\t\t\t */\r\n\t\t\tfunction processarGravacao(formaAnalise) {\r\n\r\n\t\t\t\t// Itens do pedido.\r\n\t\t\t\tfor (var i in pedidoItemEscolhido) {\r\n\r\n\t\t\t\t\tpedItemEsc = pedidoItemEscolhido[i];\r\n\r\n\t\t\t\t\t// Tratamento necessário quando a data está no formato 'dd/mm/yyyy'.\r\n\t\t\t\t\tdataIdeal = pedItemEsc.dataIdeal.split('/');\r\n\t\t\t\t\tdataIdeal = new Date(dataIdeal[2], dataIdeal[1] - 1, dataIdeal[0]);\r\n\t\t\t\t\tdataIdeal = moment(dataIdeal).format('DD.MM.YYYY');\r\n\r\n\t\t\t\t\tpedidoItem[i] = {\r\n\t\t\t\t\t\tSEQUENCIA \t\t: pedItemEsc.sequencia,\r\n\t\t\t\t\t\tPRODUTO_ID \t\t: pedItemEsc.produto.CODIGO,\r\n\t\t\t\t\t\tMODELO_ID \t\t: pedItemEsc.modelo.MODELO_CODIGO,\r\n\t\t\t\t\t\tTAMANHO \t\t: pedItemEsc.tamanhoId,\r\n\t\t\t\t\t\tCOR_ID \t \t\t: pedItemEsc.cor.CODIGO,\r\n\t\t\t\t\t\tCOR_CONDICAO\t: pedItemEsc.cor.CONDICAO.charAt(0),\r\n\t\t\t\t\t\tPERFIL_COR \t\t: pedItemEsc.cor.PERFIL,\r\n\t\t\t\t\t\tQUANTIDADE \t\t: pedItemEsc.quantidade,\r\n\t\t\t\t\t\tVALOR_UNITARIO\t: pedItemEsc.valorUnitario,\r\n\t\t\t\t\t\tVALOR_TOTAL\t\t: pedItemEsc.valorTotal,\r\n\t\t\t\t\t\tPERFIL \t\t\t: pedItemEsc.perfilId,\r\n\t\t\t\t\t\tDATA_CLIENTE \t: dataIdeal,\r\n\t\t\t\t\t\tEST_MIN \t\t: pedItemEsc.estMin\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar dados = {\r\n\r\n\t\t\t\t\tpedido: {\r\n\t\t\t\t\t\tCLIENTE_ID \t\t\t\t: (ctrl.pedidoIndex12040.filtroCliente.cliente !== undefined) ? parseInt(ctrl.pedidoIndex12040.filtroCliente.cliente.CODIGO) : 0,\r\n\t\t\t\t\t    PEDIDO \t\t\t\t\t: (infoGeral.PEDIDO != undefined) ? infoGeral.PEDIDO : null,\r\n\t\t\t\t\t    PEDIDO_CLIENTE\t\t\t: infoGeral.PEDIDO_CLIENTE,\r\n\t\t\t\t\t    REPRESENTANTE_CODIGO\t: infoGeral.REPRESENTANTE_CODIGO,\r\n\t\t\t\t\t    TRANSPORTADORA_CODIGO\t: infoGeral.TRANSPORTADORA_CODIGO,\r\n\t\t\t\t\t    FRETE\t\t\t\t\t: infoGeral.FRETE,\r\n\t\t\t\t\t    PAGAMENTO_FORMA\t\t\t: infoGeral.PAGAMENTO_FORMA,\r\n\t\t\t\t\t    PAGAMENTO_CONDICAO\t\t: infoGeral.PAGAMENTO_CONDICAO,\r\n\t\t\t\t\t    FAMILIA_CODIGO\t\t\t: pedidoItemEscolhido[0].modelo.FAMILIA_CODIGO,\r\n\t\t\t\t\t    OBSERVACAO\t\t\t\t: infoGeral.OBSERVACAO,\r\n\t\t\t\t\t    DATA_CLIENTE\t\t\t: (infoGeral.DATA_CLIENTE != undefined) ? moment(infoGeral.DATA_CLIENTE).format('DD.MM.YYYY') : null,\r\n\t\t\t\t\t    PRIORIDADE\t\t\t\t: infoGeral.PRIORIDADE,\r\n\t\t\t\t\t    PROGRAMADO\t\t\t\t: infoGeral.PROGRAMADO,\r\n\t\t\t\t\t    EMAIL_XML\t\t\t\t: infoGeral.EMAIL_XML,\r\n\t\t\t\t\t    CHAVE_LIBERACAO \t\t: infoGeral.CHAVE,\r\n\t\t\t\t\t    FORMA_ANALISE \t\t\t: formaAnalise,\r\n\t\t\t\t\t    TIPO_TELA \t\t\t\t: ctrl.tipoTela,\r\n\t\t\t\t\t    PEDIDO_ITEM \t\t\t: pedidoItem,\r\n\t\t\t\t\t    PEDIDO_ITEM_EXCLUIR \t: pedidoItemEscolhidoExcluir,\r\n\t\t\t\t\t    VALOR_FRETE             : infoGeral.VALOR_FRETE\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tPedidoCreateService\r\n\t\t\t\t\t.store(dados)\r\n\t\t\t\t\t.then(function(response) {\r\n\r\n\t\t\t\t\t\tshowSuccess('Gravado com sucesso.');\r\n\t\t\t\t\t\tctrl.tipoTela = 'exibir';\r\n\t\t\t\t\t\tctrl.consultarPedido();\r\n\r\n\t\t\t\t\t\t// espera para o tipoTela ser aplicado.\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tctrl.fecharModal();\r\n\t\t\t\t\t\t}, 500);\r\n\t\t\t\t\t})\r\n\t\t\t\t;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Verificar se itens de pedido foram escolhidos.\r\n\t\t */\r\n\t\tfunction verificarExisteItem() {\r\n\r\n\t\t\tvar ret \t= true,\r\n\t\t\t\tcorEsc \t= ''\r\n\t\t\t;\r\n\r\n\t\t\t// Se existe item.\r\n\t\t\tif (ctrl.pedidoItemEscolhido.pedidoItemEscolhido.length === 0) {\r\n\r\n\t\t\t\tshowAlert('Escolha itens para o pedido.');\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\t// Se a quantidade das cores obedece a quantidade mínima e múltipla.\r\n\t\t\telse {\r\n\t\t\t\t\r\n\t\t\t\tfor (var i in ctrl.pedidoItemEscolhido.corEscolhida) {\r\n\r\n\t\t\t\t\tcorEsc = ctrl.pedidoItemEscolhido.corEscolhida[i];\r\n\r\n\t\t\t\t\tif ( (corEsc.quantidade < corEsc.quantidadeMinima) || ((corEsc.quantidade % corEsc.quantidadeMultipla) != 0) ) {\r\n\r\n\t\t\t\t\t\tshowErro('<span>A cor <b>'+corEsc.codigo+'</b> deve ter quantidade maior que '+corEsc.quantidadeMinima+' e múltipla de '+corEsc.quantidadeMultipla+'.</span>');\r\n\t\t\t\t\t\tret = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn ret;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Excluir.\r\n\t\t */\r\n\t\tfunction excluir() {\r\n\r\n\t\t\tctrl.verificarSituacaoPedido();\r\n\t\t\t\r\n\t\t\taddConfirme(\r\n\t\t\t\t'<h4>Confirmação</h4>',\r\n\t        \t'Confirma a exclusão deste pedido?',\r\n\t        \t[obtn_nao, obtn_sim],\r\n\t        \t[\r\n\t            \t{\r\n\t            \t\tret: 1,\r\n\t            \t\tfunc: function() {\r\n\r\n\t            \t\t\tefetivarExcluir();\r\n\t            \t\t}\r\n\t            \t},\r\n\t            \t{\r\n\t            \t\tret: 2,\t\t// padrão para botão cancelar (popup.js)\r\n\t            \t\tfunc: function() {\t            \t\t\t\r\n\t            \t\t}\r\n\t            \t}\r\n\t        \t]\r\n\t        );\r\n\r\n\t        function efetivarExcluir() {\r\n\t\t\t\r\n\t\t\t\tvar dados = {\r\n\t\t\t\t\tpedido: ctrl.infoGeral.infoGeral.PEDIDO\r\n\t\t\t\t};\r\n\r\n\t\t\t\tPedidoCreateService\r\n\t\t\t\t\t.excluir(dados)\r\n\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tshowSuccess('Excluído com sucesso.');\r\n\t\t\t\t\t\tctrl.consultarPedido();\r\n\t\t\t\t\t\tctrl.fecharModal();\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}","\t\t\r\nangular\r\n\t.module('app')\r\n\t.service('InfoGeralService', InfoGeralService)\r\n\t.controller('InfoGeralController', InfoGeralController)\r\n\t.component('infoGeral12040', {\r\n\t\ttemplateUrl: '/_12040/viewInfoGeral',\r\n\t\trequire: {\r\n\t\t\tpedidoIndex12040: '^pedidoIndex12040',\r\n\t\t\tpedidoCreate12040: '^pedidoCreate12040'\r\n\t\t},\r\n\t\tbindings: {\r\n\t\t\ttipoTela: '='\r\n\t\t},\r\n\t\tcontroller: 'InfoGeralController'\r\n\t})\r\n;","\r\n    InfoGeralService.$inject = ['$ajax', '$filter'];\r\n\r\n    function InfoGeralService($ajax, $filter) {\r\n\r\n    \t// MÉTODOS (REFERÊNCIAS)\r\n    \tthis.consultarInfoGeral = consultarInfoGeral;\r\n        this.gerarChave         = gerarChave;\r\n        this.getPDF             = getPDF;\r\n\r\n\r\n    \t// MÉTODOS\r\n\r\n    \t/**\r\n    \t * Consultar informações gerais.\r\n    \t */\r\n\t    function consultarInfoGeral(clienteId) {\r\n\r\n\t\t\tvar url = '/_12040/consultarInfoGeral',\r\n                data = {\r\n                    CLIENTE_ID: clienteId\r\n                }\r\n            ;\r\n\r\n\t\t\treturn $ajax.post(url, JSON.stringify(data), {contentType: 'application/json'});\r\n\t\t}\r\n\r\n        /**\r\n         * Gerar chave para liberação de nova quantidade mínima para cor.\r\n         */\r\n        function gerarChave() {\r\n\r\n            var url = '/_12040/gerarChave';\r\n\r\n            return $ajax.post(url, JSON.stringify(data), {contentType: 'application/json'});\r\n        }\r\n\r\n        /**\r\n         * PDF do pedido\r\n         */\r\n        function getPDF(dados) {\r\n\r\n            var url = '/_12040/getPDF';\r\n\r\n            return $ajax.post(url, dados, {contentType: 'application/json'});\r\n\r\n        }\r\n\r\n\t}\r\n","\r\n\tInfoGeralController.$inject = ['$scope','InfoGeralService', 'Historico'];\r\n\r\n\tfunction InfoGeralController($scope, InfoGeralService, Historico) {\r\n\r\n\t\tvar ctrl = this;\r\n\r\n\t\t// MÉTODOS (REFERÊNCIAS).\r\n\t\tctrl.consultarInfoGeral = consultarInfoGeral;\r\n\t\tctrl.marcarProgramado \t= marcarProgramado;\r\n\t\tctrl.ngWinPopUp         = ngWinPopUp;\r\n\t\tctrl.gerarChave \t\t= gerarChave;\r\n\t\tctrl.gerarPDF           = gerarPDF;\r\n        ctrl.Historico          = new Historico('$ctrl.Historico',$scope);\r\n\r\n\t\t// VARIÁVEIS\r\n\t\tctrl.infoGeral \t\t\t= {};\r\n\r\n\t\tthis.$onInit = function() {\r\n\r\n\t\t\tctrl.pedidoIndex12040.infoGeral  = this;\r\n\t\t\tctrl.pedidoCreate12040.infoGeral = this;\r\n\r\n\t\t\tctrl.FILE = {VISIVEL: false, DATA: null}\r\n\t\t};\r\n\r\n\r\n\t\t// MÉTODOS\r\n\r\n\t\t/**\r\n\t\t * Consultar Informações Gerais.\r\n\t\t */\r\n\t\tfunction consultarInfoGeral() {\r\n\r\n\t\t\tvar clienteId = ctrl.pedidoIndex12040.filtroCliente.cliente\r\n\t\t\t\t\t\t\t? parseInt(ctrl.pedidoIndex12040.filtroCliente.cliente.CODIGO) \r\n\t\t\t\t\t\t\t: 0\r\n\t\t\t;\r\n \r\n\t\t\tInfoGeralService\r\n\t\t\t\t.consultarInfoGeral(clienteId)\r\n\t\t\t\t.then(function(response) { \r\n\t\t\t\t\tctrl.infoGeral = response;\r\n\t\t\t\t\t$('#modal-create').modal('show');\r\n\t\t\t\t})\r\n\t\t\t;\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Consultar Informações Gerais.\r\n\t\t */\r\n\t\tfunction gerarPDF() {\r\n\r\n\t\t\tvar dados = {\r\n\t\t\t\tPEDIDO : ctrl.infoGeral,\r\n\t\t\t\tITENS  : ctrl.pedidoIndex12040.pedidoItemEscolhido.pedidoItemEscolhido\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(InfoGeralService);\r\n\r\n\t\t\tInfoGeralService\r\n\t\t\t\t.getPDF(dados)\r\n\t\t\t\t.then(function(response) { \r\n\t\t\t\t\t\r\n\t\t\t\t\tctrl.FILE.DATA   = response;\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\t$('.visualizar-arquivo').css('display','block');\r\n\t\t\t\t\t$('.visualizar-arquivo').find('object').attr('data',response);\r\n\t\t\t\t\t$('.visualizar-arquivo').find('a').attr('href',response);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(ctrl.FILE.VISIVEL == false){\r\n\t\t\t\t\t  $(document).on('click','.esconder-arquivo', function(){\r\n\t\t\t\t\t  \t$('.visualizar-arquivo').css('display','none');\r\n\t\t\t\t\t  });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctrl.FILE.VISIVEL = true;\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t})\r\n\t\t\t; \r\n\r\n\t\t\t//console.log();\r\n\t\t\t//console.log();\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Gerar chave para liberação de nova quantidade mínima para cor.\r\n\t\t */\r\n\t\tfunction gerarChave() {\r\n \r\n\t\t\tInfoGeralService\r\n\t\t\t\t.gerarChave()\r\n\t\t\t\t.then(function(response) { \r\n\t\t\t\t\tctrl.infoGeral.CHAVE = response.CHAVE;\r\n\t\t\t\t})\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Ações ao marcar a opção 'Programado'.\r\n\t\t */\r\n\t\tfunction marcarProgramado() {\r\n\t\t\t\r\n\t\t\tif (ctrl.infoGeral.PROGRAMADO == '1') {\r\n\r\n\t\t\t\tif (ctrl.infoGeral.DATA_CLIENTE === undefined) {\r\n\r\n\t\t\t\t\tctrl.infoGeral.DATA_MIN_CLIENTE \t= moment().add(1, \"month\").format('YYYY-MM-DD');\r\n\t\t\t\t\tctrl.infoGeral.DATA_CLIENTE \t\t= moment().add(1, \"month\").toDate();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\t// else {\r\n\r\n\t\t\t// \tctrl.infoGeral.DATA_MIN_CLIENTE \t= '';\r\n\t\t\t// \tctrl.infoGeral.DATA_CLIENTE \t\t= '';\r\n\r\n\t\t\t// }\r\n\r\n\t\t}\r\n        \r\n        \r\n        function ngWinPopUp(url,id,params) {\r\n            var modal = winPopUp(url,id,params);\r\n            \r\n//            modal.onbeforeunload = function(){ \r\n//                $scope.$apply(function(){\r\n//\r\n//                    ctrl.pedidoIndex12040.consultarPedido().then(function(response){\r\n//                        var objeto = selectById(response,id,'PEDIDO');\r\n//\r\n//                        ctrl.pedidoIndex12040.exibirPedido(objeto);\r\n//                    });\r\n//                    // processar após fechar modal\r\n//                });\r\n//            };\r\n        };        \r\n\r\n\t}","\t\t\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.service('PedidoItemEscolhidoService', PedidoItemEscolhidoService)\r\n\t\t.controller('PedidoItemEscolhidoController', PedidoItemEscolhidoController)\r\n\t\t.component('pedidoItemEscolhido12040', {\r\n\t\t\ttemplateUrl: '/_12040/viewPedidoItemEscolhido',\r\n\t\t\trequire: {\r\n\t\t\t\tpedidoIndex12040: '^pedidoIndex12040',\r\n\t\t\t\tpedidoCreate12040: '^pedidoCreate12040'\r\n\t\t\t},\r\n\t\t\tbindings: {\r\n\t\t\t\ttipoTela: '='\r\n\t\t\t},\r\n\t\t\tcontroller: 'PedidoItemEscolhidoController'\r\n\t\t})\r\n\t;","\r\n    PedidoItemEscolhidoService.$inject = ['$ajax'];\r\n\r\n    function PedidoItemEscolhidoService($ajax) {\r\n\r\n    \t// MÉTODOS (REFERÊNCIAS)\r\n    \tthis.consultarQtdLiberada = consultarQtdLiberada;\r\n\r\n    \t// MÉTODOS\r\n    \t\r\n    \t/**\r\n    \t * Consultar a quantidade mínima liberada para uma cor.\r\n    \t */\r\n\t    function consultarQtdLiberada(param) {\r\n\r\n\t\t\treturn $ajax\r\n\t\t\t\t\t.post(\r\n\t\t\t\t\t\t'/_12040/consultarQtdLiberada', \r\n\t\t\t\t\t\tJSON.stringify(param), \r\n\t\t\t\t\t\t{contentType: 'application/json'}\r\n\t\t\t\t\t);\r\n\t\t}\r\n\r\n\t}\r\n","\r\n\t// Injetando Components ao Controller.\r\n\tPedidoItemEscolhidoController.$inject = ['PedidoItemEscolhidoService', '$scope'];\r\n\r\n\t/**\r\n\t * Controller.\r\n\t */\r\n\tfunction PedidoItemEscolhidoController(PedidoItemEscolhidoService, $scope) {\r\n\r\n\t\tvar ctrl = this;\r\n\r\n\t\t/**\r\n\t\t * MÉTODOS (REFERÊNCIAS).\r\n\t\t */\r\n\t\tctrl.selecionarPedidoItemEscolhido \t= selecionarPedidoItemEscolhido;\r\n\t\tctrl.excluirPedidoItemEscolhido \t= excluirPedidoItemEscolhido;\r\n\t\tctrl.subtrairQtdResumo \t\t\t\t= subtrairQtdResumo;\r\n\t\tctrl.somaQuantidadeGeral\t\t\t= somaQuantidadeGeral;\r\n\t\tctrl.definirDataCliente \t\t\t= definirDataCliente;\r\n\t\tctrl.atualizarQtdLiberada \t\t\t= atualizarQtdLiberada;\r\n\r\n\t\t/**\r\n\t\t * VARIÁVEIS.\r\n\t\t */\r\n\t\tctrl.pedidoItemEscolhido \t\t= [];\r\n\t\tctrl.pedidoItemEscolhidoSelec \t= [];\r\n\t\tctrl.pedidoItemEscolhidoExcluir\t= [];\r\n\t\tctrl.corEscolhida \t\t\t\t= [];\r\n\r\n\t\tthis.$onInit = function() {\r\n\r\n\t\t\tctrl.pedidoIndex12040.pedidoItemEscolhido \t= this;\r\n\t\t\tctrl.pedidoCreate12040.pedidoItemEscolhido \t= this;\r\n\r\n\t\t};\r\n\r\n\r\n\r\n\t\t/**\r\n\t\t * MÉTODOS.\r\n\t\t */\r\n\r\n\t\tfunction selecionarPedidoItemEscolhido(item) {\r\n\r\n\t\t\t// Indica se deve selecionar a linha da tabela.\r\n\t\t\tif (item.selected == undefined || item.selected == false)\r\n\t\t\t\titem.selected = true;\r\n\t\t\telse\r\n\t\t\t\titem.selected = false;\r\n\r\n\t\t\t// Preencher model com a lista de itens selecionados.\r\n\t\t\tvar index = ctrl.pedidoItemEscolhidoSelec.indexOf(item);\r\n\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tctrl.pedidoItemEscolhidoSelec.splice(index, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tctrl.pedidoItemEscolhidoSelec.push(item);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction excluirPedidoItemEscolhido() {\r\n\r\n\t\t\taddConfirme(\r\n\t\t\t\t'<h4>Confirmação</h4>',\r\n            \t'Confirma a exclusão dos itens selecionados?',\r\n            \t[obtn_sim, obtn_nao],\r\n            \t[\r\n                \t{\r\n                \t\tret: 1,\r\n                \t\tfunc: function() { \r\n\r\n                \t\t\tvar index \t= -1,\r\n\t\t\t\t\t\t\t\titem \t= ''\r\n\t\t\t\t\t\t\t;\r\n\r\n\t\t\t\t\t\t\t//Excluir no JSON.\r\n\t\t\t\t\t\t\tfor(var i in ctrl.pedidoItemEscolhidoSelec) {\r\n\r\n\t\t\t\t\t\t\t\titem  = ctrl.pedidoItemEscolhidoSelec[i];\r\n\t\t\t\t\t\t\t\tindex = ctrl.pedidoItemEscolhido.indexOf(item);\r\n\r\n\t\t\t\t\t\t\t\tif (index > -1) {\r\n\r\n\t\t\t\t\t\t\t\t\tctrl.subtrairQtdResumo(item);\r\n\t\t\t\t\t\t\t\t\tctrl.pedidoItemEscolhido.splice(index, 1);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (item.gravado) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tctrl.pedidoItemEscolhidoExcluir.push({\r\n\t\t\t\t\t\t\t\t\t\t\tPEDIDO \t\t: ctrl.pedidoCreate12040.infoGeral.infoGeral.PEDIDO,\r\n\t\t\t\t\t\t\t\t\t\t\tSEQUENCIA \t: item.sequencia \r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tctrl.somaQuantidadeGeral();\r\n\t\t\t\t\t\t\tctrl.definirDataCliente();\r\n\t\t\t\t\t\t\tctrl.pedidoItemEscolhidoSelec = [];\r\n\t\t\t\t\t\t\t$scope.$apply();\r\n\r\n               \t\t\t}\r\n                \t},\r\n                \t{\r\n                \t\tret: 2,\r\n                \t\tfunc: function() {}\r\n                \t}\r\n            \t]\r\n            );\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Subtrair quantidade da tabela de resumo de cores.\r\n\t\t */\r\n\t\tfunction subtrairQtdResumo(item) {\r\n\r\n\t\t\tvar corEsc = '',\r\n\t\t\t\tindex  = 0\r\n\t\t\t;\r\n\r\n\t\t\tfor (var j in ctrl.corEscolhida) {\r\n\r\n\t\t\t\tcorEsc = ctrl.corEscolhida[j];\r\n\r\n\t\t\t\tif (corEsc.codigo === item.cor.CODIGO)\r\n\t\t\t\t\tcorEsc.quantidade -= item.quantidade;\r\n\t\t\t\t\r\n\t\t\t\tif (corEsc.quantidade === 0) {\r\n\r\n\t\t\t\t\tindex = ctrl.corEscolhida.indexOf(corEsc);\r\n\t\t\t\t\tctrl.corEscolhida.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Somar quantidade e valor unitário dos tamanhos escolhidos pelo cliente.\r\n\t\t */\r\n\t\tfunction somaQuantidadeGeral() {\r\n\r\n\t\t\tvar item \t= {},\r\n\t\t\t\tqtdGrl \t= 0,\r\n\t\t\t\tvlrGrl \t= 0\r\n\t\t\t;\r\n\r\n\t\t\tfor(var i in ctrl.pedidoItemEscolhido) {\r\n\r\n\t\t\t\titem = ctrl.pedidoItemEscolhido[i];\r\n\r\n\t\t\t\tqtdGrl += item.quantidade;\r\n\t\t\t\tvlrGrl += item.valorTotal;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tctrl.quantidadeGeralTotal \t= qtdGrl;\r\n\t\t\tctrl.valorGeralTotal \t\t= vlrGrl;\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Definir data do cliente de acordo com a maior \r\n\t\t * data de previsão de faturamento entre os itens do pedido escolhidos.\r\n\t\t */\r\n\t\tfunction definirDataCliente() {\r\n\r\n\t\t\tif (ctrl.pedidoItemEscolhido.length > 0) {\r\n\r\n\t\t\t\tvar item \t\t= '',\r\n\t\t\t\t\tdataMaior \t= '',\r\n\t\t\t\t\tdataIdeal \t= '',\r\n\t\t\t\t\tdataCliente = moment(ctrl.pedidoCreate12040.infoGeral.infoGeral.DATA_CLIENTE)\r\n\t\t\t\t;\r\n\r\n\t\t\t\t// Tratamento necessário quando a data está no formato 'dd/mm/yyyy'.\r\n\t\t\t\tdataMaior = ctrl.pedidoItemEscolhido[0].dataIdeal.split('/');\r\n\t\t\t\tdataMaior = new Date(dataMaior[2], dataMaior[1] - 1, dataMaior[0]);\r\n\t\t\t\tdataMaior = moment(dataMaior);\r\n\r\n\t\t\t\tfor (var i in ctrl.pedidoItemEscolhido) {\r\n\r\n\t\t\t\t\titem = ctrl.pedidoItemEscolhido[i];\r\n\r\n\t\t\t\t\t// Tratamento necessário quando a data está no formato 'dd/mm/yyyy'.\r\n\t\t\t\t\tdataIdeal = item.dataIdeal.split('/');\r\n\t\t\t\t\tdataIdeal = new Date(dataIdeal[2], dataIdeal[1] - 1, dataIdeal[0]);\r\n\t\t\t\t\tdataIdeal = moment(dataIdeal);\r\n\r\n\t\t\t\t\tif (dataMaior < dataIdeal)\r\n\t\t\t\t\t\tdataMaior = dataIdeal;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Alterar quando a data do cliente for menor que a maior \r\n\t\t\t\t// data de previsão de faturamento entre os itens do pedido.\r\n\t\t\t\tif (dataMaior > dataCliente) {\r\n\r\n\t\t\t\t\tctrl.pedidoCreate12040.infoGeral.infoGeral.DATA_CLIENTE \t= dataMaior.toDate();\r\n\t\t\t\t\tctrl.pedidoCreate12040.infoGeral.infoGeral.DATA_MIN_CLIENTE = dataMaior.format('YYYY-MM-DD');\r\n\r\n\t\t\t\t\tshowAlert('Sua data foi alterada para '+ moment(dataMaior).format('DD/MM/YYYY') +'.');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n    \t * Atualizar a quantidade mínima liberada para uma cor.\r\n    \t * Caso exista uma liberação para a cor, a nova quantidade é exibida. Senão, continua a mesma.\r\n    \t */\r\n\t\tfunction atualizarQtdLiberada(cor) {\r\n\r\n\t\t\tvar param = {\r\n\t\t\t\tCOR_ID: cor.codigo,\r\n\t\t\t\tCHAVE : ctrl.pedidoCreate12040.infoGeral.infoGeral.CHAVE\r\n\t\t\t};\r\n\r\n\t\t\tPedidoItemEscolhidoService\r\n\t\t\t\t.consultarQtdLiberada(param)\r\n\t\t\t\t.then(function(response) {\r\n\r\n\t\t\t\t\tif (response.length > 0)\r\n\t\t\t\t\t\tcor.quantidadeMinima = response[0].QUANTIDADE;\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t}","\t\t\r\n\tangular\r\n\t\t.module('app')\r\n\t\t.service('PedidoItemService', PedidoItemService)\r\n\t\t.service('ProdutoPorModeloECorService', ProdutoPorModeloECorService)\t\t\r\n\t\t.controller('PedidoItemController', PedidoItemController)\r\n\t\t.component('pedidoItem12040', {\r\n\t\t\ttemplateUrl: '/_12040/viewPedidoItem',\r\n\t\t\trequire: {\r\n\t\t\t\tpedidoIndex12040: '^pedidoIndex12040',\r\n\t\t\t\tpedidoCreate12040: '^pedidoCreate12040'\r\n\t\t\t},\r\n\t\t\tbindings: {\r\n\t\t\t\tpedidoItemEscolhido: '=',\r\n\t\t\t\tcorEscolhida: '=',\r\n\t\t\t\tsomaQuantidadeGeral: '&',\r\n\t\t\t\tdefinirDataCliente: '&'\r\n\t\t\t},\r\n\t\t\tcontroller: 'PedidoItemController'\r\n\t\t})\r\n\t;","\r\n    PedidoItemService.$inject = ['$ajax', '$filter'];\r\n\r\n    function PedidoItemService($ajax, $filter) {\r\n\r\n    \tthis.consultarTamanhoComPreco \t\t= consultarTamanhoComPreco;\r\n    \tthis.consultarQtdEPrazoPorTamanho \t= consultarQtdEPrazoPorTamanho;\r\n\r\n\t    function consultarTamanhoComPreco(filtro) {\r\n\r\n\t\t\tvar url = '/_12040/consultarTamanhoComPreco';\r\n\r\n\t\t\treturn $ajax.post(url, JSON.stringify(filtro), {contentType: 'application/json'});\r\n\r\n\t\t}\r\n\r\n\t\tfunction consultarQtdEPrazoPorTamanho(filtro) {\r\n\r\n\t\t\tvar url = '/_12040/consultarQtdEPrazoPorTamanho';\r\n\r\n\t\t\treturn $ajax.post(url, JSON.stringify(filtro), {contentType: 'application/json'});\r\n\r\n\t\t}\r\n\r\n\t}\r\n","// Injetando Components ao Controller.\r\nPedidoItemController.$inject = ['PedidoItemService', 'ProdutoPorModeloECorService', '$scope'];\r\n\r\n/**\r\n * Controller.\r\n */\r\nfunction PedidoItemController(PedidoItemService, ProdutoPorModeloECorService, $scope) {\r\n\r\n\tvar ctrl = this;\r\n\r\n\t/**\r\n\t * MÉTODOS (REFERÊNCIAS).\r\n\t */\r\n\tctrl.consultarProdutoPorModeloECor \t= consultarProdutoPorModeloECor;\r\n\tctrl.consultarTamanhoComPreco\t\t= consultarTamanhoComPreco;\r\n\tctrl.somaQuantidade \t\t\t\t= somaQuantidade;\r\n\tctrl.consultarQuantidadeMin\t\t\t= consultarQuantidadeMin;\r\n\tctrl.incluirPedidoItem\t\t\t\t= incluirPedidoItem;\r\n\tctrl.verificarQuantidadeModelo \t\t= verificarQuantidadeModelo;\r\n\tctrl.arredondarQuantidadeModelo\t\t= arredondarQuantidadeModelo;\r\n\tctrl.calcularTabelaQtdMinima \t\t= calcularTabelaQtdMinima;\r\n\tctrl.preencherTabelaQtdMinima \t\t= preencherTabelaQtdMinima;\r\n\tctrl.verificarCampoPedidoItem\t\t= verificarCampoPedidoItem;\r\n\tctrl.alterarModelo\t\t\t\t\t= alterarModelo;\r\n\tctrl.alterarCor \t\t\t\t\t= alterarCor;\r\n\tctrl.limparPedidoItem\t\t\t\t= limparPedidoItem;\r\n\tctrl.limparQuantidade\t\t\t\t= limparQuantidade;\r\n\tctrl.fecharModal\t\t\t\t\t= fecharModal;\r\n\r\n\t/**\r\n\t * VARIÁVEIS.\r\n\t */\r\n\tctrl.pedidoItem = {};\r\n\t// ctrl.pedidoItem.qtdValida = false;\r\n\r\n\tthis.$onInit = function() {\r\n\r\n\t\tctrl.pedidoIndex12040.pedidoItem  = this;\r\n\r\n\t};\r\n\t\r\n\t// Consultar produto ao escolher uma cor.\r\n\t$scope.$watch('$ctrl.pedidoItem.cor', function() {\r\n\r\n\t\tif (ctrl.pedidoItem.modelo != undefined) {\r\n\t\t\t\r\n\t\t\tctrl.consultarProdutoPorModeloECor(\r\n\t\t\t\tctrl.pedidoItem.modelo.MODELO_CODIGO, \r\n\t\t\t\tctrl.pedidoItem.cor.CODIGO\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/**\r\n\t * MÉTODOS.\r\n\t */\r\n\r\n\t/**\r\n\t * Consultar Produto por Modelo e Cor.\r\n\t */\r\n\tfunction consultarProdutoPorModeloECor(modeloId, corId) {\r\n\r\n\t\tif (corId == undefined)\r\n\t\t\treturn false;\r\n\r\n\t\tProdutoPorModeloECorService\r\n\t\t\t.consultarProdutoPorModeloECor(modeloId, corId)\r\n\t\t\t.then(function(response) {\r\n\r\n\t\t\t\tctrl.pedidoItem.produto = response;\r\n\t\t\t\tctrl.consultarTamanhoComPreco();\r\n\t\t\t})\r\n\t\t;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Consultar Tamanho com Preço.\r\n\t */\r\n\tfunction consultarTamanhoComPreco() {\r\n\r\n\t\tvar filtro = {\r\n\t\t\tCLIENTE_ID \t: (ctrl.pedidoIndex12040.filtroCliente.cliente !== undefined) \r\n\t\t\t\t\t\t\t? parseInt(ctrl.pedidoIndex12040.filtroCliente.cliente.CODIGO) \r\n\t\t\t\t\t\t\t: 0,\r\n\t\t\tPRODUTO_ID \t: ctrl.pedidoItem.produto.CODIGO,\r\n\t\t\tMODELO_ID \t: ctrl.pedidoItem.modelo.MODELO_CODIGO,\r\n\t\t\tGRADE_ID \t: ctrl.pedidoItem.produto.GRADE_CODIGO,\r\n\t\t\tCOR_ID\t\t: ctrl.pedidoItem.cor.CODIGO\r\n\t\t};\r\n\r\n\t\tPedidoItemService\r\n\t\t\t.consultarTamanhoComPreco(filtro)\r\n\t\t\t.then(function(response) {\r\n\r\n\t\t\t\tctrl.tamanhoPreco = response; \r\n\r\n\t\t\t\t// Verificar se todos os tamanhos estão bloqueados para pedido.\r\n\t\t\t\tvar tam = '',\r\n\t\t\t\t\tblq = 0\r\n\t\t\t\t;\r\n\r\n\t\t\t\tfor (var i in ctrl.tamanhoPreco) {\r\n\r\n\t\t\t\t\ttam = ctrl.tamanhoPreco[i];\r\n\t\t\t\t\tblq += (parseInt(tam.BLQ_PED));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ctrl.tamanhoPreco.length === blq)\r\n\t\t\t\t\tshowAlert('SKU bloqueado para pedido.');\r\n\t\t\t})\r\n\t\t;\r\n\t}\r\n\r\n\t/**\r\n\t * Somar quantidade e valor unitário dos tamanhos escolhidos pelo cliente.\r\n\t */\r\n\tfunction somaQuantidade() {\r\n\r\n\t\tvar qtd \t\t= 0,\r\n\t\t\tsomaQtd \t= 0,\r\n\t\t\tsomaVlrUnit = 0\r\n\t\t;\r\n\r\n\t\t// ctrl.pedidoItem.qtdValida = false;\r\n\r\n\t\tfor(var i in ctrl.tamanhoPreco) {\r\n\r\n\t\t\tqtd = parseInt(ctrl.tamanhoPreco[i]['quantidade']);\r\n\r\n\t\t\tif (isNaN(qtd)) \r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tsomaQtd \t+= qtd;\r\n\t\t\tsomaVlrUnit += ( (qtd > 0) ? (parseFloat(ctrl.tamanhoPreco[i]['TAMANHO_PRECO']) * qtd) : 0 );\r\n\r\n\t\t}\r\n\r\n\t\tctrl.quantidadeTotal = somaQtd;\r\n\t\tctrl.valorTotal \t = somaVlrUnit;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Verificar se a quantidade passada é adequada para o tamanho.\r\n\t *\r\n\t * @param json tamanho\r\n\t * @param integer qtd\r\n\t * @param json cor\r\n\t * @param json pedidoItemEscolhido\r\n\t */\r\n\tfunction consultarQuantidadeMin(tamanho, qtd, cor, pedidoItemEscolhido) {\r\n\r\n\t\tvar filtro = {\r\n\t\t\t\tCOR_ID\t\t: ctrl.pedidoItem.cor.CODIGO,\r\n\t\t\t\tDATA \t\t: moment().format('YYYY-MM-DD'),\r\n\t\t\t\tPRODUTO_ID \t: ctrl.pedidoItem.produto.CODIGO,\r\n\t\t\t\tTAMANHO_ID \t: tamanho.TAMANHO,\r\n\t\t\t\tMODELO_ID\t: ctrl.pedidoItem.modelo.MODELO_CODIGO,\r\n\t\t\t\tFAMILIA_ID\t: ctrl.pedidoItem.modelo.FAMILIA_CODIGO,\r\n\t\t\t\tCHAVE \t\t: ctrl.pedidoCreate12040.infoGeral.infoGeral.CHAVE\r\n\t\t\t}\r\n\t\t;\r\n\r\n\t\tPedidoItemService\r\n\t\t\t.consultarQtdEPrazoPorTamanho(filtro)\r\n\t\t\t.then(function(response) {\r\n\r\n\t\t\t\tvar\tcorSobEnc \t\t= parseFloat(response.COR_SOBENCOMENDA),\r\n\t\t\t\t\tpzoCliCorSobEnc\t= parseInt(response.PZO_CLI_COR_SOBENC),\r\n\t\t\t\t\tpzoCliCorEstMin\t= parseInt(response.PZO_CLI_COR_ESTMIN),\r\n\t\t\t\t\tpzoCliCorNormal = parseInt(response.PZO_CLI_COR_NORMAL),\r\n\t\t\t\t\tdataIdeal\t\t= '',\r\n\t\t\t\t\testMin \t\t\t= parseInt(response.EST_MIN),\r\n\t\t\t\t\tperfilId \t\t= response.ID,\r\n\t\t\t\t\tperfilDescricao\t= response.DESCRICAO\r\n\t\t\t\t;\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tctrl.calcularTabelaQtdMinima(response, qtd, cor);\r\n\r\n\t\t\t\t// Define a data ideal (previsão de faturamento) por item.\r\n\t\t\t\tif (corSobEnc === 1)\r\n\t\t\t\t\tdataIdeal = moment().add(pzoCliCorSobEnc, 'days');\r\n\t\t\t\telse if (estMin === 1)\r\n\t\t\t\t\tdataIdeal = moment().add(pzoCliCorEstMin, 'days');\r\n\t\t\t\telse\r\n\t\t\t\t\tdataIdeal = moment().add(pzoCliCorNormal, 'days');\r\n\r\n\t\t\t\tpedidoItemEscolhido.dataIdeal = moment(dataIdeal).format('DD/MM/YYYY');\r\n\r\n\t\t\t\t// Perfil de sku do item.\r\n\t\t\t\tpedidoItemEscolhido.perfilId \t\t= perfilId;\r\n\t\t\t\tpedidoItemEscolhido.perfilDescricao = perfilDescricao;\r\n\r\n\t\t\t\t// Define a data ideal (previsão de faturamento) do pedido,\r\n\t\t\t\t// ou seja, a maior data entre os itens.\r\n\t\t\t\tif (ctrl.tamanhoPreco.indexOf(tamanho) == (ctrl.tamanhoPreco.length - 1))\t// último item da lista com os tamanhos e quantidades.\r\n\t\t\t\t\tctrl.definirDataCliente();\r\n\r\n\r\n\t\t\t\t// Verificar se a quantidade digitada é maior que a quantidade mínima \r\n\t\t\t\t// e múltipla da quantidade múltipla.\r\n\t\t\t\t/*if ( (qtd < qtdMin) || ((qtd % qtdMult) != 0) ) {\r\n\r\n\t\t\t\t\tshowErro('Quantidade deve ser maior que '+qtdMin+' e múltipla de '+qtdMult+'.');\r\n\r\n\t\t\t\t\ttamanho.quantidade \t\t\t= null;\r\n\t\t\t\t\tctrl.pedidoItem.qtdValida \t= false;\r\n\r\n\t\t\t\t\tctrl.somaQuantidade();\t// ng-change não é acionado quando o valor é alterado via script.\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\tctrl.pedidoItem.qtdValida = true;\r\n\t\t\t\t}*/\r\n\r\n\t\t\t})\r\n\t\t;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Incluir itens ao pedido.\r\n\t */\r\n\tfunction incluirPedidoItem() {\r\n\r\n\t\tif (!verificarCampoPedidoItem())\r\n\t\t\treturn false;\r\n\r\n\t\tvar tamPreco  \t= 0,\r\n\t\t\ttamId\t  \t= 0,\r\n\t\t\ttamDesc\t  \t= 0,\r\n\t\t\tqtd \t  \t= 0,\r\n\t\t\tvlr \t  \t= 0,\r\n\t\t\tsequencia \t= 0,\r\n\t\t\tcor \t  \t= ''\r\n\t\t;\r\n\r\n\t\tif (ctrl.pedidoItemEscolhido == undefined)\r\n\t\t\tctrl.pedidoItemEscolhido = [];\r\n\r\n\t\telse if (ctrl.pedidoItemEscolhido.length > 0)\r\n\t\t\tsequencia = ctrl.pedidoItemEscolhido.length;\r\n\r\n\t\tfor (var i in ctrl.tamanhoPreco) {\r\n\r\n\t\t\ttamPreco \t= ctrl.tamanhoPreco[i];\r\n\t\t\tqtd \t \t= parseInt(tamPreco.quantidade);\r\n\t\t\tvlr \t \t= parseFloat(tamPreco.TAMANHO_PRECO);\r\n\t\t\ttamId\t \t= parseInt(tamPreco.TAMANHO);\r\n\t\t\ttamDesc\t \t= parseInt(tamPreco.TAMANHO_DESCRICAO);\r\n\r\n\t\t\tif ( qtd > 0 ) {\r\n\r\n\t\t\t\tsequencia += 1;\r\n\t\t\t\t\r\n\t\t\t\tctrl.pedidoItemEscolhido.push({\r\n\t\t\t\t\tsequencia \t\t: sequencia,\r\n\t\t\t\t\tmodelo \t \t\t: ctrl.pedidoItem.modelo,\r\n\t\t\t\t\tproduto \t\t: ctrl.pedidoItem.produto,\r\n\t\t\t\t\tcor \t\t\t: ctrl.pedidoItem.cor,\r\n\t\t\t\t\ttamanhoId\t\t: tamId,\r\n\t\t\t\t\ttamanhoDescricao: tamDesc,\r\n\t\t\t\t\tquantidade \t\t: qtd,\r\n\t\t\t\t\tvalorUnitario\t: vlr,\r\n\t\t\t\t\tvalorTotal\t\t: vlr * qtd,\r\n\t\t\t\t\testMin \t\t\t: tamPreco.EST_MIN\r\n\t\t\t\t});\r\n\r\n\t\t\t\tctrl.consultarQuantidadeMin(\r\n\t\t\t\t\ttamPreco, \r\n\t\t\t\t\tqtd, \r\n\t\t\t\t\tctrl.pedidoItem.cor, \r\n\t\t\t\t\tctrl.pedidoItemEscolhido[ctrl.pedidoItemEscolhido.length - 1]\r\n\t\t\t\t);\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\r\n\t\tctrl.somaQuantidadeGeral();\r\n\t\tctrl.limparPedidoItem();\r\n\t\tctrl.fecharModal();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Definir informações para a tabela de quantidade mínima das cores.\r\n\t *\r\n\t * Quantidade e cor virão como parâmetro quando um item estiver sendo incluído;\r\n\t * do contrário, esses campos vem da consulta de item de pedido (no parâmetro item) (ao exibir).\r\n\t */\r\n\tfunction calcularTabelaQtdMinima(item, qtd, cor) {\r\n\r\n\t\tqtd = (qtd !== undefined) ? qtd : parseFloat(item.QUANTIDADE);\r\n\t\t\r\n\t\tif (cor === undefined) {\r\n\t\t\tcor \t\t\t= {};\r\n\t\t\tcor.CODIGO \t\t= item.COR_ID;\r\n\t\t\tcor.DESCRICAO \t= item.COR_DESCRICAO;\r\n\t\t}\r\n\r\n\t\tvar qtdMinPerfil  \t= parseFloat(item.QTD_MIN),\r\n\t\t\tqtdMinModelo  \t= parseFloat(item.QTD_MIN_MODELO),\r\n\t\t\tqtdMinSobEnc  \t= parseFloat(item.QTD_MIN_SOBENC),\r\n\t\t\tqtdMinLiberada \t= parseInt(item.QTD_MIN_LIBERADA),\r\n\t\t\tqtdMultPerfil \t= parseFloat(item.QTD_MULT),\r\n\t\t\tqtdMultModelo \t= parseFloat(item.QTD_MULT_MODELO),\r\n\t\t\tqtdMultSobEnc \t= parseFloat(item.QTD_MULT_SOBENC),\r\n\t\t\tcorSobEnc \t\t= parseFloat(item.COR_SOBENCOMENDA),\r\n\t\t\tqtdMin \t\t\t= 0,\r\n\t\t\tqtdMult \t\t= 0\r\n\t\t;\r\n\r\n\t\t// Define a quantidade mínima:\r\n\t\t// se a cor tiver quantidade mínima redefinida (liberada através da chave), essa será considerada;\r\n\t\t// se a cor for sobencomenda e tiver quantidade mínima, essa será considerada;\r\n\t\t// se houver quantidade mínima no perfil, ela será considerada;\r\n\t\t// senão, será considerada a definida no modelo.\r\n\t\tif (qtdMinLiberada > 0)\r\n\t\t\tqtdMin = qtdMinLiberada;\r\n\t\telse if (corSobEnc === 1 && qtdMinSobEnc > 0)\r\n\t\t\tqtdMin = qtdMinSobEnc;\r\n\t\telse if (qtdMinPerfil > 0)\r\n\t\t\tqtdMin = qtdMinPerfil;\r\n\t\telse if (qtdMinModelo > 0)\r\n\t\t\tqtdMin = qtdMinModelo;\r\n\r\n\t\t// Define a quantidade múltipla:\r\n\t\t// se a cor for sobencomenda e tiver quantidade múltipla, essa será considerada;\r\n\t\t// se houver quantidade múltipla no perfil, ela será considerada;\r\n\t\t// senão, será considerada a definida no modelo.\r\n\t\tif (corSobEnc === 1 && qtdMultSobEnc > 0)\r\n\t\t\tqtdMult = qtdMultSobEnc;\r\n\t\telse if (qtdMultPerfil > 0)\r\n\t\t\tqtdMult = qtdMultPerfil;\r\n\t\telse if (qtdMultModelo > 0)\r\n\t\t\tqtdMult = qtdMultModelo;\r\n\r\n\t\t// Tabela de quantidade mínima por cor.\r\n\t\tctrl.preencherTabelaQtdMinima(qtd, qtdMin, qtdMult, cor);\r\n\t}\r\n\r\n\t/**\r\n\t * Preencher tabela de quantidade mínima das cores.\r\n\t */\r\n\tfunction preencherTabelaQtdMinima(qtd, qtdMin, qtdMult, cor) {\r\n\r\n\t\tvar item \t  = '',\r\n\t\t\tcorExiste = false,\r\n\t\t\tcorEsc \t  = ''\r\n\t\t;\r\n\r\n\t\t// Cores escolhidas vazia\r\n\t\tif (ctrl.corEscolhida.length === 0) {\r\n\r\n\t\t\tctrl.corEscolhida.push({\r\n\t\t\t\tcodigo \t\t\t\t: cor.CODIGO,\r\n\t\t\t\tdescricao \t\t\t: cor.DESCRICAO,\r\n\t\t\t\tquantidade \t\t\t: qtd,\r\n\t\t\t\tquantidadeMinima\t: qtdMin,\r\n\t\t\t\tquantidadeMultipla\t: qtdMult\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\tfor (var j in ctrl.corEscolhida) {\r\n\r\n\t\t\t\tcorEsc = ctrl.corEscolhida[j];\r\n\r\n\t\t\t\tif (parseInt(corEsc.codigo) === parseInt(cor.CODIGO)) {\r\n\r\n\t\t\t\t\tcorExiste = true;\r\n\t\t\t\t\tcorEsc.quantidade += qtd;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// se a cor não foi escolhida ainda\r\n\t\t\tif (corExiste === false) {\r\n\r\n\t\t\t\tctrl.corEscolhida.push({\r\n\t\t\t\t\tcodigo \t\t\t\t: cor.CODIGO,\r\n\t\t\t\t\tdescricao \t\t\t: cor.DESCRICAO,\r\n\t\t\t\t\tquantidade \t\t\t: qtd,\r\n\t\t\t\t\tquantidadeMinima\t: qtdMin,\r\n\t\t\t\t\tquantidadeMultipla\t: qtdMult\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Verificar campos.\r\n\t */\r\n\tfunction verificarCampoPedidoItem() {\r\n\r\n\t\tvar ret = true,\r\n\t\t\tqtd\t= 0\r\n\t\t;\r\n\r\n\t\tif (ctrl.pedidoItem == undefined) {\r\n\t\t\tshowErro('Campos vazios.');\r\n\t\t\tret = false;\r\n\t\t}\r\n\t\telse if (ctrl.pedidoItem.modelo == undefined) {\r\n\t\t\tshowErro('Escolha um modelo.');\r\n\t\t\tret = false;\r\n\t\t}\r\n\t\telse if (ctrl.pedidoItem.cor == undefined) {\r\n\t\t\tshowErro('Escolha uma cor.');\r\n\t\t\tret = false;\t\r\n\t\t}\r\n\t\t// Quantidades.\r\n\t\telse {\r\n\r\n\t\t\t// Analisar quantidades da grade.\r\n\t\t\tfor (var i in ctrl.tamanhoPreco)\r\n\t\t\t\tqtd += (ctrl.tamanhoPreco[i].quantidade === undefined) ? 0 : parseFloat(ctrl.tamanhoPreco[i].quantidade);\r\n\r\n\t\t\tif (qtd === 0) {\r\n\t\t\t\tshowErro('Digite a quantidade.');\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\r\n\t\t\t// if (ctrl.pedidoItem.qtdValida == undefined || ctrl.pedidoItem.qtdValida == false) {\r\n\t\t\t// \tret = false;\r\n\t\t\t// }\r\n\r\n\t\t\telse if ( !ctrl.verificarQuantidadeModelo() ) {\r\n\t\t\t\tshowErro('Quantidade deve obedecer ao valor mínimo e múltiplo do Modelo.');\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Verificar se a quantidade passada é adequada para o tamanho de acordo com o modelo.\r\n\t */\r\n\tfunction verificarQuantidadeModelo() {\r\n\t\t\r\n\t\tvar tam \t\t\t= {},\r\n\t\t\tret \t\t\t= true,\r\n\t\t\tqtdMinModelo \t= 0,\r\n\t\t\tqtdMultModelo \t= 0,\r\n\t\t\tqtd \t\t\t= 0\r\n\t\t;\r\n\r\n\t\t// Analisar quantidades da grade.\r\n\t\tfor (var i in ctrl.tamanhoPreco) {\r\n\r\n\t\t\ttam = ctrl.tamanhoPreco[i];\r\n\r\n\t\t\tqtdMinModelo  \t= parseInt(tam.QTD_MIN_MODELO);\r\n\t\t\tqtdMultModelo \t= parseInt(tam.QTD_MULT_MODELO);\r\n\t\t\tqtd \t\t\t= (tam.quantidade === undefined || tam.quantidade === null) ? 0 : parseFloat(tam.quantidade);\r\n\r\n\t\t\tif ( (qtd > 0) )\r\n\t\t\t\tif ( (qtd < qtdMinModelo) || ((qtd % qtdMultModelo) != 0) )\r\n\t\t\t\t\tret = false;\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t}\r\n\r\n\t/**\r\n\t * Arredondar quantidade de acordo com a quantidade mínima e múltipla do modelo.\r\n\t */\r\n\tfunction arredondarQuantidadeModelo(tamanhoPreco) {\r\n\r\n\t\tvar qtd \t= parseFloat(tamanhoPreco.quantidade),\r\n\t\t\tqtdMin  = parseInt(tamanhoPreco.QTD_MIN_MODELO),\r\n\t\t\tqtdMult = parseInt(tamanhoPreco.QTD_MULT_MODELO)\r\n\t\t;\r\n\r\n\t\tqtd = Math.round(qtd);\r\n\r\n\t\tif (qtd < qtdMin)\r\n\t\t\ttamanhoPreco.quantidade = qtdMin;\r\n\r\n\t\telse if ((qtd % qtdMult) != 0)\r\n\t\t\ttamanhoPreco.quantidade = qtd + qtdMult - qtd % qtdMult;\r\n\r\n\t\tctrl.somaQuantidade();\r\n\t}\r\n\r\n\t/**\r\n\t * Alterar modelo.\r\n\t */\r\n\tfunction alterarModelo() {\r\n\r\n\t\tif (ctrl.pedidoItem.cor === undefined) {\r\n\r\n\t\t\tctrl.modeloPorCliente.consultarModeloPorCliente();\r\n\t\t\t$('#modal-consultar-modelo-por-cliente').modal('show');\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\taddConfirme(\r\n\t\t\t\t'<h4>Confirmação</h4>',\r\n\t        \t'Ao alterar o Modelo, a Cor e as Quantidades serão redefinidas. Deseja continuar?',\r\n\t        \t[obtn_sim, obtn_nao],\r\n\t        \t[\r\n\t            \t{\r\n\t            \t\tret: 1,\r\n\t            \t\tfunc: function() {\r\n\r\n\t            \t\t\tctrl.limparPedidoItem();\r\n\t            \t\t\tctrl.modeloPorCliente.consultarModeloPorCliente();\r\n\t            \t\t\t$('#modal-consultar-modelo-por-cliente').modal('show');\r\n\t            \t\t}\r\n\t            \t},\r\n\t            \t{\r\n\t            \t\tret: 2,\r\n\t            \t\tfunc: function() {}\r\n\t            \t}\r\n\t        \t]\r\n\t        );\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Alterar cor.\r\n\t */\r\n\tfunction alterarCor() {\r\n\r\n\t\t// Modelo vazio.\r\n\t\tif (ctrl.pedidoItem.modelo === undefined) {\r\n\r\n\t\t\tshowAlert('Escolha um modelo.');\r\n\t\t}\r\n\t\t// Cor vazia.\r\n\t\telse if (ctrl.pedidoItem.cor === undefined) {\r\n\r\n\t\t\tctrl.corPorModelo.consultarCorPorModelo();\r\n\t\t\t$('#modal-consultar-cor-por-modelo').modal('show');\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\taddConfirme(\r\n\t\t\t\t'<h4>Confirmação</h4>',\r\n\t        \t'Ao alterar a Cor, as Quantidades serão redefinidas. Deseja continuar?',\r\n\t        \t[obtn_sim, obtn_nao],\r\n\t        \t[\r\n\t            \t{\r\n\t            \t\tret: 1,\r\n\t            \t\tfunc: function() {\r\n\r\n\t            \t\t\tctrl.limparQuantidade();\r\n\t            \t\t\tctrl.corPorModelo.consultarCorPorModelo();\r\n\t            \t\t\t$('#modal-consultar-cor-por-modelo').modal('show');\r\n\t            \t\t}\r\n\t            \t},\r\n\t            \t{\r\n\t            \t\tret: 2,\r\n\t            \t\tfunc: function() {}\r\n\t            \t}\r\n\t        \t]\r\n\t        );\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Limpar itens de pedido.\r\n\t */\r\n\tfunction limparPedidoItem() {\r\n\r\n\t\tctrl.pedidoItem \t\t\t= {};\r\n\t\tctrl.pedidoItem.qtdValida \t= false;\r\n\r\n\t\tctrl.limparQuantidade();\r\n\t}\r\n\r\n\t/**\r\n\t * Limpar quantidades.\r\n\t */\r\n\tfunction limparQuantidade() {\r\n\r\n\t\tctrl.tamanhoPreco\t\t\t= [];\r\n\t\tctrl.quantidade \t\t\t= [];\r\n\t\tctrl.quantidadeTotal \t\t= 0;\r\n\t\tctrl.valorUnitario \t\t\t= [];\r\n\t\tctrl.valorTotal \t\t\t= 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Fechar modal.\r\n\t */\r\n\tfunction fecharModal() {\r\n\r\n\t\tif (ctrl.pedidoItem.modelo !== undefined) {\r\n\r\n\t\t\taddConfirme(\r\n\t\t\t\t'<h4>Confirmação</h4>',\r\n\t        \t'Os dados serão perdidos. Deseja continuar?',\r\n\t        \t[obtn_sim, obtn_nao],\r\n\t        \t[\r\n\t            \t{\r\n\t            \t\tret: 1,\r\n\t            \t\tfunc: function() {\r\n\r\n\t            \t\t\tfechar();\r\n\t            \t\t\tctrl.limparPedidoItem();\r\n\t            \t\t\t$scope.$apply();\r\n\t            \t\t}\r\n\t            \t},\r\n\t            \t{\r\n\t            \t\tret: 2,\r\n\t            \t\tfunc: function() {}\r\n\t            \t}\r\n\t        \t]\r\n\t        );\r\n\t\t}\r\n\t\telse\r\n\t\t\tfechar();\r\n\r\n\r\n\t\tfunction fechar() {\r\n\r\n\t\t\t$('#modal-pedido-item')\r\n\t\t\t\t.modal('hide')\r\n\t\t\t\t.find('.modal-body')\r\n\t\t\t\t.animate({ scrollTop: 0 }, 'fast')\r\n\t\t\t;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n}","angular\r\n\t.module('app')\r\n\t.service('ModeloPorClienteService', ModeloPorClienteService)\r\n\t.controller('ModeloPorClienteController', ModeloPorClienteController)\r\n\t.component('modeloPorCliente27020', {\r\n\t\ttemplateUrl: '/_27020/modalModeloPorCliente',\r\n\t\trequire: {\r\n\t\t\tpedidoIndex12040: '^pedidoIndex12040',\r\n\t\t\tpedidoItem12040\t: '^pedidoItem12040'\r\n\t\t},\r\n\t\tcontroller: 'ModeloPorClienteController'\r\n\t})\r\n;","ModeloPorClienteService.$inject = ['$ajax', '$filter'];\r\n\r\nfunction ModeloPorClienteService($ajax, $filter) {\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tthis.consultarModeloPorCliente = consultarModeloPorCliente;\r\n\t\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar modelo por cliente.\r\n\t */\r\n    function consultarModeloPorCliente(filtro) {\r\n\r\n\t\tvar url = '/_27020/consultarModeloPorCliente';\r\n\r\n\t\treturn $ajax.post(url, JSON.stringify(filtro), {contentType: 'application/json'});\r\n\r\n\t}\r\n\r\n}\r\n","ModeloPorClienteController.$inject = ['ModeloPorClienteService'];\r\n\r\nfunction ModeloPorClienteController(ModeloPorClienteService) {\r\n\r\n\tvar ctrl = this;\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tctrl.consultarModeloPorCliente \t\t= consultarModeloPorCliente;\r\n\tctrl.selecionarModeloPorCliente \t= selecionarModeloPorCliente;\r\n\tctrl.verArquivo \t\t\t\t\t= verArquivo;\r\n\tctrl.excluirArquivo\t\t\t\t\t= excluirArquivo;\r\n\tctrl.excluirArquivoPorUsuario\t\t= excluirArquivoPorUsuario;\r\n\tctrl.fecharModal\t\t\t\t\t= fecharModal;\r\n\r\n\t// VARIÁVEIS\r\n\tctrl.listaModeloPorCliente\t= [];\r\n\r\n\tthis.$onInit = function() {\r\n\r\n\t\tctrl.pedidoIndex12040.modeloPorCliente = this;\r\n\t\tctrl.pedidoItem12040.modeloPorCliente = this;\r\n\r\n\t};\r\n\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar modelo por cliente.\r\n\t */\r\n\tfunction consultarModeloPorCliente() {\r\n\r\n\t\tvar filtro = {\r\n\t\t\tCLIENTE_ID: (ctrl.pedidoIndex12040.filtroCliente.cliente !== undefined) \r\n\t\t\t\t\t\t\t? ctrl.pedidoIndex12040.filtroCliente.cliente.CODIGO \r\n\t\t\t\t\t\t\t: 0\r\n\t\t};\r\n\r\n\t\tModeloPorClienteService\r\n\t\t\t.consultarModeloPorCliente(filtro)\r\n\t\t\t.then(function(response) { \r\n\t\t\t\tctrl.listaModeloPorCliente = response; \r\n\t\t\t})\r\n\t\t;\r\n\r\n\t\tctrl.filtrarModeloPorCliente = '';\r\n\t\t\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\t// Fix para vs-repeat.\r\n\t\t\t$('.table-container-modelo-por-cliente')\r\n\t\t\t\t.find('.scroll-table')\r\n\t\t\t\t.trigger('resize')\r\n\t\t\t\t.scrollTop(0);\r\n\r\n\t\t\t// Foco no input de filtrar.\r\n\t\t\t$('.input-filtrar-modelo').focus();\r\n\r\n\t\t}, 500);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Selecionar modelo.\r\n\t */\r\n\tfunction selecionarModeloPorCliente($event, modelo) {\r\n\r\n\t\t// Não selecionar caso seja clicado para ver amostra.\r\n\t\tif ( $($event.target).hasClass('amostra') || $($event.target).hasClass('amostra-icone') )\r\n\t\t\treturn false;\r\n\r\n\t\tctrl.pedidoItem12040.pedidoItem.modelo = modelo;\r\n\t\tctrl.fecharModal();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Ver amostra.\r\n\t */\r\n\tfunction verArquivo(modeloId) {\r\n\r\n\t\tvar nome = modeloId+'.JPG',\r\n\t\t\ttipo = 'JPG'\r\n\t\t;\r\n\r\n\t\t$('.visualizar-arquivo')\r\n\t\t\t.children('a')\r\n\t\t\t.attr('href', '/assets/temp/modelo/'+nome)\r\n\t\t\t.parent()\r\n\t\t\t.children('input.arquivo_nome_deletar')\r\n\t\t\t.val(nome)\r\n\t\t\t.parent()\r\n\t\t\t.children('object')\r\n\t\t\t.attr('data', '/assets/temp/modelo/'+nome)\r\n\t\t\t.removeClass()\r\n\t\t\t.addClass(tipo)\r\n\t\t\t.parent()\t\t\t\t\r\n\t\t\t.fadeIn()\r\n\t\t;\r\n\t\t/*\r\n\t    //ajax\r\n\t\tvar type\t= 'POST',\r\n\t\t\turl\t\t= '/_27020/verArquivo',\r\n\t\t\tdata\t= {\r\n\t\t\t\tmodeloId: modeloId\r\n\t\t\t},\r\n\t\t\tsuccess = function(data) {\r\n\r\n\t        \tvar nome = data,\r\n\t\t\t\t\ttipo = nome.split(\".\").pop()\r\n\t\t\t\t;\r\n\t\t\r\n\t\t\t\t$('.visualizar-arquivo')\r\n\t\t\t\t\t.children('a')\r\n\t\t\t\t\t.attr('href', '/assets/temp/modelo/'+nome)\r\n\t\t\t\t\t.parent()\r\n\t\t\t\t\t.children('input.arquivo_nome_deletar')\r\n\t\t\t\t\t.val(nome)\r\n\t\t\t\t\t.parent()\r\n\t\t\t\t\t.children('object')\r\n\t\t\t\t\t.attr('data', '/assets/temp/modelo/'+nome)\r\n\t\t\t\t\t.removeClass()\r\n\t\t\t\t\t.addClass(tipo)\r\n\t\t\t\t\t.parent()\t\t\t\t\r\n\t\t\t\t\t.fadeIn()\r\n\t\t\t\t;\r\n\r\n\t        }\r\n\t    ;\r\n\t\t\r\n\t\texecAjax1(type, url, data, success, null, null, false);\r\n\t\t*/\r\n\t}\r\n\r\n\t/**\r\n\t * Excluir amostra.\r\n\t */\r\n\tfunction excluirArquivo() {\r\n\r\n\t\t$('.visualizar-arquivo').fadeOut();\r\n\r\n\t    //ajax\r\n\t\tvar type\t= 'POST',\r\n\t\t\turl\t\t= '/_27020/excluirArquivo',\r\n\t\t\tdata\t= {\r\n\t\t\t\tarquivo: $('.arquivo_nome_deletar').val()\r\n\t\t\t}\r\n\t    ;\r\n\t\t\r\n\t\texecAjax1(type, url, data, null, null, null, false);\r\n\t}\r\n\r\n\tfunction excluirArquivoPorUsuario() {\r\n\r\n\t    //ajax\r\n\t\tvar type\t= 'POST',\r\n\t\t\turl\t\t= '/_27020/excluirArquivoPorUsuario'\r\n\t    ;\r\n\t\t\r\n\t\texecAjax1(type, url, null, null, null, null, false);\r\n\t}\r\n\r\n\t/**\r\n\t * Fechar modal.\r\n\t */\r\n\tfunction fecharModal() {\r\n\r\n\t\t$('#modal-consultar-modelo-por-cliente')\r\n\t\t\t.modal('hide')\r\n\t\t\t.find('.modal-body')\r\n\t\t\t.animate({ scrollTop: 0 }, 'fast')\r\n\t\t;\r\n\r\n\t\tctrl.excluirArquivoPorUsuario();\r\n\t}\r\n\r\n}","angular\r\n\t.module('app')\r\n\t.service('CorPorModeloService', CorPorModeloService)\r\n\t.controller('CorPorModeloController', CorPorModeloController)\r\n\t.component('corPorModelo27030', {\r\n\t\ttemplateUrl: '/_27030/viewCorPorModelo',\r\n\t\trequire: {\r\n\t\t\tpedidoIndex12040: '^pedidoIndex12040',\r\n\t\t\tpedidoItem12040: '^pedidoItem12040'\r\n\t\t},\r\n\t\tcontroller: 'CorPorModeloController'\r\n\t})\r\n;","CorPorModeloService.$inject = ['$ajax', '$filter'];\r\n\r\nfunction CorPorModeloService($ajax, $filter) {\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tthis.consultarCorPorModelo = consultarCorPorModelo;\r\n\t\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar cor por modelo.\r\n\t */\r\n    function consultarCorPorModelo(param) {\r\n\r\n\t\tvar url = '/_27030/consultarCorPorModelo';\r\n\r\n\t\treturn $ajax.post(url, JSON.stringify(param), {contentType: 'application/json'});\r\n\r\n\t}\r\n\r\n}\r\n","CorPorModeloController.$inject = ['CorPorModeloService'];\r\n\r\nfunction CorPorModeloController(CorPorModeloService) {\r\n\r\n\tvar ctrl = this;\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tctrl.consultarCorPorModelo \t= consultarCorPorModelo;\r\n\tctrl.selecionarCorPorModelo = selecionarCorPorModelo;\r\n\tctrl.fecharModal \t\t\t= fecharModal;\r\n\r\n\t// VARIÁVEIS\r\n\tctrl.listaCorPorModelo\t= [];\r\n\r\n\tthis.$onInit = function() {\r\n\r\n\t\tctrl.pedidoItem12040.corPorModelo = this;\r\n\r\n\t};\r\n\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar cor por modelo.\r\n\t */\r\n\tfunction consultarCorPorModelo() {\r\n\r\n\t\tvar param = {\r\n\t\t\tCLIENTE_ID \t: (ctrl.pedidoIndex12040.filtroCliente.cliente !== undefined) ? parseInt(ctrl.pedidoIndex12040.filtroCliente.cliente.CODIGO) : 0,\r\n\t\t\tMODELO_ID \t: parseInt(ctrl.pedidoItem12040.pedidoItem.modelo.MODELO_CODIGO)\r\n\t\t};\r\n\r\n\t\tCorPorModeloService\r\n\t\t\t.consultarCorPorModelo(param)\r\n\t\t\t.then(function(response) { \r\n\t\t\t\tctrl.listaCorPorModelo = response; \r\n\t\t\t})\r\n\t\t;\r\n\r\n\t\tctrl.filtrarCorPorModelo = '';\r\n\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\t// Fix para vs-repeat.\r\n\t\t\t$('.table-container-cor-por-modelo')\r\n\t\t\t\t.find('.scroll-table')\r\n\t\t\t\t.trigger('resize')\r\n\t\t\t\t.scrollTop(0);\r\n\r\n\t\t\t// Foco no input de filtrar.\r\n\t\t\t$('.input-filtrar-cor-por-modelo').focus();\r\n\r\n\t\t}, 500);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Selecionar cor.\r\n\t */\r\n\tfunction selecionarCorPorModelo(cor) {\r\n\r\n\t\tctrl.pedidoItem12040.pedidoItem.cor = cor;\r\n\t\tctrl.fecharModal();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Fechar modal.\r\n\t */\r\n\tfunction fecharModal() {\r\n\r\n\t\t$('#modal-consultar-cor-por-modelo')\r\n\t\t\t.modal('hide')\r\n\t\t\t.find('.modal-body')\r\n\t\t\t.animate({ scrollTop: 0 }, 'fast')\r\n\t\t;\r\n\t\t\r\n\t}\r\n\r\n}","ProdutoPorModeloECorService.$inject = ['$ajax'];\r\n\r\nfunction ProdutoPorModeloECorService($ajax) {\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tthis.consultarProdutoPorModeloECor = consultarProdutoPorModeloECor;\r\n\t\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar produto por modelo e cor.\r\n\t */\r\n    function consultarProdutoPorModeloECor(modeloId, corId) {\r\n\r\n\t\tvar url = '/_27050/consultarPorModeloECor',\r\n\t\t\tdata = {\r\n\t\t\t\tmodeloId: modeloId,\r\n\t\t\t\tcorId \t: corId\r\n\t\t\t}\r\n\t\t;\r\n\r\n\t\treturn $ajax.post(url, JSON.stringify(data), {contentType: 'application/json'});\r\n\r\n\t}\r\n\r\n}\r\n","angular\r\n\t.module('app')\r\n\t.service('ConsultarCorService', ConsultarCorService)\r\n\t.controller('ConsultarCorController', ConsultarCorController)\r\n\t.component('consultarCor27030', {\r\n\t\ttemplateUrl: '/_27030/viewConsultarCor',\r\n\t\trequire: {\r\n\t\t\tliberacao12040: '^liberacao12040'\r\n\t\t},\r\n\t\tcontroller: 'ConsultarCorController'\r\n\t})\r\n;","ConsultarCorService.$inject = ['$ajax', '$filter'];\r\n\r\nfunction ConsultarCorService($ajax, $filter) {\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tthis.consultarCor = consultarCor;\r\n\t\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar cor.\r\n\t */\r\n    function consultarCor() {\r\n\r\n\t\treturn $ajax.post('/_27030/consultarCor', null, {contentType: 'application/json'});\r\n\r\n\t}\r\n\r\n}\r\n","ConsultarCorController.$inject = ['ConsultarCorService'];\r\n\r\nfunction ConsultarCorController(ConsultarCorService) {\r\n\r\n\tvar ctrl = this;\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tctrl.consultarCor  = consultarCor;\r\n\tctrl.selecionarCor = selecionarCor;\r\n\tctrl.fecharModal   = fecharModal;\r\n\r\n\t// VARIÁVEIS\r\n\tctrl.listaCor = [];\r\n\r\n\tthis.$onInit = function() {\r\n\r\n\t\tctrl.liberacao12040.consultarCor = this;\r\n\t};\r\n\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Consultar cor.\r\n\t */\r\n\tfunction consultarCor() {\r\n\r\n\t\t// Verificação para consultar apenas uma vez.\r\n\t\tif (ctrl.listaCor.length == 0) {\r\n\r\n\t\t\tConsultarCorService\r\n\t\t\t\t.consultarCor()\r\n\t\t\t\t.then(function(response) { \r\n\t\t\t\t\tctrl.listaCor = response; \r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\t// Fix para vs-repeat.\r\n\t\t\t$('.table-container-consultar-cor')\r\n\t\t\t\t.find('.scroll-table')\r\n\t\t\t\t.trigger('resize')\r\n\t\t\t\t.scrollTop(0);\r\n\r\n\t\t\t// Foco no input de filtrar.\r\n\t\t\t$('.input-filtrar-cor').select();\r\n\r\n\t\t}, 500);\r\n\t}\r\n\r\n\t/**\r\n\t * Selecionar cor.\r\n\t */\r\n\tfunction selecionarCor(cor) {\r\n\r\n\t\tvar corLiberacao = ctrl.liberacao12040.liberacao.COR;\r\n\t\tcorLiberacao.splice(corLiberacao.length-1, 1, cor);\r\n\t\tctrl.fecharModal();\r\n\t}\r\n\r\n\t/**\r\n\t * Fechar modal.\r\n\t */\r\n\tfunction fecharModal() {\r\n\r\n\t\t$('#modal-consultar-cor')\r\n\t\t\t.modal('hide')\r\n\t\t\t.find('.modal-body')\r\n\t\t\t.animate({ scrollTop: 0 }, 'fast')\r\n\t\t;\r\n\r\n\t\tctrl.filtrarCor = '';\r\n\t}\r\n\r\n}","\t\t\r\nangular\r\n\t.module('app')\r\n\t.service('LiberacaoService', LiberacaoService)\r\n\t.controller('LiberacaoController', LiberacaoController)\r\n\t.component('liberacao12040', {\r\n\t\ttemplateUrl: '/_12040/viewLiberacao',\r\n\t\tcontroller: 'LiberacaoController'\r\n\t})\r\n;","\r\n    LiberacaoService.$inject = ['$ajax', '$filter'];\r\n\r\n    function LiberacaoService($ajax, $filter) {\r\n\r\n    \t// MÉTODOS (REFERÊNCIAS)\r\n    \tthis.gravarLiberacao = gravarLiberacao;\r\n\r\n\r\n    \t// MÉTODOS\r\n\r\n        /**\r\n         * Gravar liberação de nova quantidade mínima para cor.\r\n         */\r\n        function gravarLiberacao(param) {\r\n\r\n            return $ajax.post('/_12040/gravarLiberacao', JSON.stringify(param), {contentType: 'application/json'});\r\n        }\r\n\r\n\t}\r\n","\r\n\tLiberacaoController.$inject = ['LiberacaoService'];\r\n\r\n\tfunction LiberacaoController(LiberacaoService) {\r\n\r\n\t\tvar ctrl = this;\r\n\r\n\t\t// MÉTODOS (REFERÊNCIAS).\r\n\t\tctrl.addCor \t\t\t\t= addCor;\r\n\t\tctrl.excluirCor \t\t\t= excluirCor;\r\n\t\tctrl.consultarCorLiberacao \t= consultarCorLiberacao;\r\n\t\tctrl.gravarLiberacao\t\t= gravarLiberacao;\r\n\t\tctrl.verificarCampos \t\t= verificarCampos;\r\n\t\tctrl.limparModalLiberacao \t= limparModalLiberacao;\r\n\t\tctrl.fecharModalLiberacao \t= fecharModalLiberacao;\r\n\t\t\r\n\t\t// VARIÁVEIS\r\n\t\tctrl.liberacao  \t= {};\r\n\t\tctrl.liberacao.COR \t= [];\r\n\t\tctrl.corPadrao \t\t= {\r\n\t\t\tCODIGO \t\t: null,\r\n\t\t\tDESCRICAO \t: null,\r\n\t\t\tAMOSTRA \t: null,\r\n\t\t\tQUANTIDADE \t: null\r\n\t\t};\r\n\r\n\t\t// Métodos iniciados ao carregar página.\r\n\t\tctrl.$onInit = function() {\r\n\r\n\t\t\tctrl.addCor();\r\n\t\t};\r\n\r\n\r\n\t\t// MÉTODOS\r\n\r\n\t\t/**\r\n\t\t * Adicionar cor.\r\n\t\t */\r\n\t\tfunction addCor() {\r\n\r\n\t\t\tvar corNova = {};\r\n\t\t\tangular.copy(ctrl.corPadrao, corNova);\r\n\t\t\tctrl.liberacao.COR.push(corNova);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Excluir cor.\r\n\t\t */\r\n\t\tfunction excluirCor(index) {\r\n\r\n\t\t\tif (ctrl.liberacao.COR.length > 1)\r\n\t\t\t\tctrl.liberacao.COR.splice(index, 1);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Consultar cor para liberação.\r\n\t\t */\r\n\t\tfunction consultarCorLiberacao() {\r\n\r\n\t\t\tctrl.consultarCor.consultarCor();\r\n\t\t\t$('#modal-consultar-cor').modal('show');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Gravar liberação.\r\n\t\t */\r\n\t\tfunction gravarLiberacao() {\r\n\r\n\t\t\tctrl.verificarCampos();\r\n \t\t\t\r\n\t\t\tLiberacaoService\r\n\t\t\t\t.gravarLiberacao(ctrl.liberacao)\r\n\t\t\t\t.then(function(response) {\r\n\r\n\t\t\t\t\tshowSuccess('Gravado com sucesso.');\r\n\t\t\t\t\tctrl.fecharModalLiberacao();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Verificar campos do modal.\r\n\t\t */\r\n\t\tfunction verificarCampos() {\r\n\r\n\t\t\tvar ret = true;\r\n\r\n\t\t\tif (ctrl.liberacao.COR == undefined || ctrl.liberacao.COR.length == 0) {\r\n\t\t\t\tshowAlert('Escolha uma cor.');\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (ret == false)\r\n\t\t\t\tthrow 'Existem campos inválidos.';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Limpar campos do modal.\r\n\t\t */\r\n\t\tfunction limparModalLiberacao() {\r\n\r\n\t\t\tctrl.liberacao \t\t= {};\r\n\t\t\tctrl.liberacao.COR \t= [];\r\n\t\t\tctrl.addCor();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Fechar modal.\r\n\t\t */\r\n\t\tfunction fecharModalLiberacao() {\r\n\r\n\t\t\t$('#modal-liberacao')\r\n\t\t\t\t.modal('hide')\r\n\t\t\t\t.find('.modal-body')\r\n\t\t\t\t.animate({ scrollTop: 0 }, 'fast')\r\n\t\t\t;\r\n\r\n\t\t\tlimparModalLiberacao();\t\t\t\r\n\t\t}\r\n\r\n\t}","\t\t\r\nangular\r\n\t.module('app')\r\n\t.service('ChatService', ChatService)\r\n\t.controller('ChatController', ChatController)\r\n\t.component('chat', {\r\n\t\ttemplateUrl: '/chat/viewIndex',\r\n\t\tcontroller: 'ChatController'\r\n\t})\r\n;","\r\nChatService.$inject = ['$ajax', '$filter'];\r\n\r\nfunction ChatService($ajax, $filter) {\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tthis.gravar \t\t\t\t\t= gravar;\r\n\tthis.consultarHistoricoConversa = consultarHistoricoConversa;\r\n\r\n\t// MÉTODOS\r\n\r\n\t/**\r\n\t * Gravar conversa.\r\n\t */\r\n\tfunction gravar(dadoMsg) {\r\n\r\n        var url = '/chat/gravar',\r\n        \tparam = {\r\n\t\t\t\tREMETENTE_ID\t: dadoMsg.DE,\r\n\t\t\t\tDESTINATARIO_ID\t: dadoMsg.PARA,\r\n\t\t\t\tMENSAGEM\t\t: dadoMsg.MSG\r\n\t\t\t}\r\n\t\t;\r\n\r\n        return $ajax.post(url, JSON.stringify(param), {contentType: 'application/json', progress: false});\r\n    }\r\n\r\n    /**\r\n\t * Consultar histórico de conversas.\r\n\t */\r\n\tfunction consultarHistoricoConversa(param) {\r\n\r\n        var url = '/chat/consultarHistoricoConversa';\r\n\r\n        return $ajax.post(url, JSON.stringify(param), {contentType: 'application/json'});\r\n    }\r\n}","\r\nChatController.$inject = ['ChatService', '$scope'];\r\n\r\nfunction ChatController(ChatService, $scope) {\r\n\r\n\tvar ctrl = this;\r\n\r\n\t// MÉTODOS (REFERÊNCIAS)\r\n\tctrl.iniciarWebSocket\t\t\t= iniciarWebSocket;\r\n\tctrl.reconectarWebSocket \t\t= reconectarWebSocket;\r\n\tctrl.analisarUsuario \t\t\t= analisarUsuario;\r\n\tctrl.descerScrollConversa \t\t= descerScrollConversa;\r\n\tctrl.atalhoTextarea \t\t\t= atalhoTextarea;\r\n\tctrl.acaoScrollConversa\t\t\t= acaoScrollConversa;\r\n\tctrl.selecionarUsuario \t\t\t= selecionarUsuario;\r\n\tctrl.enviarMsg \t\t\t\t\t= enviarMsg;\r\n\tctrl.gravar  \t\t\t\t\t= gravar;\r\n\tctrl.consultarHistoricoConversa\t= consultarHistoricoConversa;\r\n\r\n\t// VARIÁVEIS\r\n\tctrl.ONLINE_CHAT \t\t\t= [];\t\t// usuários online\r\n\tctrl.MENSAGE \t\t\t\t= [];\t\t// mensagem do usuário\r\n\tctrl.usuarioIdConSelec \t\t= 0;\t\t// id do usuário selecionado para conversar\r\n\tctrl.usuarioIdConAtual\t\t= 0;\t\t// id do usuário atual\r\n\tctrl.estadoJanelaChat \t\t= 0;\r\n\tctrl.notifNovaMsgGeral \t\t= 0;\r\n\tctrl.numFirstHistorico \t\t= 30;\r\n\tctrl.ultimaConversa \t\t= false; \t// flag que define quando todas as conversas foram carregadas\r\n\tctrl.usuarioEhCliente \t\t= (parseInt(document.querySelector('#usuario-cliente-id').value) > 0) ? true : false;\r\n\tctrl.usuarioEhRepresentante = false;\r\n\tctrl.represDoCliente \t\t= null;\r\n\tctrl.representanteId \t\t= null;\r\n\tctrl.houveErro\t\t\t\t= false;\r\n\tctrl.reconectando \t\t\t= false;\r\n\tctrl.scrollPorConversa \t\t= [];\r\n\tctrl.timeReconec;\r\n\r\n\t// Funções iniciadas ao carregar página\r\n\tctrl.$onInit = function() {\r\n\r\n\t\t// Esperar tela ser carregada pelo angular.\r\n\t\tsetTimeout(function() { \r\n\t\t\tctrl.iniciarWebSocket(); \r\n\t\t}, 2000);\r\n\r\n\t\tctrl.atalhoTextarea();\r\n\t\tctrl.acaoScrollConversa();\r\n\t};\r\n\r\n\r\n    // MÉTODOS\r\n\r\n\tfunction iniciarWebSocket() {\r\n\r\n\t\tctrl.usuarioEhRepresentante\t= (parseInt(document.querySelector('#usuario-representante-id').value) > 0) ? true : false;\r\n\t\tctrl.represDoCliente \t\t= parseInt(document.querySelector('#representante-do-cliente').value);\r\n\t\tctrl.represDoCliente \t\t= ctrl.represDoCliente > 0 ? ctrl.represDoCliente : 0;\r\n\t\tctrl.representanteId \t\t= parseInt(document.querySelector('#usuario-representante-id').value) \r\n\t\tctrl.representanteId \t\t= ctrl.representanteId > 0 ? ctrl.representanteId : 0;\r\n\r\n\t\t// Funções para o web socket.\r\n\t\tvar metodos = [\r\n\t\t\t{\r\n\t\t\t\tMETHOD  :'ON_LOGIN_USER',\r\n\t\t\t\tFUNCTION:function(ret){\r\n\t\t\t\t\t\r\n\t\t\t\t\t// console.log('Entrou no chat:');\r\n\t\t\t\t\t//console.log(ret.MENSAGE.DADOS.NEW);\r\n\t\t\t\t\tctrl.ONLINE_CHAT = ret.MENSAGE.DADOS.LISTA;\r\n\r\n\t\t\t\t\t$scope.$apply();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tMETHOD  :'ON_LOGOF_USER',\r\n\t\t\t\tFUNCTION:function(ret){\r\n\t\t\t\t\t$scope.$apply(function(){\r\n\t\t\t\t\t\t// console.log('Saiu do chat:');\r\n\t\t\t\t\t\t//console.log(ret.MENSAGE.DADOS.OLD);\r\n\t\t\t\t\t\tctrl.ONLINE_CHAT = ret.MENSAGE.DADOS.LISTA;\r\n\t    \t\t\t});\t\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tMETHOD  :'ON_MENSAGE',\r\n\t\t\t\tFUNCTION:function(ret){\r\n\r\n\t\t\t\t\tctrl.MENSAGE.push(ret.MENSAGE.DADOS);\r\n\t\t\t\t\tctrl.descerScrollConversa();\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar online = {};\r\n\r\n\t\t\t\t\t// Notificação.\r\n\t\t\t\t\tfor (var i in ctrl.ONLINE_CHAT) {\r\n\r\n\t\t\t\t\t\tonline = ctrl.ONLINE_CHAT[i];\r\n\r\n\t\t\t\t\t\t// Se o remetente na mensagem é diferente do usuário atual (remetente) e\r\n\t\t\t\t\t\t// pegar o usuário da lista (online) que é igual ao remetente na mensagem.\r\n\t\t\t\t\t\t// A primeira verificação serve para notificar ao destinatário apenas.\r\n\t\t\t\t\t\t// Como a mensagem é enviada (server) também para o próprio remetente,\r\n\t\t\t\t\t\t// é necessária essa verificação.\r\n\t\t\t\t\t\tif (ret.MENSAGE.DADOS.DE != ctrl.usuarioIdConAtual && online.USUARIO_ID == ret.MENSAGE.DADOS.DE) {\r\n\r\n\t\t\t\t\t\t\t// Notificar quando a conversa não estiver em foco\r\n\t\t\t\t\t\t\tif (!$('.digitar-msg textarea').is(':focus')) {\r\n\r\n\t\t\t\t\t\t\t\tctrl.notifNovaMsgGeral = 1;\t// notificação geral\r\n\t\t\t\t\t\t\t\tonline.NOTIF_NOVA_MSG = 1;\t// notificação no usuário\r\n\r\n\t\t\t\t\t\t\t\tNotification\r\n\t\t\t\t\t\t\t\t\t.requestPermission(function() {\r\n\t\t    \t\t\t\t\r\n\t\t\t\t\t    \t\t\t\tvar notification = new Notification(\r\n\t\t\t\t\t    \t\t\t\t\t\"Delfa - Chat\", \r\n\t\t\t\t\t    \t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t            icon: '../../assets/images/logo2.png',\r\n\t\t\t\t\t\t\t\t\t            body: ret.MENSAGE.DADOS.MSG,\r\n\t\t\t\t\t\t\t\t\t            tag : ret.MENSAGE.DADOS.DE\r\n\t\t\t\t\t\t\t\t        \t}\r\n\t\t\t\t\t\t\t\t        );\r\n\r\n\t\t\t\t\t\t\t\t        notification.onclick = function() {\r\n\t\t\t\t\t\t\t\t            window.focus();\r\n\t\t\t\t\t\t\t\t            notification.close();\r\n\t\t\t\t\t\t\t\t        };\r\n\r\n\t\t\t\t\t\t\t\t        setTimeout(notification.close.bind(notification), 5000);\r\n\t\t\t\t\t    \t\t\t})\r\n\t\t\t\t\t    \t\t;\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t    \t\t\t\r\n\t    \t\t\t$scope.$apply();\r\n\r\n\t    \t\t\t//console.log(ret.MENSAGE.DADOS);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t];\r\n\r\n\t\t// Iniciar web socket.\r\n\t\tSocketWeb.create(metodos);\r\n\r\n\t\t// Conectar usuário.\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\t// ctrl.usuarioIdConAtual = SocketWeb.CONNECTION_ID;\r\n\t\t\tctrl.usuarioIdConAtual = document.querySelector('#usuario-id').value;\r\n\r\n\t\t\tSocketWeb.sendMensage(\r\n\t\t\t\tSocketWeb.CONNECTION_ID,\r\n\t\t\t\tSocketWeb.CONNECTION_ID,\r\n\t\t\t\t{\r\n\t\t\t\t\tNOME \t\t\t : document.querySelector('.user_nome').value,\r\n\t\t\t        ID \t\t\t\t : SocketWeb.CONNECTION_ID,\r\n\t\t\t        TYPO \t\t\t : 'CLIENTE',\r\n\t\t\t        CLIENTE_ID\t\t : document.querySelector('#usuario-cliente-id').value,\t\t\t// identificar se é cliente\r\n\t\t\t        REPRESENTANTE_ID : ctrl.representanteId,\t// identificar se é representante\r\n\t\t\t        REPRES_DO_CLIENTE: ctrl.represDoCliente,\r\n\t\t\t        STATUS  \t\t : 1\r\n\t\t\t\t},\r\n\t\t\t\t'LOGIN_CHAT',\r\n\t\t\t\t'LOGIN_CHAT',\r\n\t\t\t\t[]\r\n\t\t\t);\r\n\r\n\t\t\tctrl.houveErro \t  = false;\r\n\t\t\tctrl.reconectando = false;\r\n\r\n\t\t}, 1000);\r\n\r\n\t\t// Erro.\r\n\t\tSocketWeb.ERROR_EVENT = function(error) {\r\n\t\t\t\r\n\t\t\tctrl.houveErro \t  = true;\r\n\t\t\tctrl.reconectando = false;\r\n\t\t\tctrl.ONLINE_CHAT  = [];\r\n\t\t\tctrl.MENSAGE \t  = [];\r\n\t\t\t\r\n\t\t\t$scope.$apply();\r\n\r\n\t\t\tctrl.reconectarWebSocket(false);\r\n\t\t};\r\n\r\n\t\t// Sucesso.\r\n\t\tSocketWeb.SUCCESS_EVENT = function() {\r\n\r\n\t\t\t// Se estiver reconectando.\r\n\t\t\tif (ctrl.reconectando)\r\n\t\t\t\tshowSuccess('Chat conectado!');\r\n\r\n\t\t\tctrl.reconectando = false;\r\n\t\t};\r\n\t}\r\n\r\n\r\n\tfunction reconectarWebSocket(imediatamente) {\r\n\r\n\t\t// Reconectar imediatamente (ativado ao clicar no botão 'reconectar')\r\n\t\tif (imediatamente) {\r\n\r\n\t\t\tclearTimeout(ctrl.timeReconec);\r\n\t\t\tativar();\r\n\t\t}\r\n\t\t// Reconectar após 30s (ativado pelo evento de erro no WebSocket)\r\n\t\telse {\r\n\t\t\tctrl.timeReconec = setTimeout(function() { ativar(); }, 10000);\r\n\t\t}\r\n\r\n\t\tfunction ativar() {\r\n\r\n\t\t\tctrl.reconectando = true;\r\n\t\t\tctrl.iniciarWebSocket();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Analisar usuário para exibir ou não na lista de usuários.\r\n\t */\r\n\tfunction analisarUsuario(online) {\r\n\r\n\t\tvar ret = false;\r\n\r\n\t\t// Usuário diferente do atual.\r\n\t\tif (online.USUARIO_ID != ctrl.usuarioIdConAtual) {\r\n\r\n\t\t\t// Se o atual for cliente e o corrente for representante.\r\n\t\t\t// Conversa com comercial e SEU representante.\r\n\t\t\tif ( (ctrl.usuarioEhCliente == true) && (online.REPRESENTANTE_ID > 0) ) {\r\n\t\t\t\t// Se o corrente não for cliente também \r\n\t\t\t\t// e o id de representante (do cliente) do atual for igual ao id de representante do corrente.\r\n\t\t\t\tif ( (online.CLIENTE_ID == '') && (ctrl.represDoCliente == online.REPRESENTANTE_ID) )\r\n\t\t\t\t\tret = true;\r\n\t\t\t}\r\n\t\t\t// Se o atual for cliente.\r\n\t\t\t// Conversa com comercial.\r\n\t\t\telse if (ctrl.usuarioEhCliente == true) {\r\n\t\t\t\t// Se o corrente não for cliente também.\r\n\t\t\t\tif (online.CLIENTE_ID == '')\r\n\t\t\t\t\tret = true;\r\n\t\t\t}\r\n\t\t\t// Se o atual for representante e o corrente for cliente (que deve ter um id de representante).\r\n\t\t\t// Conversa com comercial e SEU cliente.\r\n\t\t\telse if ( (ctrl.usuarioEhRepresentante == true) && (online.REPRES_DO_CLIENTE > 0) ) {\r\n\t\t\t\t// Se o corrente não for representante também\r\n\t\t\t\t// e o id de representante do atual for igual ao id de representante (do cliente) do corrente.\r\n\t\t\t\tif ( (online.REPRESENTANTE_ID == 0) && (ctrl.representanteId == online.REPRES_DO_CLIENTE) )\r\n\t\t\t\t\tret = true;\r\n\t\t\t}\r\n\t\t\t// Se o atual for representante.\r\n\t\t\t// Conversa com comercial.\r\n\t\t\telse if (ctrl.usuarioEhRepresentante == true) {\r\n\t\t\t\t// Se o corrente não for representante também.\r\n\t\t\t\tif (online.REPRESENTANTE_ID == 0)\r\n\t\t\t\t\tret = true;\r\n\t\t\t}\r\n\t\t\t// Se o atual for comercial.\r\n\t\t\t// Conversa com todos.\r\n\t\t\telse\r\n\t\t\t\tret = true;\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tfunction descerScrollConversa() {\r\n\r\n\t\tvar container = $('.conversa-msg-container')[0];\r\n\r\n\t\tif ( container != undefined ) {\r\n\t\t\t\t\t\t\t\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tcontainer.scrollTop = container.scrollHeight;\r\n\t\t\t}, 200);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction acaoScrollConversa() {\r\n\t\r\n\t\t// Não continuar se o histórico de conversas já tiver sido completamente carregado.\r\n\t\tif (ctrl.ultimaConversa == true)\r\n\t\t\treturn false;\r\n\r\n\t\tvar scrollTimer = 0;\t//verificar timeout\r\n\r\n\t\tdocument.addEventListener('scroll', function(event) {\r\n\r\n\t\t    if (event.target.className === 'conversa-msg-container') {\r\n\r\n\t\t\t\tclearTimeout(scrollTimer);\r\n\r\n\t\t\t\tscrollTimer = setTimeout(function() {\r\n\r\n\t\t\t\t\tif (event.target.scrollTop == 0) {\r\n\r\n\t\t\t\t\t\tctrl.consultarHistoricoConversa();\r\n\t\t\t\t\t\tevent.target.scrollTop = 10;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}, 500);\r\n\t\t    }\r\n\t\t}, true);\r\n\t}\r\n\r\n\tfunction atalhoTextarea() {\r\n\r\n\t\t$(document)\r\n\t\t\t.on('keydown', '.digitar-msg textarea', 'return', function(e) {\r\n\t\t\t\t\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\t// ctrl.enviarMsg();\r\n\t\t\t\t$('.digitar-msg button').click();\r\n\t\t\t})\r\n\t\t;\r\n\t}\r\n\r\n\tfunction selecionarUsuario(usuario) {\r\n\r\n\t\tvar notifPendente \t= 0,\r\n\t\t\tonline \t\t\t= {}\r\n\t\t;\r\n\r\n\t\t// Seleciona o usuário.\r\n\t\tif (usuario != null)\r\n\t\t\tctrl.usuarioIdConSelec = usuario.USUARIO_ID;\r\n\r\n\t\tfor (var i in ctrl.ONLINE_CHAT) {\r\n\r\n\t\t\tonline = ctrl.ONLINE_CHAT[i];\r\n\r\n\t\t\t// Remove a notificação do usuário.\r\n\t\t\tif (online.USUARIO_ID == ctrl.usuarioIdConSelec)\r\n\t\t\t\tonline.NOTIF_NOVA_MSG = 0;\r\n\r\n\t\t\t// Define se ainda existe notificação pendente.\r\n\t\t\tif (online.NOTIF_NOVA_MSG == 1)\r\n\t\t\t\tnotifPendente = 1;\r\n\t\t}\r\n\r\n\t\tctrl.notifNovaMsgGeral = notifPendente;\r\n\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\tvar textarea = $('.digitar-msg textarea');\r\n\r\n\t\t\tif ( !$(textarea).is(':focus') )\r\n\t\t\t\t$(textarea).focus();\r\n\r\n\t\t\tctrl.descerScrollConversa();\r\n\r\n\t\t}, 200);\r\n\r\n\t\t// Indicar que um novo usuário foi selecionado \r\n\t\t// e que o histórico de conversas pode ser consultado novamente (scroll).\r\n\t\tctrl.ultimaConversa = false;\r\n\t}\r\n\r\n\r\n\tfunction enviarMsg() {\r\n\r\n\t\tif (!ctrl.mensagem)\r\n\t\t\treturn false;\r\n\r\n\t\tvar msg = {\r\n\t\t\t\tMSG \t\t: ctrl.mensagem,\r\n\t\t        DATA    \t: moment().toDate(),\r\n\t\t        DE \t    \t: ctrl.usuarioIdConAtual,\r\n\t\t        PARA \t\t: ctrl.usuarioIdConSelec,\r\n\t\t        REMETENTE \t: true,\r\n\t\t        CHAVE \t\t: parseInt($('.lbl-chave').text())\r\n\t\t\t}\r\n\t\t;\r\n\r\n\t\t// Enviar msg do remetente para ele mesmo (necessário quando há várias instâncias abertas).\r\n\t\tSocketWeb.sendMensage(\r\n\t\t\tctrl.usuarioIdConAtual,\r\n\t\t\tctrl.usuarioIdConAtual,\r\n\t\t\tmsg,\r\n\t\t\t'SEND_CHAT',\r\n\t\t\t'SEND_CHAT',\r\n\t\t\t[]\r\n\t\t);\r\n\r\n\t\tctrl.descerScrollConversa();\r\n\r\n\t\t// Limpar textarea.\r\n\t\tctrl.mensagem = '';\r\n\r\n\t\tmsg.REMETENTE = false;\r\n\r\n\t\t// Enviar msg para o destinatário.\r\n\t\tSocketWeb.sendMensage(\r\n\t\t\tctrl.usuarioIdConAtual,\r\n\t\t\tctrl.usuarioIdConSelec,\r\n\t\t\tmsg,\r\n\t\t\t'SEND_CHAT',\r\n\t\t\t'SEND_CHAT',\r\n\t\t\t[]\r\n\t\t);\r\n\r\n\t\t// Gravar conversa na base.\r\n\t\tctrl.gravar(msg);\r\n\t}\r\n\r\n\tfunction gravar(dadoMsg) {\r\n\r\n\t\tChatService\r\n\t\t\t.gravar(dadoMsg)\r\n\t\t;\r\n\t}\r\n\r\n\tfunction consultarHistoricoConversa() {\r\n\r\n\t\tvar scr \t\t\t\t= {},\r\n\t\t\tusuarioJaConversa \t= false,\r\n\t\t\tskip \t\t\t\t= 0;\r\n\r\n\t\t// Analisar os usuários que já estão com conversas (histórico) carregadas\r\n\t\tfor (var i in ctrl.scrollPorConversa) {\r\n\r\n\t\t\tscr = ctrl.scrollPorConversa[i];\r\n\r\n\t\t\tif (scr.USUARIO_ID == ctrl.usuarioIdConSelec) {\r\n\r\n\t\t\t\tscr.POSICAO\t\t += ctrl.numFirstHistorico;\r\n\t\t\t\tskip \t\t\t  = scr.POSICAO;\r\n\t\t\t\tusuarioJaConversa = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Se o usuário ainda não tem conversa carregada, \r\n\t\t// ou seja, primeiro carregamento de histórico do usuário online.\r\n\t\tif (!usuarioJaConversa) {\r\n\r\n\t\t\tctrl.scrollPorConversa.push({\r\n\t\t\t\tUSUARIO_ID \t: ctrl.usuarioIdConSelec,\r\n\t\t\t\tPOSICAO \t: 0\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Na ação do scroll, se ctrl.ultimaConversa for true não chega aqui;\r\n\t\t// mas quando o botão é clicado essa verificação é necessária.\r\n\t\tif (ctrl.ultimaConversa == true) \r\n\t\t\treturn false;\r\n\r\n\t\tvar param = {\r\n\t\t\tFIRST \t\t\t\t: ctrl.numFirstHistorico,\r\n\t\t\tSKIP\t\t\t\t: skip,\r\n\t\t\tUSUARIO_ID_ATUAL\t: ctrl.usuarioIdConAtual,\r\n\t\t\tUSUARIO_ID_SELEC\t: ctrl.usuarioIdConSelec\r\n\t\t};\r\n\r\n\t\t// Zerar conversa quando a consulta for feita pela primeira vez.\r\n\t\tif (skip == 0)\r\n\t\t\tctrl.MENSAGE = [];\r\n\r\n\t\tChatService\r\n\t\t\t.consultarHistoricoConversa(param)\r\n\t\t\t.then(function(response) {\r\n\r\n\t\t\t\tif (response.length == 0) {\r\n\t\t\t\t\tctrl.ultimaConversa = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar resp = {},\r\n\t\t\t\t\tdado = {}\r\n\t\t\t\t;\r\n\r\n\t\t\t\tfor (var i in response) {\r\n\r\n\t\t\t\t\tresp = response[i];\r\n\r\n\t\t\t\t\tdado = {\r\n\t\t\t\t\t\tDE \t\t\t: resp.REMETENTE_ID,\r\n\t\t\t\t\t\tPARA \t\t: resp.DESTINATARIO_ID,\r\n\t\t\t\t\t\tMSG \t\t: resp.MENSAGEM,\r\n\t\t\t\t\t\tDATA \t\t: moment(resp.DATAHORA).format('DD/MM/YYYY HH:mm'),\r\n\t\t\t\t\t\tREMETENTE \t: (resp.REMETENTE_ID == ctrl.usuarioIdConAtual) ? true : false\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tctrl.MENSAGE.splice(0, 0, dado);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t;\r\n\t}\r\n\r\n}"]}