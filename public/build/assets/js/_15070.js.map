{"version":3,"sources":["_15070.app.js","_15070.factory.remessa.js","_15070.factory.talao.js","_15070.factory.consumo.js","_15070.factory.filtro.js","_15070.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_15070.js","sourcesContent":["'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n        'gc-find',\n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils'\n\t])\n;","angular\n    .module('app')\n    .factory('Remessa', Remessa);\n    \n\n\tRemessa.$inject = [\n        '$ajax',\n        '$rootScope',\n        '$q',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Remessa($ajax, $rootScope, $q, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Remessa(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Remessa = this; \n        \n        this.DADOS                  = [];\n        this.SELECTED               = {};\n        this.FILTRO                 = '';\n        this.FAMILIAS               = [];\n        this.FAMILIAS_CHECKEDS      = [];\n        this.FAMILIAS_CHECKEDS_LIST = '';\n        this.CONSUMOS               = [];\n        this.CONSUMO_PERCENTUAL     = '< 1';\n        this.DATA_1                 = '01.01.1989'; \n        this.DATA_2                 = '01.01.2500';        \n    }\n\n    this.GUIA_ATIVA = 'TALAO_PRODUZIR';\n    \n    /**\n     * Private property\n     */\n    var url_base        = '_15070/api';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n\n    /**\n     * Public method, assigned to prototype\n     */\n    \n    \n    Remessa.prototype.pick = function(remessa,setfocus) {\n        \n        var that = this;\n\n        if ( remessa != undefined ) {\n\n            if ( remessa != this.SELECTED ) {\n                gScope.Talao.pick({});\n            }        \n\n            this.SELECTED       = remessa;\n\n            if ( setfocus ) {\n                that.setFocus();\n            }\n        }\n\n    };\n    \n    Remessa.prototype.click = function(remessa) {\n        \n        this.SELECTED != remessa ? this.pick(remessa) : '';\n        \n    };\n    \n    Remessa.prototype.dblClick = function() {\n        $timeout(function(){\n            $('#tab-visualizacao-por-consumo').click();\n        });\n    };\n    \n    Remessa.prototype.etiqueta = function(remessa,setfocus) {\n        \n        var that = this;\n\n        $ajax.post('/_15070/api/etiqueta',that.SELECTED).then(function(response){\n            \n            postprint(response);\n                        \n        });\n\n    };\n    \n    Remessa.prototype.setFocus = function() {\n        \n        $timeout(function(){\n            $('.table-remessa .table-lc-body tr.selected:focusable').focus();\n        },50);                      \n    };\n    \n    \n    Remessa.prototype.consultarFamilia = function() {\n        \n        var that = this;\n        \n        return $q(function(resolve,reject){     \n\n            $ajax.post('/_15070/api/familia',{}).then(function(response){\n\n                that.mergeFamilia(response);\n\n                resolve(response);\n\n            },function(erro){\n                reject(erro);\n            });\n        });\n    };\n\n    Remessa.prototype.consultar = function() {\n        \n        var that = this;\n        \n        return $q(function(resolve,reject){\n            if ( that.FAMILIAS_CHECKEDS_LIST.trim() == '' ) {\n                showErro('Selecione uma familia de produto.');\n            } else {\n\n                var data = {\n                    REMESSA_FAMILIAS_ID : that.FAMILIAS_CHECKEDS_LIST,\n                    CONSUMO_PERCENTUAL  : that.CONSUMO_PERCENTUAL,\n                    PERIODO             : [moment(that.DATA_1).format('DD.MM.YYYY'),moment(that.DATA_2).format('DD.MM.YYYY')]\n                };\n\n                $ajax.post('/_15070/api/remessa',data).then(function(response){\n\n                    that.merge(response);\n\n                    resolve(response);\n\n                },function(erro){\n                    reject(erro);\n                });\n            }\n        });\n        \n    };\n\n    Remessa.prototype.consultarConsumos = function() {\n        \n        var that = this;\n        \n        return $q(function(resolve,reject){\n            if ( that.FAMILIAS_CHECKEDS_LIST.trim() == '' ) {\n                showErro('Selecione uma familia de produto.');\n            } else {\n\n                var data = {\n                    REMESSA_ID : that.SELECTED.REMESSA_ID\n                };\n\n                $ajax.post('/_15070/api/consumo',data).then(function(response){\n\n                    that.mergeConsumo(response);\n                    \n                    resolve(response);\n\n                },function(erro){\n                    reject(erro);\n                });\n            }\n        });\n        \n    };\n    \n    \n    Remessa.prototype.merge = function(response) {\n\n        gcCollection.merge(this.DADOS, response, 'REMESSA_ID');\n\n    };    \n    \n    \n    Remessa.prototype.mergeFamilia = function(response) {\n\n        gcCollection.merge(this.FAMILIAS, response, 'REMESSA_FAMILIA_ID');\n\n    };    \n    \n    \n    Remessa.prototype.mergeConsumo = function(response) {\n\n        gcCollection.merge(gScope.Consumo.DADOS, response, 'CONSUMO_ID');\n\n        /**\n         * Agrupa consumos para os talões\n         */\n        var taloes_consumos = gcCollection.groupBy(gScope.Consumo.DADOS,[\n            'REMESSA',\n            'REMESSA_ID',\n            'REMESSA_ESTABELECIMENTO_ID',\n            'REMESSA_DATA',\n            'REMESSA_DATA_TEXT',\n            'REMESSA_FAMILIA_ID',\n            'REMESSA_FAMILIA_DESCRICAO',\n            'REMESSA_TALAO_ID',\n            'MODELO_ID',\n            'MODELO_DESCRICAO',\n            'COR_ID',\n            'COR_DESCRICAO',\n            'GRADE_ID',\n            'TAMANHO',\n            'TAMANHO_DESCRICAO',\n            'QUANTIDADE_TALAO',\n            'UM_TALAO'\n        ],'CONSUMOS');\n\n        gcCollection.merge(gScope.Talao.DADOS, taloes_consumos, ['REMESSA_ID','REMESSA_TALAO_ID']);\n\n        /**\n         * Agrupa consumos para os produtos\n         */\n        var produtos_consumos = gcCollection.groupBy(gScope.Consumo.DADOS,[\n            'REMESSA',\n            'REMESSA_ID',\n            'REMESSA_ESTABELECIMENTO_ID',\n            'REMESSA_DATA',\n            'REMESSA_DATA_TEXT',\n            'REMESSA_FAMILIA_ID',\n            'REMESSA_FAMILIA_DESCRICAO',\n            'CONSUMO_FAMILIA_ID',\n            'CONSUMO_FAMILIA_DESCRICAO',\n            'CONSUMO_PRODUTO_ID',\n            'CONSUMO_PRODUTO_DESCRICAO',\n            'CONSUMO_GRADE_ID',\n            'CONSUMO_TAMANHO',\n            'CONSUMO_TAMANHO_DESCRICAO',\n            'QUANTIDADE_ESTOQUE',\n            'CONSUMO_UM',\n            'CONSUMO_STATUS',\n            'CONSUMO_STATUS_DESCRICAO',\n            'CONSUMO_LOCALIZACAO_ID',\n            'CONSUMO_LOCALIZACAO_ID_PROCESSO',\n            'GP_CCUSTO'\n        ],'TALOES');\n\n        gcCollection.merge(gScope.Consumo.PRODUTOS, produtos_consumos, ['REMESSA_ID','CONSUMO_PRODUTO_ID','CONSUMO_TAMANHO']);\n\n        for ( var i in gScope.Consumo.PRODUTOS ) {\n            var produto = gScope.Consumo.PRODUTOS[i];\n\n            produto.QUANTIDADE          = 0;\n            produto.QUANTIDADE_CONSUMO  = 0;\n            produto.QUANTIDADE_SALDO    = 0;\n\n            for ( var j in produto.TALOES ) {\n                var talao = produto.TALOES[j];\n\n                produto.QUANTIDADE          += parseFloat(talao.QUANTIDADE        );\n                produto.QUANTIDADE_CONSUMO  += parseFloat(talao.QUANTIDADE_CONSUMO);\n                produto.QUANTIDADE_SALDO    += parseFloat(talao.QUANTIDADE_SALDO  );\n\n            }\n        }\n\n\n        gcCollection.bind(gScope.Remessa.DADOS, gScope.Talao.DADOS     , 'REMESSA_ID', 'TALOES');\n        gcCollection.bind(gScope.Remessa.DADOS, gScope.Consumo.PRODUTOS, 'REMESSA_ID', 'PRODUTOS');\n\n    };    \n    \n    \n    Remessa.prototype.toggleCheckFamilia = function(item,type) {\n\n        item.CHECKED = item.CHECKED ? false : true;\n\n        if ( type != undefined ) {\n            item.CHECKED = type == true ? true : false;\n        }\n\n        var index = this.FAMILIAS_CHECKEDS.indexOf(item);\n\n        if ( index == -1 ) {\n            this.FAMILIAS_CHECKEDS.push(item);   \n        }                 \n        else \n        if ( index > -1 ) {\n            this.FAMILIAS_CHECKEDS.splice(index, 1);                      \n        }\n    \n        this.FAMILIAS_CHECKEDS_LIST = arrayToList(this.FAMILIAS_CHECKEDS, 'REMESSA_FAMILIA_ID' );\n        \n    };   \n    \n    function arrayToList( array, field, str, val_def ) {\n        \n        val_def = val_def   || '';\n        str     = str       || false;\n        field   = field     || false;\n        \n        var list    = '';\n        var i       = -1;\n\n        if ( Array.isArray(array) ) {\n            for ( var key in array ) {\n                \n                var o    = array[key];\n                var item = '';\n\n                i++;\n\n                //Verifica se existe um campo com nome \n                if (field) {\n                    o = o[field];\n                }\n\n                //Verifica se é uma string e pega o caractere\n                if ( str ) {\n                    item = str . o . str;\n                } else {\n                    item = o;\n                }\n\n                list = ( i == 0 ) ? item : list  + ', ' + item;\n            }   \n        } else {\n            list = array;\n        }\n\n        return ( list != '' ) ? list : val_def;\n    }  \n\n    /**\n     * Return the constructor function\n     */\n    return Remessa;\n};","angular\n    .module('app')\n    .factory('Talao', Talao);\n    \n\n\tTalao.$inject = [\n        '$ajax',\n        '$rootScope',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Talao($ajax, $rootScope, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Talao(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Talao = this; \n        \n        this.DADOS = [];\n        this.SELECTED = {};\n    }\n        \n    Talao.prototype.pick = function(talao,setfocus) {\n        \n        var that = this;\n\n        if ( talao != undefined ) {\n\n            if ( talao != this.SELECTED ) {\n                gScope.Consumo.pick({});\n            }   \n\n            this.SELECTED       = talao;\n\n            if ( setfocus ) {\n                that.setFocus();\n            }\n        }\n\n    };\n    \n    Talao.prototype.setFocus = function() {\n        \n        $timeout(function(){\n            $('.table-talao.table-lc-body tr.selected:focusable').focus();\n        },50);                      \n    };\n    \n    /**\n     * Extende propriedades para o objeto\n     * @param {object} data\n     * @returns {void}\n     */\n    Talao.prototype.setData = function(data) {\n            angular.extend(this, data);\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Talao;\n};","angular\n    .module('app')\n    .factory('Consumo', Consumo);\n    \n\n\tConsumo.$inject = [\n        '$ajax',\n        '$rootScope',\n        '$timeout',\n        '$q',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Consumo($ajax, $rootScope, $timeout, $q, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Consumo(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Consumo = this; \n        \n        this.DADOS = [];\n        this.PRODUTOS = [];\n    }\n    \n    this.GUIA_ATIVA = 'TALAO_PRODUZIR';\n    \n    /**\n     * Private property\n     */\n    var url_base        = '_15070/api';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n\n    /**\n     * Public method, assigned to prototype\n     */\n\n\n\n    Consumo.prototype.pick = function(consumo,setfocus) {\n        \n        var that = this;\n\n        if ( consumo != undefined ) {\n        \n            this.SELECTED = consumo;\n\n            if ( setfocus ) {\n                that.setFocus();\n            }\n        }\n\n    };\n    \n    Consumo.prototype.setFocus = function() {\n        \n        $timeout(function(){\n            $('.table-consumo.table-lc-body tr.selected:focusable').focus();\n        },50);                      \n    };\n    \n    \n    Consumo.prototype.keypress = function($event) {\n\n        var that = this;\n        var is_enabled = true;\n        \n        $event.preventDefault();\n                \n        switch (gScope.Filtro.TAB_ACTIVE) {\n            case 'TALAO':\n                \n                if ( gScope.Remessa.SELECTED.TALOES.indexOf(gScope.Talao.SELECTED) < 0 || gScope.Talao.SELECTED.CONSUMOS.indexOf(gScope.Consumo.SELECTED) < 0 || !(gScope.Consumo.SELECTED.CONSUMO_LOCALIZACAO_ID_PROCESSO > 0) || !(gScope.Consumo.SELECTED.QUANTIDADE_ESTOQUE > 0) ) {\n                    is_enabled = false;\n                }\n                \n                break;\n                \n            case 'CONSUMO':\n\n                if ( gScope.Remessa.SELECTED.PRODUTOS.indexOf(gScope.Talao.SELECTED) < 0 || !(gScope.Talao.SELECTED.CONSUMO_LOCALIZACAO_ID_PROCESSO > 0) || !(gScope.Talao.SELECTED.QUANTIDADE_ESTOQUE > 0) ) {\n                    is_enabled = false;\n                }\n                \n                break;\n        }\n        \n        if ( !is_enabled ) {\n            return false;\n        }\n        \n        switch ($event.key) {\n            case ' ':\n\n                that.ModalPeca.open();\n\n                break;\n\n            case 'Enter':\n\n                that.ModalAvulso.open();\n\n                break;\n\n        }\n    };\n    \n        \n    /**\n     * Extende propriedades para o objeto\n     * @param {object} data\n     * @returns {void}\n     */\n    Consumo.prototype.setData = function(data) {\n            angular.extend(this, data);\n    };\n\n\n    Consumo.prototype.ModalPeca = {\n        ITEM : {},\n        PECA_BARRAS : '',\n        open : function() {\n\n            var that = this;\n\n            switch (gScope.Filtro.TAB_ACTIVE) {\n                case 'CONSUMO':\n\n                    that.ITEM = gScope.Talao.SELECTED;\n                    \n                    that.show(function(){\n                        that.selectInput();\n                    },function(){\n                        gScope.Talao.setFocus();\n                        that.setEmptyInput();\n                    });\n\n                    break;\n                case 'TALAO':\n\n                    that.ITEM = gScope.Consumo.SELECTED;\n                    \n                    that.show(function(){\n                        that.selectInput();\n                    },function(){\n                        gScope.Consumo.setFocus();\n                        that.setEmptyInput();\n                    });\n\n                    break;\n\n            }\n        },\n        confirm : function () {\n            var that = this;\n\n            var item = angular.copy(that.ITEM);\n                    \n            var dados = {};\n            dados.DADOS = {};\n            \n            dados.FILTRO = gScope.Filtro;\n            dados.DADOS.PECA_BARRAS = that.PECA_BARRAS;\n            \n            switch (gScope.Filtro.TAB_ACTIVE) {\n                case 'CONSUMO':\n                                        \n                    dados.DADOS.ITENS = item.TALOES;\n                    \n                    that.enableButton(false);\n                    \n                    $ajax.post('/_15070/api/peca',dados,{complete: function(){\n                            \n                        that.enableButton(true);\n                        \n                    }}).then(function(response){\n                        \n                        gScope.Filtro.merge(response.DATA_RETURN);\n                        \n                        that.close(function(){\n                            gScope.Talao.setFocus();\n                        });\n                        \n                    },function(){\n                        \n                        that.setEmptyInput();\n                        that.setFocus();\n                        \n                    });\n\n                    break;\n                case 'TALAO':\n                 \n                    dados.DADOS.ITENS = [item];\n                    \n                    that.enableButton(false);\n                    \n                    $ajax.post('/_15070/api/peca',dados,{complete: function(){\n                            \n                        that.enableButton(true);\n                        \n                    }}).then(function(response){\n                        \n                        gScope.Filtro.merge(response.DATA_RETURN);\n                        that.close(function(){\n                            gScope.Consumo.setFocus();\n                        });\n                        \n                    },function(){\n                        \n                        that.setEmptyInput();\n                        that.setFocus();\n                        \n                    });\n                    \n                    break;\n\n            }\n        },\n        close : function (hidden) {\n\n            $('#modal-registrar-saida-por-peca')\n                .modal('hide')\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;        \n        },\n        show : function(shown,hidden) {\n\n            $('#modal-registrar-saida-por-peca')\n                .modal('show')\n                .one('shown.bs.modal', function(){\n                    shown ? shown() : '';\n                })\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;                         \n        },\n        selectInput : function() {        \n            $timeout(function(){\n                $('#modal-registrar-saida-por-peca input:focusable').first().select();\n            },50);       \n        },\n        setFocusInput : function() {        \n            $timeout(function(){\n                $('#modal-registrar-saida-por-peca input:focusable').first().focus();\n            },50);       \n        },\n        setEmptyInput : function() {        \n            var that = this;\n            \n            that.PECA_BARRAS = '';\n        },\n        enableButton : function(bool) {\n            $('#modal-registrar-saida-por-peca button').prop('disabled',!bool);\n        }\n    };\n\n    Consumo.prototype.ModalAvulso = {\n        ITEM : {},\n        QUANTIDADE : '',\n        open : function() {\n\n            var that = this;\n            \n            switch (gScope.Filtro.TAB_ACTIVE) {\n                case 'CONSUMO':\n\n                    that.QUANTIDADE = gScope.Talao.SELECTED.QUANTIDADE_SALDO;\n                    that.ITEM = gScope.Talao.SELECTED;\n                                        \n                    that.show(function(){\n                        that.selectInput();\n                    },function(){\n                        gScope.Talao.setFocus();\n                        that.setEmptyInput();\n                    });\n\n                    break;\n                case 'TALAO':\n                    \n                    that.QUANTIDADE = gScope.Consumo.SELECTED.QUANTIDADE_SALDO;\n                    that.ITEM = gScope.Consumo.SELECTED;\n\n                    that.show(function(){\n                        that.selectInput();\n                    },function(){\n                        gScope.Consumo.setFocus();\n                        that.setEmptyInput();\n                    });\n\n                    break;\n\n            }\n            \n            if ( parseFloat(that.QUANTIDADE) > parseFloat(that.ITEM.QUANTIDADE_ESTOQUE) ) {\n                that.QUANTIDADE = that.ITEM.QUANTIDADE_ESTOQUE;\n            }\n            \n        },\n        confirm : function () {\n            var that = this;\n\n            var item = angular.copy(that.ITEM);\n                    \n            var dados = {};\n            dados.DADOS = {};\n            \n            dados.FILTRO = gScope.Filtro;\n            dados.DADOS.QUANTIDADE = that.QUANTIDADE;\n            \n            switch (gScope.Filtro.TAB_ACTIVE) {\n                case 'CONSUMO':\n                    \n                    dados.DADOS.ITENS = item.TALOES;\n                    \n                    that.enableButton(false);\n                    \n                    $ajax.post('/_15070/api/avulso',dados,{complete: function(){\n                            \n                        that.enableButton(true);\n                        \n                    }}).then(function(response){\n                        \n                        gScope.Filtro.merge(response.DATA_RETURN);\n                        \n                        that.close(function(){\n                            gScope.Talao.setFocus();\n                        });\n                    },function(){\n                        that.selectInput();\n                    });\n                    \n\n                    break;\n                case 'TALAO':\n\n                    dados.DADOS.ITENS = [item];\n                 \n                    that.enableButton(false);\n                    \n                    $ajax.post('/_15070/api/avulso',dados,{complete: function(){\n                            \n                        that.enableButton(true);\n                        \n                    }}).then(function(response){\n                        \n                        gScope.Filtro.merge(response.DATA_RETURN);\n                        \n                        that.close(function(){\n                            gScope.Consumo.setFocus();\n                        });\n                    \n                    },function(){\n                        that.selectInput();\n                    });\n                    \n                    break;\n\n            }\n        },\n        close : function (hidden) {\n\n            $('#modal-registrar-saida-avulsa')\n                .modal('hide')\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;        \n        },\n        show : function(shown,hidden) {\n\n            $('#modal-registrar-saida-avulsa')\n                .modal('show')\n                .one('shown.bs.modal', function(){\n                    shown ? shown() : '';\n                })\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;                         \n        },\n        setFocusInput : function() {        \n            $timeout(function(){\n                $('#modal-registrar-saida-avulsa input:focusable').first().focus();\n            },50);       \n        },\n        selectInput : function() {        \n            $timeout(function(){\n                $('#modal-registrar-saida-avulsa input:focusable').first().select();\n            },50);       \n        },\n        setEmptyInput : function() {        \n            var that = this;\n            \n            that.QUANTIDADE = '';\n        },\n        enableButton : function(bool) {\n            $('#modal-registrar-saida-avulsa button').prop('disabled',!bool);\n        }\n    };\n\n    Consumo.prototype.ModalTransacao = {\n        DADOS : {\n            AVULSA : [],\n            PECA : []\n        },\n        FILTRO : {},\n        dadosMerge : function (response) {\n            \n            var that = this;\n            \n            gcCollection.merge(that.DADOS.AVULSA,response.AVULSA);\n            gcCollection.merge(that.DADOS.PECA,response.PECA);\n        },\n        consultar : function(remessa_id,remessa_talao_id,produto_id,tamanho){\n            var that = this;\n            \n            that.FILTRO = {\n                REMESSA_ID          : remessa_id,\n                REMESSA_TALAO_ID    : remessa_talao_id,\n                PRODUTO_ID          : produto_id,\n                TAMANHO             : tamanho\n            };\n            \n            $ajax.post('/_15070/api/transacao',that.FILTRO).then(function(response){\n                \n                that.dadosMerge(response);\n                \n                $('#modal-transacao').modal('show');\n            });\n        },\n        excluirTransacao : function (transacao) {\n            var that = this;\n            addConfirme('<h4>Confirmação</h4>',\n                'Deseja realmente excluir esta transação? <br/> <b>Atenção: A operação não poderá ser revertida!</b>',\n                [obtn_sim,obtn_nao],\n                [{ret:1,func:function(){\n                    $rootScope.$apply(function(){\n\n                        $ajax.post('/_15070/api/transacao/delete',{\n                            FILTRO: gScope.Filtro, \n                            FILTRO_TRANSACAO: that.FILTRO, \n                            DADOS: [transacao]\n                        }).then(function(response){\n                            \n                            gScope.Filtro.merge(response.DATA_RETURN.DADOS);\n                            that.dadosMerge(response.DATA_RETURN);\n                            \n                            if ( !(that.DADOS.AVULSA.length > 0) && !(that.DADOS.PECA.length > 0) ) {\n                                $('#modal-transacao').modal('hide');\n                            }\n                        });\n                    });\n                }}]     \n            );\n        }\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Consumo;\n};","angular\n    .module('app')\n    .factory('Filtro', Filtro);\n    \n\n\tFiltro.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$rootScope',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Filtro($ajax, $httpParamSerializer, $rootScope, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Filtro(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Filtro = this; \n        \n//        this.REMESSA_FAMILIA_ID = 133;\n        this.VISUALIZACAO = '1';\n    }\n    \n    Filtro.prototype.consultar = function() {\n        \n        var that = this;\n        \n        loading('.main-ctrl');        \n        \n        $ajax.post('/_15070/api/consumo',that,{progress: false}).then(function(response){\n            \n            that.merge(response);\n            \n            loading('hide');\n            \n        });\n    };\n    \n    \n    Filtro.prototype.merge = function(response) {\n\n        gcCollection.merge(gScope.Consumo.DADOS, response, 'CONSUMO_ID');\n\n\n        /**\n         * Configura a dependência de talões\n         */\n\n        /**\n         * Agrupa consumos para os talões\n         */\n        var taloes_consumos = gcCollection.groupBy(gScope.Consumo.DADOS,[\n            'REMESSA',\n            'REMESSA_ID',\n            'REMESSA_ESTABELECIMENTO_ID',\n            'REMESSA_DATA',\n            'REMESSA_DATA_TEXT',\n            'REMESSA_FAMILIA_ID',\n            'REMESSA_FAMILIA_DESCRICAO',\n            'REMESSA_TALAO_ID',\n            'MODELO_ID',\n            'MODELO_DESCRICAO',\n            'COR_ID',\n            'COR_DESCRICAO',\n            'GRADE_ID',\n            'TAMANHO',\n            'TAMANHO_DESCRICAO',\n            'QUANTIDADE_TALAO',\n            'UM_TALAO'\n        ],'CONSUMOS');\n\n        gcCollection.merge(gScope.Talao.DADOS, taloes_consumos, ['REMESSA_ID','REMESSA_TALAO_ID']);\n\n\n        /**\n         * Agrupa talões para as remessas\n         */\n        var taloes = gcCollection.groupBy(gScope.Talao.DADOS,[\n            'REMESSA',\n            'REMESSA_ID',\n            'REMESSA_ESTABELECIMENTO_ID',\n            'REMESSA_DATA',\n            'REMESSA_DATA_TEXT',\n            'REMESSA_FAMILIA_ID',\n            'REMESSA_FAMILIA_DESCRICAO'\n        ],'TALOES');\n\n        gcCollection.merge(gScope.Remessa.DADOS, taloes, 'REMESSA_ID');\n\n\n\n        /**\n         * Configura a dependência de modelos\n         */\n\n        /**\n         * Agrupa consumos para os talões\n         */\n        var produtos_consumos = gcCollection.groupBy(gScope.Consumo.DADOS,[\n            'REMESSA',\n            'REMESSA_ID',\n            'REMESSA_ESTABELECIMENTO_ID',\n            'REMESSA_DATA',\n            'REMESSA_DATA_TEXT',\n            'REMESSA_FAMILIA_ID',\n            'REMESSA_FAMILIA_DESCRICAO',\n            'CONSUMO_FAMILIA_ID',\n            'CONSUMO_FAMILIA_DESCRICAO',\n            'CONSUMO_PRODUTO_ID',\n            'CONSUMO_PRODUTO_DESCRICAO',\n            'CONSUMO_GRADE_ID',\n            'CONSUMO_TAMANHO',\n            'CONSUMO_TAMANHO_DESCRICAO',\n            'QUANTIDADE_ESTOQUE',\n            'CONSUMO_UM',\n            'CONSUMO_STATUS',\n            'CONSUMO_STATUS_DESCRICAO',\n            'CONSUMO_LOCALIZACAO_ID',\n            'CONSUMO_LOCALIZACAO_ID_PROCESSO',\n            'GP_CCUSTO'\n        ],'TALOES');\n\n        gcCollection.merge(gScope.Consumo.PRODUTOS, produtos_consumos, ['REMESSA_ID','CONSUMO_PRODUTO_ID','CONSUMO_TAMANHO']);\n\n        for ( var i in gScope.Consumo.PRODUTOS ) {\n            var produto = gScope.Consumo.PRODUTOS[i];\n\n            produto.QUANTIDADE          = 0;\n            produto.QUANTIDADE_CONSUMO  = 0;\n            produto.QUANTIDADE_SALDO    = 0;\n\n            for ( var j in produto.TALOES ) {\n                var talao = produto.TALOES[j];\n\n                produto.QUANTIDADE          += parseFloat(talao.QUANTIDADE        );\n                produto.QUANTIDADE_CONSUMO  += parseFloat(talao.QUANTIDADE_CONSUMO);\n                produto.QUANTIDADE_SALDO    += parseFloat(talao.QUANTIDADE_SALDO  );\n\n            }\n        }\n\n        gcCollection.bind(gScope.Remessa.DADOS, gScope.Consumo.PRODUTOS, 'REMESSA_ID', 'PRODUTOS');\n\n        for ( var i in gScope.Remessa.DADOS ) {\n            var remessa = gScope.Remessa.DADOS[i];\n\n            remessa.QUANTIDADE          = 0;\n            remessa.QUANTIDADE_CONSUMO  = 0;\n            remessa.QUANTIDADE_SALDO    = 0;\n\n            for ( var j in remessa.PRODUTOS ) {\n                var produto = remessa.PRODUTOS[j];\n\n                remessa.QUANTIDADE          += parseFloat(produto.QUANTIDADE        );\n                remessa.QUANTIDADE_CONSUMO  += parseFloat(produto.QUANTIDADE_CONSUMO);\n                remessa.QUANTIDADE_SALDO    += parseFloat(produto.QUANTIDADE_SALDO  );\n\n                if ( remessa.QUANTIDADE_CONSUMO > remessa.QUANTIDADE ) {\n                    remessa.QUANTIDADE_CONSUMO = remessa.QUANTIDADE;\n                    remessa.QUANTIDADE_SALDO   = 0;\n                }\n            }\n        }\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Filtro;\n};","angular\n    .module('app')\n    .value('gScope', {})\n    .controller('Ctrl', Ctrl);\n    \n    \n\tCtrl.$inject = [\n        '$scope',\n        '$timeout',\n        'gScope',\n        'Filtro',\n        'Remessa',\n        'Consumo',\n        'Talao'\n    ];\n\n\tfunction Ctrl( $scope, $timeout, gScope, Filtro, Remessa, Consumo,  Talao ) {\n\n\t\tvar vm = this;\n\n\t\tvm.Filtro   = new Filtro();\n\t\tvm.Consumo  = new Consumo();\n\t\tvm.Remessa  = new Remessa();\n\t\tvm.Talao    = new Talao();\n\n        loading('.main-ctrl');\n        vm.Remessa.consultarFamilia().then(function(){\n            loading('hide');    \n        },function(){\n            loading('hide');\n        });\n        \n        \n//        $timeout(function () {\n//            var container = $(\".main-container\");\n//            var numberOfCol = 2;\n//            $(\".resize\").css('height', 100/numberOfCol +'%');\n//\n//            var sibTotalHeight;\n//            $(\".resize-item\").resizable({\n//                handles: 's',\n//                start: function(event, ui){\n//                    sibTotalHeight = ui.originalSize.height + ui.originalElement.next().outerHeight();\n//                },\n//                stop: function(event, ui){     \n//                    var cellPercentHeight=100 * ui.originalElement.outerHeight()/ container.innerHeight();\n//                    \n//                    ui.originalElement.css('height', cellPercentHeight + '%');  \n//                    \n//                    var nextCell = ui.originalElement.next();\n//                    \n//                    var nextPercentHeight=100 * nextCell.outerHeight()/container.innerHeight();\n//                    \n//                    nextCell.css('height', nextPercentHeight + '%');\n//                },\n//                resize: function(event, ui){ \n////                    $(this).mouseup();\n//                    \n//                    if ( ui.size.height > ( container.innerHeight() - 130 ) ) {\n//                        $(this).mouseup();\n//                        ui.originalElement.height(container.innerHeight() - 130);\n//                    } else {\n//                        ui.originalElement.next().height(container.innerHeight() - ui.size.height); \n//                    }\n//                    console.log(ui.size.height + ' ' + ui.originalElement.next().height());\n//                },\n//                minHeight : 130\n//            });\n//            \n//        });   \n\n \n\t}   \n  "]}