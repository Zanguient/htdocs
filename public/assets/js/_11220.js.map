{"version":3,"sources":["_11220.app.js","_11220.factory.filtro.js","_11220.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_11220.js","sourcesContent":["'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n        'gc-find',\n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils'\n\t])\n;    ","(function(window, angular) {\n    'use strict';\n\n    angular\n        .module('app')\n        .factory('Filtro', Filtro);\n\n\tFiltro.$inject = [\n        '$ajax',\n        '$q',\n        '$rootScope',\n        '$compile',\n        '$timeout',\n        '$consulta',\n        'gScope',\n        'gcCollection',\n        'gcObject'\n    ];\n\n\tfunction Filtro($ajax, $q, $rootScope, $compile,$timeout, $consulta, gScope, gcCollection, gcObject) {\n\n        // Private variables.\n        var obj = null;\n        var selected = null;\n        \n        \n\t    /**\n\t     * Constructor, with class name\n\t     */\n\t    function Filtro() {\n            \n            obj = this; \n\n            // Public methods         \n            this.consultar        = consultar;\n//            this.consultarDetalhe = consultarDetalhe;\n            this.merge            = merge;\n            \n            \n            this.incluir        = incluir; \n            this.confirmar      = confirmar; \n            this.alterar        = alterar; \n            this.cancelar       = cancelar; \n            this.excluir        = excluir; \n          \n            this.changeDataInicial  = changeDataInicial;\n            this.changeDataFinal    = changeDataFinal;\n            this.changeDataCorrente = changeDataCorrente;\n            \n            this.Modal         = Modal; \n            \n            this.ORDER_BY  = 'ID*1';\n            this.INCLUINDO = false;\n            this.ALTERANDO = false;\n            this.DADOS = [];\n            this.DADOS_RENDER = [];\n\n            this.DADOS          = [];\n            this.DADOS_DETALHES = [];\n            \n            this.TOTAL_GERAL = 0;\n            this.SELECTEDS = [];\n            this.SELECTED = {};\n            this.SELECTED_BACKUP = {};\n            \n\t    }\n\n        function consultar() {\n            \n            return $q(function(resolve, reject){\n                $ajax.get('/_11220/api/dados').then(function(response){                    \n                    resolve(response);\n                },function(e){\n                    reject(e);\n                });\n            });\n        }                \n\n//        function consultarDetalhe() {\n//            \n//            return $q(function(resolve, reject){\n//                $ajax.get('/_11220/api/filtro/detalhe').then(function(response){\n//                    \n//                    obj.merge(response);\n//                    \n//                    resolve(response);\n//                },function(e){\n//                    reject(e);\n//                });\n//            });\n//        }                \n        \n        /**\n         * Retorna a view da factory\n         */\n        function merge(response) {\n            \n            sanitizeJson(response.ESTABELECIMENTOS);\n            sanitizeJson(response.MODULOS);\n            sanitizeJson(response.PERIODOS);\n            \n            gScope.Ctrl.RESPONSE = response;\n            \n            gcCollection.merge(gScope.Ctrl.ESTABELECIMENTOS, response.ESTABELECIMENTOS, 'ID');\n            gcCollection.merge(gScope.Ctrl.MODULOS         , response.MODULOS         , 'ID');\n            gcCollection.merge(gScope.Ctrl.PERIODOS        , response.PERIODOS        , ['ESTABELECIMENTO_ID','MODULO_ID']);\n            \n            var estabelecimentos = gScope.Ctrl.ESTABELECIMENTOS;\n            var modulos          = gScope.Ctrl.MODULOS;\n            var periodos         = gScope.Ctrl.PERIODOS;\n            for ( var i in periodos ) {\n                var periodo = periodos[i];\n                \n                periodo.ESTABELECIMENTO_SELECT = selectById(estabelecimentos,periodo.ESTABELECIMENTO_ID);\n                periodo.MODULO_SELECT = selectById(modulos,periodo.MODULO_ID);\n            }\n            \n        }\n        \n\n        \n        function incluir() {\n            \n            obj.SELECTED = {\n                DESCRICAO         : '',\n                FILTRO_GASTO        : 0,\n                FILTRO_GASTO_SELECT : selectById(gScope.Ctrl.FILTROS_GASTO,0),\n                EXCLUIDO          : false\n            };\n                        \n            gScope.Ctrl.ConsultaCContabil.apagar(true);\n            \n            obj.DADOS.push(obj.SELECTED);\n//            obj.FILTRO.CCUSTOS.push(obj.SELECTED);\n//            mergeGroup();\n            \n            obj.INCLUINDO = true;\n            obj.ALTERANDO = true;\n            obj.Modal.show();\n\n//            obj.selectedReset();\n        }\n        \n        function confirmar() {\n       \n            \n            var dados = {\n                FILTRO: {},\n                DADOS : obj.DADOS\n            };\n//    \n            $ajax.post('/_11220/api/filtro/post',dados).then(function(response){\n\n                obj.merge(response.DATA_RETURN);\n                \n            });\n        }\n\n        function alterar() {\n            \n//            gScope.Ctrl.ImobilizadoItem.SELECTEDS = [];\n\n            gScope.Ctrl.ConsultaCContabil.Input.value = obj.SELECTED.CCONTABIL_MASK + ' - ' + obj.SELECTED.CCONTABIL_DESCRICAO;\n//            \n            gScope.Ctrl.ConsultaCContabil.Input.readonly             = true;\n            gScope.Ctrl.ConsultaCContabil.btn_apagar_filtro.visivel  = true;\n            gScope.Ctrl.ConsultaCContabil.btn_apagar_filtro.disabled = false;\n            gScope.Ctrl.ConsultaCContabil.btn_filtro.visivel         = false;            \n//            \n            gScope.Ctrl.ConsultaCContabil.item.selected = true;            \n            \n            this.ALTERANDO = true;\n            this.INCLUINDO = false;\n            angular.copy(this.SELECTED, this.SELECTED_BACKUP);\n            \n            obj.Modal.show();\n        };        \n        \n        function cancelar() {\n            \n            var selected = angular.toJson(obj.SELECTED);\n            var backup   = angular.toJson(obj.SELECTED_BACKUP );\n            \n            function close() {\n                if ( obj.ALTERANDO && !obj.INCLUINDO ) {\n                    angular.extend(obj.SELECTED, obj.SELECTED_BACKUP);  \n\n                    obj.Modal.hide();\n                }\n\n                if ( obj.INCLUINDO ) {\n\n                    var idx = obj.DADOS.indexOf(obj.SELECTED);\n\n                    obj.DADOS.splice(idx,1);                            \n\n\n//                            obj.selectedReset();\n                    obj.Modal.hide();\n                }\n            }\n            \n            if ( selected != backup ) {\n                addConfirme('<h4>Confirmação</h4>',\n                    'Deseja realmente cancelar esta operação?',\n                    [obtn_sim,obtn_nao],\n                    [{ret:1,func:function(){\n                        $rootScope.$apply(function(){\n\n                            close();\n                        });\n                    }}]     \n                );\n            } else {\n                close();\n            }\n        }\n        \n        function excluir() {\n            addConfirme('<h4>Confirmação</h4>',\n                'Deseja realmente excluir este item?',\n                [obtn_sim,obtn_nao],\n                [{ret:1,func:function(){\n                    $rootScope.$apply(function(){\n                        \n                        obj.SELECTED.EXCLUIDO = true;\n                    });\n                }}]     \n            );\n        }\n        \n        \n        /**\n         * Retorna a view da factory\n         */\n        function renderChart(response) {\n\n\n            var obj = $('#chart_div');\n            var pai = $(obj).closest('#chart-google');\n\n            google.charts.load('current', {packages:[\"orgchart\"]});\n            google.charts.setOnLoadCallback(function() {\n                \n                var data = new google.visualization.DataTable();\n                data.addColumn('string', 'Name');\n                data.addColumn('string', 'Manager');\n                data.addColumn('string', 'ToolTip');\n\n                var dados = response;\n                var item = null;\n                \n                var chart_container = [];\n                var chart_item = [];\n                \n                for ( var i in dados ) {\n                    item = dados[i];\n                    \n                    chart_item = [\n                        {\n                            v:''+item.ID,\n                            f:item.CCUSTO_DESCRICAO,\n                            id: ''+item.ORDEM\n                        },\n                        ''+( (item.ORDEM - 1) > 0 ? item.ORDEM - 1 : ''),\n                        ''\n                    ];\n                    \n                    chart_container.push(chart_item);\n                }\n                \n                // For each orgchart box, provide the name, manager, and tooltip to show.\n                data.addRows(chart_container);\n\n                var chart = new google.visualization.OrgChart(document.getElementById('chart_div'));\n                chart.draw(data, {allowHtml:true});\n\n                setTimeout(function(){\n//\n//                    $('.img-loading').css('display','none');\n                    $(obj).replaceWith( $compile($(obj).html())($rootScope) );\n                    $(pai).append('<div style=\"width: 99%; height: 100%;\" id=\"chart_div\"></div>');\n\n                    $rootScope.$apply(function () {\n                        $rootScope.message = \"Timeout called!\";\n                    });\n\n                },400);\n            });\n                        \n            \n        }\n        \n        function changeDataInicial() {\n            \n            obj.SELECTED.DATA_INICIAL = moment(obj.SELECTED.DATA_INICIAL_MODEL).format('DD.MM.YYYY');\n        }  \n        \n        function changeDataFinal() {\n            \n            obj.SELECTED.DATA_FINAL = moment(obj.SELECTED.DATA_FINAL_MODEL).format('DD.MM.YYYY');\n        }  \n        \n        function changeDataCorrente() {\n            \n            if ( obj.SELECTED.DATA_CORRENTE == true ) {\n                obj.SELECTED.DATA_FINAL       = null;\n                obj.SELECTED.DATA_FINAL_MODEL = undefined;\n            }\n        }  \n        \n        var Modal = {\n            \n            _modal : function(){\n                return $('#modal-filtro');\n            },\n            show : function(shown,hidden) {\n\n                this._modal()\n                    .modal('show')\n                ;                         \n\n\n                this._modal()\n                    .one('shown.bs.modal', function(){\n\n                        $(this).find('input:focusable').first().select();\n\n                        if ( shown ) {\n                            shown(); \n                        }\n                    })\n                ;    \n\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            \n                            obj.ALTERANDO = false;\n                            obj.INCLUINDO = false;\n                            $('.selected:focusable').first().focus();\n                    \n                            if ( hidden ) {\n                                hidden();      \n                            }\n                        })\n                    ;        \n            },\n            hide : function(hidden) {\n\n                this._modal()\n                    .modal('hide')\n                ;\n\n                if ( hidden ) {\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            \n                            obj.ALTERANDO = false;\n                            obj.INCLUINDO = false;\n                            $('.selected:focusable').first().focus();\n                    \n                            hidden ? hidden() : '';\n                        })\n                    ;                      \n                }\n            }\n        };     \n\n            \n\t    /**\n\t     * Return the constructor function\n\t     */\n\t    return Filtro;\n\t};\n   \n})(window, window.angular);","angular\n    .module('app')\n    .value('gScope', {})\n    .controller('Ctrl', Ctrl);\n    \n    \n\tCtrl.$inject = [\n        '$scope',\n        '$timeout',\n        '$ajax',\n        'gScope',\n        '$consulta',\n        'Historico',\n        'Filtro'\n    ];\n\n\tfunction Ctrl( \n        $scope, \n        $timeout, \n        $ajax,\n        gScope, \n        $consulta,\n        Historico,\n        Filtro\n    ) {\n\n\t\tvar vm          = this;\n        gScope.Ctrl     = this;\n        \n        \n\n        vm.Estabelecimento = {};\n        vm.Modulo          = {\n            DESCRICAO : '',\n            INSERINDO : false,\n            gravar : function(){\n                \n                $ajax.post('/_11220/api/modulo/post',{DATA_RETURN:true,DADOS:{DESCRICAO:vm.Modulo.DESCRICAO}}).then(function(response){\n\n                    vm.Modulo.DESCRICAO = '';\n                    vm.Modulo.INSERINDO = false;\n                    \n                    vm.Filtro.merge(response.DATA_RETURN);\n\n                });\n\n            }\n        };\n        vm.Periodo         = {};\n        \n        vm.RESPONSE         = [];\n        vm.ESTABELECIMENTOS = [];\n        vm.MODULOS          = [];\n        vm.PERIODOS         = [];\n        \n        \n        /**\n         * Importa a função helper selectById para ser utlizado na view\n         */\n        vm.selectById = selectById;        \n        \n        /**\n         * Inicializa as factorys\n         */\n        vm.Filtro      = new Filtro();\n        vm.Historico = new Historico();\n        vm.Consulta  = new $consulta();\n        \n        /**\n         * Realiza a consulta inicial\n         */\n        vm.Filtro.consultar().then(function(response){\n            vm.Filtro.merge(response);\n        });\n        \n\n        vm.PeriodoSumbit = function(){\n        \n            var periodos = [];\n            angular.copy(vm.PERIODO_FILTERED,periodos);\n            \n            for ( var i in periodos ) {\n                var periodo = periodos[i];\n                \n                \n                periodo.DATAINICIAL = moment(vm.Filtro.DATA_1).format('YYYY.MM.DD');\n                periodo.DATAFINAL = moment(vm.Filtro.DATA_2).format('YYYY.MM.DD');\n        \n            }\n            \n            $ajax.post('/_11220/api/periodo/post',{DATA_RETURN:true,DADOS:periodos}).then(function(response){\n                \n                vm.Filtro.merge(response.DATA_RETURN);\n    \n                resolve(response);\n\n            });\n            \n            \n        };\n\n        vm.PeriodoFilter = function (item) {\n            \n            var ret = true;\n            \n            var filter_estabelecimento = false;\n            \n            if ( vm.Estabelecimento.SELECTED != undefined && !isEmpty(vm.Estabelecimento.SELECTED) ) {\n                filter_estabelecimento = true;\n            }\n            \n            \n            if ( filter_estabelecimento && vm.Estabelecimento.SELECTED.ID != item.ESTABELECIMENTO_ID ) {\n                ret = false;\n            }\n            \n            \n            var filter_modulo = false;\n            \n            if ( vm.Modulo.SELECTED != undefined && !isEmpty(vm.Modulo.SELECTED) ) {\n                filter_modulo = true;\n            }\n            \n            \n            if ( filter_modulo && vm.Modulo.SELECTED.ID != item.MODULO_ID ) {\n                ret = false;\n            }\n            \n            return ret;\n        };\n\t}   \n  "]}