{"version":3,"sources":["consulta.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"consulta.js","sourcesContent":["\t{ \r\n        /** Consulta generica (Tabulado) */\r\n\t\t\r\n\t\t  var filtro;\r\n\t\t  var campo_consulta;\r\n\t\t  var btn_filtro_consulta;\r\n\t\t  var input_group;\r\n\t\t  var itens_consulta;\r\n\t\t  var _consulta_id;\r\n\t\t  var tempo_focus;\r\n\t\t  var consulta_selecionado = false;\r\n      var obj;\r\n        \r\n       var campos_imputs   = [];\r\n       var recebe_valor    = [];\r\n       var recebe_todos    = [];\r\n       var campos_sql      = [];\r\n       var filtro_sql      = [];\r\n       var campos_tabela   = [];\r\n       var campos_titulo   = [];\r\n       var tamanho_tabela  = [];\r\n       var campos_titulo   = [];\r\n       var campo_ret       = [];\r\n       var gets            = []; \r\n       \r\n       var total_width     = 0;\r\n       var fechar = 0;\r\n        \r\n       /** Retorna as classes dos campos que irão receber os valores que foram passados como parametro\r\n        * \r\n        *@param {json} x imputs com as classes   \r\n        *@returns {array}\r\n        **/\r\n       function getRecebeValor(x){\r\n         var obj = $(recebe_valor)[x];\r\n         \r\n         var vclass = '.'+$(obj).attr('objClass');\r\n         var vcampo = ''+$(obj).attr('objCampo');\r\n         \r\n         var ret = $(vclass);\r\n         \r\n         $(ret).attr('objCampo',vcampo);\r\n         \r\n         return ret;\r\n       }\r\n\t   \r\n\t   \r\n\t   function getTodos(x){\r\n         var obj = $(recebe_todos)[x];\r\n         \r\n         var vclass = '.'+$(obj).attr('objClass');\r\n         \r\n         var ret = $(vclass);\r\n         \r\n         return ret;\r\n       }\r\n\t   \r\n\t   /** Retorna as classes dos campos que irão receber se a opção todos for selecionada.\r\n        * \r\n        *@returns {array}\r\n        **/\r\n       function getRecebeTodos(){\r\n\t\t \r\n\t\t var vetor = new Array ();\r\n            var cont = $(recebe_todos).length;\r\n            \r\n            for (i = 0; i < cont; i++) {\r\n               var obj = $(recebe_todos)[i];\r\n               var campo = $(obj).attr('objClass');\r\n               vetor[i] = campo;           \r\n\r\n             }\r\n         \r\n            return vetor;\r\n       }\r\n       \r\n       /** Retorna os campos da consulta que foram passados como parametro\r\n        *  \r\n        *@returns {array}\r\n        **/\r\n       function getCampos(){\r\n            \r\n            var vetor = new Array ();\r\n            var cont = $(campos_sql).length;\r\n            \r\n            for (i = 0; i < cont; i++) {\r\n               var obj = $(campos_sql)[i];\r\n               var campo = $(obj).val();\r\n               vetor[i] = campo;           \r\n\r\n             }\r\n         \r\n            return vetor;\r\n       }\r\n       \r\n       /** Retorna os imputs hidden\r\n        *  \r\n        *@returns {array}\r\n        **/\r\n       function getImputs(){\r\n            \r\n            var vetor = new Array ();\r\n            var cont = $(gets).length;\r\n\r\n            for (i = 0; i < cont; i++) {\r\n                var obj = $(gets)[i];\r\n                var valor = $(obj).val();\r\n                var nomes = $(obj).attr('name');\r\n                \r\n                if (typeof(nomes) !== 'undefined'){\r\n                    vetor[i] = [nomes,valor];\r\n                }\r\n\r\n            }\r\n            \r\n            return vetor;\r\n       }\r\n       \r\n       /** Retorna os as condições que foram passados como parametro\r\n        *  \r\n        *@returns {array}\r\n        **/\r\n       function getCondicao(){\r\n            \r\n            var vetor = new Array ();\r\n            var cont = $(filtro_sql).length;\r\n            \r\n            for (i = 0; i < cont; i++) {\r\n               var obj = $(filtro_sql)[i];\r\n               var campo = $(obj).val();\r\n               vetor[i] = campo;           \r\n\r\n             }\r\n         \r\n            return vetor;\r\n       }\r\n       \r\n        /**\r\n         * Retorna as Condições de Consulta com o nome do campo\r\n         * @returns {json}\r\n         */\r\n        function getCondicaoCampo(){\r\n\r\n             var vetor = {};\r\n             var cont = $(filtro_sql).length;\r\n\r\n             for (i = 0; i < cont; i++) {\r\n                var obj = $(filtro_sql)[i];\r\n                var valor = $(obj).val();\r\n                var campo = $(obj).attr('objcampo');\r\n                \r\n                vetor[campo] = valor;\r\n              }\r\n             return vetor;\r\n        }       \r\n       \r\n       /** Retorna os campos da tabela que sera montada com os parametros\r\n        *  \r\n        *@returns {array}\r\n        **/\r\n       function getTabela(){\r\n            \r\n            var vetor = new Array ();\r\n            var cont = $(campos_tabela).length;\r\n            \r\n            for (i = 0; i < cont; i++) {\r\n               var obj = $(campos_tabela)[i];\r\n               var campo = $(obj).val();\r\n               vetor[i] = campo;           \r\n\r\n             }\r\n         \r\n            return vetor;\r\n       }\r\n       \r\n       /** Retorna os tamanhos dos campos da tabela que sera montada com os parametros\r\n        *  \r\n        *@returns {array}\r\n        **/\r\n       function getTamanhos(){\r\n            \r\n            var vetor = new Array ();\r\n            var cont = $(tamanho_tabela).length;\r\n            total_width = 0;\r\n            \r\n            for (i = 0; i < cont; i++) {\r\n               var obj = $(tamanho_tabela)[i];\r\n               var campo = $(obj).attr('objTamanho');\r\n               vetor[i] = campo;\r\n               total_width = parseInt(total_width) + parseInt(campo);\r\n\r\n            }\r\n         \r\n            return vetor;\r\n        }\r\n       \r\n       /** Retorna os titulos dos campos da tabela que sera montada com os parametros\r\n        *  \r\n        *@returns {array}\r\n        **/\r\n       function getTitulos(){\r\n            \r\n            var vetor = new Array ();\r\n            var cont = $(campos_titulo).length;\r\n            \r\n            for (i = 0; i < cont; i++) {\r\n               var obj = $(campos_titulo)[i];\r\n               var campo = $(obj).val();\r\n               vetor[i] = campo;           \r\n\r\n             }\r\n         \r\n            return vetor;\r\n        }\r\n        \r\n       \r\n       /** Seta os valores dos campos Ocultos, e Recebe valor como vazio\r\n        **/\r\n        function empytValores(){\r\n           \r\n           var cont = $(recebe_valor).length;\r\n           \r\n            for (i = 0; i < cont; i++) {\r\n                var objrv = getRecebeValor(i);\r\n\r\n                if($(objrv).attr('type') == 'button'){\r\n                    $(objrv).empty();\r\n                }else{\r\n                    $(objrv).val('');\r\n                }\r\n            }\r\n\t\t\t\r\n\t\t\tvar cont2 = $(recebe_todos).length;\r\n\t\t\t\r\n            for (i = 0; i < cont2; i++) {\r\n\t\t\t\tvar objrv = getTodos(i);\r\n\t\t\t\t$(objrv).val('0');\r\n\r\n\t\t\t}\r\n           \r\n\t\t\t$.each(campos_imputs , function( key, value ) {\r\n\t\t\t\tvar tag = $(value).attr('objcampo');\r\n\t\t\t\tif( tag != 'noclear' ) {\r\n\t\t\t\t $(value).val('').trigger('change');\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n        }\r\n       \r\n       /** adiciona os eventos dos items da lista que forão adicionados\r\n        * \r\n        *@param {json} e objeto jquey do form-group  \r\n        **/\r\n       function trataItens(e){\r\n            \r\n            itens_consulta = $(e).find('ul.consulta-lista li a');\r\n           \r\n            selecItemListaConsulta( $(itens_consulta), campo_consulta );\r\n\r\n            $(itens_consulta)\r\n                .focusout(function() {\r\n\r\n                    if(tempo_focus) \r\n                        clearTimeout(tempo_focus);\r\n\r\n                    tempo_focus = setTimeout(function() {\r\n\r\n                        if( !$(e).find(itens_consulta).is(':focus') && \r\n                            !$(e).find(campo_consulta).is(':focus') && \r\n                            !$(e).find(btn_filtro_consulta).is(':focus')\r\n                        ) {\r\n                            $(campo_consulta).val('');\r\n                            fechaListaConsulta( input_group ,e);\r\n                        }\r\n\r\n                    }, 200);\r\n\r\n                });\r\n\r\n            $(campo_consulta)\r\n                .focusout(function() {\r\n\r\n                    if(tempo_focus) \r\n                        clearTimeout(tempo_focus);\r\n\r\n                    tempo_focus = setTimeout(function() {\r\n\r\n                        if( !$(itens_consulta).is(':focus') &&\r\n                            !$(_consulta_id).val() && \r\n                            !$(btn_filtro_consulta).is(':focus') \r\n                        ) {\r\n                            $(campo_consulta).val('');\r\n                            fechaListaConsulta( input_group ,e);\r\n                        }\r\n\r\n                    }, 200);\r\n\r\n                });\r\n                        \r\n            if(itens_consulta.length == 1){\r\n                $(itens_consulta).trigger(\"click\");\r\n            }\r\n        }\r\n        \r\n       \r\n\t\t/** Chama a consulta com os parametros passados como parametros\r\n        * \r\n        *@param {json} e objeto jquey que foi clicado  \r\n        **/\r\n\t\tfunction filtrarConsulta(e) {\r\n            \r\n\t\t\tvar base\t\t= $(e).parent().parent().parent();\r\n\t\t\tvar obj_imputs\t= $(base).find('._consulta_imputs');\r\n\t\t\tvar prod\t\t= $(obj_imputs).children('._produto_id');\r\n\t\t\tvar valida\t\t= 'true';\r\n\t\t\t\r\n\t\t\tif ( $(prod).length > 0 ) {\r\n\t\t\t\texecValidar();\t//função encontra-se em 'consulta.blade.php'\t\t\t\r\n\t\t\t\tvalida = $('._consulta_validate').val();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif( valida == 'true' || valida == true ) {\r\n\r\n//\t\t\t\tvar base  = $(e).parent().parent().parent();\r\n\r\n\t\t\t\tvar obj_parametros = $(base).find('._consulta_parametros');\r\n//\t\t\t\tvar obj_imputs = $(base).find('._consulta_imputs');\r\n\r\n\t\t\t\tcampos_imputs   = $(obj_imputs).find('._consulta_imputs');\r\n\r\n\t\t\t\tobj             = $(obj_parametros).find('._consulta_obj').val();\r\n\t\t\t\trecebe_valor    = $(obj_parametros).find('._consulta_recebevalor');\r\n\t\t\t\trecebe_todos\t= $(obj_parametros).find('._recebevalor_todos');\r\n\t\t\t\tcampos_sql      = $(obj_parametros).find('._consulta_campos');\r\n\t\t\t\tfiltro_sql      = $(obj_parametros).find('._consulta_filtro');\r\n\t\t\t\tcampos_tabela   = $(obj_parametros).find('._consulta_tabela');\r\n\t\t\t\ttamanho_tabela  = $(obj_parametros).find('._consulta_tabela');\r\n\t\t\t\tcampos_titulo   = $(obj_parametros).find('._consulta_titulo');\r\n\t\t\t\tcampo_ret       = $(obj_parametros).find('._consulta_ret');\r\n                gets            = $(document).find('input[type=hidden]');\r\n\r\n\t\t\t\tcampo_consulta\t\t= $(base).find('.consulta-descricao');\t//campo\r\n\t\t\t\tbtn_filtro_consulta\t= $(base).find('.btn-filtro-consulta');\r\n\r\n\t\t\t\tinput_group\t\t\t= $(campo_consulta).parent('.input-group');\t//input-group\r\n\t\t\t\t_consulta_id\t\t= $(base).find('._valor_selecionado_consulta');\r\n\r\n\t\t\t\tfiltro = campo_consulta.val();\r\n\r\n\t\t\t\t//esvazia campo hidden caso algum item já tenha sido escolhido antes\r\n\t\t\t\tif(consulta_selecionado){ \r\n\t\t\t\t\t$(_consulta_id).val('');\r\n\t\t\t\t\tempytValores();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( !filtro ) {\r\n\t\t\t\t\tfechaListaConsulta( input_group ,e);\r\n\t\t\t\t\t$(_consulta_id).val('');\r\n\t\t\t\t\tempytValores();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar campos         = getCampos();\r\n\t\t\t\tvar condicao       = getCondicao();\r\n\t\t\t\tvar condicao_campo = getCondicaoCampo();\r\n\t\t\t\tvar tabela         = getTabela();\r\n\t\t\t\tvar titulos        = getTitulos();\r\n\t\t\t\tvar tamanhos       = getTamanhos();\r\n                var imputhidden    = getImputs();\r\n\t\t\t\tvar recebetodos    = getRecebeTodos();\r\n\r\n\t\t\t\tvar dadosEnvio = {\r\n                    filtro\t\t\t: filtro, \r\n                    campos\t\t\t: campos, \r\n                    obj\t\t\t\t: obj, \r\n                    condicao\t\t: condicao,\r\n                    condicao_campo\t: condicao_campo,\r\n                    tabela\t\t\t: tabela, \r\n                    titulos\t\t\t: titulos, \r\n                    tamanhos\t\t: tamanhos,\r\n                    imputhidden\t\t: imputhidden,\r\n\t\t\t\t\trecebe_todos\t: recebetodos,\r\n\t\t\t\t\topcao_todos\t\t: $(obj_parametros).find('._opcao_todos').val(),\r\n\t\t\t\t\tget_todos\t\t: $(obj_imputs).find('._todos_selecionado').val(),\r\n\t\t\t\t\tset_todos\t\t: $(obj_parametros).find('._todos_selecionar').val()\r\n                };\r\n                \r\n\t\t\t\t$(base).find('.lista-consulta-container').css('width',total_width);\r\n\r\n\t\t\t\tvar url_action = \"/consultaAll\";\r\n\t\t\t\tvar dados = dadosEnvio;\r\n\t\t\t\tvar type = \"POST\";\r\n\r\n\t\t\t\tfunction success(data){\r\n\t\t\t\t  abreListaConsulta( input_group );\r\n\r\n\t\t\t\t\t\t$(base).find('.lista-consulta')\r\n\t\t\t\t\t\t\t.html(data);\r\n                            \r\n\t\t\t\t\t\t//existem dados cadastrados\r\n\t\t\t\t\t\tif( data.indexOf('nao-cadastrado') === -1 ) {\r\n\t\t\t\t\t\t\ttrataItens(base);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t$(_consulta_id).val('');\r\n\r\n\t\t\t\t\t\t\t$(campo_consulta)\r\n\t\t\t\t\t\t\t\t.focusout(function() {\r\n\t\t\t\t\t\t\t\t\tif( $(base).find('.lista-consulta').children().children().hasClass('nao-cadastrado') ) {\r\n\t\t\t\t\t\t\t\t\t\t$(campo_consulta).val('');\r\n\t\t\t\t\t\t\t\t\t\tfechaListaConsulta( input_group ,base);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}  \r\n\t\t\t\t}\r\n\r\n\t\t\t\texecAjax2(type,url_action,dados,success,false,btn_filtro_consulta);\r\n                \r\n\t\t\t}\r\n\t\t}\r\n        \r\n        /** Chama a consulta da procima pagina a ser caregada\r\n        * \r\n        *@param {json} e objeto jquey que foi clicado  \r\n        **/\r\n\t\tfunction getMais(e) {\r\n            \r\n            var obj = $(e).closest('.form-group');\r\n            \r\n            $(obj).find('._valida_fechar_lista').val(1);\r\n            \r\n            btn_filtro_consulta\t= $(obj).find('.btn-filtro-consulta');\r\n            \r\n            var tag = $(e).attr('tag');\r\n            var pag = $(e).attr('pag');\r\n            \r\n            var mais_all = $(e).parent().find('.btn-caregar-mais-all');\r\n            \r\n            var url_action = \"/consultaMais\";\r\n            var dados = {'tag':tag, 'pag':pag};\r\n            var type = \"POST\";\r\n            \r\n            function success(data){\r\n              $(e).parent().append(data);\r\n              $(e).remove();\r\n              $(mais_all).remove();\r\n              \r\n              trataItens(obj);\r\n              \r\n              $(obj).find('._valida_fechar_lista').val(0);\r\n            }\r\n\r\n            execAjax2(type,url_action,dados,success,false,btn_filtro_consulta,false);\r\n            \r\n            \r\n\t\t}\r\n        \r\n        /** Chama a consulta com todas as paginas que estão faltando serem caregadas\r\n        * \r\n        *@param {json} e objeto jquey que foi clicado  \r\n        **/\r\n\t\tfunction getAll(e) {\r\n            \r\n            var obj = $(e).closest('.form-group');\r\n            \r\n            $(obj).find('._valida_fechar_lista').val(1);\r\n              \r\n            btn_filtro_consulta\t= $(obj).find('.btn-filtro-consulta');\r\n            \r\n            var tag = $(e).attr('tag');\r\n            var pag = $(e).attr('pag');\r\n            \r\n            var mais = $(e).parent().find('.btn-caregar-mais');\r\n            \r\n            var url_action = \"/consultaMaisAll\";\r\n            var dados = {'tag':tag, 'pag':pag};\r\n            var type = \"POST\";\r\n            \r\n            function success(data){\r\n              $(e).parent().append(data);\r\n              $(e).remove();\r\n              $(mais).remove();\r\n              \r\n              trataItens(obj);\r\n              \r\n              $(obj).find('._valida_fechar_lista').val(0);\r\n            }\r\n\r\n            execAjax2(type,url_action,dados,success,false,btn_filtro_consulta,false);\r\n\t\t}\r\n\r\n\t\t/** Mostra lista com o resultado da consulta na tela\r\n        * \r\n        *@param {json} consulta objeto jquey que contem a lista  \r\n        **/\r\n\t\tfunction abreListaConsulta(consulta) {\r\n\t\t\t\r\n\t\t\t$(consulta)\r\n\t\t\t\t.next('.lista-consulta-container')\r\n\t\t\t\t.addClass('ativo');\r\n\r\n\t\t}\r\n\r\n\t\t/** Fecha lista com o resultado da consulta na tela\r\n        * \r\n        *@param {json} consulta objeto jquey que contem a lista \r\n        *@param {json} e objeto jquey do form-group  \r\n        **/\r\n\t\tfunction fechaListaConsulta(consulta,e) {\r\n            \r\n            fechar = $(e).find('._valida_fechar_lista').val();\r\n            \r\n            if (fechar == 0){\r\n\t\t\t$(consulta)\r\n\t\t\t\t.next('.lista-consulta-container')\r\n\t\t\t\t.removeClass('ativo')\r\n\t\t\t\t.children('.lista-consulta')\r\n\t\t\t\t.empty();\r\n\t\t\r\n            }else{\r\n              $(itens_consulta).focus();  \r\n            }   \r\n           \r\n           //*/\r\n\t\t}\r\n        \r\n        /** Fecha todas as lista de consulta \r\n        **/\r\n\t\tfunction fechaListaConsultaAll() {\r\n\r\n\t\t\t$('.lista-consulta-container')\r\n\t\t\t\t.removeClass('ativo')\r\n\t\t\t\t.children('.lista-consulta')\r\n\t\t\t\t.empty();\r\n \r\n\t\t}\r\n\r\n\r\n\t\t/**\r\n\t\t * Preencher campos de acordo com o item selecionado.\r\n\t\t * \r\n\t\t * @param {json} itens Item que foi clicado\r\n\t\t * @param {json} campo Campos que recebe valor\r\n\t\t */\r\n\t\tfunction selecItemListaConsulta(itens, campo) {\r\n            \r\n                $(itens).click(function(e) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar input_todos = $(this).find('._consulta_todos');\r\n\t\t\t\t\t\r\n                    var obj = $(campos_imputs).closest('.form-group');\r\n\r\n                    e.preventDefault();\r\n\r\n                    var cont  = $(recebe_valor).length;\r\n                    var cont2 = $(campo_ret).length;\r\n                    var cont3 = $(campos_imputs).length;\r\n                    var cont4 = $(recebe_todos).length;\r\n\t\t\t\t\t\r\n\r\n                        for (i = 0; i < cont; i++) {\r\n                            var objrv = getRecebeValor(i);\r\n\r\n                            if ($(objrv).attr('objcampo') === 'clear') {\r\n                              var objValor = ''; \r\n                            }\r\n                            else {\r\n                              var clas = '._consulta_'+$(objrv).attr('objcampo');\r\n                              var objValor = $(this).find(clas).val();\r\n                            }\r\n\r\n                            if($(objrv).attr('type') == 'button'){\r\n                                $(objrv).html(objValor);\r\n                            }else{\r\n                                $(objrv).val(objValor).trigger('change');\r\n                            }\r\n\r\n                        }\r\n\r\n                        for (i = 0; i < cont3; i++) {\r\n                          var objrv = $(campos_imputs)[i];\r\n                          var clas = '._consulta_'+$(objrv).attr('objcampo');\r\n                          var objValor = $(this).find(clas).val();\r\n                             \r\n                          $(objrv).val(objValor).trigger('change');\r\n\r\n                        }\r\n\r\n                        var ret ='';\r\n                        for (i = 0; i < cont2; i++) {\r\n                            var objrv = $(campo_ret)[i];\r\n                            var clas = '._consulta_'+$(objrv).attr('objcampo');\r\n                            var objValor = $(this).find(clas).val();\r\n\r\n                            if (i == 0){\r\n                                ret = objValor;\r\n                            }else{\r\n                                ret = ret + ' - ' + objValor;\r\n                            } \r\n\r\n                        }\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\r\n                    $(campo)\r\n                        .val(ret)\r\n                        .focus();\r\n\r\n                    selecionadoConsulta(obj);\r\n\r\n                    $(_consulta_id)\r\n                        .val(1)\r\n                        .trigger('change');\r\n\r\n                    $(obj).find(\".consulta-descricao\").trigger( \"change\" );\r\n\r\n                    fechaListaConsulta( input_group, obj);\r\n                    consulta_selecionado = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif($(input_todos).val() === 'todos_selecionado'){\r\n\t\t\t\t\t\t$(campo).val('TODOS').focus();\r\n\t\t\t\t\t\t$(campos_imputs).parent('._consulta_imputs').find('._todos_selecionado').val('1');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor (i = 0; i < cont4; i++) {\r\n                            var objrv = getTodos(i);\r\n                            $(objrv).val('1');\r\n                        }\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tfor (i = 0; i < cont4; i++) {\r\n                            var objrv = getTodos(i);\r\n                            $(objrv).val('0');\r\n\r\n                        }\r\n\t\t\t\t\t}\r\n                });\r\n\t\t\t\t\r\n\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * Se um item foi selecionado modifica os campos.\r\n\t\t * \r\n\t\t * @param {json} e Objeto jquey do form-group\r\n\t\t */\r\n\t\tfunction selecionadoConsulta(e) {\r\n            \r\n            var obj = e;\r\n            \r\n\t\t\t$(obj).find('.consulta-descricao')\r\n\t\t\t\t.attr('readonly', true);\r\n\r\n\t\t\t$(obj).find('.btn-filtro-consulta')\r\n\t\t\t\t.hide();\r\n            \r\n\t\t\t$(obj).find('.btn-apagar-filtro-consulta')\r\n\t\t\t\t.show()\r\n\t\t\t\t.click(function() {\r\n                \r\n                    var obj_parametros = $(this).parent().parent().parent().find('._consulta_parametros');\r\n                    var obj_imputs = $(this).parent().parent().parent().find('._consulta_imputs');\r\n\r\n                    campos_imputs   = $(obj_imputs).find('._consulta_imputs');\r\n                    recebe_valor    = $(obj_parametros).find('._consulta_recebevalor');\r\n                    recebe_todos    = $(obj_parametros).find('._recebevalor_todos');\r\n\r\n                    \r\n\t\t\t\t\t$(this)\r\n\t\t\t\t\t\t.siblings('input')\r\n\t\t\t\t\t\t.removeAttr('readonly');\r\n\r\n\t\t\t\t\t$(this)\r\n\t\t\t\t\t\t.hide()\r\n\t\t\t\t\t\t.prev('button')\r\n\t\t\t\t\t\t.show();\r\n                \r\n                    empytValores();    \r\n\r\n\t\t\t\t\t$(obj).find('.consulta-descricao')\r\n\t\t\t\t\t\t.val('')\r\n\t\t\t\t\t\t.focus();\r\n\r\n\t\t\t\t\t$(obj).find('._valor_selecionado_consulta')\r\n\t\t\t\t\t\t.val('');\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Inicializa os eventos que irão disparaar as chamadas dos metodos de consulta\r\n\t\t */\r\n\t\tfunction iniciarFiltroConsulta() {\r\n            \r\n            //função nesnecessaria no momento pois esta usando o scroll\r\n            $(document).on('click','.btn-caregar-mais', function(e) {\r\n                \r\n\t\t\t\tgetMais(this);\r\n\t\t\t\t\r\n\t\t\t\t//foco no último item da lista após carregar\r\n\t\t\t\t$(this)\r\n\t\t\t\t\t.closest('li')\r\n\t\t\t\t\t.children('a')\r\n\t\t\t\t\t.focus();\r\n\t\t\t\r\n            });\r\n            \r\n            //função nesnecessaria no momento pois esta usando o scroll\r\n            $(document).on('click','.btn-caregar-mais-all', function(e) {\r\n                \r\n\t\t\t\tgetAll(this);\r\n\t\t\t\t\r\n\t\t\t\t//foco no último item da lista após carregar\r\n\t\t\t\t$(this)\r\n\t\t\t\t\t.closest('li')\r\n\t\t\t\t\t.children('a')\r\n\t\t\t\t\t.focus();\r\n\t\t\t\t\r\n            });\r\n            \r\n            var pageScroll = 0;\r\n            \r\n            $(document).scroll(function() {\r\n                var obj = $('.lista-consulta-container.ativo');\r\n                \r\n                if ($(obj).length > 0) {\r\n                    $(document).scrollTop(pageScroll);\r\n                }else{\r\n                    pageScroll = $(document).scrollTop();\r\n                }\r\n                \r\n            });\r\n            \r\n            \r\n            //caregamento via scroll\r\n            $('.pesquisa-res').scroll(function() {\r\n                \r\n\t\t\t\tif( ($(this).scrollTop()+$(this).height()) >= $(this).find('.consulta-lista').height()-600 ){\r\n                    \r\n                    if(requestRunning) return;\r\n                    \r\n                    var btn = $(this).parent().find('.btn-caregar-mais');\r\n\r\n                    if ($(btn).length > 0) {\r\n                        \r\n                        getMais(btn);\r\n                        \r\n                        //foco no último item da lista após carregar\r\n                        $(this)\r\n                            .closest('li')\r\n                            .children('a')\r\n                            .focus();\r\n                        }\r\n                    }\r\n                \r\n            });\r\n\t\t\t\r\n            $('._valor_selecionado_consulta').each(function() {\r\n                \r\n                //Se o item já estiver selecionado (tela de update), efetua as devidas ações.\r\n                if ( $(this).val() !== '' ){\r\n                    var obj = $(this).closest('.form-group');\r\n                    selecionadoConsulta(obj);\r\n                }\r\n                \r\n            });\r\n            \r\n\r\n\t\t\t//Botão de filtrar\r\n\t\t\t$('.btn-filtro-consulta').on({\r\n\r\n\t\t\t\tclick: function() {\r\n                    var obj = $(this).closest('.form-group');\r\n                    _consulta_id = $(obj).find('._valor_selecionado_consulta');\r\n                    \r\n\t\t\t\t\tif ( !$(_consulta_id).val() )\r\n                        fechaListaConsultaAll();\r\n\t\t\t\t\t\tfiltrarConsulta(this);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tfocusout: function() {\r\n                    \r\n                    var obj = $(this).closest('.form-group');\r\n                    \r\n\t\t\t\t\tif(tempo_focus) clearTimeout(tempo_focus);\r\n\r\n\t\t\t\t\ttempo_focus = setTimeout(function() {\r\n\r\n\t\t\t\t\t\tif ( !$(obj).find('input[name=\"_consulta_id\"]').val() && \r\n\t\t\t\t\t\t\t $(obj).find('.lista-consulta').is(':empty') \r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t   //$(obj).find('.consulta-descricao').val('');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( !$(obj).find('input[name=\"_consulta_id\"]').val() && \r\n\t\t\t\t\t\t\t !$(obj).find('.lista-consulta ul li a').is(':focus') && \r\n\t\t\t\t\t\t\t  $(obj).find('.consulta-descricao').val() \r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t//$(obj).find('.consulta-descricao').val('');\r\n\t\t\t\t\t\t\tfechaListaConsulta(input_group,obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ( !$(obj).find('input[name=\"_consulta_id\"]').val() && \r\n\t\t\t\t\t\t\t !$(obj).find('.lista-consulta ul li a').is(':focus') && \r\n\t\t\t\t\t\t\t !$(obj).find('.consulta-descricao').val() \r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tfechaListaConsulta(input_group,obj);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}, 200);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\t//Campo de filtro\r\n\t\t\t$('.consulta-descricao').on({\r\n\r\n\t\t\t\tkeydown: function(e) {\r\n                    var obj = $(this).closest('.form-group');\r\n                    \r\n\t\t\t\t\t//Eventos ap?s a escolha de um item\r\n\t\t\t\t\tif ( $(this).is('[readonly]') ) {\r\n\r\n\t\t\t\t\t\t//Deletar teclando 'Backspace' ou 'Delete'\r\n\t\t\t\t\t\tif ( (e.keyCode === 8) || (e.keyCode === 46) ) {\r\n\t\t\t\t\t\t\t$(obj).find('.btn-apagar-filtro-consulta').click();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t//Pesquisar com 'Enter'\r\n\t\t\t\t\t\tif (e.keyCode === 13) {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar obj = $(this).closest('.form-group');\r\n\t\t\t\t\t\t\t_consulta_id = $(obj).find('._valor_selecionado_consulta');\r\n\r\n\t\t\t\t\t\t\tif ( !$(_consulta_id).val() )\r\n                                fechaListaConsultaAll();\r\n\t\t\t\t\t\t\t\tfiltrarConsulta(this);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tfocusout: function() {\r\n                    var obj = $(this).closest('.form-group');\r\n                    \r\n\t\t\t\t\t//verificar quando o campo deve ser zerado\r\n\t\t\t\t\t//*\r\n                    if(tempo_focus)\r\n\t\t\t\t\t\tclearTimeout(tempo_focus);\r\n\r\n\t\t\t\t\ttempo_focus = setTimeout(function() {\r\n                        \r\n\t\t\t\t\t\tif ( !$(obj).find('._valor_selecionado_consulta').val() && \r\n\t\t\t\t\t\t\t $(obj).find('.lista-consulta').is(':empty') &&\r\n\t\t\t\t\t\t\t !$(obj).find('.btn-filtro-consulta').is(':focus') \r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t$(obj).find('.consulta-descricao').val('');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}, 200);\r\n                    //*/\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t\r\n\t\t}\r\n\t\t\t\r\n\t\tiniciarFiltroConsulta();\r\n\t}\r\n\t  \r\n    "]}