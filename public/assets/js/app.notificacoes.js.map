{"version":3,"sources":["app.notificacoes.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.notificacoes.js","sourcesContent":["/**\r\n * _11190 - Notificacao\r\n */\r\n\r\n;(function(angular) {\r\n\r\n    var Notificacao = function($scope,$ajax,$timeout) {\r\n\r\n        var vm    = this;\r\n        vm.acaoContador = {};\r\n        vm.acaoContador.tempo = 5;   \r\n\r\n        vm.acaoContador.fechar = function(){\r\n            if(vm.contador.visivel == true){\r\n                vm.contador.visivel = false;\r\n                $timeout.cancel(vm.contador.time);\r\n                $timeout.cancel(vm.acaoContador.ftime);\r\n                vm.contador.acao();\r\n            }\r\n        };\r\n\r\n        vm.acaoContador.ftime  = function(){\r\n\r\n            vm.acaoContador.tempo = vm.acaoContador.tempo - 1;\r\n\r\n            if(vm.acaoContador.tempo > 0){\r\n                $timeout(vm.acaoContador.ftime,1000);\r\n            }else{\r\n                vm.acaoContador.fechar();\r\n            }\r\n        };\r\n\r\n        vm.contador = {\r\n            tempo  : 5,\r\n            acao   : null,\r\n            time   : null,\r\n            visivel: false,\r\n            msg1   : 'Sua tela sera atualizada em',\r\n            msg2   : 'Fechar o contador atualizara sua tela agora',\r\n            fechar : function(){\r\n                vm.contador.visivel = false;\r\n            },\r\n            iniciar: function() {\r\n                var that     = this;\r\n                that.visivel = true;\r\n                that.time    = $timeout(vm.acaoContador.ftime,1000); \r\n\r\n                vm.acaoContador.tempo = that.tempo;\r\n            }\r\n        };\r\n\r\n\t\t// Funções para o web socket.\r\n\t\tvar metodos = [\r\n\t\t\t{\r\n\t\t\t\tMETHOD  :'NOTIFICACAO',\r\n\t\t\t\tFUNCTION:function(ret){\r\n\t\t\t\t\tvar mensagem = ret.MENSAGE.DADOS.MENSAGEM;\r\n\t\t\t\t\tvar titulo   = ret.MENSAGE.DADOS.TITULO;\r\n                    var id       = ret.MENSAGE.DADOS.MENSAGE_SOCKET_ID;\r\n                    var agd_id   = ret.MENSAGE.DADOS.AGENDAMENTO_ID;\r\n\r\n\t\t\t\t\taddNotificacao(mensagem,titulo,id, 0 ,agd_id);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tMETHOD  :'UPDATETELA',\r\n\t\t\t\tFUNCTION:function(ret){\r\n                    vm.contador.acao  = function(){location.reload();};\r\n                    vm.contador.msg1  = 'Sua tela sera atualizada em';\r\n                    vm.contador.msg2  = 'Fechar o contador atualizara sua tela agora';\r\n                    vm.contador.tempo = 5;\r\n                    vm.contador.iniciar();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tMETHOD  :'UPDATEMENUS',\r\n\t\t\t\tFUNCTION:function(ret){\r\n                    vm.contador.acao  = function(){\r\n                        window.localStorage.removeItem('ngStorage-menus');\r\n                        location.reload();\r\n                    };\r\n                    vm.contador.msg1  = 'Seus menus serão atualizados em';\r\n                    vm.contador.msg2  = 'Fechar o contador atualizara seus menus agora';\r\n                    vm.contador.tempo = 5;\r\n                    vm.contador.iniciar();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t];\r\n\r\n\t\t// Iniciar web socket.\r\n\t\tSocketWeb.SILENT = true;\r\n\t\tvar reconet = null;\r\n\r\n\t\tSocketWeb.ERROR_EVENT = function (error){\r\n\r\n            SocketWeb.setStatus(2);\r\n\r\n\t\t\treconet = setTimeout(function(e){\r\n\t\t\t\tif(SocketWeb.ERROS < 3){\r\n\t\t\t\t\tconsole.log('Tentando conectar...');\r\n\t\t\t\t\tSocketWeb.create(metodos);\r\n\t\t\t\t\tclearTimeout(reconet);\r\n\t\t\t\t}\r\n\t\t\t},6000);\r\n\r\n            if (error.type == 'close') {\r\n                //showErro('Servidor WebSocket desconectado.');\r\n            }\r\n            else {\r\n                //showErro('Erro no servidor WebSocket.');\r\n            }\r\n\r\n        };\r\n\r\n        $(document).on('click', '.websocket-desconectado', function(event) {\r\n            console.log('Tentando conectar...');\r\n            clearTimeout(reconet);\r\n            SocketWeb.create(metodos);\r\n        });\r\n\r\n        vm.init = function(){\r\n            SocketWeb.create(metodos);\r\n        }\r\n    };\r\n\r\n    Notificacao.$inject = [\r\n\t\t'$scope',\r\n\t\t'$ajax',\r\n\t\t'$timeout'\r\n\t];\r\n \r\n    angular\r\n    .module    ('appNotificacao' , ['angular.filter','vs-repeat','gc-ajax','gc-form','gc-find','gc-transform'])\r\n    .controller('CrtNotificacao', Notificacao);\r\n\r\n    angular.bootstrap(document.getElementById('idNotificacao'), ['appNotificacao']);\r\n        \r\n})(angular);\r\n\r\n(function($) {\r\n\r\n    $(document).on('click', '.btn-agendar-notificacao', function(event) {\r\n        $(this).attr('disabled','disabled');\r\n        var id    = $(this).data('id');\r\n        var ag    = $('.agd-id-'+id).val();\r\n        var balao = $('.agd-id-'+id).closest('.balao');\r\n\r\n        var ds = {\r\n                    AGD_ID : id,\r\n                    AGD_TM : ag\r\n                };\r\n\r\n        execAjax1(\r\n            'POST', \r\n            urlhost + '/_11190/agendamento',ds,\r\n            function(data){\r\n                var id = $(balao).data('id');\r\n\r\n                $(balao).find('.btn-agendar-notificacao').removeAttr('disabled');\r\n                $(balao).find('.'+id+'-fechar').trigger('click');\r\n\r\n                showSuccess('Notificação adiada');\r\n            }\r\n        );\r\n\r\n    });\r\n    \r\n})(jQuery);"]}