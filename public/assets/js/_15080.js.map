{"version":3,"sources":["_15080.app.js","_15080.factory.lote.js","_15080.factory.reposicao.js","_15080.factory.produto.js","_15080.factory.filtro.js","_15080.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_15080.js","sourcesContent":["'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n        'gc-find',\n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils'\n\t])\n;\n     ","angular\n    .module('app')\n    .factory('Lote', Lote);\n    \n\n\tLote.$inject = [\n        '$ajax',\n        '$rootScope',\n        '$timeout',\n        '$q',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Lote($ajax, $rootScope, $timeout, $q, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Lote(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Lote = this; \n        \n        this.DADOS = [];\n        this.PRODUTOS = [];\n        this.LOCALIZACOES = [];\n        this.LOCALIZACAO_ID = null;\n        this.PRE_SELECTED = {};\n        this.SELECTED = {};\n        this.FILTRO = '';\n\n\n        this.LOTES_GERADOS = {\n            LOTE : [],\n            DETALHE : []\n        };\n\n        this.FILTRO2 = '';\n        this.DATA_1  = new Date(Clock.DATETIME_SERVER);\n        this.DATA_2  = new Date(Clock.DATETIME_SERVER);\n    }\n    \n    this.GUIA_ATIVA = 'TALAO_PRODUZIR';\n    \n    /**\n     * Private property\n     */\n    var url_base        = '_15070/api';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n\n    /**\n     * Public method, assigned to prototype\n     */\n\n\n\n    Lote.prototype.acaoCheck = function(acao) {\n\n\n        var ret         = {\n            status    : true,\n            descricao : ''\n        };\n\n        switch(acao) {\n            case 'iniciar':\n\n//                // Se não estiver na tela de produção\n                if ( gScope.Lote.SELECTED.KANBAN_LOTE_ID > 0 ) {\n                    ret.status = false;\n                }\n//                // Se não houver talao selecionado\n//                if ( talao == undefined ) {\n//                    ret.status = false;\n//                } else                    \n//                // Se não houver estacao selecionada\n//                if ( gScope.Filtro.ESTACAO == '' ) {\n//                    ret.status = false;\n//                    ret.descricao = 'É necessário selecionar uma estação individual para iniciar um talão.';\n//                } else                    \n//                // Se estiver em produção \n//                if ( em_producao ) {\n//                    ret.status = false;\n//                } else\n//                // Se houverem consumos não disponíveis\n//                if ( talao.STATUS_MP_CP == '0' ) {\n//                    ret.status    = false;\n//                    ret.descricao = 'Há consumos com materia prima indisponível';\n//                } else\n//                // Se a remessa estiver fora do prazo para produção\n//                if ( talao.REMESSA_TIPO == '1' ) {\n//\n//                    if ( gScope.Filtro.GP_REMESSA_DIAS >= 0 || $('#_pu212').val() == '0' ) {\n//                        var remessas_normais = $filter('filter')(gScope.TalaoProduzir.DADOS,{REMESSA_TIPO : '1'});\n//                        var remessas_normais = $filter('orderBy')(remessas_normais,['PROGRAMACAO_DATA', '+DATAHORA_INICIO', 'REMESSA_ID', 'REMESSA_TALAO_ID']);\n//\n//                        if ( $('#_pu212').val() == '0' ) {\n//                            var idx = remessas_normais.indexOf(talao);\n//\n//                            if ( idx > 0 ) {\n//                                ret.status    = false;\n//                                ret.descricao = 'Usuário não possui permissão para quebrar sequenciamento de talões';\n//                            }\n//                        }\n//\n//                        if ( gScope.Filtro.GP_REMESSA_DIAS >= 0 ) {\n//                            var data_base = remessas_normais[0] != undefined ? remessas_normais[0].REMESSA_DATA : null;\n//\n//\n//                            var data_limite = moment(data_base).add(gScope.Filtro.GP_REMESSA_DIAS, 'days');\n//\n//                            if ( moment(talao.REMESSA_DATA) > data_limite ) {\n//                                ret.status    = false;\n//                                ret.descricao = 'Remessa fora do prazo permitido de ' + gScope.Filtro.GP_REMESSA_DIAS + ' dias. Produza remessas normais com data até ' + data_limite.format(\"DD/MM\");\n//                            }\n//                        }\n//                    }\n//                }\n\n                break;\n            case 'finalizar':\n\n//                // Se não estiver na tela de produção\n                if ( !(gScope.Lote.SELECTED.KANBAN_LOTE_ID > 0) ) {\n                    ret.status = false;\n                }\n//                if ( talao == undefined ) {\n//                    ret.status    = false;\n//                    ret.descricao = 'Selecione um talão';\n//                } else                    \n//                // Se estiver em produção \n//                if ( !em_producao ) {\n//                    ret.status    = false;\n//                }\n\n                break;\n            case 'continuar':\n\n//                // Se não estiver na tela de produção\n//                if ( gScope.Filtro.GUIA_ATIVA != 'TALAO_PRODUZIR' ) {\n//                    ret.status    = false;\n//                } else                 \n//                if ( talao == undefined ) {\n//                    ret.status    = false;\n//                    ret.descricao = 'Selecione um talão';\n//                } else                    \n//                // Se estiver em produção \n//                if ( !em_producao ) {\n//                    ret.status    = false;\n//                }\n\n                break;\n        }\n\n        return ret;\n\n    };\n\n    Lote.prototype.iniciar = function() {\n        \n        var that = this;\n        \n        $ajax.get('/_15080/api/localizacoes').then(function(response){\n            that.LOCALIZACOES = response;  \n            $('#modal-lote-iniciar').modal('show');\n        });\n        \n    };\n\n    Lote.prototype.getLotes = function() {\n        \n        var that = this;\n\n        var paran = {\n            DATA1 : moment(that.DATA_1).format('YYYY.MM.DD 00:00:00'),\n            DATA2 : moment(that.DATA_2).format('YYYY.MM.DD 23:59:59')\n        };\n        \n        $ajax.post('/_15080/api/lotes_gerados',paran).then(function(response){\n\n            gcCollection.merge(that.LOTES_GERADOS.LOTE    , response.LOTE               , 'KANBAN_LOTE_ID');\n            gcCollection.merge(that.LOTES_GERADOS.DETALHE , response.DETALHE            , 'KANBAN_LOTE_DETALHE_ID');\n            gcCollection.bind(that.LOTES_GERADOS.LOTE     , that.LOTES_GERADOS.DETALHE  , 'KANBAN_LOTE_ID', 'LOTE_DETALHE');\n\n        });\n        \n    };\n\n\n    Lote.prototype.excluirItem = function(item) {\n        \n        var that = this;\n\n        var paran = {\n            DATA1 : moment(that.DATA_1).format('YYYY.MM.DD 00:00:00'),\n            DATA2 : moment(that.DATA_2).format('YYYY.MM.DD 23:59:59'),\n            KANBAN_LOTE_DETALHE_ID : item.ID\n        };\n        \n        $ajax.post('/_15080/api/lote/excluirItem',paran).then(function(response){\n            gcCollection.merge(that.LOTES_GERADOS.LOTE    , response.LOTE               , 'KANBAN_LOTE_ID');\n            gcCollection.merge(that.LOTES_GERADOS.DETALHE , response.DETALHE            , 'KANBAN_LOTE_DETALHE_ID');\n            gcCollection.bind(that.LOTES_GERADOS.LOTE     , that.LOTES_GERADOS.DETALHE  , 'KANBAN_LOTE_ID', 'LOTE_DETALHE');\n        });\n        \n    };\n    \n    Lote.prototype.iniciarConfirm = function(acao) {\n        \n        var that = this;\n        \n        return $q(function(resolve,reject){\n            var data = {\n                FILTRO: gScope.Filtro,\n                DADOS: {\n                    LOCALIZACAO_ID : that.LOCALIZACAO_ID\n                }\n            };\n\n            $ajax.post('/_15080/api/lote/iniciar',data).then(function(response){\n\n                gScope.Filtro.merge(response.DATA_RETURN.DADOS);\n\n                that.SELECTED = response.DATA_RETURN.LOTE;\n\n                for ( var i in gScope.Produto.FAMILIAS ) {\n                    var familia = gScope.Produto.FAMILIAS[i];\n\n                    familia.CHECKED = true;\n                }                    \n                \n                $('#modal-lote-iniciar').modal('hide');\n                \n                resolve(response.DATA_RETURN);\n\n            },function(erro){\n                reject(erro);\n            });\n        });\n    };\n\n    Lote.prototype.continuar = function() {\n        \n        var that = this;\n        \n        var data = {\n            KANBAN_LOTE_STATUS : \"= '0'\"\n        };\n        \n        \n        $ajax.post('/_15080/api/lotes',data).then(function(response){\n            that.LOCALIZACOES = response;   \n            \n            $('#modal-lote-continuar').modal('show');\n        });\n        \n    };\n\n    Lote.prototype.continuarConfirm = function() {\n       \n        var that = this;\n        \n        return $q(function(resolve,reject){\n            var data = {\n                FILTRO: gScope.Filtro,\n                DADOS:  that.PRE_SELECTED\n            };\n\n            $ajax.post('/_15080/api/lote/continuar',data).then(function(response){\n\n                gScope.Filtro.merge(response.DATA_RETURN.DADOS);\n\n                that.SELECTED = that.PRE_SELECTED;\n\n                for ( var i in gScope.Produto.FAMILIAS ) {\n                    var familia = gScope.Produto.FAMILIAS[i];\n\n                    familia.CHECKED = true;\n                }                    \n                \n            $('#modal-lote-continuar').modal('hide');\n                \n                resolve(response.DATA_RETURN);\n\n            },function(erro){\n                reject(erro);\n            });\n        });        \n        \n    };\n\n    Lote.prototype.finalizar = function() {\n        var that = this;\n        \n        return $q(function(resolve,reject){\n            var data = {\n                FILTRO: gScope.Filtro,\n                DADOS: that.SELECTED\n            };\n\n            $ajax.post('/_15080/api/lote/finalizar',data).then(function(response){\n\n\n                postprint(response.DATA_RETURN.ETIQUETAS);\n                \n                gScope.Filtro.merge(response.DATA_RETURN.DADOS);\n                that.SELECTED = {};\n                resolve(response.DATA_RETURN);\n\n            },function(erro){\n                reject(erro);\n            });\n        });\n    };\n\n    Lote.prototype.imprimir = function(item) {\n        var that = this;\n        item.VISIVEL = item.VISIVEL == 1 ? 0 : 1;\n\n        var data = {\n                FILTRO: gScope.Filtro,\n                DADOS : item\n            };\n\n        addConfirme('Imprimir','Deseja realmente imprimir LOTE:'+item.KANBAN_LOTE_ID,[obtn_sim,obtn_cancelar],\n                   [\n                       {ret:1,func:function(){\n                            $ajax.post('/_15080/api/lote/imprimirLote',data).then(function(response){\n                                postprint(response.DATA_RETURN.ETIQUETAS);\n                            });\n                       }},\n                       {ret:2,func:function(){\n\n                       }},\n                   ]   \n              );\n\n        \n    };\n\n    \n\n    Lote.prototype.cancelar = function() {\n        var that = this;\n        \n        addConfirme('<h4>Confirmação</h4>',\n            'Deseja realmente cancelar este lote?<br/><b>Obs: Transações já realizadas, serão perdidas.</b>',\n            [obtn_sim,obtn_nao],\n            [{ret:1,func:function(){\n                $rootScope.$apply(function(){\n                    \n                    return $q(function(resolve,reject){\n                        var data = {\n                            FILTRO: gScope.Filtro,\n                            DADOS: that.SELECTED\n                        };\n\n                        $ajax.post('/_15080/api/lote/cancelar',data).then(function(response){\n\n                            gScope.Filtro.merge(response.DATA_RETURN.LOTE);\n                            that.SELECTED = {};\n                            resolve(response.DATA_RETURN);\n\n                        },function(erro){\n                            reject(erro);\n                        });\n                    });\n                    \n                });\n            }}]     \n        );        \n        \n        \n\n    };\n    \n    \n\n    Lote.prototype.pick = function(lote,setfocus) {\n        \n        var that = this;\n\n        if ( lote != undefined ) {\n        \n            this.SELECTED = lote;\n\n            if ( setfocus ) {\n                that.setFocus();\n            }\n        }\n\n    };\n    \n    Lote.prototype.setFocus = function() {\n        \n        $timeout(function(){\n            $('.table-container.table-lotes .table-lc-body tr.selected:focusable').focus();\n        },50);                      \n    };\n    \n    \n    Lote.prototype.keypress = function($event) {\n\n        $event.preventDefault();\n         \n        \n        switch ($event.key) {\n\n            case 'Enter':\n\n                gScope.Reposicao.Modal.open();\n\n                break;\n\n        }\n    };\n    \n        \n    /**\n     * Extende propriedades para o objeto\n     * @param {object} data\n     * @returns {void}\n     */\n    Lote.prototype.setData = function(data) {\n            angular.extend(this, data);\n    };\n\n\n    var modal = $('#modal-lote-iniciar');\n    \n    Lote.prototype.modalShow = function(shown,hidden) {\n\n        modal\n            .modal('show')\n        ;                         \n        \n        if ( shown ) {\n            modal\n                .one('shown.bs.modal', function(){\n                    shown();\n                })\n            ;     \n        }\n        \n        if ( hidden ) {\n            modal\n                .one('hidden.bs.modal', function(){\n                    hidden();\n                })\n            ;              \n        }\n    };\n\n    Lote.prototype.modalClose = function(hidden) {\n\n        modal\n            .modal('hide')\n        ;\n        \n        if ( hidden ) {\n            modal\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;                      \n        }\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Lote;\n};","angular\n    .module('app')\n    .factory('Reposicao', Reposicao);\n    \n\n\tReposicao.$inject = [\n        '$ajax',\n        '$rootScope',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Reposicao($ajax, $rootScope, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Reposicao(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Reposicao = this; \n        \n        this.DADOS    = [];\n        this.SELECTED = {};\n        this.FILTRO   = '';\n        this.PECA_BARRAS = '';\n        this.QUANTIDADE = null;\n    }\n    \n    this.GUIA_ATIVA = 'TALAO_PRODUZIR';\n    \n    /**\n     * Private property\n     */\n    var url_base        = '_15070/api';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n\n    /**\n     * Public method, assigned to prototype\n     */\n    \n    \n    Reposicao.prototype.confirm = function () {\n        var that = this;\n\n        var dados = {\n            FILTRO: gScope.Lote.SELECTED,\n            FILTRO_TRANSACAO: {\n                KANBAN_LOTE_ID: gScope.Lote.SELECTED.KANBAN_LOTE_ID,\n                ESTOQUE_MINIMO_ID: that.SELECTED.ESTOQUE_MINIMO_ID\n            },\n            DADOS: {\n                ITENS : [that.SELECTED],\n                QUANTIDADE : that.QUANTIDADE,\n                PECA_BARRAS : that.PECA_BARRAS\n            }\n        };\n        \n        var input = null;\n        \n        if ( that.PECA_BARRAS != undefined && that.PECA_BARRAS.length > 0 ) {\n            that.QUANTIDADE = null;   \n            input = that.Modal.inputPeca();\n        }\n        if ( that.QUANTIDADE != undefined && parseFloat(that.QUANTIDADE) > 0 ) {\n            that.PECA_BARRAS = '';\n            input = that.Modal.inputQuantidade();\n        }\n\n        that.Modal.enableButton(false);\n        \n        $ajax.post('/_15080/api/transacao/post',dados,{complete: function(){\n\n            that.Modal.enableButton(true);\n\n        }}).then(function(response){\n\n            gScope.Filtro.merge(response.DATA_RETURN.DADOS);\n            gcCollection.merge(gScope.Reposicao.DADOS,response.DATA_RETURN.TRANSACOES,['TIPO','TABELA_ID','TABELA_NIVEL']);\n            \n            input.focus();\n            input.val('');\n            \n            if ( that.SELECTED.ESTOQUE_NECESSIDADE <= 0 ) {\n                that.Modal.close(function(){\n                    gScope.Produto.setFocus();                  \n                });\n            }\n        },function(){\n            input.select();\n        });        \n    };\n    \n    Reposicao.prototype.deleteTransacao = function (transacao) {\n        var that = this;\n\n        addConfirme('<h4>Confirmação</h4>',\n            'Deseja realmente excluir esta transação? <br/> <b>Atenção: A operação não poderá ser revertida!</b>',\n            [obtn_sim,obtn_nao],\n            [{ret:1,func:function(){\n                $rootScope.$apply(function(){\n                    \n                    var dados = {\n                        FILTRO: gScope.Lote.SELECTED,\n                        FILTRO_TRANSACAO: {\n                            KANBAN_LOTE_ID: gScope.Lote.SELECTED.KANBAN_LOTE_ID,\n                            ESTOQUE_MINIMO_ID: that.SELECTED.ESTOQUE_MINIMO_ID\n                        },\n                        DADOS: {\n                            ITENS : [transacao]\n                        }\n                    };\n\n                    that.Modal.enableButton(false);\n\n                    $ajax.post('/_15080/api/transacao/delete',dados,{complete: function(){\n\n                        that.Modal.enableButton(true);\n\n                    }}).then(function(response){\n\n                        gScope.Filtro.merge(response.DATA_RETURN.DADOS);\n                        gcCollection.merge(gScope.Reposicao.DADOS,response.DATA_RETURN.TRANSACOES,['TIPO','ESTOQUE_MINIMO_ID','TABELA_NIVEL']);\n\n                        gScope.Reposicao.QUANTIDADE = null;   \n                        gScope.Reposicao.PECA_BARRAS = '';    \n                    });        \n\n\n                });\n            }}]     \n        );        \n    };\n    \n    Reposicao.prototype.setFocus = function() {\n        \n        $timeout(function(){\n            $('.table-reposicao .table-lc-body tr.selected:focusable').focus();\n        },50);                      \n    };\n    \n    \n    /**\n     * Extende propriedades para o objeto\n     * @param {object} data\n     * @returns {void}\n     */\n    Reposicao.prototype.setData = function(data) {\n            angular.extend(this, data);\n    };\n\n\n    Reposicao.prototype.Modal = {\n        modal : function () {\n            return $('#modal-reposicao');\n        },\n        open : function(item,localizacao) {\n            var that = this;\n\n            gScope.Reposicao.SELECTED = gScope.Produto.SELECTED;\n\n            $ajax.post('/_15080/api/transacao',gScope.Produto.SELECTED).then(function(response){\n                gcCollection.merge(gScope.Reposicao.DADOS,response,['TIPO','ESTOQUE_MINIMO_ID','TABELA_NIVEL']);\n\n                that.show(function(){\n\n                    var inputs = that.modal().find('input:visible');\n\n                    if ( inputs.length == 1 ) {\n                        inputs.first().select();\n                    }\n\n                },function(){\n                    gScope.Reposicao.QUANTIDADE = null;   \n                    gScope.Reposicao.PECA_BARRAS = '';                          \n                    gScope.Produto.setFocus();\n                });\n            });\n        },\n        \n        close : function (hidden) {\n\n            this.modal()\n                .modal('hide')\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;        \n        },\n        show : function(shown,hidden) {\n            \n            var that = this;\n            \n            that.modal()\n                .modal('show')\n                .one('shown.bs.modal', function(){\n                    shown ? shown() : '';\n                })\n                .one('hidden.bs.modal', function(){\n                    hidden ? hidden() : '';\n                })\n            ;                         \n        },\n        inputQuantidade : function() {\n            return this.modal().find('.input-quantidade');\n        },\n        inputPeca : function() {\n            return this.modal().find('.input-peca');\n        },\n        enableButton : function(bool) {\n            this.modal().find('button').prop('disabled',!bool);\n        }\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Reposicao;\n};","angular\n    .module('app')\n    .factory('Produto', Produto);\n    \n\n\tProduto.$inject = [\n        '$ajax',\n        '$rootScope',\n        '$timeout',\n        '$q',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Produto($ajax, $rootScope, $timeout, $q, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Produto(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Produto = this; \n        \n        this.DADOS = [];\n        this.PRODUTOS = [];\n        this.LOCALIZACOES = [];\n        this.FAMILIAS = [];\n        this.FILTRO = '';\n    }\n    \n    this.GUIA_ATIVA = 'TALAO_PRODUZIR';\n    \n    /**\n     * Private property\n     */\n    var url_base        = '_15070/api';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n\n    /**\n     * Public method, assigned to prototype\n     */\n\n\n\n    Produto.prototype.filtrarMaiorQueZero = function(produto) {\n        \n        var that = this;\n\n        var ret = false;\n        \n        if ( gScope.Filtro.NECESSIDADE == 'maior-que-zero' ) {\n            if ( produto.ESTOQUE_NECESSIDADE > 0 ) {\n                ret = true;\n            }\n        } else {\n            ret = true;\n        }\n        \n        return ret;\n\n    };\n\n    Produto.prototype.checkVisibility = function(produto) {\n        \n        var that = this;\n        var ret  = true;\n        \n        for ( var i in that.FAMILIAS ) {\n            var familia = that.FAMILIAS[i];\n            \n            if ( familia.FAMILIA_ID == produto.FAMILIA_ID ) {\n                if ( !familia.CHECKED ) {\n                    ret = false;\n                }\n                break;\n            }\n        }\n        \n        return ret;\n\n    };\n\n    Produto.prototype.pick = function(produto,setfocus) {\n        \n        var that = this;\n\n        if ( produto != undefined ) {\n        \n            this.SELECTED = produto;\n\n            if ( setfocus ) {\n                that.setFocus();\n            }\n        }\n\n    };\n    \n    Produto.prototype.setFocus = function() {\n        \n        $timeout(function(){\n            $('.table-container.table-produtos .table-lc-body tr.selected:focusable').focus();\n        },50);                      \n    };\n    \n    \n    Produto.prototype.keypress = function($event) {\n\n        $event.preventDefault();\n         \n        \n        switch ($event.key) {\n\n            case 'Enter':\n\n                gScope.Reposicao.Modal.open();\n\n                break;\n\n        }\n    };\n    \n        \n    /**\n     * Extende propriedades para o objeto\n     * @param {object} data\n     * @returns {void}\n     */\n    Produto.prototype.setData = function(data) {\n            angular.extend(this, data);\n    };\n\n\n    /**\n     * Return the constructor function\n     */\n    return Produto;\n};","angular\n    .module('app')\n    .factory('Filtro', Filtro);\n    \n\n\tFiltro.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$rootScope',\n        '$q',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Filtro($ajax, $httpParamSerializer, $rootScope, $q, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Filtro(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Filtro = this; \n        \n        this.VISUALIZACAO = '1';\n        this.NECESSIDADE = 'maior-que-zero';\n        this.LOCALIZACAO_ID = null;\n    }\n    \n    Filtro.prototype.consultar = function() {\n        \n        var that = this;\n        \n        return $q(function(resolve,reject){\n\n            $ajax.post('/_15080/api/produto-estoque-minimo',that).then(function(response){\n\n                that.merge(response);\n\n                resolve(response);\n            },function(){\n                reject(reject);\n            });\n        });\n    };\n   \n    \n    Filtro.prototype.merge = function(response) {\n        \n        function isNumber(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        for ( var i in response ) {\n            var item = response[i];\n            \n            for (var k in item){\n                if (item.hasOwnProperty(k)) {\n                    \n                    if ( isNumber(item[k]) && (String(item[k]).substr(0, 1) !== '0' || String(item[k]).indexOf('.') !== -1) ) {               \n                        item[k] = parseFloat(item[k]);\n                    }\n                }\n            }            \n        }\n                       \n        \n        gcCollection.merge(gScope.Produto.DADOS, response, [\n            'ESTABELECIMENTO_ID',\n            'LOCALIZACAO_ID',\n            'PRODUTO_ID',\n            'TAMANHO'\n        ]);\n\n\n        /**\n         * Configura a dependência de talões\n         */\n\n        /**\n         * Agrupa consumos para os talões\n         */\n        var produtos = gcCollection.groupBy(gScope.Produto.DADOS,[\n            'PRODUTO_ID',\n            'PRODUTO_DESCRICAO',\n            'GRADE_ID',\n            'TAMANHO',\n            'TAMANHO_DESCRICAO',\n            'PRODUTO_LOCALIZACAO_ID',\n            'PRODUTO_LOCALIZACAO_DESCRICAO',\n            'FAMILIA_ID',\n            'FAMILIA_DESCRICAO'\n        ],'ESTOQUES');\n\n        gcCollection.merge(gScope.Produto.PRODUTOS, produtos, ['PRODUTO_ID','TAMANHO']);\n\n        /**\n         * Agrupa consumos para os talões\n         */\n        var localizacoes = gcCollection.groupBy(gScope.Produto.DADOS,[\n            'LOCALIZACAO_ID',\n            'LOCALIZACAO_DESCRICAO'\n        ],'PRODUTOS');\n\n        gcCollection.merge(gScope.Produto.LOCALIZACOES, localizacoes, ['LOCALIZACAO_ID']);\n\n        angular.copy(gScope.Produto.LOCALIZACOES, gScope.Lote.LOCALIZACOES);\n\n        /**\n         * Agrupa consumos para os talões\n         */\n        var familias = gcCollection.groupBy(gScope.Produto.DADOS,[\n            'FAMILIA_ID',\n            'FAMILIA_DESCRICAO'\n        ],'PRODUTOS');\n\n        gcCollection.merge(gScope.Produto.FAMILIAS, familias, ['FAMILIA_ID']);\n\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Filtro;\n};","angular\n    .module('app')\n    .value('gScope', {})\n    .controller('Ctrl', Ctrl);\n    \n    \n\tCtrl.$inject = [\n        '$scope',\n        '$timeout',\n        'gScope',\n        'Filtro',\n        'Produto',\n        'Reposicao',\n        'Lote'\n    ];\n\n\tfunction Ctrl( $scope, $timeout, gScope, Filtro, Produto, Reposicao, Lote ) {\n\n\t\tvar vm = this;\n\n\t\tvm.Filtro    = new Filtro();\n\t\tvm.Produto   = new Produto();\n\t\tvm.Reposicao = new Reposicao();\n\t\tvm.Lote      = new Lote();\n\n\n        loading('.main-ctrl');        \n\n        loading('hide');\n\n        vm.Filtro.consultar().then(function(){\n            \n            for ( var i in vm.Produto.FAMILIAS ) {\n                var familia = vm.Produto.FAMILIAS[i];\n                \n                familia.CHECKED = true;\n            }\n        });\n        \n        \n        \n//        $timeout(function () {\n//            var container = $(\".main-container\");\n//            var numberOfCol = 2;\n//            $(\".resize\").css('height', 100/numberOfCol +'%');\n//\n//            var sibTotalHeight;\n//            $(\".resize-item\").resizable({\n//                handles: 's',\n//                start: function(event, ui){\n//                    sibTotalHeight = ui.originalSize.height + ui.originalElement.next().outerHeight();\n//                },\n//                stop: function(event, ui){     \n//                    var cellPercentHeight=100 * ui.originalElement.outerHeight()/ container.innerHeight();\n//                    \n//                    ui.originalElement.css('height', cellPercentHeight + '%');  \n//                    \n//                    var nextCell = ui.originalElement.next();\n//                    \n//                    var nextPercentHeight=100 * nextCell.outerHeight()/container.innerHeight();\n//                    \n//                    nextCell.css('height', nextPercentHeight + '%');\n//                },\n//                resize: function(event, ui){ \n////                    $(this).mouseup();\n//                    \n//                    if ( ui.size.height > ( container.innerHeight() - 130 ) ) {\n//                        $(this).mouseup();\n//                        ui.originalElement.height(container.innerHeight() - 130);\n//                    } else {\n//                        ui.originalElement.next().height(container.innerHeight() - ui.size.height); \n//                    }\n//                    console.log(ui.size.height + ' ' + ui.originalElement.next().height());\n//                },\n//                minHeight : 130\n//            });\n//            \n//        });   \n\n \n\t}   \n  "]}