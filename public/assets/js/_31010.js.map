{"version":3,"sources":["_31010.app.js","_31010.factory.Modelo.js","_31010.factory.Cor.js","_31010.factory.Tamanho.js","_31010.factory.Ficha.js","_31010.factory.ItenCusto.js","_31010.factory.filtro.js","_31010.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3pBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9gDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_31010.js","sourcesContent":["'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n        'gc-find',\n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils'\n\t])\n;\n     ","angular\r\n    .module('app')\r\n    .factory('Modelo', Modelo);\r\n    \r\n\r\n\tModelo.$inject = [\r\n        '$ajax',\r\n        '$httpParamSerializer',\r\n        '$rootScope',\r\n        '$q',\r\n        '$timeout',\r\n        'gcCollection',\r\n        'gScope',\r\n        '$consulta'\r\n    ];\r\n\r\nfunction Modelo($ajax, $httpParamSerializer, $rootScope, $q, $timeout, gcCollection, gScope, $consulta) {\r\n\r\n    /**\r\n     * Constructor, with class name\r\n     */\r\n    function Modelo(data) {\r\n        if (data) {\r\n            this.setData(data);\r\n        }\r\n        \r\n\t\tgScope.Modelo = this; \r\n        \r\n        this.ITENS = [];\r\n        this.FILTRO = '';\r\n        this.ORDEM = 'MODELO_DESCRICAO';\r\n        this.SELECTED = [];\r\n        this.TIME = [];\r\n        this.Perfil = [];\r\n\r\n        this.Consulta   = new $consulta();\r\n        \r\n        this.ConsultaModelo = this.Consulta.getNew();\r\n            \r\n        this.ConsultaModelo.componente                  = '.consulta-modelo';\r\n        this.ConsultaModelo.option.class                = 'modeloctrl';\r\n        this.ConsultaModelo.model                       = 'vm.Modelo.ConsultaModelo';\r\n        this.ConsultaModelo.option.label_descricao      = 'Modelo:';\r\n        this.ConsultaModelo.option.obj_consulta         = '/_31010/Consultar';\r\n        this.ConsultaModelo.option.tamanho_input        = 'input-maior';\r\n        this.ConsultaModelo.option.tamanho_tabela       = 427;\r\n        this.ConsultaModelo.compile();\r\n\r\n    }\r\n    \r\n    Modelo.prototype.open = function(item) {\r\n        var that = this;\r\n\r\n        $('#modal-sku').modal();\r\n    }\r\n\r\n    Modelo.prototype.close = function() {\r\n        var that = this;\r\n\r\n        $('#modal-sku').modal('hide');\r\n    }\r\n\r\n    Modelo.prototype.ConsultarPerfil = function() {\r\n        var that = this;\r\n\r\n        var ds = {\r\n                MODELO  : gScope.Modelo.ConsultaModelo.selected,\r\n                COR     : gScope.Cor.SELECTED,\r\n                TAMANHO : gScope.Tamanho.SELECTED\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarPerfil',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.Perfil = response; \r\n     \r\n            }\r\n        );\r\n    }\r\n\r\n    Modelo.prototype.consultar = function() {\r\n        var that = this;\r\n\r\n        var ds = {\r\n                ID : 0\r\n            };\r\n\r\n        $ajax.post('/_31010/Consultar',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.ITENS = response;\r\n\r\n                var grupos = gcCollection.groupBy(response, [\r\n                    'MODELO_CODIGO',\r\n                    'MODELO_DESCRICAO'\r\n                ], 'COR'); \r\n                \r\n                gcCollection.merge(that.ITENS, grupos, ['COR_CODIGO', 'COR_DESCRICAO']);             \r\n            }\r\n        );\r\n    }\r\n\r\n    Modelo.prototype.Selectionar = function (modelo) {\r\n        var that = this;\r\n\r\n        if(that.SELECTED.MODELO_CODIGO != modelo.MODELO_CODIGO){\r\n            that.SELECTED = modelo; \r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * Return the constructor function\r\n     */\r\n    return Modelo;\r\n};","angular\r\n    .module('app')\r\n    .factory('Cor', Cor);\r\n    \r\n\r\n\tCor.$inject = [\r\n        '$ajax',\r\n        '$httpParamSerializer',\r\n        '$rootScope',\r\n        '$q',\r\n        '$timeout',\r\n        'gcCollection',\r\n        'gScope'\r\n    ];\r\n\r\nfunction Cor($ajax, $httpParamSerializer, $rootScope, $q, $timeout, gcCollection, gScope) {\r\n\r\n    /**\r\n     * Constructor, with class name\r\n     */\r\n    function Cor(data) {\r\n        if (data) {\r\n            this.setData(data);\r\n        }\r\n        \r\n\t\tgScope.Cor = this; \r\n        \r\n        this.ITENS = [];\r\n        this.FILTRO = '';\r\n        this.ORDEM = 'DESCRICAO';\r\n        this.SELECTED = [];\r\n    }\r\n\r\n    Cor.prototype.consultar = function() {\r\n        var that = this;\r\n\r\n        var cor = gScope.Modelo.ConsultaModelo.selected.COR_ID;\r\n\r\n        var ds  = {\r\n                MODELO : gScope.Modelo.ConsultaModelo.selected\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarCor',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.ITENS = response;\r\n\r\n                angular.forEach(that.ITENS, function(item, key) {\r\n                    item.PADRAO = 0;\r\n                    \r\n                    if( parseInt(item.ID) == parseInt(cor)){\r\n                        item.PADRAO = 1;\r\n                        that.SELECTED = item;\r\n\r\n                        setTimeout(function(){\r\n                            $('.item_modelo_'+item.ID).focus();\r\n                        },300);\r\n                    }\r\n                });               \r\n            }\r\n        );\r\n    }\r\n\r\n    Cor.prototype.Selectionar = function (cor) {\r\n        var that = this;\r\n\r\n        if(that.SELECTED != cor){\r\n            that.SELECTED = cor;\r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * Return the constructor function\r\n     */\r\n    return Cor;\r\n};","angular\r\n    .module('app')\r\n    .factory('Tamanho', Tamanho);\r\n    \r\n\r\n\tTamanho.$inject = [\r\n        '$ajax',\r\n        '$httpParamSerializer',\r\n        '$rootScope',\r\n        '$q',\r\n        '$timeout',\r\n        'gcCollection',\r\n        'gScope'\r\n    ];\r\n\r\nfunction Tamanho($ajax, $httpParamSerializer, $rootScope, $q, $timeout, gcCollection, gScope) {\r\n\r\n    /**\r\n     * Constructor, with class name\r\n     */\r\n    function Tamanho(data) {\r\n        if (data) {\r\n            this.setData(data);\r\n        }\r\n        \r\n\t\tgScope.Tamanho = this; \r\n        \r\n        this.ITENS = [];\r\n        this.FILTRO = '';\r\n        this.ORDEM = 'DESCRICAO';\r\n        this.SELECTED = [];\r\n    }\r\n\r\n    Tamanho.prototype.consultar = function() {\r\n        var that = this;\r\n\r\n        var tamanho = gScope.Modelo.ConsultaModelo.selected.TAMANHO;\r\n\r\n        var ds = {\r\n                MODELO : gScope.Modelo.ConsultaModelo.selected\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarTamanho',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.ITENS = response;  \r\n\r\n                angular.forEach(that.ITENS, function(item, key) {\r\n                    item.PADRAO = 0;\r\n                    \r\n                    if( parseInt(item.ID) == parseInt(tamanho)){\r\n                        item.PADRAO = 1;\r\n                        that.SELECTED = item;\r\n\r\n                        setTimeout(function(){\r\n                            $('.item_tamanho_'+item.ID).focus();\r\n                        },300);\r\n                    }\r\n                });              \r\n            }\r\n        );\r\n    }\r\n\r\n    Tamanho.prototype.Selectionar = function (Tamanho) {\r\n        var that = this;\r\n\r\n        if(that.SELECTED != Tamanho){\r\n            that.SELECTED = Tamanho;\r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * Return the constructor function\r\n     */\r\n    return Tamanho;\r\n};","angular\r\n    .module('app')\r\n    .factory('Ficha', Ficha);\r\n    \r\n\r\n\tFicha.$inject = [\r\n        '$ajax',\r\n        '$httpParamSerializer',\r\n        '$rootScope',\r\n        '$q',\r\n        '$timeout',\r\n        'gcCollection',\r\n        'gScope',\r\n        '$compile'\r\n    ];\r\n\r\nfunction Ficha($ajax, $httpParamSerializer, $rootScope, $q, $timeout, gcCollection, gScope, $compile) {\r\n\r\n    /**\r\n     * Constructor, with class name\r\n     */\r\n    function Ficha(data) {\r\n        if (data) {\r\n            this.setData(data);\r\n        }\r\n        \r\n\t\tgScope.Ficha = this; \r\n        \r\n        this.ITENS = [];\r\n        this.DADOS = [];\r\n        this.FILTRO = '';\r\n        this.ORDEM = 'NIVEL';\r\n        this.SELECTED = [];\r\n        this.MO = [];\r\n        this.AGRUPAMENTO = [];\r\n        this.FILHOS = [];\r\n        this.DADOS_ABSORCAO = [];\r\n        this.ItensAbsorvidos = [];\r\n        this.DADOS_PROPRIO = [];\r\n        this.TEMPO_MODELO = 0;\r\n\r\n        this.OrdemAbs  = 'ABRANGENCIA';\r\n        this.OrdemPro  = 'ORIGEM_DESCRICAO';\r\n        this.OrdemMdo1 = 'CCUSTO_DESCRICAO';\r\n        this.OrdemMdo2 = 'CARGO';\r\n        this.OrdemMdo3 = 'CCUSTO_DESCRICAO';\r\n\r\n        this.OrdemDespesa1 = 'DESCRICAO';\r\n        this.OrdemDespesa2 = 'DESCRICAO';\r\n        this.OrdemDespesa3 = 'DESCRICAO';\r\n\r\n        this.TOTALAbs = {\r\n            VALOR : 0,\r\n            CUSTO : 0,\r\n            CUSTOT: 0,\r\n            RATEAMENTO : 0\r\n        };\r\n        this.TOTALProp = {\r\n            VALOR : 0,\r\n            CUSTO : 0,\r\n            CUSTOT: 0\r\n        };\r\n    }\r\n\r\n    Ficha.prototype.replaceLast = function(texto, substituir, substituto) {\r\n        // Retorna o índice da última ocorrência de \"substituir\"\r\n        var pos = texto.lastIndexOf(substituir); \r\n        // Se encontrar o índice\r\n        if (pos > -1) { \r\n           // Retorna os caracteres antecedentes de \"substituir\"\r\n           return texto.substring(0, pos) \r\n            + substituto\r\n            // Retorna os caracteres posteriores a \"substituir\"\r\n            + texto.substring(pos + substituir.length, texto.length); \r\n        } else \r\n       // Se a palavra especificada em \"substituir\" não for encontrada não altera nada\r\n       return texto;\r\n    }\r\n\r\n    Ficha.prototype.esconderFilhos = function(item){\r\n        var that = this;\r\n\r\n        angular.forEach(item.FILHOS, function(iten, key) {\r\n            iten.ABERTO = false;\r\n\r\n            if(iten.ABERTO == false){\r\n                that.esconderFilhos(iten);   \r\n            }\r\n        });\r\n    }\r\n\r\n    Ficha.prototype.MontarFilhos = function(item, flag){\r\n        var html = '';\r\n        var that = this;\r\n\r\n        if(item.MONTADO == true){\r\n\r\n            //item.ABERTO = !item.ABERTO;\r\n            angular.forEach(item.FILHOS, function(iten, key) {\r\n                iten.ABERTO = !iten.ABERTO;\r\n\r\n                if(iten.ABERTO == false){\r\n                    that.esconderFilhos(iten);   \r\n                }\r\n            });\r\n\r\n        }else{\r\n            angular.forEach(that.ITENS, function(iten, key) {\r\n\r\n                if(iten.ORIGEM == item.PRODUTO_CONSUMO_ID){\r\n\r\n                    that.FILHOS.push(iten);\r\n                    item.FILHOS.push(iten);\r\n\r\n                    iten.NIVEL  = parseInt(item.NIVEL) + 1;\r\n                    iten.ABERTO = true;\r\n\r\n                    var cont = that.FILHOS.length - 1;\r\n\r\n                    //var add  = '';\r\n                    //for (var i = 0; i <= iten.NIVEL; i++) {\r\n                    //        add += '&nbsp;&nbsp;';\r\n                    //}\r\n\r\n                    html += '<tr';\r\n                    html += '    tabindex=\"-1\"';     \r\n                    html += '    class=\"tr-fixed-1 filho_'+item.PRODUTO_CONSUMO_ID+' pai_'+iten.PRODUTO_CONSUMO_ID+' nivel_'+iten.NIVEL+'\"';\r\n                    html += '    ng-if=\"vm.Ficha.FILHOS['+cont+'].ABERTO == true\"';\r\n\r\n                    if( item.PRODUTO_CONSUMO_ID != iten.PRODUTO_CONSUMO_ID){\r\n                        html += '    ng-click=\"vm.Ficha.MontarFilhos(vm.Ficha.FILHOS['+cont+'],1)\"';\r\n                    }\r\n\r\n                    html += '    >';\r\n\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].NIVEL}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].DESCRICAO}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].T_VALOR}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].C_VALOR}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].TO_VALOR}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].TS_VALOR}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].CMS_VALOR}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].CMO_VALOR}}</td>';\r\n                    html += '    <td auto-title >{{vm.Ficha.FILHOS['+cont+'].FATOR_CONVERSAO}}</td>';\r\n\r\n                    html += '</tr>';\r\n                    html += '<tr style=\"display: none;\" class=\"_pai_'+iten.NIVEL+'_'+iten.PRODUTO_CONSUMO_ID+'\"></tr>';\r\n\r\n                }\r\n            });\r\n\r\n            //html = that.replaceLast(html,'╠➧','╚➧');\r\n\r\n            item.MONTADO = true;\r\n\r\n            that._controller   = function(){return $('#main').find('[ng-controller]')};\r\n            var scope = that._controller().scope();\r\n\r\n            $('._pai_'+parseInt(item.NIVEL)+'_' + item.PRODUTO_CONSUMO_ID ).replaceWith( $compile(html)(scope) );\r\n        }\r\n\r\n    };\r\n\r\n    Ficha.prototype.voltarItem = function() {\r\n        var that  = this;\r\n        var index = that.ItensAbsorvidos.length - 1;\r\n\r\n        if (index > -1) {\r\n            that.ItensAbsorvidos.splice(index, 1);\r\n        }\r\n\r\n        if(index > 0){\r\n            if(index == 1){\r\n                that.ConsultarAbsorcao(2);\r\n            }else{\r\n                that.DetalharAbsorcao(that.ItensAbsorvidos[index - 1],2);\r\n            }\r\n        }else{\r\n            $('#modal-absorcao').modal('hide');\r\n        }      \r\n    }\r\n\r\n    Ficha.prototype.consultar = function(flag) {\r\n        var that = this;\r\n\r\n        var ds = {\r\n                MODELO  : gScope.Modelo.ConsultaModelo.selected,\r\n                COR     : gScope.Cor.SELECTED,\r\n                TAMANHO : gScope.Tamanho.SELECTED,\r\n                DATA    : gScope.DATA\r\n            };\r\n\r\n            \r\n\r\n        $ajax.post('/_31010/ConsultarFicha',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.ITENS = response;\r\n                that.FILHOS = [];\r\n\r\n                angular.forEach(that.ITENS, function(item, key) {\r\n                    item.MONTADO = false;\r\n                    item.ABERTO  = false;\r\n                    item.FILHOS  = [];\r\n                });\r\n\r\n                that.calcular();            \r\n            }\r\n        );\r\n    }\r\n\r\n    Ficha.prototype.ConsultarProprio = function(flag) {\r\n        var that = this;\r\n\r\n        var ds = {\r\n                DATA  : gScope.DATA,\r\n                CONFIGURACAO : gScope.Item.Ficha.CONFIGURACAO\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarProprio',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.DADOS_PROPRIO = response;\r\n\r\n                angular.forEach(that.DADOS_PROPRIO, function(item, key) {\r\n\r\n                    item.RATEAMENTO      = Number(item.RATEAMENTO);\r\n                    item.VALOR           = Number(item.VALOR);\r\n\r\n                    var t_s = (Number(gScope.Item.SETUP_MODELO) / gScope.Item.Quantidade);\r\n                    var Custo = 0;\r\n                    var custo_minuto         = item.VALOR   / Number(gScope.Item.Ficha.FATOR);\r\n                    var custo_proprio_modelo = custo_minuto * Number(gScope.Item.TEMPO_MODELO);\r\n                    var custo_proprio_setup  = custo_minuto * t_s;\r\n                    \r\n                    item.CUSTO_PROPRIO  = (custo_proprio_modelo  + custo_proprio_setup);\r\n                    item.CUSTO_PROPRIOT = ((custo_proprio_modelo + custo_proprio_setup) * gScope.Item.Quantidade) ;    \r\n\r\n                });\r\n\r\n                that.calTotalProp(1);          \r\n            }\r\n        );\r\n    }\r\n\r\n    Ficha.prototype.calTotalAbs = function(flag) {\r\n        var that = this;\r\n\r\n        that.TOTALAbs = {\r\n            VALOR : 0,\r\n            CUSTO : 0,\r\n            CUSTOT: 0,\r\n            RATEAMENTO : 1\r\n        };\r\n\r\n        angular.forEach(that.DADOS_ABSORCAO,function(item){\r\n            that.TOTALAbs.VALOR = Number(that.TOTALAbs.VALOR) + Number(item.VALOR);\r\n            that.TOTALAbs.CUSTO  = item.CUSTO_ABSORVIDO  + that.TOTALAbs.CUSTO;\r\n            that.TOTALAbs.CUSTOT = item.CUSTO_ABSORVIDOT + that.TOTALAbs.CUSTOT; \r\n\r\n            if(item.ORIGEM_DESCRICAO == 'Salário'){\r\n                that.TOTALAbs.RATEAMENTO = item.RATEAMENTO; \r\n            }\r\n        });\r\n    }\r\n\r\n    Ficha.prototype.calTotalProp = function(flag) {\r\n        var that = this;\r\n\r\n        that.TOTALProp = {\r\n            VALOR : 0,\r\n            CUSTO : 0,\r\n            CUSTOT: 0\r\n        };\r\n\r\n        var v = 0;\r\n        angular.forEach(that.DADOS_PROPRIO,function(item){\r\n            v = Number(v) + Number(item.VALOR);   \r\n        });\r\n\r\n        var t_s = (Number(gScope.Item.SETUP_MODELO) / gScope.Item.Quantidade);\r\n\r\n        var custo_minuto         = Number(v)    / Number(gScope.Item.Ficha.FATOR);\r\n        var custo_proprio_modelo = custo_minuto * Number(gScope.Item.TEMPO_MODELO);\r\n        var custo_proprio_setup  = custo_minuto * t_s;\r\n\r\n        that.TOTALProp.VALOR  = v;\r\n        that.TOTALProp.CUSTO  = (custo_proprio_modelo  + custo_proprio_setup);\r\n        that.TOTALProp.CUSTOT = ((custo_proprio_modelo + custo_proprio_setup) * gScope.Item.Quantidade) ;\r\n    }\r\n\r\n    Ficha.prototype.ConsultarAbsorcao = function(flag) {\r\n        var that = this;\r\n\r\n        if(flag == 1){\r\n            that.ItensAbsorvidos.push({FLAG: flag, ORIGEM_DESCRICAO : 'Geral', BASE: 1 });\r\n        }\r\n\r\n        var ds = {\r\n                DATA  : gScope.DATA,\r\n                CONFIGURACAO : gScope.Item.Ficha.CONFIGURACAO\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarAbsorcao',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.DADOS_ABSORCAO = response;  \r\n                that.DADOS_ABSORCAO.FLAG = 1; \r\n\r\n                angular.forEach(that.DADOS_ABSORCAO, function(item, key) {\r\n\r\n                    item.RATEAMENTO      = Number(item.RATEAMENTO);\r\n                    item.VALOR           = Number(item.VALOR);\r\n                    item.ABRANGENCIA     = Number(item.ABRANGENCIA);\r\n\r\n                    var Custo = 0;\r\n                    var custo_minuto     =  item.VALOR  / gScope.Item.Ficha.FATOR;\r\n                    var custo_abs_modelo = custo_minuto * gScope.Item.TEMPO_MODELO;\r\n                    var custo_abs_setup  = custo_minuto * gScope.Item.SETUP_MODELO;\r\n                    \r\n                    item.CUSTO_ABSORVIDO = custo_abs_modelo  + (custo_abs_setup / gScope.Item.Quantidade);\r\n                    item.CUSTO_ABSORVIDOT= (custo_abs_modelo * gScope.Item.Quantidade)  + custo_abs_setup;    \r\n\r\n                });\r\n\r\n                that.calTotalAbs(1);       \r\n            }\r\n        );\r\n    }\r\n\r\n    Ficha.prototype.OrdemD1 = function(filtro){\r\n        if(this.OrdemDespesa1 == filtro){\r\n            this.OrdemDespesa1 = '-'+filtro;\r\n        }else{\r\n            this.OrdemDespesa1 = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.OrdemD2 = function(filtro){\r\n        if(this.OrdemDespesa2 == filtro){\r\n            this.OrdemDespesa2 = '-'+filtro;\r\n        }else{\r\n            this.OrdemDespesa2 = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.OrdemD3 = function(filtro){\r\n        if(this.OrdemDespesa3 == filtro){\r\n            this.OrdemDespesa3 = '-'+filtro;\r\n        }else{\r\n            this.OrdemDespesa3 = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.OrdemAbsorvido = function(filtro){\r\n        if(this.OrdemAbs == filtro){\r\n            this.OrdemAbs = '-'+filtro;\r\n        }else{\r\n            this.OrdemAbs = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.OrdemProprio = function(filtro){\r\n        if(this.OrdemPro == filtro){\r\n            this.OrdemPro = '-'+filtro;\r\n        }else{\r\n            this.OrdemPro = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.OrdemMaoDeObra1 = function(filtro){\r\n        if(this.OrdemMdo1 == filtro){\r\n            this.OrdemMdo1 = '-'+filtro;\r\n        }else{\r\n            this.OrdemMdo1 = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.OrdemMaoDeObra2 = function(filtro){\r\n        if(this.OrdemMdo2 == filtro){\r\n            this.OrdemMdo2 = '-'+filtro;\r\n        }else{\r\n            this.OrdemMdo2 = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.OrdemMaoDeObra3 = function(filtro){\r\n        if(this.OrdemMdo3 == filtro){\r\n            this.OrdemMdo3 = '-'+filtro;\r\n        }else{\r\n            this.OrdemMdo3 = filtro;\r\n        }\r\n    };\r\n\r\n    Ficha.prototype.ConsultarAbsorcao2 = function(flag) {\r\n        var that = this;\r\n\r\n        that.ItensAbsorvidos = [];\r\n        that.ItensAbsorvidos.push({FLAG: flag, ORIGEM_DESCRICAO : 'Geral', BASE: 1 });\r\n\r\n        var ds = {\r\n                DATA  : gScope.DATA,\r\n                CONFIGURACAO : gScope.Item.Ficha.CONFIGURACAO\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarAbsorcao',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.DADOS_ABSORCAO = response;\r\n                that.DADOS_ABSORCAO.FLAG = 1; \r\n\r\n                angular.forEach(that.DADOS_ABSORCAO, function(item, key) {\r\n\r\n                    item.RATEAMENTO      = Number(item.RATEAMENTO);\r\n                    item.VALOR           = Number(item.VALOR);\r\n                    item.ABRANGENCIA     = Number(item.ABRANGENCIA);\r\n\r\n                    var Custo = 0;\r\n                    var custo_minuto     =  item.VALOR  / gScope.Item.Ficha.FATOR;\r\n                    var custo_abs_modelo = custo_minuto * gScope.Item.TEMPO_MODELO;\r\n                    var custo_abs_setup  = custo_minuto * gScope.Item.SETUP_MODELO;\r\n                    \r\n                    item.CUSTO_ABSORVIDO = custo_abs_modelo  + (custo_abs_setup / gScope.Item.Quantidade);\r\n                    item.CUSTO_ABSORVIDOT= (custo_abs_modelo * gScope.Item.Quantidade)  + custo_abs_setup;    \r\n\r\n                });\r\n\r\n                that.calTotalAbs(1);         \r\n            }\r\n        );\r\n    };\r\n\r\n    Ficha.prototype.DetalharAbsorcao = function(item,flag) {\r\n        var that = this;\r\n\r\n        item.BASE = 0;\r\n\r\n        if(flag == 1){\r\n            that.ItensAbsorvidos.push(item);\r\n        }\r\n\r\n        var ds = {\r\n                DATA : gScope.DATA,\r\n                ITEM : item,\r\n                CONFIGURACAO : gScope.Item.Ficha.CONFIGURACAO\r\n            };\r\n\r\n            $ajax.post('/_31010/ConsultarAbsorcao',ds,{contentType: 'application/json'})\r\n                .then(function(response) {\r\n                    that.DADOS_ABSORCAO = response;    \r\n                    that.DADOS_ABSORCAO.FLAG = 2;\r\n\r\n                    angular.forEach(that.DADOS_ABSORCAO, function(item, key) {\r\n\r\n                        item.RATEAMENTO      = Number(item.RATEAMENTO);\r\n                        item.VALOR           = Number(item.VALOR);\r\n                        item.ABRANGENCIA     = Number(item.ABRANGENCIA);\r\n\r\n                        var Custo = 0;\r\n                        var custo_minuto     =  item.VALOR  / gScope.Item.Ficha.FATOR;\r\n                        var custo_abs_modelo = custo_minuto * gScope.Item.TEMPO_MODELO;\r\n                        var custo_abs_setup  = custo_minuto * gScope.Item.SETUP_MODELO;\r\n                        \r\n                        item.CUSTO_ABSORVIDO = custo_abs_modelo  + (custo_abs_setup / gScope.Item.Quantidade);\r\n                        item.CUSTO_ABSORVIDOT= (custo_abs_modelo * gScope.Item.Quantidade)  + custo_abs_setup;    \r\n\r\n                    });\r\n\r\n                that.calTotalAbs(2);          \r\n            }\r\n        );\r\n    }\r\n\r\n    Ficha.prototype.DetalharAbsorcao2 = function(iten,flag) {\r\n        var that = this;\r\n        var deletar = false;\r\n        var list = [];\r\n\r\n        angular.forEach(that.ItensAbsorvidos, function(item, key) {\r\n            if(item == iten){\r\n                deletar = true;\r\n            }else{\r\n                if(deletar == true){\r\n                    list.push(key);\r\n                    //that.ItensAbsorvidos.splice(key,1);\r\n                }\r\n            }\r\n        });\r\n\r\n        list.reverse();\r\n\r\n        angular.forEach(list, function(index, key) {\r\n            that.ItensAbsorvidos.splice(index,1);\r\n        });\r\n\r\n        var ds = {\r\n                DATA : gScope.DATA,\r\n                ITEM : iten,\r\n                CONFIGURACAO : gScope.Item.Ficha.CONFIGURACAO\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarAbsorcao',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.DADOS_ABSORCAO = response;\r\n                that.DADOS_ABSORCAO.FLAG = flag; \r\n                that.calTotalAbs(flag);             \r\n            }\r\n        );\r\n    }\r\n\r\n    Ficha.prototype.consultarTempo = function(flag) {\r\n        var that = this;\r\n\r\n        var ds = {\r\n                MODELO  : gScope.Modelo.ConsultaModelo.selected,\r\n                COR     : gScope.Cor.SELECTED,\r\n                TAMANHO : gScope.Tamanho.SELECTED,\r\n                DATA    : gScope.DATA\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarFichaTempo',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.DADOS = response;\r\n\r\n                that.calcularCusto();            \r\n            }\r\n        );\r\n    }\r\n\r\n    Ficha.prototype.consultarTempoModelo = function(flag) {\r\n        var that = this;\r\n\r\n        var ds = {\r\n                MODELO  : gScope.Item.Modelo.ConsultaModelo.selected,\r\n                COR     : gScope.Item.Cor.SELECTED,\r\n                TAMANHO : gScope.Item.Tamanho.SELECTED,\r\n                DATA    : gScope.DATA\r\n            };\r\n\r\n        $ajax.post('/_31010/ConsultarTempo',ds,{contentType: 'application/json'})\r\n            .then(function(response) {\r\n                that.TEMPO_MODELO = response;           \r\n            }\r\n        );\r\n    }\r\n\r\n    Ficha.prototype.calcular = function(flag) {\r\n        var that = this;\r\n        var tamanho = gScope.Tamanho.SELECTED;\r\n\r\n        function pad(n, width, z) {\r\n          z = z || '0';\r\n          n = n + '';\r\n          return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\r\n        }\r\n\r\n        angular.forEach(that.ITENS, function(item, key) {\r\n\r\n            var tamanho = pad(item.TAMANHO_PROD, 2);\r\n\r\n            var t     = 'T'     + tamanho;\r\n            var c     = 'C'     + tamanho;\r\n            var to    = 'TO'    + tamanho;\r\n            var ts    = 'TS'    + tamanho;\r\n            var cs    = 'CS'    + tamanho;\r\n            var co    = 'CO'    + tamanho;\r\n            var cmoip = 'CMOIP' + tamanho;\r\n            var cmoia = 'CMOIA' + tamanho;\r\n\r\n            var t_valor     = item[t];\r\n            var c_valor     = item[c];\r\n            var to_valor    = item[to];\r\n            var ts_valor    = item[ts];\r\n            var cs_valor    = item[cs];\r\n            var co_valor    = item[co];\r\n            var cmoip_valor = item[cmoip];\r\n            var cmoia_valor = item[cmoia];\r\n\r\n            item.T_VALOR     = t_valor;\r\n            item.C_VALOR     = c_valor;\r\n            item.TO_VALOR    = to_valor;\r\n            item.TS_VALOR    = ts_valor;\r\n            item.CS_VALOR     = cs_valor;\r\n            item.CO_VALOR     = co_valor;\r\n            item.CMOIP_VALOR = cmoip_valor;\r\n            item.CMOIA_VALOR = cmoia_valor;\r\n\r\n            gScope.Modelo.PERFIL = item.PERFIL;\r\n\r\n        });\r\n        \r\n    }\r\n\r\n    Ficha.prototype.calcularCusto = function(flag) {\r\n        var that = this;\r\n        var tamanho = gScope.Tamanho.SELECTED.ID;\r\n\r\n        function pad(n, width, z) {\r\n          z = z || '0';\r\n          n = n + '';\r\n          return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\r\n        }\r\n\r\n        angular.forEach(that.DADOS, function(item, key) {\r\n\r\n            tamanho = pad(tamanho, 2);\r\n\r\n            var t     = 'T'     + tamanho;\r\n            var c     = 'C'     + tamanho;\r\n            var to    = 'TO'    + tamanho;\r\n            var ts    = 'TS'    + tamanho;\r\n            var cs    = 'CS'    + tamanho;\r\n            var co    = 'CO'    + tamanho;\r\n            var cmoip = 'CMOIP' + tamanho;\r\n            var cmoia = 'CMOIA' + tamanho;\r\n\r\n            var t_valor     = item[t];\r\n            var c_valor     = item[c];\r\n            var to_valor    = item[to];\r\n            var ts_valor    = item[ts];\r\n            var cs_valor    = item[cs];\r\n            var co_valor    = item[co];\r\n            var cmoip_valor = item[cmoip];\r\n            var cmoia_valor = item[cmoia];\r\n\r\n            item.T_VALOR     = t_valor;\r\n            item.C_VALOR     = c_valor;\r\n            item.TO_VALOR    = to_valor;\r\n            item.TS_VALOR    = ts_valor;\r\n            item.CS_VALOR     = cs_valor;\r\n            item.CO_VALOR     = co_valor;\r\n            item.CMOIP_VALOR = cmoip_valor;\r\n            item.CMOIA_VALOR = cmoia_valor;\r\n\r\n            gScope.Gasto.Custo.Direto.MaoObraDireta.CustoSetup       = Number(cs_valor);\r\n            gScope.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional = Number(co_valor);\r\n            gScope.Gasto.Custo.Indireto.Proprio                      = Number(cmoip_valor);\r\n            gScope.Gasto.Custo.Indireto.Absorvido                    = Number(cmoia_valor);\r\n            gScope.Gasto.Custo.MateriaPrima                          = Number(c_valor);\r\n\r\n            var CustoSetup        = Number(gScope.Gasto.Custo.Direto.MaoObraDireta.CustoSetup) / Number(gScope.Fatores.QuantidadePedido);\r\n            var CustoFrete        = Number(gScope.Fatores.Frete.Valor) / Number(gScope.Fatores.QuantidadePedido);\r\n            var CustoOperacional  = Number(gScope.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional);\r\n            var IndiretoAbsorvido = Number(gScope.Gasto.Custo.Indireto.Absorvido);\r\n            var IndiretoProprio   = Number(gScope.Gasto.Custo.Indireto.Proprio);\r\n            var IndiretoProprio   = Number(gScope.Gasto.Custo.Indireto.Proprio);\r\n            var MateriaPrima      = Number(gScope.Gasto.Custo.MateriaPrima);\r\n\r\n            gScope.Fatores.CustoProduto         = MateriaPrima + CustoSetup + IndiretoAbsorvido + IndiretoProprio + CustoOperacional;\r\n            gScope.Fatores.Incentivo.Resultado  = Number(gScope.Fatores.CustoProduto) * Number(gScope.Fatores.Incentivo.Valor / 100);\r\n            gScope.Gasto.Despesa.CustoProduto  = Number(gScope.Fatores.CustoProduto)  - Number(gScope.Fatores.Incentivo.Resultado);\r\n            gScope.Gasto.Despesa.Comissao       = Number(gScope.Fatores.CustoProduto) * Number(gScope.Fatores.Comissao / 100);\r\n            gScope.Fatores.CustoProduto         = Number(gScope.Fatores.CustoProduto) + Number(gScope.Gasto.Despesa.Comissao) + Number(CustoFrete);\r\n\r\n        });\r\n        \r\n    }\r\n\r\n    Ficha.prototype.Selectionar = function (Ficha) {\r\n        var that = this;\r\n\r\n        if(that.SELECTED != Ficha){\r\n            that.SELECTED = Ficha; \r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * Return the constructor function\r\n     */\r\n    return Ficha;\r\n};","angular\r\n    .module('app')\r\n    .factory('ItenCusto', ItenCusto);\r\n    \r\n\r\n\tItenCusto.$inject = [\r\n        '$ajax',\r\n        '$httpParamSerializer',\r\n        '$rootScope',\r\n        '$q',\r\n        '$timeout',\r\n        'gcCollection',\r\n        'gScope',\r\n        '$compile',\r\n        '$consulta',\r\n    ];\r\n\r\nfunction ItenCusto($ajax, $httpParamSerializer, $rootScope, $q, $timeout, gcCollection, gScope, $compile, $consulta) {\r\n\r\n    function ItenCusto(data) {\r\n        if (data) {\r\n            this.setData(data);\r\n        }\r\n        \r\n\t\tgScope.ItenCusto = this;\r\n\r\n        this.Consulta   = new $consulta();\r\n\r\n        this.Contador = 0;\r\n    }\r\n\r\n    ItenCusto.prototype.CalcularTotal = function(){\r\n        var that = this;\r\n\r\n        gScope.Total.Custo         = 0;\r\n        gScope.Total.CustoT        = 0;\r\n        gScope.Total.Quantidade    = 0;\r\n        gScope.Total.Venda         = 0;\r\n        gScope.Total.Despesa       = 0;\r\n        gScope.Total.UnidadeMedida = '';\r\n        gScope.VlrComissao         = 0;\r\n\r\n        angular.forEach(gScope.ListaItens, function(item, key) {\r\n            gScope.Total.Custo      = Number(gScope.Total.Custo)      + Number(item.Cst_Produto);\r\n            gScope.Total.Quantidade = Number(gScope.Total.Quantidade) + Number(item.Quantidade);\r\n            gScope.Total.CustoT     = Number(gScope.Total.CustoT)     + Number(item.Cst_t_Produto);\r\n            gScope.Total.Venda      = Number(gScope.Total.Venda)      + Number(item.TotalPrecoVenda);\r\n            gScope.Total.Despesa    = Number(gScope.Total.Despesa)    + (Number(item.Despesa) * Number(gScope.PERC_FATURAMENTO.VALOR));\r\n\r\n            var vlr = gScope.Total.Venda;\r\n            \r\n            gScope.VlrComissao = (Number(gScope.Total.Venda) * (Number(gScope.Fatores.Comissao) / 100));\r\n\r\n            if(gScope.Fatores.Comissao > 0){\r\n            // vlr = Number(gScope.Total.Venda) + gScope.VlrComissao;\r\n            }\r\n            \r\n            gScope.Total.Venda = vlr;\r\n\r\n            if(gScope.Total.UnidadeMedida == ''){\r\n                gScope.Total.UnidadeMedida = item.UnidadeMedida;\r\n            }else{\r\n                if(gScope.Total.UnidadeMedida != item.UnidadeMedida){\r\n                    gScope.Total.UnidadeMedida = '*';\r\n                }\r\n            }\r\n\r\n        });\r\n    };\r\n\r\n    var obj_item = {\r\n        CALCULADO        : 0,\r\n        DADOS            : [],\r\n        SELECTED         : [],\r\n        Modelo           : {},\r\n        Cor              : {},\r\n        Tamanho          : {},\r\n        Perfil           : {},\r\n        ConsultaModelo   : {},\r\n        ConsultaCor      : {},\r\n        ConsultaTamanho  : {},\r\n        UnidadeMedida    : '',\r\n        Quantidade       : 200,\r\n        Cst_u_Produto    : 0,\r\n        Cst_t_Produto    : 0,\r\n        Margem           : 0,\r\n        PrecoVenda       : 0,\r\n        Despesa          : 0,\r\n        MarckUp          : 0,\r\n        TotalPrecoVenda  : 0,\r\n        Contribuicao     : 0,\r\n        ContribuicaoReal : 0,\r\n        MUDAR_PRECO      : false,\r\n        MUDAR_CONTRIBUICAO: false, \r\n        PERCENTUAL_PERDA : 0,\r\n        TEMPO_MODELO     : 0,\r\n        SETUP_MODELO     : 0,\r\n        DESPESA          : 0,\r\n        CM_DESPESA       : 0,\r\n        C_DESPESA        : 0,\r\n        PERC_DESPESA     : 0,\r\n        ImpostoDeRenda   : 0,\r\n        DESPESA_DETALHE  : [],\r\n        DESPESA_ITEM     : [],\r\n        Ficha            : {\r\n            PAI          : null, \r\n            ITENS        : [],\r\n            DADOS        : [],\r\n            FILTRO       : '',\r\n            ORDEM        : 'NIVEL',\r\n            SELECTED     : [],\r\n            MO           : [],\r\n            PRODUTO_TROCA: '',\r\n            OLD_PRODUTO  : {},\r\n            NEW_PRODUTO  : {},\r\n            LST_TROCA    : [],\r\n            AGRUPAMENTO  : [],\r\n            FILHOS       : [],\r\n            MAO_DE_OBRA1 : [],\r\n            MAO_DE_OBRA2 : [],\r\n            MAO_DE_OBRA3 : [],\r\n            VALOR_DESPESA: 0,\r\n            DESPESA1     : [],\r\n            DESPESA2     : [],\r\n            VALOR_ICMS   : 0,\r\n            LISTA_MATERIA: [],\r\n            LISTA_DENSIDADE   : {DADOS : [], VISIVEL : false},\r\n            TOTAL_MAO_DE_OBRA : {\r\n                COLABORADORES : 0,\r\n                CUSTO_MINUTO  : 0,\r\n                CUSTO_OPE     : 0,\r\n                CUSTO_SET     : 0,\r\n                CUSTO_OPE_T   : 0,\r\n                CUSTO_SET_T   : 0,\r\n                CUSTO_TOTAL   : 0,\r\n                SALARIO       : 0\r\n            },\r\n            ESTACOES     : 0,\r\n            MINUTOS_DIA  : 0,\r\n            FATOR        : 0,\r\n            CONFIGURACAO : [],\r\n            ConfirmarTroca : function(){\r\n                var that = this;\r\n                var add =  true;\r\n\r\n                if(that.LST_TROCA.length > 0){\r\n\r\n                    angular.forEach(that.LST_TROCA, function(item, key) {\r\n                        if(item.PRODUTO == that.OLD_PRODUTO.PRODUTO_CONSUMO && item.NIVEL == that.OLD_PRODUTO.NIVEL){\r\n                            add = false;\r\n                            item.PRODUTO      = that.NEW_PRODUTO.ID;\r\n                            item.TROCA        = that.NEW_PRODUTO.ID;\r\n                            item.TAMANHO      = that.NEW_PRODUTO.TAMANHO,\r\n                            item.DESC_TAMANHO = that.NEW_PRODUTO.DESC_TAMANHO;\r\n                        }\r\n                    });\r\n\r\n                }\r\n\r\n                if(add == true){\r\n\r\n                    console.log('Trocar Item:');\r\n                    console.log(that.LST_TROCA);\r\n\r\n                    that.LST_TROCA.push({\r\n                        NIVEL        : that.OLD_PRODUTO.NIVEL,\r\n                        ORIGINAL     : that.OLD_PRODUTO.PRODUTO_CONSUMO,\r\n                        PRODUTO      : that.NEW_PRODUTO.ID,\r\n                        TROCA        : that.NEW_PRODUTO.ID,\r\n                        TAMANHO      : that.NEW_PRODUTO.TAMANHO,\r\n                        DESC_TAMANHO : that.NEW_PRODUTO.DESC_TAMANHO,\r\n                    });\r\n                }\r\n\r\n                that.PRODUTO_TROCA = '';\r\n\r\n                angular.forEach(that.LST_TROCA, function(item, key) {\r\n                    that.PRODUTO_TROCA = that.PRODUTO_TROCA+'|' +item.ORIGINAL+','+item.TROCA +','+item.TAMANHO;\r\n                });\r\n\r\n                if(that.PRODUTO_TROCA.length > 0){\r\n                    that.consultar(5);\r\n                    $('#modal-trocar-produto').modal('hide');\r\n                }else{\r\n                    showErro('Erro ao trocar produto. Troca:{'+that.PRODUTO_TROCA+'}');\r\n                }\r\n\r\n            },\r\n            selectDensidade : function(item){\r\n                var that = this;\r\n\r\n                that.NEW_PRODUTO.TAMANHO      = that.OLD_PRODUTO.TAMANHO_CONSUMO;\r\n                that.NEW_PRODUTO.DESC_TAMANHO = that.OLD_PRODUTO.DESC_TAMANHO;\r\n                that.NEW_PRODUTO.ID           = item.PRODUTO_ID;\r\n                that.NEW_PRODUTO.DESCRICAO    = item.PRODUTO_DESCRICAO;\r\n\r\n                that.LISTA_DENSIDADE.ITEM     = item.PRODUTO_DESCRICAO;\r\n                that.LISTA_DENSIDADE.VISIVEL  = false;\r\n                that.LISTA_DENSIDADE.SELECTED = true;\r\n            },\r\n            limparDensidade : function(item){\r\n                var that = this;\r\n\r\n                that.NEW_PRODUTO.TAMANHO      = '0';\r\n                that.NEW_PRODUTO.DESC_TAMANHO = '0';\r\n                that.NEW_PRODUTO.ID           = '0';\r\n                that.NEW_PRODUTO.DESCRICAO    = '' ;\r\n\r\n                that.LISTA_DENSIDADE.ITEM     = '';\r\n                that.LISTA_DENSIDADE.VISIVEL  = false;\r\n                that.LISTA_DENSIDADE.SELECTED = false;\r\n            },\r\n            consultarDensidade : function(){\r\n                var that = this;\r\n\r\n                that.LISTA_DENSIDADE.VISIVEL  = false;\r\n                that.LISTA_DENSIDADE.SELECTED = false;\r\n                that.LISTA_DENSIDADE.DADOS    = [];\r\n\r\n                return $q(function(resolve,reject){\r\n\r\n                    var ds = {\r\n                        DENSIDADE  : that.DENSIDADE,\r\n                        ESPESSURA  : that.ESPESSURA,\r\n                        PRODUTO_ID : that.OLD_PRODUTO.PRODUTO_CONSUMO\r\n                    };\r\n\r\n                    $ajax.post('/_31010/consultarDensidade',ds,{contentType: 'application/json'})\r\n                        .then(function(response) {\r\n\r\n                            that.LISTA_DENSIDADE.DADOS    = response;\r\n                            that.LISTA_DENSIDADE.VISIVEL  = true;\r\n                            that.LISTA_DENSIDADE.SELECTED = false;\r\n\r\n                            console.log(response);\r\n                            resolve(true);\r\n\r\n                        },function(e){\r\n                            reject(e);\r\n                        }\r\n                    );\r\n\r\n                });\r\n            },\r\n            TrocarProduto : function(item){\r\n                var that = this;\r\n\r\n                gScope.ConsultaProduto.apagar();\r\n\r\n                that.OLD_PRODUTO = item;\r\n\r\n                that.DENSIDADE = 0;\r\n                that.ESPESSURA = 0;\r\n\r\n                that.LISTA_DENSIDADE.ITEM     = '';\r\n                that.LISTA_DENSIDADE.VISIVEL  = false;\r\n                that.LISTA_DENSIDADE.SELECTED = false;\r\n\r\n                $('#modal-trocar-produto').modal();\r\n            },\r\n            ConsultarConfiguracao : function(flag) {\r\n                var that = this;\r\n\r\n                return $q(function(resolve,reject){\r\n\r\n                    var ds = {\r\n                        MODELO  : that.PAI.ConsultaModelo.selected,\r\n                        COR     : that.PAI.ConsultaCor.selected,\r\n                        TAMANHO : that.PAI.ConsultaTamanho.selected,\r\n                        DATA    : gScope.DATA\r\n                    };\r\n\r\n                    $ajax.post('/_31010/ConsultarConfiguracao',ds,{contentType: 'application/json'})\r\n                        .then(function(response) {\r\n                            that.CONFIGURACAO = response;\r\n\r\n                            resolve(true);\r\n\r\n                        },function(e){\r\n                            reject(e);\r\n                        }\r\n                    );\r\n\r\n                });\r\n\r\n            },\r\n            ConsultarDensidade : function(produto) {\r\n                var that = this;\r\n\r\n                return $q(function(resolve,reject){\r\n\r\n                    var ds = {\r\n                        MODELO  : that.PAI.ConsultaModelo.selected,\r\n                        COR     : that.PAI.ConsultaCor.selected,\r\n                        TAMANHO : that.PAI.ConsultaTamanho.selected,\r\n                        DATA    : gScope.DATA\r\n                    };\r\n\r\n                    $ajax.post('/_31010/ConsultarConfiguracao',ds,{contentType: 'application/json'})\r\n                        .then(function(response) {\r\n                            that.CONFIGURACAO = response;\r\n\r\n                            resolve(true);\r\n\r\n                        },function(e){\r\n                            reject(e);\r\n                        }\r\n                    );\r\n\r\n                });\r\n\r\n            },\r\n            ConsultarEstacoes : function(flag) {\r\n                var that = this;\r\n\r\n                return $q(function(resolve,reject){\r\n\r\n                    var ds = {\r\n                            DATA : gScope.DATA,\r\n                            CONF : that.CONFIGURACAO\r\n                        };\r\n\r\n                    $ajax.post('/_31010/ConsultarEstacoes',ds,{contentType: 'application/json'})\r\n                        .then(function(response) {\r\n                            that.ESTACOES       = response.ESTACOES; \r\n                            that.FATOR          = response.FATOR;\r\n                            that.MINUTOS_DIA    = response.TOTAL_MINUTOS_DIA; \r\n\r\n                            resolve(true);\r\n                            //that.PAI.calcularCusto();      \r\n                        },function(e){\r\n                            reject(e);\r\n                        }\r\n                    );\r\n\r\n                });\r\n            },\r\n            ConsultarFaturamento : function(flag) {\r\n                var that = this;\r\n\r\n                return $q(function(resolve,reject){\r\n\r\n                    var ds = {\r\n                            DATA    : gScope.DATA,\r\n                            MERCADO : gScope.ConsultaPadrao.selected\r\n                        };\r\n\r\n                    $ajax.post('/_31010/FaturamentoFamilia',ds,{contentType: 'application/json'})\r\n                        .then(function(response) {\r\n\r\n                            gScope.PERC_FATURAMENTO.VALOR = response;\r\n                            gScope.PERC_FATURAMENTO.FLAG  = 1;\r\n\r\n                            //that.PAI.calcularCusto();\r\n\r\n                            resolve(true);      \r\n                        },\r\n                        function(e){\r\n                            reject(e);\r\n                        }\r\n                    );\r\n\r\n                });\r\n            },\r\n            replaceLast : function(texto, substituir, substituto) {\r\n                var pos = texto.lastIndexOf(substituir); \r\n                if (pos > -1) {\r\n                   return texto.substring(0, pos) \r\n                    + substituto\r\n                    + texto.substring(pos + substituir.length, texto.length); \r\n                } else\r\n               return texto;\r\n            },\r\n            MaoDeObra : function(flag) {\r\n                var that = this;\r\n\r\n                var ds = {\r\n                        MODELO  : that.PAI.ConsultaModelo.selected,\r\n                        COR     : that.PAI.ConsultaCor.selected,\r\n                        TAMANHO : that.PAI.ConsultaTamanho.selected,\r\n                        DATA    : gScope.DATA,\r\n                        CONFIGURACAO : that.CONFIGURACAO\r\n                    };\r\n\r\n                $ajax.post('/_31010/ConsultarMaoDeObra',ds,{contentType: 'application/json'})\r\n                    .then(function(response) {\r\n\r\n                        that.MAO_DE_OBRA1  = response.G1;\r\n                        that.MAO_DE_OBRA2  = response.G2;\r\n                        that.MAO_DE_OBRA3  = response.G3;\r\n\r\n                        that.TOTAL_MAO_DE_OBRA = {\r\n                            COLABORADORES : 0,\r\n                            CUSTO_MINUTO  : 0,\r\n                            CUSTO_OPE     : 0,\r\n                            CUSTO_SET     : 0,\r\n                            CUSTO_OPE_T   : 0,\r\n                            CUSTO_SET_T   : 0,\r\n                            CUSTO_TOTAL1  : 0,\r\n                            CUSTO_TOTAL2  : 0,\r\n                            SALARIO       : 0,\r\n                            MINUTOS_DIA   : 0\r\n                        };\r\n\r\n                        angular.forEach(that.MAO_DE_OBRA3, function(iten, key) {\r\n                            that.TOTAL_MAO_DE_OBRA.COLABORADORES = Number(that.TOTAL_MAO_DE_OBRA.COLABORADORES) + 1;\r\n                            that.TOTAL_MAO_DE_OBRA.SALARIO  = Number(that.TOTAL_MAO_DE_OBRA.SALARIO) + Number(iten.SALARIO); \r\n                        });\r\n\r\n                        that.TOTAL_MAO_DE_OBRA.MINUTOS_DIA = Number(that.MINUTOS_DIA * that.TOTAL_MAO_DE_OBRA.COLABORADORES);\r\n\r\n                        angular.forEach(that.MAO_DE_OBRA1, function(iten, key) {\r\n\r\n                            iten.SALARIO       = Number(iten.SALARIO);\r\n                            iten.COLABORADOR   = Number(iten.COLABORADOR);\r\n\r\n                            iten.CUSTO_MINUTO = Number(iten.SALARIO)      / Number(that.TOTAL_MAO_DE_OBRA.MINUTOS_DIA);\r\n                            iten.CUSTO_OPE    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.TEMPO_MODELO);\r\n                            iten.CUSTO_SET    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.SETUP_MODELO);\r\n                            iten.CUSTO_OPE_T  = Number(iten.CUSTO_OPE)    * Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_SET_T  = Number(iten.CUSTO_SET)    / Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_TOTAL1 = Number(iten.CUSTO_OPE)    + Number(iten.CUSTO_SET_T);\r\n                            iten.CUSTO_TOTAL2 = Number(iten.CUSTO_OPE_T)  + Number(iten.CUSTO_SET_T);\r\n\r\n                        });\r\n\r\n                        angular.forEach(that.MAO_DE_OBRA2, function(iten, key) {\r\n                            iten.SALARIO       = Number(iten.SALARIO);\r\n                            iten.COLABORADOR   = Number(iten.COLABORADOR);\r\n\r\n                            iten.CUSTO_MINUTO = Number(iten.SALARIO)      / Number(that.TOTAL_MAO_DE_OBRA.MINUTOS_DIA);\r\n                            iten.CUSTO_OPE    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.TEMPO_MODELO);\r\n                            iten.CUSTO_SET    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.SETUP_MODELO);\r\n                            iten.CUSTO_OPE_T  = Number(iten.CUSTO_OPE)    * Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_SET_T  = Number(iten.CUSTO_SET)    / Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_TOTAL1 = Number(iten.CUSTO_OPE)    + Number(iten.CUSTO_SET_T);\r\n                            iten.CUSTO_TOTAL2 = Number(iten.CUSTO_OPE_T)  + Number(iten.CUSTO_SET_T);\r\n                        });\r\n\r\n                        angular.forEach(that.MAO_DE_OBRA3, function(iten, key) {\r\n\r\n                            iten.DATA_ADMISSAO = moment(iten.DATA_ADMISSAO).toDate();\r\n                            iten.DATA_DEMISSAO = moment(iten.DATA_DEMISSAO).toDate();\r\n                            iten.SALARIO       = Number(iten.SALARIO);\r\n\r\n                            iten.CUSTO_MINUTO = Number(iten.SALARIO)      / Number(that.TOTAL_MAO_DE_OBRA.MINUTOS_DIA);\r\n                            iten.CUSTO_OPE    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.TEMPO_MODELO);\r\n                            iten.CUSTO_SET    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.SETUP_MODELO);\r\n                            iten.CUSTO_OPE_T  = Number(iten.CUSTO_OPE)    * Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_SET_T  = Number(iten.CUSTO_SET)    / Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_TOTAL1 = Number(iten.CUSTO_OPE)    + Number(iten.CUSTO_SET_T);\r\n                            iten.CUSTO_TOTAL2 = Number(iten.CUSTO_OPE_T)  + Number(iten.CUSTO_SET_T);\r\n\r\n                            if(iten.DATA_DEMISSAO == 'Invalid Date'){\r\n                                iten.DATA_DEMISSAO = '';\r\n                            } \r\n                        });\r\n                        \r\n                        that.TOTAL_MAO_DE_OBRA.CUSTO_MINUTO = Number(that.TOTAL_MAO_DE_OBRA.SALARIO)      / Number(that.TOTAL_MAO_DE_OBRA.MINUTOS_DIA);\r\n                        that.TOTAL_MAO_DE_OBRA.CUSTO_OPE    = Number(that.TOTAL_MAO_DE_OBRA.CUSTO_MINUTO) * Number(that.PAI.TEMPO_MODELO);\r\n                        that.TOTAL_MAO_DE_OBRA.CUSTO_SET    = Number(that.TOTAL_MAO_DE_OBRA.CUSTO_MINUTO) * Number(that.PAI.SETUP_MODELO);\r\n                        that.TOTAL_MAO_DE_OBRA.CUSTO_OPE_T  = Number(that.TOTAL_MAO_DE_OBRA.CUSTO_OPE)    * Number(that.PAI.Quantidade);\r\n                        that.TOTAL_MAO_DE_OBRA.CUSTO_SET_T  = Number(that.TOTAL_MAO_DE_OBRA.CUSTO_SET)   / Number(that.PAI.Quantidade);\r\n\r\n                        that.TOTAL_MAO_DE_OBRA.CUSTO_TOTAL1 = Number(that.TOTAL_MAO_DE_OBRA.CUSTO_OPE)    + Number(that.TOTAL_MAO_DE_OBRA.CUSTO_SET_T);\r\n                        that.TOTAL_MAO_DE_OBRA.CUSTO_TOTAL2 = Number(that.TOTAL_MAO_DE_OBRA.CUSTO_OPE_T)  + Number(that.TOTAL_MAO_DE_OBRA.CUSTO_SET_T);\r\n\r\n                    }\r\n                );\r\n            },\r\n            Despesa : function(flag) {\r\n                var that = this;\r\n\r\n                that.DESPESA1      = [];\r\n                that.DESPESA2      = [];\r\n\r\n                var ds = {\r\n                        MODELO  : that.PAI.ConsultaModelo.selected,\r\n                        COR     : that.PAI.ConsultaCor.selected,\r\n                        TAMANHO : that.PAI.ConsultaTamanho.selected,\r\n                        DATA    : gScope.DATA,\r\n                        MERCADO : gScope.ConsultaPadrao.selected\r\n                    };\r\n\r\n                $ajax.post('/_31010/ConsultarDespesas',ds,{contentType: 'application/json'})\r\n                    .then(function(response) {\r\n\r\n                        that.DESPESA1       = response.G1;\r\n                        that.DESPESA2       = response.G2;\r\n                        that.DESPESA_MINUTO = 0;\r\n                        that.DESPESA_OPE    = 0;\r\n                        that.DESPESA_OPE_T  = 0;\r\n                        that.DESPESA_SET    = 0;\r\n                        that.DESPESA_SET_T  = 0;\r\n                        that.DESPESA_TOTAL1 = 0;\r\n                        that.DESPESA_TOTAL2 = 0;\r\n\r\n                        that.DESPESA3 = [];\r\n                        var grupo = '';\r\n                        var obj = {FLAG : '0'};\r\n\r\n                        angular.forEach(that.DESPESA1, function(iten, key) {\r\n\r\n                            if(grupo != iten.GRUPO){\r\n                                grupo = iten.GRUPO;\r\n                                that.DESPESA3.push({ID: iten.GRUPO, DESCRICAO: iten.DESC_GRUPO, ITENS: [], DESPESA: 0, DESPESAM: 0, DESPESAT: 0, VALOR_DESPESA : 0});\r\n                            }\r\n\r\n                            iten.SALARIO      = Number(iten.SALARIO);\r\n                            iten.VALOR        = Number(iten.VALOR) * Number(gScope.PERC_FATURAMENTO.VALOR);\r\n                            iten.PERCENTUAL   = Number(iten.PERCENTUAL);\r\n\r\n                            if(iten.TIPO == 1 || iten.TIPO == 2 || iten.PERCENTUAL > 1){\r\n                                iten.PERCENTUAL = 100;\r\n                            }else{\r\n                                iten.PERCENTUAL = iten.PERCENTUAL * 100;    \r\n                            }\r\n\r\n                            iten.VALOR_DESPESA = Number(iten.VALOR_DESPESA);\r\n                            iten.CUSTO_MINUTO  = Number(iten.VALOR)        / Number(that.FATOR);\r\n                            iten.CUSTO_OPE     = Number(iten.CUSTO_MINUTO) * Number(that.PAI.TEMPO_MODELO);\r\n                            iten.CUSTO_SET     = Number(iten.CUSTO_MINUTO) * Number(that.PAI.SETUP_MODELO);\r\n                            iten.CUSTO_OPE_T   = Number(iten.CUSTO_OPE)    * Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_SET_T   = Number(iten.CUSTO_SET)    / Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_TOTAL1  = Number(iten.CUSTO_OPE)    + Number(iten.CUSTO_SET_T);\r\n                            iten.CUSTO_TOTAL2  = Number(iten.CUSTO_OPE_T)  + Number(iten.CUSTO_SET_T);\r\n\r\n                            that.DESPESA3[that.DESPESA3.length - 1].ITENS.push(iten);\r\n\r\n                            that.DESPESA3[that.DESPESA3.length - 1].VALOR_DESPESA   += Number(iten.VALOR_DESPESA);\r\n                            that.DESPESA3[that.DESPESA3.length - 1].DESPESA         += Number(iten.VALOR);\r\n                            that.DESPESA3[that.DESPESA3.length - 1].DESPESAM        += Number(iten.CUSTO_TOTAL1);\r\n                            that.DESPESA3[that.DESPESA3.length - 1].DESPESAT        += Number(iten.CUSTO_TOTAL2);\r\n\r\n                        });\r\n\r\n                        that.DESPESA1 = that.DESPESA3;\r\n\r\n                        angular.forEach(that.DESPESA2, function(iten, key) {\r\n\r\n                            iten.SALARIO     = Number(iten.SALARIO);\r\n                            iten.VALOR       = Number(iten.VALOR) * Number(gScope.PERC_FATURAMENTO.VALOR);\r\n                            iten.PERCENTUAL  = Number(iten.PERCENTUAL);\r\n\r\n                            iten.PERCENTUAL = iten.PERCENTUAL * 1;    \r\n\r\n                            if(iten.PERCENTUAL >= 100){ \r\n                                iten.PERCENTUAL = 100;\r\n                            }\r\n\r\n                            iten.CUSTO_MINUTO = Number(iten.VALOR)        / Number(that.FATOR);\r\n                            iten.CUSTO_OPE    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.TEMPO_MODELO);\r\n                            iten.CUSTO_SET    = Number(iten.CUSTO_MINUTO) * Number(that.PAI.SETUP_MODELO);\r\n                            iten.CUSTO_OPE_T  = Number(iten.CUSTO_OPE)    * Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_SET_T  = Number(iten.CUSTO_SET)    / Number(that.PAI.Quantidade);\r\n                            iten.CUSTO_TOTAL1 = Number(iten.CUSTO_OPE)    + Number(iten.CUSTO_SET_T);\r\n                            iten.CUSTO_TOTAL2 = Number(iten.CUSTO_OPE_T)  + Number(iten.CUSTO_SET_T);\r\n\r\n                        });\r\n\r\n                        that.DESPESA_MINUTO = (Number(that.PAI.DESPESA)   * Number(gScope.PERC_FATURAMENTO.VALOR))   / Number(that.FATOR);\r\n\r\n                        that.DESPESA_OPE    = Number(that.DESPESA_MINUTO) * Number(that.PAI.TEMPO_MODELO);\r\n                        that.DESPESA_OPE_T  = Number(that.DESPESA_OPE)    * Number(that.PAI.Quantidade);\r\n\r\n                        that.DESPESA_SET    = Number(that.DESPESA_MINUTO) * Number(that.PAI.SETUP_MODELO);\r\n                        that.DESPESA_SET_T  = Number(that.DESPESA_SET)    / Number(that.PAI.Quantidade);\r\n\r\n                        that.DESPESA_TOTAL1 = Number(that.DESPESA_OPE)    + Number(that.DESPESA_SET_T);\r\n                        that.DESPESA_TOTAL2 = Number(that.DESPESA_OPE_T)  + Number(that.DESPESA_SET_T);\r\n                        \r\n                    }\r\n                );\r\n            },\r\n            FLAG_FICHA: 0,\r\n            consultar : function(flag) {\r\n                var that = this;\r\n\r\n                that.PAI.CALCULADO = 0;\r\n\r\n                return $q(function(resolve,reject){\r\n\r\n\r\n                    var ds = {\r\n                            MODELO  : that.PAI.ConsultaModelo.selected,\r\n                            COR     : that.PAI.ConsultaCor.selected,\r\n                            TAMANHO : that.PAI.ConsultaTamanho.selected,\r\n                            MERCADO : gScope.ConsultaPadrao.selected,\r\n                            DATA    : gScope.DATA,\r\n                            TROCA   : that.PRODUTO_TROCA,\r\n                            FLAG_TROCA : 1\r\n                        };\r\n\r\n                    that.FLAG_FICHA = 0;\r\n\r\n                    if(that.FLAG_FICHA == 0){\r\n\r\n                        $ajax.post('/_31010/ConsultarFicha',ds,{contentType: 'application/json'})\r\n                            .then(function(response) {\r\n                                that.ITENS  = response;\r\n                                that.FILHOS = [];\r\n\r\n                                angular.forEach(that.ITENS, function(item, key) {\r\n                                    item.MONTADO     = false;\r\n                                    item.ABERTO      = false;\r\n                                    item.FILHOS      = [];\r\n                                    item.TOTALIZADOR = 0;\r\n                                });\r\n\r\n                                if(flag == 5){\r\n                                    that.PAI.calcularCusto();    \r\n                                }else{\r\n                                    //that.montar();\r\n                                }\r\n\r\n                                if(flag == 1){\r\n                                    that.FLAG_FICHA = 1;\r\n                                }\r\n\r\n                                resolve(true);        \r\n                            },\r\n                            function(e){\r\n                                reject(e);\r\n                            }\r\n                        );\r\n                    }else{\r\n                        resolve(true);\r\n                    }\r\n                });\r\n            },\r\n            montar : function() {\r\n                var that = this;\r\n\r\n                var maxNivel = 0;\r\n\r\n                var that = this;\r\n\r\n                var tamanho = that.PAI.ConsultaTamanho.selected.ID;\r\n\r\n                that.VALOR_ICMS = 0;\r\n\r\n                function pad(n, width, z) {\r\n                  z = z || '0';\r\n                  n = n + '';\r\n                  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\r\n                }\r\n\r\n                var maxNivel = 0;\r\n\r\n                angular.forEach(that.ITENS, function(item, key) {\r\n\r\n                    if(item.NIVEL >= 0){\r\n\r\n                        item.ADD = false;\r\n\r\n                        if(maxNivel < item.NIVEL){\r\n                            maxNivel = Number(item.NIVEL);\r\n                        }\r\n\r\n                        var temp_tamanho1 = pad(item.TAMANHO_PROD, 2);\r\n                        var temp_tamanho2 = pad(tamanho, 2);\r\n                        var temp_tamanho3 = pad(tamanho, 2);\r\n\r\n                        angular.forEach(that.ITENS, function(iten, key) {\r\n                            if(item.ORIGEM == iten.PRODUTO_CONSUMO){\r\n                                temp_tamanho3 = pad(iten.TAMANHO_CONSUMO, 2);\r\n                            }\r\n                        });\r\n\r\n                        /*\r\n                        var t             = 'T'      + temp_tamanho3;\r\n                        var c             = 'C'      + temp_tamanho3;\r\n                        var to            = 'TO'     + temp_tamanho3;\r\n                        var ts            = 'TS'     + temp_tamanho3;\r\n                        var cms           = 'CMS'    + temp_tamanho3;\r\n                        var cmo           = 'CMO'    + temp_tamanho3;\r\n                        var comoip        = 'COMOIP' + temp_tamanho3;\r\n                        var comoia        = 'COMOIA' + temp_tamanho3;\r\n\r\n                        var t_valor       = item[t];\r\n                        var c_valor       = item[c];\r\n                        var to_valor      = item[to];\r\n                        var ts_valor      = item[ts];\r\n                        var cms_valor     = item[cms];\r\n                        var cmo_valor     = item[cmo];\r\n                        var comoip_valor  = item[comoip];\r\n                        var comoia_valor  = item[comoia];\r\n                        */\r\n\r\n                        var t      = 'T'     ;\r\n                        var c      = 'C'     ;\r\n                        var to     = 'TO'    ;\r\n                        var ts     = 'TS'    ;\r\n                        var cs     = 'CS'    ;\r\n                        var co     = 'CO'    ;\r\n                        var cms    = 'CMS'   ;\r\n                        var cmo    = 'CMO'   ;\r\n                        var cmoip  = 'CMOIP' ;\r\n                        var cmoia  = 'CMOIA' ;\r\n                        var csmoip = 'CSMOIP';\r\n                        var csmoia = 'CSMOIA';\r\n                        var perda  = 'PERDA' ;\r\n                        var comoip = 'COMOIP';\r\n                        var comoia = 'COMOIA';\r\n\r\n                        var t_valor       = item[t];\r\n                        var c_valor       = item[c];\r\n                        var to_valor      = item[to];\r\n                        var ts_valor      = item[ts];\r\n                        var cs_valor      = item[cs];\r\n                        var co_valor      = item[co];\r\n                        var cms_valor     = item[cms];\r\n                        var cmo_valor     = item[cmo];\r\n                        var cmoip_valor   = item[cmoip];\r\n                        var cmoia_valor   = item[cmoia];\r\n                        var csmoip_valor  = item[csmoip];\r\n                        var csmoia_valor  = item[csmoia];\r\n                        var perda_valor   = item[perda];\r\n                        var comoip_valor  = item[comoip];\r\n                        var comoia_valor  = item[comoia];\r\n                        var despesa       = item['DESPESA'];\r\n\r\n                        var Incentivo = 0;\r\n                        var vlr_icms  = 0;\r\n                        if(item.ICMS > 0){\r\n                            Incentivo = gScope.Fatores.Incentivo;\r\n\r\n                            //if(item.NIVEL == 0){\r\n                                angular.forEach(that.ITENS, function(filho, key){\r\n                                    if(filho.ORIGEM == item.PRODUTO_CONSUMO && filho.PRODUTO_CONSUMO == item.PRODUTO_CONSUMO){\r\n                                        if(filho.NIVEL > item.NIVEL){\r\n                                            item.ICMS = 0;\r\n                                        }\r\n                                    }\r\n                                });\r\n                            //}\r\n\r\n                            vlr_icms = Number(item.CUSTO_MEDIO) * ((Number(item.ICMS) * (Number(Incentivo) / 100)) / 100);\r\n\r\n                        }\r\n\r\n                        ///*\r\n                        item.T_VALOR      = t_valor;\r\n                        item.C_VALOR      = Number(c_valor) + Number(vlr_icms);\r\n                        item.TO_VALOR     = to_valor;\r\n                        item.TS_VALOR     = ts_valor;\r\n                        item.CS_VALOR     = cs_valor;\r\n                        item.CO_VALOR     = co_valor;\r\n                        item.CMS_VALOR    = cms_valor;\r\n                        item.CMO_VALOR    = cmo_valor;\r\n                        item.CMOIP_VALOR  = cmoip_valor;\r\n                        item.CMOIA_VALOR  = cmoia_valor;\r\n                        item.CSMOIP_VALOR = csmoip_valor;\r\n                        item.CSMOIA_VALOR = csmoia_valor;\r\n                        item.COMOIP_VALOR = comoip_valor;\r\n                        item.COMOIA_VALOR = comoia_valor;\r\n                        //*/\r\n\r\n                        /*\r\n                        item.T_VALOR      = t_valor;\r\n                        item.C_VALOR      = \r\n                        item.TO_VALOR     = to_valor;\r\n                        item.TS_VALOR     = ts_valor;\r\n                        item.CMS_VALOR    = cms_valor;\r\n                        item.CMO_VALOR    = cmo_valor;\r\n                        item.COMOIP_VALOR = comoip_valor;\r\n                        item.COMOIA_VALOR = comoia_valor;\r\n                        //*/\r\n\r\n                        item.VLR_ICMS  = vlr_icms;\r\n                        item.VLR_ICMS2 = vlr_icms;\r\n                        item.CONSUMO   = (item.T_VALOR / item.FATOR_CONVERSAO);\r\n                        item.CUSTO     = item.C_VALOR;\r\n                        item.TOTAL     = item.CUSTO * that.PAI.Quantidade;              \r\n                    }\r\n                });\r\n\r\n                var novo = [];\r\n\r\n                for (var i = maxNivel; i >= 0; i--){\r\n\r\n                    angular.forEach(that.ITENS, function(item, k) {\r\n\r\n                        if(item.NIVEL == i){\r\n\r\n                            item.SUB_ITENS = [];\r\n                            item.ABERTO = false;\r\n\r\n                            item.TOTAL_CUSTO = 0; \r\n                            item.TOTAL_ICMS  = 0;\r\n                            item.TOTAL_GERAL = 0;\r\n\r\n                            item.CUSTO2     = 0;\r\n                            item.TOTAL2     = 0;\r\n\r\n                            //adicionar os filhos ao pai\r\n                            angular.forEach(that.ITENS, function(iten, y) {\r\n                                if((item.PRODUTO_CONSUMO == iten.ORIGEM) && (Number(iten.NIVEL) > Number(item.NIVEL))){\r\n                                    item.SUB_ITENS.push(iten);\r\n                                }               \r\n                            });\r\n\r\n                            //calcula o valor do pai usando os filhos\r\n                            angular.forEach(item.SUB_ITENS, function(iten, y) {\r\n\r\n                                iten.CUSTO2      = Number(iten.CUSTO_MEDIO) * Number(iten.CONSUMO); \r\n                                iten.TOTAL2      = Number(iten.CUSTO2)      * Number(that.PAI.Quantidade);\r\n\r\n                                item.CUSTO2      = Number(item.CUSTO2)      + Number(iten.CUSTO2);\r\n                                item.TOTAL2      = Number(item.CUSTO2)      * Number(that.PAI.Quantidade);\r\n\r\n                                if(Number(iten.VLR_ICMS2) > 0){\r\n                                    item.VLR_ICMS2   = Number(item.VLR_ICMS2)   + (Number(iten.VLR_ICMS2) * Number(iten.CONSUMO));\r\n                                }\r\n\r\n                            });\r\n\r\n\r\n                            item.TOTAL_CUSTO = Number(item.CUSTO2);\r\n                            item.TOTAL_ICMS  = Number(item.VLR_ICMS2);\r\n                            item.TOTAL_GERAL = Number(item.TOTAL_CUSTO) * Number(that.PAI.Quantidade);\r\n\r\n                        }\r\n\r\n                        if(item.NIVEL == 0 && i == 0){\r\n\r\n                            that.VALOR_ICMS = Number(that.VALOR_ICMS) + item.VLR_ICMS; \r\n\r\n                            if(item.ADD == false){\r\n                                novo.push(item);\r\n                                item.ADD = true;\r\n                            }\r\n                            \r\n                        }\r\n\r\n                    }); \r\n\r\n                }\r\n\r\n                angular.forEach(novo, function(item, y) {\r\n\r\n                    if(item.NIVEL == 0){\r\n\r\n                        if(item.SUB_ITENS == undefined){\r\n                            item.SUB_ITENS = [];\r\n                        }\r\n\r\n                        if(item.SUB_ITENS.length == 0){\r\n                            item.TOTAL_CUSTO = item.CUSTO_MEDIO;\r\n                        } \r\n\r\n                    }\r\n\r\n                }); \r\n\r\n                that.LISTA_MATERIA = novo;\r\n                that.LISTA_MATERIA.TOTAL_CUSTO = 0; \r\n                that.LISTA_MATERIA.TOTAL_GERAL = 0; \r\n                that.LISTA_MATERIA.TOTAL_ICMS  = 0;\r\n\r\n                var tmp = {\r\n                    T_VALOR      : 0,\r\n                    C_VALOR      : 0,\r\n                    TO_VALOR     : 0,\r\n                    TS_VALOR     : 0,\r\n                    CS_VALOR     : 0,\r\n                    CO_VALOR     : 0,\r\n                    CMS_VALOR    : 0,\r\n                    CMO_VALOR    : 0,\r\n                    CMOIP_VALOR  : 0,\r\n                    CMOIA_VALOR  : 0,\r\n                    CSMOIP_VALOR : 0,\r\n                    CSMOIA_VALOR : 0,\r\n                    COMOIP_VALOR : 0,\r\n                    COMOIA_VALOR : 0\r\n                };\r\n\r\n                angular.forEach(that.LISTA_MATERIA, function(item, y) {\r\n\r\n                    item.VLR_ICMS2  = Number(item.VLR_ICMS2);//   * Number(item.CONSUMO);\r\n                    item.CUSTO2     = Number(item.TOTAL_CUSTO) * Number(item.CONSUMO); \r\n                    item.TOTAL2     = Number(item.CUSTO2)      * Number(that.PAI.Quantidade);\r\n\r\n                    that.LISTA_MATERIA.TOTAL_ICMS  = Number(that.LISTA_MATERIA.TOTAL_ICMS)  + (Number(item.VLR_ICMS2) * Number(item.CONSUMO)) ;\r\n                    that.LISTA_MATERIA.TOTAL_CUSTO = Number(that.LISTA_MATERIA.TOTAL_CUSTO) + Number(item.CUSTO2);\r\n                    that.LISTA_MATERIA.TOTAL_GERAL = Number(that.LISTA_MATERIA.TOTAL_GERAL) + Number(item.TOTAL2);\r\n\r\n                    tmp.T_VALOR      = tmp.T_VALOR      + Number(item.T_VALOR);\r\n                    tmp.C_VALOR      = tmp.C_VALOR      + Number(item.C_VALOR);\r\n                    tmp.TO_VALOR     = tmp.TO_VALOR     + Number(item.TO_VALOR);\r\n                    tmp.TS_VALOR     = tmp.TS_VALOR     + Number(item.TS_VALOR);\r\n                    tmp.CS_VALOR     = tmp.CS_VALOR     + Number(item.CS_VALOR);\r\n                    tmp.CO_VALOR     = tmp.CO_VALOR     + Number(item.CO_VALOR);\r\n                    tmp.CMS_VALOR    = tmp.CMS_VALOR    + Number(item.CMS_VALOR);\r\n                    tmp.CMO_VALOR    = tmp.CMO_VALOR    + Number(item.CMO_VALOR);\r\n                    tmp.CMOIP_VALOR  = tmp.CMOIP_VALOR  + Number(item.CMOIP_VALOR);\r\n                    tmp.CMOIA_VALOR  = tmp.CMOIA_VALOR  + Number(item.CMOIA_VALOR);\r\n                    tmp.CSMOIP_VALOR = tmp.CSMOIP_VALOR + Number(item.CSMOIP_VALOR);\r\n                    tmp.CSMOIA_VALOR = tmp.CSMOIA_VALOR + Number(item.CSMOIA_VALOR);\r\n                    tmp.COMOIP_VALOR = tmp.COMOIP_VALOR + Number(item.COMOIP_VALOR);\r\n                    tmp.COMOIA_VALOR = tmp.COMOIP_VALOR + Number(item.COMOIP_VALOR);\r\n\r\n                });\r\n\r\n                //console.log(tmp); \r\n\r\n                //console.log(that.LISTA_MATERIA);\r\n                \r\n            },\r\n            Selectionar : function (Ficha) {\r\n                var that = this;\r\n\r\n                if(that.SELECTED != Ficha){\r\n                    that.SELECTED = Ficha; \r\n                }\r\n                \r\n            }\r\n        },\r\n        Gasto : {\r\n            Valor: 0,\r\n            Custo: {\r\n                Valor: 0,\r\n                MateriaPrima : {Valor: 0},\r\n                Direto: {\r\n                    Valor: 0,\r\n                    MaoObraDireta: {\r\n                        Valor: 0,\r\n                        CustoSetup: {Valor: 0, Valor2: 0},\r\n                        CustoOperacional: {Valor: 0, Valor2: 0}\r\n                    },\r\n                    MateriaPrima: {Valor: 0}\r\n                },\r\n                Indireto: {\r\n                    Valor: 0,\r\n                    Proprio: {Valor: 0, Setup: 0, Proprio: 0},\r\n                    Absorvido: {Valor: 0, Setup: 0, Absorvido: 0},\r\n\r\n                }\r\n            },\r\n            Despesa:{\r\n                Tributos: 0,\r\n                Contas: 0,\r\n                Valor: 0,\r\n                Comissao:{Valor: 0},\r\n                Itens:{}\r\n            }\r\n        },\r\n        consultarTempo : function(flag) {\r\n            var that = this;\r\n\r\n            that.CALCULADO = 0;\r\n\r\n            var T1 = 0;\r\n            var T2 = 0;\r\n            var T3 = 0;\r\n\r\n            that.Ficha.ConsultarFaturamento().then(function(){\r\n                T1 = 1;\r\n                if(T1 == 1 && T2 == 1 && T3 == 1){\r\n                    that.calcularCusto();\r\n                }    \r\n            });\r\n\r\n            that.Ficha.ConsultarConfiguracao().then(function(){\r\n               that.Ficha.ConsultarEstacoes().then(function(){\r\n                    T2 = 1;\r\n\r\n                    if(T1 == 1 && T2 == 1 && T3 == 1){\r\n                        that.calcularCusto();\r\n                    }    \r\n                });    \r\n            });\r\n\r\n            that.Ficha.consultar().then(function(){\r\n                T3 = 1;\r\n                if(T1 == 1 && T2 == 1 && T3 == 1){\r\n                    that.calcularCusto();\r\n                }\r\n            });\r\n        },\r\n        calcularCusto : function(flag) {\r\n\r\n            var that = this;\r\n            var tamanho = that.ConsultaTamanho.selected.ID;\r\n\r\n            function pad(n, width, z) {\r\n              z = z || '0';\r\n              n = n + '';\r\n              return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\r\n            }\r\n\r\n            //that.Ficha.calcular();\r\n\r\n            that.Ficha.montar();\r\n\r\n            angular.forEach(that.Ficha.ITENS, function(item, key) {\r\n\r\n                if(item.NIVEL == -1){\r\n                    tamanho = pad(tamanho, 2);\r\n\r\n                    that.UnidadeMedida = item.UNIDADEMEDIDA_SIGLA;\r\n                    that.PERCENTUAL_PERDA = item.PERDA;\r\n\r\n                    var t     = 'T'     ;\r\n                    var c     = 'C'     ;\r\n                    var to    = 'TO'    ;\r\n                    var ts    = 'TS'    ;\r\n                    var cs    = 'CS'    ;\r\n                    var co    = 'CO'    ;\r\n                    var cms   = 'CMS'   ;\r\n                    var cmo   = 'CMO'   ;\r\n                    var cmoip = 'CMOIP' ;\r\n                    var cmoia = 'CMOIA' ;\r\n                    var csmoip= 'CSMOIP';\r\n                    var csmoia= 'CSMOIA';\r\n                    var perda = 'PERDA' ;\r\n\r\n\r\n                    var t_valor       = item[t];\r\n                    var c_valor       = item[c];\r\n                    var to_valor      = item[to];\r\n                    var ts_valor      = item[ts];\r\n                    var cs_valor      = item[cs];\r\n                    var co_valor      = item[co];\r\n                    var cms_valor     = item[cms];\r\n                    var cmo_valor     = item[cmo];\r\n                    var cmoip_valor   = item[cmoip];\r\n                    var cmoia_valor   = item[cmoia];\r\n                    var csmoip_valor  = item[csmoip];\r\n                    var csmoia_valor  = item[csmoia];\r\n                    var perda_valor   = item[perda];\r\n                    var despesa       = item['DESPESA'];\r\n\r\n                    item.T_VALOR      = t_valor;\r\n                    item.C_VALOR      = c_valor;\r\n                    item.TO_VALOR     = to_valor;\r\n                    item.TS_VALOR     = ts_valor;\r\n                    item.CS_VALOR     = cs_valor;\r\n                    item.CO_VALOR     = co_valor;\r\n                    item.CMS_VALOR    = cms_valor;\r\n                    item.CMO_VALOR    = cmo_valor;\r\n                    item.CMOIP_VALOR  = cmoip_valor;\r\n                    item.CMOIA_VALOR  = cmoia_valor;\r\n                    item.CSMOIP_VALOR = csmoip_valor;\r\n                    item.CSMOIA_VALOR = csmoia_valor;\r\n\r\n                    //console.log(item);\r\n\r\n                    var tbm_despesa   = (Number(despesa) * Number(gScope.PERC_FATURAMENTO.VALOR))\r\n\r\n                    //item.DESPESA      = tbm_despesa;\r\n                    that.DESPESA      = despesa;\r\n\r\n                    that.TEMPO_MODELO = to_valor;\r\n                    that.SETUP_MODELO = ts_valor;\r\n\r\n                    that.PERCENTUAL_PERDA = Number(perda_valor);\r\n\r\n                    //valores de materia prima, setup, mao de obra, absorvido e proprio\r\n                    that.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor        = Number(cms_valor) / Number(that.Quantidade);\r\n                    that.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor  = Number(cmo_valor);\r\n                    that.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor2       = Number(cs_valor) / Number(that.Quantidade);\r\n                    that.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor2 = Number(co_valor);\r\n                    that.Gasto.Custo.Indireto.Proprio.Proprio                     = Number(cmoip_valor);\r\n                    that.Gasto.Custo.Indireto.Absorvido.Absorvido                 = Number(cmoia_valor);\r\n                    that.Gasto.Custo.Indireto.Proprio.Setup                       = Number(csmoip_valor) / Number(that.Quantidade);\r\n                    that.Gasto.Custo.Indireto.Absorvido.Setup                     = Number(csmoia_valor) / Number(that.Quantidade);\r\n                    that.Gasto.Custo.Indireto.Proprio.Valor                       = Number(cmoip_valor) + (Number(csmoip_valor) / Number(that.Quantidade));\r\n                    that.Gasto.Custo.Indireto.Absorvido.Valor                     = Number(cmoia_valor) + (Number(csmoia_valor) / Number(that.Quantidade));\r\n\r\n                    that.Gasto.Custo.MateriaPrima.Valor                           = Number(that.Ficha.LISTA_MATERIA.TOTAL_CUSTO) + Number(that.Ficha.LISTA_MATERIA.TOTAL_ICMS);//Number(c_valor) + Number(that.Ficha.VALOR_ICMS);\r\n\r\n                    var CustoSetup          = Number(that.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor2)      + Number(that.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor);\r\n                    var CustoOperacional    = Number(that.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor) + Number(that.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor2);\r\n                    var IndiretoAbsorvido   = Number(that.Gasto.Custo.Indireto.Absorvido.Valor);\r\n                    var IndiretoProprio     = Number(that.Gasto.Custo.Indireto.Proprio.Valor);\r\n                    var IndiretoAbsorvidoSp = Number(that.Gasto.Custo.Indireto.Absorvido.Setup);\r\n                    var IndiretoProprioSp   = Number(that.Gasto.Custo.Indireto.Proprio.Setup);\r\n                    var MateriaPrima        = Number(that.Gasto.Custo.MateriaPrima.Valor);\r\n\r\n                    //soma os valores para ir subindo no grafico, ex.: custo Direto = Mao de Obra Direta + Materia Prima\r\n                    that.Gasto.Custo.Direto.MaoObraDireta.Valor = CustoSetup + CustoOperacional;\r\n                    that.Gasto.Custo.Direto.Valor = that.Gasto.Custo.Direto.MaoObraDireta.Valor + MateriaPrima;\r\n                    that.Gasto.Custo.Indireto.Valor =  IndiretoAbsorvido + IndiretoProprio;\r\n                    that.Gasto.Custo.Valor = that.Gasto.Custo.Direto.Valor + that.Gasto.Custo.Indireto.Valor;\r\n\r\n                    //calcula valor de perdas caso seja necessario\r\n                    var perdas = 0;\r\n                    if(gScope.Fatores.ConsiderarPerdas == true){\r\n                        perdas = Number(that.Gasto.Custo.Valor) * Number(that.PERCENTUAL_PERDA);\r\n                    }\r\n\r\n                    //custo mais perdas\r\n                    that.Gasto.Custo.Valor = that.Gasto.Custo.Valor + perdas;\r\n                    that.Cst_u_Produto     = MateriaPrima + CustoSetup + IndiretoAbsorvido + IndiretoProprio + CustoOperacional + perdas;\r\n                    that.Cst_t_Produto     = that.Cst_u_Produto * Number(that.Quantidade);\r\n\r\n                    var vlr3 = 0;\r\n                    var vlr2 = 0;\r\n                    var vlr1 = 0;\r\n                    var vlr0 = 0;\r\n\r\n                    //pega despesa + fatores do mercado, calcula setup e custo minuto e adiciona ao produto\r\n                    item.CM_DESPESA   = (Number(tbm_despesa)     / that.Ficha.FATOR);\r\n                    item.C_DESPESA    = (Number(item.CM_DESPESA) * that.TEMPO_MODELO);\r\n                    item.S_DESPESA    = (Number(item.CM_DESPESA) * that.SETUP_MODELO) /  Number(that.Quantidade);\r\n\r\n                    that.Gasto.Despesa.Contas = item.C_DESPESA + item.S_DESPESA;\r\n\r\n                    //se preco calculado ou manual\r\n                    if(that.MUDAR_PRECO == true){\r\n                        \r\n                    }else{\r\n\r\n                        if(that.MUDAR_CONTRIBUICAO == true){\r\n\r\n                            vlr0 = 0;\r\n                            vlr3 = 0;\r\n                            angular.forEach(gScope.PadraoItem, function(item, key) {\r\n\r\n                                var Incentivo = 0;\r\n                                if(gScope.Fatores.Incentivo > 0 && item.INCENTIVO == 1){\r\n                                    Incentivo = gScope.Fatores.Incentivo;\r\n                                    vlr0 = ((Number(item.VALOR) * (Number(Incentivo) / 100)) / 100);\r\n                                }else{\r\n                                    vlr0 = (Number(item.VALOR) / 100);                           \r\n                                }\r\n\r\n                                if(item.MARGEM == 1){\r\n                                    vlr0 = (vlr0 * (Number(gScope.MARGEM) / 100));\r\n                                }\r\n\r\n                                vlr3 = vlr3 + vlr0;\r\n                            });\r\n\r\n                            //frete calculado\r\n                            if(gScope.Frete.PERCENTUAL > 0){\r\n                                vlr3 = vlr3 + Number(gScope.Frete.PERCENTUAL);\r\n                            }\r\n\r\n                            var perc = 0;\r\n                            angular.forEach(gScope.ListaIncentivo, function(item, key) {\r\n                                if(item.PERCENTUAL == gScope.Fatores.Incentivo){\r\n                                   perc = item.PERCENTUAL_IR;\r\n                                }\r\n                            });\r\n\r\n                            perc = (perc * (Number(gScope.MARGEM) / 100));\r\n\r\n                            //valor da contribuicao + imposto de renda\r\n                            var a = 100 - Number(perc);\r\n                            var b = (Number(that.Contribuicao) / a) * 100;\r\n\r\n                            var d = ((vlr3 * 100) + b);\r\n                            var v = (100 - d); //1 - tributos + contribuicao + imp renda\r\n                            var c = (that.Gasto.Custo.Valor + item.C_DESPESA + item.S_DESPESA); //custo + contas\r\n                            var z = (v * (1 - vlr3));\r\n                            var x = (c * 100) / v;\r\n\r\n                            that.PrecoVenda = x; \r\n\r\n                            if(d > 100){\r\n                                showErro('O % de contribuição + tributos não pode superar 100%, (contribuição + tributos) = ' + d);\r\n                                that.PrecoVenda = 0; \r\n                            }                  \r\n                        \r\n                        }else{\r\n                            that.PrecoVenda = Number(that.Cst_u_Produto) + ((Number(gScope.Fatores.MarckUp) / 100) * that.Cst_u_Produto);\r\n                        }\r\n\r\n                        //that.PrecoVenda = Number(Number(that.PrecoVenda).toFixed(2)); \r\n                    }\r\n                    \r\n\r\n                    //total do preço\r\n                    that.TotalPrecoVenda = that.PrecoVenda * Number(that.Quantidade);\r\n\r\n\r\n                    //calcula fatores do custo, os fatores vem do mercado\r\n                    that.Gasto.Despesa.Itens = [];\r\n                    angular.forEach(gScope.PadraoItem, function(item, key) {\r\n\r\n                        if(item.FRETE == 0 || (item.FRETE == 1 && gScope.Frete.PERCENTUAL <= 0)){\r\n\r\n                            var Incentivo = 0;\r\n                            if(gScope.Fatores.Incentivo > 0 && item.INCENTIVO == 1){\r\n                                Incentivo = gScope.Fatores.Incentivo;\r\n                                vlr0 = Number(that.TotalPrecoVenda) * ((Number(item.VALOR) * (Number(Incentivo) / 100)) / 100);\r\n                            }else{\r\n                                vlr0 = Number(that.TotalPrecoVenda) * (Number(item.VALOR) / 100);                           \r\n                            }\r\n\r\n                            if(item.MARGEM == 1){\r\n                                vlr0 = (vlr0 * (Number(gScope.MARGEM) / 100));\r\n                            }\r\n\r\n                            vlr1 = Number(vlr0) / Number(that.Quantidade); \r\n                            \r\n                            that.Gasto.Despesa.Itens.push({\r\n                                DESCRICAO: item.DESCRICAO,\r\n                                VALOR : vlr1,\r\n                                TOTAL : vlr0\r\n                            });\r\n\r\n                            vlr3 = vlr3 + vlr1;\r\n                        }\r\n                    });\r\n\r\n                    //frete calculado\r\n                    if(gScope.Frete.PERCENTUAL > 0){\r\n\r\n                        var Incentivo = 0;\r\n                        \r\n                        vlr0 = Number(that.TotalPrecoVenda) * Number(gScope.Frete.PERCENTUAL);                           \r\n\r\n                        vlr1 = Number(vlr0) / Number(that.Quantidade); \r\n                        \r\n                        that.Gasto.Despesa.Itens.push({\r\n                            DESCRICAO: 'Frete Calculado',\r\n                            VALOR : vlr1,\r\n                            TOTAL : vlr0\r\n                        });\r\n\r\n                        vlr3 = vlr3 + vlr1;\r\n                    }        \r\n\r\n                    that.Gasto.Despesa.Tributos = vlr3;\r\n\r\n                    item.C_DESPESA    = item.C_DESPESA + item.S_DESPESA + vlr3;\r\n\r\n                    var despesa1      = ((item.C_DESPESA / that.Cst_u_Produto) * 100);\r\n\r\n                    item.PERC_DESPESA = despesa1;\r\n\r\n                    that.CM_DESPESA   = item.CM_DESPESA;\r\n                    that.C_DESPESA    = item.C_DESPESA;\r\n                    that.PERC_DESPESA = item.PERC_DESPESA;             \r\n\r\n                    //calcula o MarckUp\r\n                    vlr1 = Number(that.PrecoVenda) - Number(that.Cst_u_Produto);\r\n                    vlr3 = (vlr1 / Number(that.Cst_u_Produto)) * 100;\r\n                    that.MarckUp = vlr3;\r\n\r\n                    that.Gasto.Despesa.Valor = item.C_DESPESA;\r\n                    that.Gasto.Valor = that.Gasto.Custo.Valor + that.Gasto.Despesa.Valor;\r\n\r\n                    if(that.MUDAR_CONTRIBUICAO == false){\r\n                        that.Contribuicao     = ((Number(that.PrecoVenda) - Number(that.Gasto.Valor)) / Number(that.PrecoVenda)) * 100;\r\n                    }\r\n\r\n                    that.ContribuicaoReal = 0;\r\n                    that.Despesa = (item.C_DESPESA * Number(that.Quantidade));\r\n\r\n                    that.ImpostoDeRenda = 0;\r\n\r\n                    if(that.Contribuicao > 0){\r\n\r\n                        var perc = 0;\r\n                        angular.forEach(gScope.ListaIncentivo, function(item, key) {\r\n                            if(item.PERCENTUAL == gScope.Fatores.Incentivo){\r\n                               perc = item.PERCENTUAL_IR;\r\n                            }\r\n                        });\r\n\r\n                        perc = (perc * (Number(gScope.MARGEM) / 100));\r\n\r\n                        var j = 0;\r\n                        if(that.MUDAR_CONTRIBUICAO == true){\r\n                            var a = 100 - Number(perc);\r\n                            var p = (Number(perc) / 100) * (that.Contribuicao / 100); //imp. renda\r\n                            var b = Number(that.Contribuicao) / a;\r\n\r\n                            j = b;//(Number(that.Contribuicao) / 100) + ((Number(perc) / 100) * (that.Contribuicao / 100)); //imp. renda\r\n                        }else{\r\n                            j = Number(that.Contribuicao) / 100;\r\n                        }\r\n\r\n                        vlr1 = (j) * Number(that.TotalPrecoVenda);\r\n\r\n                        var p = (Number(perc) / 100);\r\n                        var v = vlr1 * p;\r\n\r\n                        that.ImpostoDeRendaDesc = Number(perc);\r\n                        that.ImpostoDeRenda     = v;\r\n\r\n                        //that.Contribuicao     = ((vlr1 - v) / Number(that.Cst_t_Produto)) * 100;\r\n\r\n                        if(that.MUDAR_CONTRIBUICAO == false){\r\n                            that.Contribuicao       = ((Number(that.TotalPrecoVenda) - ((Number(that.Gasto.Valor)  * Number(that.Quantidade)) + that.ImpostoDeRenda)) / Number(that.TotalPrecoVenda)) * 100;\r\n                        }\r\n\r\n                        that.ContribuicaoReal   = (Number(that.Contribuicao) / 100) * Number(that.TotalPrecoVenda);\r\n\r\n                        that.ContribuicaoReal2  = (Number(that.ContribuicaoReal) / Number(that.Quantidade));\r\n\r\n                    }\r\n                }\r\n\r\n            });\r\n            \r\n            gScope.ItenCusto.CalcularTotal();\r\n\r\n            that.CALCULADO = 1;\r\n            \r\n        },\r\n        DetalharDespesa: function(item,flag){\r\n            var that = this;\r\n\r\n            that.DESPESA_ITEM = item;\r\n            that.DESPESA_DETALHE = [];\r\n\r\n            var ds = {\r\n                    FLAG    : flag,\r\n                    ITEM    : item,\r\n                    DATA    : gScope.DATA,\r\n                    MERCADO : gScope.ConsultaPadrao.selected\r\n                };\r\n\r\n            $ajax.post('/_31010/DetalharDespesa',ds,{contentType: 'application/json'})\r\n                .then(function(response) {\r\n                    that.DESPESA_DETALHE = response;  \r\n\r\n                    angular.forEach(that.DESPESA_DETALHE, function(item, key) {\r\n                        item.VALOR = Number(item.VALOR);\r\n                        item.PERCENTUAL = Number(item.PERCENTUAL) * 100;\r\n\r\n                        if(item.PERCENTUAL > 100){\r\n                            item.PERCENTUAL = 100;\r\n                        }\r\n                    });         \r\n                }\r\n            );\r\n\r\n            if(flag == 2){\r\n               $('#modal-detalhar-despesa2').modal();\r\n            }else{\r\n               $('#modal-detalhar-despesa').modal(); \r\n            }\r\n        },\r\n        Alternar: function(flag){\r\n\r\n            if(flag == 1){\r\n                //alterar preço\r\n\r\n                this.MUDAR_PRECO = !this.MUDAR_PRECO;\r\n\r\n                if(this.MUDAR_PRECO == false){\r\n                    this.calcularCusto();\r\n                }else{\r\n                    if(this.MUDAR_CONTRIBUICAO == true){\r\n                        this.MUDAR_CONTRIBUICAO = false;  \r\n                        this.calcularCusto();\r\n                    }else{\r\n                        this.MUDAR_CONTRIBUICAO = false;\r\n                    }  \r\n                }\r\n\r\n            }else{\r\n                //alerar contribuição\r\n                this.MUDAR_CONTRIBUICAO = !this.MUDAR_CONTRIBUICAO;\r\n\r\n                if(this.MUDAR_CONTRIBUICAO == false){\r\n                    this.calcularCusto();\r\n                }else{\r\n                    if(this.MUDAR_PRECO == true){\r\n                        this.MUDAR_PRECO = false; \r\n                        this.calcularCusto();\r\n                    }else{\r\n                        this.MUDAR_PRECO = false; \r\n                    }\r\n                }\r\n            }           \r\n\r\n        },\r\n        keyupQuantidade : function(){\r\n\r\n            if(!(this.ConsultaModelo.selected == null) && !(this.ConsultaCor.selected == null) && !(this.ConsultaTamanho.selected == null)){\r\n                this.calcularCusto();\r\n            }\r\n        },\r\n        keyupValor : function(){\r\n\r\n            if(!(this.ConsultaModelo.selected == null) && !(this.ConsultaCor.selected == null) && !(this.ConsultaTamanho.selected == null)){\r\n                this.calcularCusto();\r\n            }\r\n        }\r\n    };\r\n\r\n    var contador = 0;\r\n    ItenCusto.prototype.getNew = function(){\r\n        var that = this;\r\n        var item = angular.copy(obj_item);\r\n\r\n        var id = contador;//gScope.ListaItens.length;\r\n\r\n        item.id = id;\r\n        item.Ficha.PAI = item; \r\n\r\n        //this.Lista.push(item);\r\n        //gScope.ListaItens.push(item);\r\n\r\n        gScope.ListaItens.push(item);\r\n\r\n        item.SelectModelo_1 = 0;\r\n        item.SelectModelo_2 = 0;\r\n\r\n        gScope.scope.$watch('vm.ListaItens['+id+'].PrecoVenda', function (newValue, oldValue, scope) {\r\n            if(newValue != oldValue){\r\n                gScope.Frete.CALCULADO = false;\r\n            }\r\n        }, true);\r\n\r\n        //var obj = $('.container-consulta-itens');\r\n        //id = $(obj).length;\r\n\r\n        item.Ficha.PRODUTO_TROCA = '';\r\n\r\n        item.ConsultaModelo = this.Consulta.getNew(true);\r\n        item.ConsultaModelo.componente                  = '.consulta-modelo-'+id;\r\n        item.ConsultaModelo.option.class                = 'modeloctrl1-'+id;\r\n        item.ConsultaModelo.model                       = 'itemCusto.ConsultaModelo';\r\n        item.ConsultaModelo.option.label_descricao      = 'Modelo:';\r\n        item.ConsultaModelo.option.obj_consulta         = '/_31010/Consultar';\r\n        item.ConsultaModelo.option.tamanho_input        = 'input-medio';\r\n        item.ConsultaModelo.option.tamanho_tabela       = 240;\r\n        item.ConsultaModelo.autoload                    = false;\r\n        item.ConsultaModelo.option.paran                 = {MERCADO: gScope.ConsultaPadrao.item.dados}; \r\n\r\n        item.ConsultaCor = this.Consulta.getNew(true);\r\n        item.ConsultaCor.componente                      = '.consulta-cor-'+id;\r\n        item.ConsultaCor.option.class                    = 'modeloctrl2-'+id;\r\n        item.ConsultaCor.model                           = 'itemCusto.ConsultaCor';\r\n        item.ConsultaCor.option.label_descricao          = 'Cor:';\r\n        item.ConsultaCor.option.obj_consulta             = '/_31010/ConsultarCor';\r\n        item.ConsultaCor.option.tamanho_input            = 'input-medio';\r\n        item.ConsultaCor.option.tamanho_tabela           = 240;\r\n        item.ConsultaCor.autoload                        = false;\r\n        item.ConsultaCor.option.paran = {'PADRAO': 0};\r\n\r\n        item.ConsultaTamanho = this.Consulta.getNew(true);\r\n        item.ConsultaTamanho.componente                  = '.consulta-tamanho-'+id;\r\n        item.ConsultaTamanho.option.class                = 'modeloctrl3-'+id;\r\n        item.ConsultaTamanho.model                       = 'itemCusto.ConsultaTamanho';\r\n        item.ConsultaTamanho.option.label_descricao      = 'Tamanho:';\r\n        item.ConsultaTamanho.option.obj_consulta         = '/_31010/ConsultarTamanho';\r\n        item.ConsultaTamanho.option.tamanho_input        = 'input-menor';\r\n        item.ConsultaTamanho.option.obj_ret              = ['DESCRICAO'];\r\n        item.ConsultaTamanho.option.tamanho_tabela       = 150;\r\n        item.ConsultaTamanho.autoload                    = false;\r\n        item.ConsultaTamanho.option.paran = {'PADRAO': 0};\r\n\r\n        item.ConsultaModelo.disable(!gScope.ConsultaPadrao.item.selected);\r\n        item.ConsultaCor.disable(!gScope.ConsultaPadrao.item.selected);\r\n        item.ConsultaTamanho.disable(!gScope.ConsultaPadrao.item.selected);\r\n\r\n        item.ConsultaModelo.onClear = function(){\r\n            item.Ficha.PRODUTO_TROCA = '';\r\n            item.Ficha.LST_TROCA     = [];\r\n        }\r\n\r\n        item.ConsultaCor.onClear = function(){\r\n            item.Ficha.PRODUTO_TROCA = '';\r\n            item.Ficha.LST_TROCA     = [];\r\n        }\r\n\r\n        item.ConsultaTamanho.onClear = function(){\r\n            item.Ficha.PRODUTO_TROCA = '';\r\n            item.Ficha.LST_TROCA     = [];\r\n        }\r\n\r\n        item.ConsultaModelo.onSelect = function(){\r\n\r\n            item.Ficha.PRODUTO_TROCA = '';\r\n            item.Ficha.LST_TROCA     = [];\r\n\r\n            gScope.Frete.CALCULADO = false;\r\n\r\n            item.SelectModelo_1 = 0;\r\n            item.SelectModelo_2 = 0;\r\n\r\n            if(item.ConsultaModelo.item.dados.COR_ID >= 0){\r\n                item.ConsultaCor.option.paran = {'PADRAO': 1};\r\n                item.ConsultaCor.filtrar();\r\n            }else{\r\n                showAlert('Modelo sem cor padrão');\r\n\r\n            }\r\n            \r\n            if(item.ConsultaModelo.item.dados.TAMANHO >= 0){\r\n                item.ConsultaTamanho.option.paran = {'PADRAO': 1};\r\n                item.ConsultaTamanho.filtrar();\r\n            }else{\r\n                showAlert('Modelo sem tamanho padrão');                \r\n            }\r\n        }\r\n\r\n        item.ConsultaCor.onSelect = function(){\r\n\r\n            item.Ficha.PRODUTO_TROCA = '';\r\n            item.Ficha.LST_TROCA     = [];\r\n\r\n            gScope.Frete.CALCULADO = false;\r\n\r\n            item.Ficha.FLAG_FICHA = 0;\r\n\r\n            item.SelectModelo_1 = 1;\r\n            item.ConsultaCor.option.paran = {'PADRAO': 0};\r\n\r\n            if(item.ConsultaModelo.item.selected == true && item.ConsultaTamanho.item.selected == true){\r\n                item.consultarTempo();\r\n            }\r\n        }\r\n\r\n        item.ConsultaTamanho.onSelect = function(){\r\n\r\n            item.Ficha.PRODUTO_TROCA = '';\r\n            item.Ficha.LST_TROCA     = [];\r\n\r\n            gScope.Frete.CALCULADO = false;\r\n\r\n            item.Ficha.FLAG_FICHA = 0;\r\n\r\n            item.SelectModelo_2 = 1;\r\n            item.ConsultaTamanho.option.paran = {'PADRAO': 0};\r\n\r\n            if(item.ConsultaModelo.item.selected == true && item.ConsultaCor.item.selected == true){\r\n                item.consultarTempo();\r\n            }\r\n        }\r\n\r\n        $timeout(function(){\r\n\r\n            item.ConsultaModelo.compile();\r\n            item.ConsultaCor.compile();\r\n            item.ConsultaTamanho.compile();\r\n\r\n            item.ConsultaCor.require = item.ConsultaModelo;\r\n            item.ConsultaCor.vincular();\r\n\r\n            item.ConsultaTamanho.require = item.ConsultaModelo;\r\n            item.ConsultaTamanho.vincular();\r\n\r\n        });\r\n\r\n        contador = contador + 1;\r\n\r\n        return item;\r\n    }\r\n\r\n    return ItenCusto;\r\n};","angular\n    .module('app')\n    .factory('Filtro', Filtro);\n    \n\n\tFiltro.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$rootScope',\n        '$q',\n        '$timeout',\n        'gcCollection',\n        'gScope'\n    ];\n\nfunction Filtro($ajax, $httpParamSerializer, $rootScope, $q, $timeout, gcCollection, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Filtro(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n\t\tgScope.Filtro = this; \n        \n        this.CODIGO_BARRAS = '';\n    }\n    \n    Filtro.prototype.consultar = function() {\n        \n        var that = this;\n        \n        return $q(function(resolve,reject){\n\n            $ajax.post('/_15090/api/conferencia/itens',that).then(function(response){\n\n                that.merge(response);\n\n                resolve(response);\n            },function(){\n                reject(reject);\n            });\n        });\n    };\n   \n    \n    Filtro.prototype.merge = function(response) {\n        \n        function isNumber(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        for ( var i in response ) {\n            var item = response[i];\n            \n            for (var k in item){\n                if (item.hasOwnProperty(k)) {\n                    \n                    if ( isNumber(item[k]) && (String(item[k]).substr(0, 1) !== '0' || String(item[k]).indexOf('.') !== -1) ) {               \n                        item[k] = parseFloat(item[k]);\n                    }\n                }\n            }            \n        }\n        \n        gcCollection.merge(gScope.Conferencia.DADOS, response, [\n            'PRODUTO_ID',\n            'TAMANHO',\n            'PECA_ID'\n        ]);\n\n        for ( var i in gScope.Conferencia.DADOS ) {\n            var item = gScope.Conferencia.DADOS[i];\n            \n            item.CONFERIR = item.CONFERENCIA;\n        }\n\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Filtro;\n};","angular\n    .module('app')\n    .value('gScope', {})\n    .controller('Ctrl', Ctrl);\n    \n    \n\tCtrl.$inject = [\n        '$scope',\n        '$timeout',\n        'Modelo',\n        'Cor',\n        'Tamanho',\n        'Ficha',\n        'ItenCusto',\n        'gScope',\n        '$compile',\n        '$consulta',\n        '$ajax',\n        '$q',\n        '$rootScope'\n    ];\n\n\tfunction Ctrl( \n        $scope, \n        $timeout, \n        Modelo, \n        Cor,\n        Tamanho,\n        Ficha,\n        ItenCusto,\n        gScope,\n        $compile,\n        $consulta,\n        $ajax,\n        $q,\n        $rootScope\n    ) {\n\n\tvar vm = this;\n\n    gScope.scope = $scope;\n\n    vm.ID = 0;\n    vm.Descricao = '';\n\n    vm.MARGEM = 100;\n    gScope.MARGEM = vm.MARGEM;\n\n    vm.ListaItens = [];\n    gScope.ListaItens = vm.ListaItens;\n\n    vm.Item       = {};\n    vm.MarckUp    = 0;\n    vm.MargemContribuicao = 0;\n    vm.Comicao    = 0;\n    vm.Total      = {\n        Quantidade: 0,\n        Custo:0,\n        CustoT : 0,\n        UnidadeMedida: '',\n        Venda : 0,\n        Despesa: 0\n    };\n\n    vm.FLAG_RECALCULAR = false;\n\n    vm.PERC_FATURAMENTO = {\n        VALOR : 0,\n        FLAG  : 0\n    };\n\n    gScope.PERC_FATURAMENTO = vm.PERC_FATURAMENTO;\n\n    vm.DataInvalida = true;\n\n    gScope.Item    = vm.Item;\n    gScope.Total   = vm.Total;\n    gScope.MarckUp = vm.MarckUp;\n\n    vm.Lista = {\n        MODELO : [],\n        COR    : [],\n        TAMANHO: [],\n        FICHA  : []\n    };\n\n    vm.LISTA_ANO  = [];\n    vm.LISTA_MES  = [];\n    vm.LISTA_ANO2 = [];\n    vm.LISTA_MES2 = [];\n\n    vm.DATA = {\n        ANO : 0,\n        MES : 0,\n        ANO2: 0,\n        MES2: 0\n    };\n\n    vm.Filtro  = new Filtro();\n    vm.Modelo  = new Modelo();\n    vm.Cor     = new Cor();\n    vm.Tamanho = new Tamanho();\n    vm.Ficha   = new Ficha();\n    vm.Custo   = new ItenCusto();\n\n    vm.Fatores = {\n        Frete: {\n            Tipo: 'FOB',\n            Valor: 0\n        },\n        ConsiderarPerdas: true,\n        MarckUp: 100,\n    }\n\n    gScope.Fatores = vm.Fatores;\n    gScope.DATA    = vm.DATA;\n\n    vm.Frete = {\n        DADOS : [],\n        CALCULADO : false,\n        PERCENTUAL: 0\n    };\n\n    gScope.Frete = vm.Frete;\n\n    vm.FRETES = [];\n    vm.FRETES.push({Tipo: 'FOB', Valor: 0});\n    vm.FRETES.push({Tipo: 'CIF - Rodoviário', Valor: 200});\n    vm.FRETES.push({Tipo: 'CIF - Aéreo', Valor: 500});\n\n    function init(){\n\n        var id = $('._id_simulacao').val();\n\n        vm.consultarIncentivo();\n\n        vm.MontarListaMes();\n        vm.MontarListaAno();\n        vm.MontarListaMes2();\n        vm.MontarListaAno2();\n\n        vm.CalcularMeses();\n\n        if(id > 0){\n            vm.ID = id;\n\n            vm.ConsultaSimular.selected.DESCRICAO = '';\n            vm.ConsultaSimular.selected.ID        = id;\n\n            vm.Simulacao().then(function(){\n                \n            });\n\n        }\n    }\n\n    function pad(n, width, z) {\n       z = z || '0';\n       n = n + '';\n       return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n    }\n\n\n    vm.ReplicarTamanhos = function(item){\n\n        var tamanhos = item.ConsultaTamanho.selected.LISTA   + '';\n        var replicas = item.ConsultaTamanho.selected.REPLICA + '';\n\n        var res = tamanhos.split(\",\");\n        var rep = replicas.split(\"#@#\");\n\n        angular.forEach(rep, function(iten, key) {\n            \n            var res = iten.split(\"#$#\");\n\n            var dados = {\n                REPLICA   : '',\n                LISTA     : res[0],\n                ID        : res[1],\n                GRADE_ID  : res[2],\n                DESCRICAO : res[3],\n            };\n\n            vm.Custo.getNew(true);\n\n            var obj = gScope.ListaItens[gScope.ListaItens.length - 1];\n\n            obj.ConsultaModelo.setSelected(  angular.copy(item.ConsultaModelo.selected)  , angular.copy(item.ConsultaModelo.Input.value)  );\n            obj.ConsultaCor.setSelected(     angular.copy(item.ConsultaCor.selected)     , angular.copy(item.ConsultaCor.Input.value)     );\n            obj.ConsultaTamanho.setSelected( dados , res[3]);\n\n            obj.CALCULADO = 0;\n            obj.consultarTempo(1);\n\n        });\n\n        //vm.RemoverItem(item);\n\n    }\n\n    vm.Simulacao = function(){\n\n        return $q(function(resolve,reject){\n\n            var ds = {\n                    ID : vm.ConsultaSimular.selected.ID\n                };\n\n            $ajax.post('/_31010/Simulacao',ds,{contentType: 'application/json'})\n                .then(function(response) {\n\n                    vm.ListaItens = [];\n                    gScope.ListaItens = [];\n\n                    vm.add_confime = 1;\n                    \n                    if(response.PARAMETROS.length > 0){\n\n                        var paran = response.PARAMETROS[0];\n\n                        paran.MERCADO           = paran.MERCADO         == null ? '{}' : paran.MERCADO; \n                        paran.MERCADO_ITENS     = paran.MERCADO_ITENS   == null ? '{}' : paran.MERCADO_ITENS; \n                        paran.TRANSPORTADORA    = paran.TRANSPORTADORA  == null ? '{}' : paran.TRANSPORTADORA; \n                        paran.CLIENTE           = paran.CLIENTE         == null ? '{}' : paran.CLIENTE; \n                        paran.CIDADE            = paran.CIDADE          == null ? '{}' : paran.CIDADE; \n                        paran.FRETE             = paran.FRETES          == null ? '{}' : paran.FRETES; \n                        paran.DATAS             = paran.DATAS           == null ? '{}' : paran.DATAS; \n                        paran.FATORES           = paran.FATORES         == null ? '{}' : paran.FATORES; \n                        paran.ITENS             = paran.ITENS           == null ? '{}' : paran.ITENS; \n                        paran.MARGEM            = paran.MARGEM          == null ? 0    : Number(paran.MARGEM); \n                        paran.ID                = paran.ID              == null ? 0    : Number(paran.ID); \n                        paran.DESCRICAO         = paran.DESCRICAO       == null ? ''   : paran.DESCRICAO; \n\n                        var MERCADO         = JSON.parse(paran.MERCADO);\n                        var MERCADO_ITENS   = JSON.parse(paran.MERCADO_ITENS);\n                        var TRANSPORTADORA  = JSON.parse(paran.TRANSPORTADORA);\n                        var CLIENTE         = JSON.parse(paran.CLIENTE);\n                        var CIDADE          = JSON.parse(paran.CIDADE);\n                        var FRETE           = JSON.parse(paran.FRETE);\n                        var DATAS           = JSON.parse(paran.DATAS);\n                        var FATORES         = JSON.parse(paran.FATORES);\n                        var ITENS           = JSON.parse(paran.ITENS);\n                        var MARGEM          = paran.MARGEM;\n                        var DESCRICAO       = paran.DESCRICAO;\n\n                        vm.ConsultaPadrao.setSelected(MERCADO);\n                        vm.Consultatransportadora.setSelected(TRANSPORTADORA);\n                        vm.ConsultaCliente.setSelected(CLIENTE);\n                        vm.ConsultaCidade.setSelected(CIDADE);\n\n                        vm.Descricao    = DESCRICAO;\n                        vm.Frete        = FRETE;\n                        vm.Fatores      = FATORES;\n                        vm.DATA         = DATAS;\n                        vm.PadraoItem   = MERCADO_ITENS;\n                        vm.MARGEM       = MARGEM;\n\n                        gScope.Descricao    = vm.Descricao;\n                        gScope.Frete        = vm.Frete;\n                        gScope.Fatores      = vm.Fatores;\n                        gScope.DATA         = vm.DATA;\n                        gScope.PadraoItem   = vm.PadraoItem;\n                        gScope.MARGEM       = vm.MARGEM;\n\n                        var link = encodeURI(urlhost + '/_31010?SIMULACAO_ID='+paran.ID);\n                        window.history.replaceState(document.title, 'Title', link);\n\n                        vm.ConsultaSimular.setSelected({ID: paran.ID, DESCRICAO: paran.DESCRICAO});\n                    }\n\n                    if(response.ITENS.length > 0){\n                        var itens = response.ITENS[0].VALOR;\n\n                            itens = itens == null ? '{}' : itens;\n                            itens = JSON.parse(itens);\n\n                            angular.forEach(itens, function(iten, key) {\n                                \n                                vm.Custo.getNew(true);\n                                vm.ListaItens = gScope.ListaItens;\n\n                                var obj = vm.ListaItens[vm.ListaItens.length - 1];\n\n                                iten.MODELO             = iten.MODELO         == null ? '{}' : iten.MODELO ; \n                                iten.TAMANHO            = iten.TAMANHO        == null ? '{}' : iten.TAMANHO;  \n                                iten.COR                = iten.COR            == null ? '{}' : iten.COR; \n                                iten.QUANTIDADE         = iten.QUANTIDADE     == null ? 0    : Number(iten.QUANTIDADE); \n                                iten.PRECO_VENDA        = iten.PRECO_VENDA    == null ? 0    : Number(iten.PRECO_VENDA); \n                                iten.MARGEM             = iten.MARGEM         == null ? 0    : Number(iten.MARGEM) ; \n                                iten.PRODUTO_TROCA      = iten.PRODUTO_TROCA  == null ? ''   : iten.PRODUTO_TROCA; \n                                iten.LST_TROCA          = iten.LST_TROCA      == null ? []   : iten.LST_TROCA ;\n\n                                obj.MUDAR_PRECO         = (iten.MUDAR_PRECO == true);\n                                obj.MUDAR_CONTRIBUICAO  = (iten.MUDAR_CONTRIBUICAO == true);\n\n                                obj.Ficha.PRODUTO_TROCA = iten.PRODUTO_TROCA;\n                                obj.Ficha.LST_TROCA     = iten.LST_TROCA;\n                                obj.Quantidade          = iten.QUANTIDADE;\n                                obj.PrecoVenda          = iten.PRECO_VENDA;\n                                obj.Contribuicao        = iten.MARGEM;\n\n                                obj.ConsultaModelo.setSelected(iten.MODELO);\n                                obj.ConsultaCor.setSelected(iten.COR);\n                                obj.ConsultaTamanho.setSelected(iten.TAMANHO);\n\n                                vm.ListaItens[vm.ListaItens.length - 1].CALCULADO = 0;\n                            });\n                     }\n\n                     vm.RecalcularCusto();\n\n                    resolve(true);\n                },function(e){\n                    reject(e);\n                }\n            );\n\n        });    \n    }\n\n    vm.PrecoMedioVenda = function(item){\n\n        return $q(function(resolve,reject){\n\n            var ds = {\n                    TAMANHO : item.ConsultaTamanho.selected,\n                    MODELO  : item.ConsultaModelo.selected,\n                    COR     : item.ConsultaCor.selected,\n                    DATA    : vm.DATA\n                };\n\n            $ajax.post('/_31010/ConsultarPrecoVenda',ds,{contentType: 'application/json'})\n                .then(function(response) {\n                    item.MUDAR_PRECO = true;\n                    item.PrecoVenda  = Number(Number(response).toFixed(2));\n\n                    resolve(true);\n                },function(e){\n                    reject(e);\n                }\n            );\n\n        });    \n    }\n\n    vm.excluirSimulacao = function(){\n\n        if(vm.ConsultaSimular.selected.ID > 0){\n            addConfirme('<h4>Confirmação</h4>',\n                    'Excluir simulação \"'+vm.ConsultaSimular.selected.ID+'-'+vm.ConsultaSimular.selected.DESCRICAO+'\"?',\n                    [obtn_sim,obtn_nao],\n                    [{ret:1,func:function(){\n                        $rootScope.$apply(function(){\n\n                            var ds = {\n                                ID  : vm.ConsultaSimular.selected.ID\n                            };\n\n                        $ajax.post('/_31010/excluirSimulacao',ds,{contentType: 'application/json'})\n                            .then(function(response) {\n\n                                vm.add_confime = 0;\n\n                                vm.ConsultaSimular.apagar();\n\n                                vm.ConsultaSimular.selected = {\n                                    DESCRICAO : '',\n                                    ID        : 0\n                                };\n\n                                var link = encodeURI(urlhost + '/_31010');\n                                window.history.replaceState(document.title, 'Title', link); \n\n                                vm.InitVariaveis();\n\n                                showSuccess('Simulação Excluida!');\n\n                                resolve(true);\n                            },function(e){\n                                reject(e);\n                            }\n                        );                             \n                                 \n                        });\n                    }}]     \n            );\n\n        }else{\n            showErro('Selecione uma simulação');\n        } \n    \n    }\n\n    vm.gravarSimulacao = function(){\n\n\n        return $q(function(resolve,reject){\n\n            if(vm.Descricao != ''){\n                var itens = [];\n\n                vm.ConsultaSimular.selected.DESCRICAO = vm.Descricao;\n\n                angular.forEach(vm.ListaItens, function(iten, key) {\n                    itens.push({\n                        MODELO        : iten.ConsultaModelo.selected,\n                        TAMANHO       : iten.ConsultaTamanho.selected, \n                        COR           : iten.ConsultaCor.selected,\n                        QUANTIDADE    : iten.Quantidade,\n                        PRECO_VENDA   : iten.PrecoVenda,\n                        MARGEM        : iten.Contribuicao,\n                        PRODUTO_TROCA : iten.Ficha.PRODUTO_TROCA,\n                        LST_TROCA     : iten.Ficha.LST_TROCA,\n                        MUDAR_PRECO         : iten.MUDAR_PRECO,\n                        MUDAR_CONTRIBUICAO  : iten.MUDAR_CONTRIBUICAO  \n                    });\n                });  \n\n                var ds = {\n                        MERCADO         : JSON.stringify(vm.ConsultaPadrao.selected),\n                        MERCADO_ITENS   : JSON.stringify(vm.PadraoItem),\n                        TRANSPORTADORA  : JSON.stringify(vm.Consultatransportadora.selected),\n                        CLINETE         : JSON.stringify(vm.ConsultaCliente.selected),\n                        CIDADE          : JSON.stringify(vm.ConsultaCidade.selected),\n                        FRETE           : JSON.stringify(vm.Frete),\n                        DATAS           : JSON.stringify(vm.DATA),\n                        FATORES         : JSON.stringify(vm.Fatores),\n                        MARGEM          : vm.MARGEM,\n                        DESCRICAO       : vm.ConsultaSimular.selected.DESCRICAO,\n                        ID              : vm.ConsultaSimular.selected.ID,\n                        ITENS           : JSON.stringify(itens)\n                    };\n\n                $ajax.post('/_31010/gravarSimulacao',ds,{contentType: 'application/json'})\n                    .then(function(response) {\n\n                        vm.ID = response;\n\n                        vm.add_confime = 1;\n\n                        var link = encodeURI(urlhost + '/_31010?SIMULACAO_ID='+ vm.ID);\n                        window.history.replaceState(document.title, 'Title', link);\n\n                        vm.ConsultaSimular.setSelected({ID: vm.ID , DESCRICAO: vm.ConsultaSimular.selected.DESCRICAO});\n\n                        showSuccess('Simulação gravada!');\n\n                        resolve(true);\n                    },function(e){\n                        reject(e);\n                    }\n                );\n            }else{\n                showErro('Descrição da simulação Inválida');\n            }\n        });    \n    }\n\n    vm.RemoverItem = function(item){\n        angular.forEach(vm.ListaItens, function(iten, key) {\n            if(iten == item){\n                vm.ListaItens.splice(key, 1);\n                vm.Custo.CalcularTotal();\n            }\n        });    \n    }\n\n    vm.MontarListaMes = function(){\n        var data = new Date();\n        var dia = data.getDate();\n        var mes = data.getMonth() + 1;\n        var ano = data.getFullYear();\n        var tmp = 13;\n\n        vm.DATA.MES = pad((mes - 1),2);\n\n        if(vm.DATA.MES == '00'){\n            vm.DATA.MES = '12';\n        }\n\n        for (var i = 0; i < 12; i++) {\n            tmp = tmp - 1; \n            if(tmp > 0){\n                vm.LISTA_MES.push(pad(tmp,2));\n            }\n        }\n    };\n\n\n    vm.MontarListaAno = function(){\n        var data = new Date();\n        var dia = data.getDate();\n        var mes = data.getMonth() + 1;\n        var ano = data.getFullYear();\n\n        vm.DATA.ANO = pad(ano,4);\n\n        if(vm.DATA.MES == '12'){\n           vm.DATA.ANO =  pad((Number(ano) - 1),4);\n        }\n\n        for (var i = 0; i < 10; i++) {\n            vm.LISTA_ANO.push(pad((ano - i),2));\n        }\n    };\n\n    vm.MontarListaMes2 = function(){\n        var data = new Date();\n        var dia = data.getDate();\n        var mes = data.getMonth() + 1;\n        var ano = data.getFullYear();\n        var tmp = 13;\n\n        vm.DATA.MES2 = pad((mes - 1),2);\n\n        if(vm.DATA.MES2 == '00'){\n            vm.DATA.MES2 = '12';\n        }\n\n        for (var i = 0; i < 12; i++) {\n            tmp = tmp - 1; \n            if(tmp > 0){\n                vm.LISTA_MES2.push(pad(tmp,2));\n            }\n        }\n    };\n\n    vm.MontarListaAno2 = function(){\n        var data = new Date();\n        var dia = data.getDate();\n        var mes = data.getMonth() + 1;\n        var ano = data.getFullYear();\n\n        vm.DATA.ANO2 = pad(ano,4);\n\n        if(vm.DATA.MES2 == '12'){\n           vm.DATA.ANO2 =  pad((Number(ano) - 1),4);\n        }\n\n        for (var i = 0; i < 10; i++) {\n            vm.LISTA_ANO2.push(pad((ano - i),2));\n        }\n    };\n\n    vm.CalcularMeses= function(){\n        var ano1 =  vm.DATA.ANO;\n        var ano2 =  vm.DATA.ANO2;\n\n        var mes1 =  vm.DATA.MES;\n        var mes2 =  vm.DATA.MES2;\n\n        var ret = 0;\n\n        if(ano1 <= ano2){\n            if(ano2 == ano1){\n                if(mes2 >= mes1){\n                    ret = new Number(mes2) - Number(mes1);\n                    vm.DataInvalida = false;\n                }else{\n                    vm.DataInvalida = true;\n                }\n            }else{\n                ret = (Number(mes2) + 12) - Number(mes1);\n                vm.DataInvalida = false;\n            }\n        }else{\n            vm.DataInvalida = true;\n        }\n\n        vm.DATA.FATOR = ret + 1;\n\n    };\n\n    vm.keyupMarckUp = function(){\n        angular.forEach(vm.ListaItens, function(item, key) {\n            if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                item.CALCULADO = 0;\n                item.calcularCusto(1);\n            }\n        }); \n    }\n\n    vm.keyupMargem = function(){\n        gScope.MARGEM = vm.MARGEM;\n\n        angular.forEach(vm.ListaItens, function(item, key) {\n            if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                item.CALCULADO = 0;\n                item.calcularCusto(1);\n            }\n        }); \n    }\n\n    vm.keyupComicao = function(){\n        angular.forEach(vm.ListaItens, function(item, key) {\n            if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                item.CALCULADO = 0;\n                item.calcularCusto(1);\n            }\n        }); \n    }\n\n    vm.AdicionarItensCusto = function(){\n\n        if(vm.ListaItens.length == 0){\n            vm.FLAG_RECALCULAR = false;\n        }\n\n        gScope.ListaItens = vm.ListaItens;\n\n        vm.Custo.getNew();\n        //var item = vm.Custo.getNew();\n        //vm.ListaItens.push(item);\n\n        //gScope.ListaItens = vm.ListaItens;\n        //vm.ListaItens     = gScope.ListaItens;\n    }\n\n    $scope.$watch('vm.Fatores.ConsiderarPerdas', function (newValue, oldValue, scope) {\n        if(newValue != oldValue){\n            angular.forEach(vm.ListaItens, function(item, key) {\n                if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                    item.CALCULADO = 0;\n                    item.calcularCusto(1);\n                }\n            }); \n        }\n    }, true);\n\n    $scope.$watch('vm.DATA.ANO', function (newValue, oldValue, scope) {\n        if(newValue != oldValue){\n\n            vm.CalcularMeses();\n\n            vm.FLAG_RECALCULAR = true;\n            vm.Frete.CALCULADO = false;\n        }\n    }, true);\n\n    $scope.$watch('vm.DATA.MES', function (newValue, oldValue, scope) {\n        if(newValue != oldValue){\n\n            vm.CalcularMeses();\n\n            vm.FLAG_RECALCULAR = true;\n            vm.Frete.CALCULADO = false;\n        }\n    }, true);\n\n    $scope.$watch('vm.DATA.ANO2', function (newValue, oldValue, scope) {\n        if(newValue != oldValue){\n\n            vm.CalcularMeses();\n\n            vm.FLAG_RECALCULAR = true;\n            vm.Frete.CALCULADO = false;\n        }\n    }, true);\n\n    $scope.$watch('vm.DATA.MES2', function (newValue, oldValue, scope) {\n        if(newValue != oldValue){\n\n            vm.CalcularMeses();\n\n            vm.FLAG_RECALCULAR = true;\n            vm.Frete.CALCULADO = false;\n        }\n    }, true);\n    \n    vm.DetalharCusto = function(item,flag){\n        if(item.Ficha.ITENS.length > 0){\n\n            $('.img-loading').css('display','block');\n\n            vm.Item = item;\n            gScope.Item = vm.Item;\n            vm.MontarGrafico();\n\n            //vm.Item.Ficha.ConsultarConfiguracao();\n            \n            $('#modal-detalhar').modal();\n\n        }else{\n            showErro('Produto sem dados de Custo');\n        }\n    }\n\n    vm.DetalharNivel = function(item,flag){\n\n        if(flag == 9){\n            vm.Ficha.ConsultarAbsorcao(1);\n            $('#modal-absorcao').modal();\n        }\n\n        if(flag == 8){\n            vm.Ficha.ConsultarProprio(1);\n            $('#modal-proprio').modal();\n        }\n\n        if(flag == 4){\n            //vm.Item.Ficha.consultar(1);\n            $('#modal-materia').modal();\n        }\n\n        if(flag == 7){\n            vm.Item.Ficha.MaoDeObra(1);\n            $('#modal-maodeobra').modal();\n        }\n\n        if(flag == 3){\n            vm.Item.Ficha.Despesa(1);\n            $('#modal-despesas').modal();\n        }\n    }\n\n    vm.export1 = function(tabela,nome){\n        exportTableToCsv(nome, tabela);\n    };\n\n    vm.export2 = function(tabela,nome){\n        exportTableToXls(nome, tabela);\n    };\n\n    vm.Imprimir = function(div,descricao){\n        var user = $('#usuario-descricao').val();\n        var filtro = 'Modelo:' + vm.Item.ConsultaModelo.selected.DESCRICAO + '    Cor:' + vm.Item.ConsultaCor.selected.DESCRICAO + '    Tamanho:' + vm.Item.ConsultaTamanho.selected.DESCRICAO;\n        printHtml(div, 'Custos Gerenciais - ' + descricao, filtro, user, '1.0.0',1,'');\n    }            \n\n    vm.FecharCusto = function(item){\n        $('.google-visualization-orgchart-table').remove();\n    }\n\n    vm.MontarGrafico = function(){\n        \n        google.charts.load('current', {packages:[\"orgchart\"]});\n        google.charts.setOnLoadCallback(drawChart);\n\n        that._controller   = function(){return $('#main').find('[ng-controller]')};\n        var scope = that._controller().scope();\n\n        //$('#chart_div').empty();\n\n        var obj = $('#chart_div');\n        var pai = $(obj).closest('.ficha');\n\n        function drawChart() {\n            var data = new google.visualization.DataTable();\n            data.addColumn('string', 'Name');\n            data.addColumn('string', 'Manager');\n            data.addColumn('string', 'ToolTip');\n\n            var btn01 = '';//<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,01)\">Detalhar</button>';\n            var btn02 = '';//<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,02)\">Detalhar</button>';\n            var btn03 = '<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,03)\">Detalhar</button>';\n            var btn04 = '<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,04)\">Detalhar</button>';\n            var btn05 = '';//'<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,05)\">Detalhar</button>';\n            var btn06 = '';//'<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,06)\">Detalhar</button>';\n            var btn07 = '<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,07)\">Detalhar</button>';\n            var btn08 = '<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,08)\">Detalhar</button>';\n            var btn09 = '<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,09)\">Detalhar</button>';\n            var btn10 = '';//'<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,10)\">Detalhar</button>';\n            var btn11 = '';//'<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,11)\">Detalhar</button>';\n            var btn12 = '';//<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,12)\">Detalhar</button>';\n            var btn13 = '';//'<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,11)\">Detalhar</button>';\n            var btn14 = '';//<button type=\"button\" class=\"btn btn-primary \" ng-click=\"vm.DetalharNivel(vm.Item,12)\">Detalhar</button>';\n\n            // For each orgchart box, provide the name, manager, and tooltip to show.\n\n            var divInicio = '<div style=\"color: red; font-weight: bold; font-size: 16px;\">';\n            var spanInicio = '<span style=\"color: black; font-weight: bold; font-size: 13px;\">';\n            var roll = [\n              [{v:'Gasto'            ,  f:'Gasto'+divInicio+'{{vm.Item.Gasto.Valor | number:5}}<br>'+btn01+'</span></div>'}, '', ''],\n              [{v:'Custo'            ,  f:'Custo'+divInicio+'{{vm.Item.Gasto.Custo.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn02+'</span></div>'}, 'Gasto', ''],\n              [{v:'Despesa'          ,  f:'Despesa'+divInicio+'{{vm.Item.Gasto.Despesa.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Despesa.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn14+'</span></div>'}, 'Gasto', ''],\n              [{v:'Contas'           ,  f:'Contas'+divInicio+'{{vm.Item.Gasto.Despesa.Contas | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Despesa.Contas / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn03+'</span></div>'}, 'Despesa', ''],\n              [{v:'Tributos'         ,  f:'Tributos'+divInicio+'{{vm.Item.Gasto.Despesa.Tributos | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Despesa.Tributos / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn13+'</span></div>'}, 'Despesa', ''],\n              [{v:'MatariaPrima'     ,  f:'Matéria-prima'+divInicio+'{{vm.Item.Gasto.Custo.MateriaPrima.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.MateriaPrima.Valor/ vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn04+'</span></div>'}, 'Direto', ''],\n              [{v:'Direto'           ,  f:'Direto'+divInicio+'{{vm.Item.Gasto.Custo.Direto.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Direto.Valor  / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn05+'</span></div>'}, 'Custo', ''],\n              [{v:'Indireto'         ,  f:'Indireto'+divInicio+'{{vm.Item.Gasto.Custo.Indireto.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Indireto.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn06+'</span></div>'}, 'Custo', ''],\n              [{v:'MaoObraDireta'    ,  f:'Mão de Obra'+divInicio+'{{vm.Item.Gasto.Custo.Direto.MaoObraDireta.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Direto.MaoObraDireta.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn07+'</span></div>'}, 'Direto', ''],\n              [{v:'Proprio'          ,  f:'Próprio'+divInicio+'{{vm.Item.Gasto.Custo.Indireto.Proprio.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Indireto.Proprio.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn08+'</span></div>'}, 'Indireto', ''],\n              [{v:'Absorvido'        ,  f:'Absorvido'+divInicio+'{{vm.Item.Gasto.Custo.Indireto.Absorvido.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Indireto.Absorvido.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn09+'</span></div>'}, 'Indireto', ''],\n              [{v:'CustoSetup'       ,  f:'Custo Setup'+divInicio+'{{vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn10+'</span></div>'}, 'MaoObraDireta', ''],\n              [{v:'CustoOperacional' ,  f:'Custo Operacional'+divInicio+'{{vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn11+'</span></div>'}, 'MaoObraDireta', ''],\n              [{v:'CustoOeSAbsorvido',  f:'Absorvido'+divInicio+'{{vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor2 + vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor2 | number:5}} '+spanInicio+'{{((vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoOperacional.Valor2 + vm.Item.Gasto.Custo.Direto.MaoObraDireta.CustoSetup.Valor2) / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn11+'</span></div>'}, 'MaoObraDireta', '']\n            ];\n\n            angular.forEach(vm.Item.Gasto.Despesa.Itens, function(iten, key) {\n                \n                roll.push([{\n                    v: iten.DESCRICAO, \n                    f: iten.DESCRICAO + divInicio + '{{vm.Item.Gasto.Despesa.Itens['+key+'].VALOR | number:5}} '+spanInicio+'{{(vm.Item.Gasto.Despesa.Itens['+key+'].VALOR / vm.Item.Gasto.Valor) * 100 | number:2}}%<br>'+btn12+'</span></div>'},\n                    'Tributos', '']\n                );               \n\n            });\n\n            data.addRows(roll);\n\n            var chart = new google.visualization.OrgChart(document.getElementById('chart_div'));\n            chart.draw(data, {allowHtml:true});\n\n            $timeout(function(){\n            \n                $('.img-loading').css('display','none');\n                $(obj).replaceWith( $compile($(obj).html())(scope) );\n                $(pai).append('<div style=\"width: 99%; height: 100%;\" id=\"chart_div\"></div>');\n\n                ///$scope.$apply(function () {\n                //    $scope.message = \"Timeout called!\";\n                //});\n\n            },200);\n        }\n    }\n\n    vm.Consulta = new $consulta();\n                \n    vm.Consultatransportadora                        = vm.Consulta.getNew(true);\n    vm.Consultatransportadora.componente             = '.consulta-frete-transportadora';\n    vm.Consultatransportadora.model                  = 'vm.Consultatransportadora';\n    vm.Consultatransportadora.option.label_descricao = 'Transportadora:';\n    vm.Consultatransportadora.option.obj_consulta    = '/_14020/api/transportadora';\n    vm.Consultatransportadora.option.tamanho_input   = 'input-maior';\n    vm.Consultatransportadora.option.campos_tabela   = [['TRANSPORTADORA_ID', 'Id'],['RAZAOSOCIAL','Razão Social'],['NOMEFANTASIA', 'Nome Fantasia'],['CLASSIFICACAO','CLASSIFICAÇÃO']];\n    vm.Consultatransportadora.option.obj_ret         = ['TRANSPORTADORA_ID','RAZAOSOCIAL','CLASSIFICACAO'];\n    vm.Consultatransportadora.option.required        = true;\n    vm.Consultatransportadora.compile();\n\n    vm.Consultatransportadora.onSelect = function() {\n        vm.Frete.CALCULADO = false;\n    };\n\n    vm.Consultatransportadora.onClear = function() {\n        vm.Frete.CALCULADO = false;\n    };  \n\n    vm.ConsultaCliente                        = vm.Consulta.getNew(true);\n    vm.ConsultaCliente.componente             = '.consulta-cliente';\n    vm.ConsultaCliente.model                  = 'vm.ConsultaCliente';\n    vm.ConsultaCliente.option.label_descricao = 'Cliente:';\n    vm.ConsultaCliente.option.obj_consulta    = '/_14020/api/cliente';\n    vm.ConsultaCliente.option.tamanho_input   = 'input-maior';\n    vm.ConsultaCliente.option.tamanho_tabela  = 780;\n    vm.ConsultaCliente.option.campos_tabela   = [['ID', 'Id'],['RAZAOSOCIAL','Razão Social'],['NOMEFANTASIA', 'Nome Fantasia'],['UF','UF'],['CIDADE','Cidade']];\n    vm.ConsultaCliente.option.obj_ret         = ['ID','RAZAOSOCIAL'];\n    vm.ConsultaCliente.option.required        = false;\n    vm.ConsultaCliente.compile();\n\n    vm.ConsultaCliente.onSelect = function() {\n        vm.Frete.CALCULADO = false;\n        vm.ConsultaCidade.setSelected({ID: 0, DESCRICAO: vm.ConsultaCliente.CIDADE, UF: vm.ConsultaCliente.UF, FILTRO: ''}, vm.ConsultaCliente.UF + ' - ' + vm.ConsultaCliente.CIDADE);\n    };\n\n    vm.ConsultaCliente.onClear = function() {\n        vm.Frete.CALCULADO = false;\n\n        if(vm.ConsultaCidade.item.selected == true){\n            vm.ConsultaCidade.apagar(true);\n        }\n    };  \n\n    vm.ConsultaCidade                        = vm.Consulta.getNew(true);\n    vm.ConsultaCidade.componente             = '.consulta-cidade';\n    vm.ConsultaCidade.model                  = 'vm.ConsultaCidade';\n    vm.ConsultaCidade.option.label_descricao = 'Cidade:';\n    vm.ConsultaCidade.option.obj_consulta    = '/_14020/api/cidade';\n    vm.ConsultaCidade.option.campos_tabela   = [['UF', 'UF'],['DESCRICAO','Cidade']];\n    vm.ConsultaCidade.option.obj_ret         = ['UF','DESCRICAO'];\n    vm.ConsultaCidade.option.required        = true;\n    vm.ConsultaCidade.compile();\n\n    vm.ConsultaCidade.onSelect = function() {\n        vm.Frete.CALCULADO = false;\n    };\n\n    vm.ConsultaCidade.onClear = function() {\n        vm.Frete.CALCULADO = false;\n\n        if(vm.ConsultaCliente.item.selected == true){\n            vm.ConsultaCliente.apagar(true);\n        }              \n    };\n\n    vm.ConsultaSimular = vm.Consulta.getNew();\n    vm.ConsultaSimular.componente                  = '.consultar-simulacao';\n    vm.ConsultaSimular.option.class                = 'consultar-simulacao-class';\n    vm.ConsultaSimular.model                       = 'vm.ConsultaSimular';\n    vm.ConsultaSimular.option.label_descricao      = 'Simulação:';\n    vm.ConsultaSimular.option.obj_consulta         = '/_31010/ConsultarSimulacao';\n    vm.ConsultaSimular.option.tamanho_input        = 'input-maior';\n    vm.ConsultaSimular.option.campos_tabela        = [['ID','ID'],['DESCRICAO','DESCRIÇÃO'],['DATA_HORA','DATA']];\n    vm.ConsultaSimular.option.tamanho_tabela       = 690;\n    vm.ConsultaSimular.autoload                    = false;\n    vm.ConsultaSimular.compile();\n\n\n    vm.ConsultaSimular.selected = {\n        DESCRICAO : '',\n        ID        : 0\n    };\n\n    vm.ConsultaSimular.onSelect= function(){\n\n        if(vm.ConsultaSimular.selected.ID > 0){\n\n            vm.Descricao = vm.ConsultaSimular.selected.DESCRICAO;\n            vm.ID        = vm.ConsultaSimular.selected.ID;\n\n            vm.Simulacao().then(function(){\n                \n            });\n        }\n    }\n\n    vm.add_confime = 0;\n\n    vm.ConsultaSimular.onClear = function(){\n\n        if(vm.add_confime > 0){\n\n            vm.add_confime = 0;\n\n            addConfirme('<h4>Confirmação</h4>',\n                    'Limpar itens da simulação?',\n                    [obtn_sim,obtn_nao],\n                    [{ret:1,func:function(){\n                        $rootScope.$apply(function(){\n\n                            vm.InitVariaveis();                               \n                                 \n                        });\n                    }}]     \n            );\n        };\n\n        vm.Descricao    = '';\n        vm.ID = 0;\n        vm.ConsultaSimular.selected = {\n            DESCRICAO : '',\n            ID        : 0\n        };\n\n        var link = encodeURI(urlhost + '/_31010');\n        window.history.replaceState(document.title, 'Title', link); \n    }\n    \n    vm.InitVariaveis = function(){\n        vm.ConsultaPadrao.apagar();\n        vm.Consultatransportadora.apagar();\n        vm.ConsultaCliente.apagar();\n        vm.ConsultaCidade.apagar();\n        vm.ListaItens = []; \n\n        vm.Descricao    = '';\n        \n        vm.Frete = {\n            DADOS : [],\n            CALCULADO : false,\n            PERCENTUAL: 0\n        };\n\n        vm.Fatores = {\n            Frete: {\n                Tipo: 'FOB',\n                Valor: 0\n            },\n            ConsiderarPerdas: true,\n            MarckUp: 100,\n        };\n\n        vm.DATA = {\n            ANO : 0,\n            MES : 0,\n            ANO2: 0,\n            MES2: 0\n        };\n\n        vm.MontarListaMes();\n        vm.MontarListaAno();\n        vm.MontarListaMes2();\n        vm.MontarListaAno2();\n        vm.CalcularMeses();\n\n        vm.PadraoItem = {};\n        vm.MARGEM     = 100;\n\n        gScope.Descricao    = vm.Descricao;\n        gScope.Frete        = vm.Frete;\n        gScope.Fatores      = vm.Fatores;\n        gScope.DATA         = vm.DATA;\n        gScope.PadraoItem   = vm.PadraoItem;\n        gScope.MARGEM       = vm.MARGEM;\n    }\n\n    vm.ConsultaPadrao = vm.Consulta.getNew(true);\n    vm.ConsultaPadrao.componente                  = '.consulta-padrao';\n    vm.ConsultaPadrao.option.class                = 'custo-padrao';\n    vm.ConsultaPadrao.model                       = 'vm.ConsultaPadrao';\n    vm.ConsultaPadrao.option.label_descricao      = 'Mercado:';\n    vm.ConsultaPadrao.option.obj_consulta         = '/_31010/custoPadrao';\n    vm.ConsultaPadrao.option.tamanho_input        = 'input-maior';\n    vm.ConsultaPadrao.option.campos_tabela        = [['ID','ID'],['FAMILIA_DESCRICAO','FAMÍLIA'],['DESCRICAO','DESCRIÇÃO']];\n    vm.ConsultaPadrao.option.tamanho_tabela       = 690;\n    vm.ConsultaPadrao.autoload                    = false;\n    vm.ConsultaPadrao.compile();\n\n    vm.ConsultaProduto = vm.Consulta.getNew(true);\n    vm.ConsultaProduto.componente                  = '.consulta-produto';\n    vm.ConsultaProduto.option.class                = 'produt-troca';\n    vm.ConsultaProduto.model                       = 'vm.ConsultaProduto';\n    vm.ConsultaProduto.option.label_descricao      = 'Produto:';\n    vm.ConsultaProduto.option.obj_consulta         = '/_31010/consultarProduto';\n    vm.ConsultaProduto.option.tamanho_input        = 'input-maior';\n    vm.ConsultaProduto.option.campos_tabela        = [['ID','ID'],['DESCRICAO','DESCRIÇÃO']];\n    vm.ConsultaProduto.option.tamanho_tabela       = 436;\n    vm.ConsultaProduto.autoload                    = false;\n    vm.ConsultaProduto.option.paran                = {MERCADO: vm.ConsultaPadrao.item.dados}; \n    vm.ConsultaProduto.compile();\n\n    vm.ConsultaTamanho = vm.Consulta.getNew(true);\n    vm.ConsultaTamanho.componente                  = '.consulta-tamanho';\n    vm.ConsultaTamanho.option.class                = 'produt-troca';\n    vm.ConsultaTamanho.model                       = 'vm.ConsultaTamanho';\n    vm.ConsultaTamanho.option.label_descricao      = 'Tamanho:';\n    vm.ConsultaTamanho.option.obj_consulta         = '/_31010/ConsultarTamanho2';\n    vm.ConsultaTamanho.option.tamanho_input        = 'input-medio';\n    vm.ConsultaTamanho.option.campos_tabela        = [['ID','ID'],['DESCRICAO','DESCRIÇÃO']];\n    vm.ConsultaTamanho.option.tamanho_tabela       = 436;\n    vm.ConsultaTamanho.autoload                    = false;\n    vm.ConsultaTamanho.option.paran                = {PRODUTO: {GRADE_CODIGO : 0}}; \n    vm.ConsultaTamanho.compile();\n\n    vm.ConsultaProduto.onSelect= function(){\n        vm.Item.Ficha.NEW_PRODUTO =  vm.ConsultaProduto.item.dados;\n        vm.ConsultaTamanho.option.paran = {PRODUTO: vm.ConsultaProduto.item.dados   , PADRAO: 1};\n\n        vm.Item.Ficha.NEW_PRODUTO.TAMANHO = 0;\n\n        vm.ConsultaTamanho.filtrar();\n    }\n\n    vm.ConsultaTamanho.onSelect= function(){\n        vm.Item.Ficha.NEW_PRODUTO.TAMANHO =  vm.ConsultaTamanho.item.dados.ID;\n        vm.Item.Ficha.NEW_PRODUTO.DESC_TAMANHO =  vm.ConsultaTamanho.item.dados.DESCRICAO;\n        vm.ConsultaTamanho.option.paran   = {PRODUTO: vm.ConsultaProduto.item.dados   , PADRAO: 0};\n    }\n\n    vm.ConsultaProduto.onClear = function(){\n        vm.Item.Ficha.NEW_PRODUTO =  {};\n        vm.ConsultaTamanho.apagar();\n        vm.ConsultaTamanho.option.paran = {PRODUTO: {GRADE_CODIGO : 0, MODELO_ID: 0, TAMANHO: 0}, PADRAO: 0};\n    }\n\n    vm.ConsultaTamanho.onClear = function(){\n        vm.Item.Ficha.NEW_PRODUTO.TAMANHO = 0;\n        vm.Item.Ficha.NEW_PRODUTO.DESC_TAMANHO = '0';\n    }\n\n    gScope.ConsultaProduto = vm.ConsultaProduto;\n    gScope.ConsultaPadrao  = vm.ConsultaPadrao;\n    vm.PadraoItem = {};\n    gScope.PadraoItem = vm.PadraoItem;\n\n    vm.ListaIncentivo = {};\n    vm.consultarIncentivo = function(){\n\n        var ds = {\n                FLAG : 0\n            };\n\n        $ajax.post('/_31010/consultarIncentivo',ds,{contentType: 'application/json'})\n            .then(function(response) {\n                vm.ListaIncentivo = response;\n                gScope.ListaIncentivo = vm.ListaIncentivo;\n            }\n        );\n    };\n\n    vm.consultarPadraoItens = function(){\n\n        var ds = {\n                PADRAO : vm.ConsultaPadrao.item.dados\n            };\n\n        $ajax.post('/_31010/custoPadraoItem',ds,{contentType: 'application/json'})\n            .then(function(response) {\n                vm.PadraoItem = response;\n\n                angular.forEach(vm.PadraoItem, function(item, key) {\n                    \n                    item.FATOR      = Number(item.FATOR);\n                    item.AVOS       = Number(item.AVOS);\n                    item.PERCENTUAL = Number(item.PERCENTUAL);\n                    item.FRETE      = Number(item.FRETE);\n                    item.OLD_FRETE  = Number(item.OLD_FRETE);\n\n                    if(item.USAR_FATOR == 1){\n                        vm.CalcularFator(item);\n                    }else{\n                        item.VALOR      = Number(item.PERCENTUAL);\n                    }\n                });\n\n                gScope.PadraoItem = vm.PadraoItem; \n\n                vm.FLAG_RECALCULAR = true;\n                vm.Frete.CALCULADO = false; \n            }\n        );\n    };\n\n    vm.RecalcularCusto = function(){\n\n        $timeout(function() {\n            vm.FLAG_RECALCULAR = false;\n\n            angular.forEach(vm.ListaItens, function(item, key) {\n                if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                    item.CALCULADO = 0;\n                    item.consultarTempo(1);\n                }\n            });\n        });\n\n    }\n\n    vm.recalcularPadrao = function(){\n        angular.forEach(vm.ListaItens, function(item, key) {\n            if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                item.CALCULADO = 0;\n                item.calcularCusto(1);\n            }\n        });       \n    };\n\n    $scope.$watch('gScope.PadraoItem', function (newValue, oldValue, scope) {\n        if(newValue != oldValue){\n            vm.FLAG_RECALCULAR = true;\n            vm.Frete.CALCULADO = false;\n        }\n    }, true);\n\n    $scope.$watch('vm.Fatores.Incentivo', function (newValue, oldValue, scope) {\n        if(newValue != oldValue){\n            vm.recalcularPadrao();\n        }\n    }, true);\n\n    vm.CalcularFator = function(item) {\n        item.VALOR = ((Number(item.PERCENTUAL) / Number(item.AVOS)) * Number(item.FATOR));\n        vm.recalcularPadrao();\n    }\n\n    vm.ConsultaPadrao.onSelect= function(){\n\n        vm.PERC_FATURAMENTO.VALOR = 0;\n        vm.PERC_FATURAMENTO.FLAG  = 0;\n\n        vm.Fatores.Incentivo = ''+vm.ConsultaPadrao.selected.PERC_INCENTIVO+'';\n\n        vm.ConsultaProduto.option.paran = {MERCADO: vm.ConsultaPadrao.item.dados}; \n\n        vm.PadraoItem = {};\n        vm.consultarPadraoItens();\n\n        angular.forEach(vm.ListaItens, function(item, key) {\n            item.ConsultaModelo.disable(false);\n            item.ConsultaCor.disable(false);\n            item.ConsultaTamanho.disable(false);\n\n            item.ConsultaModelo.option.paran = {MERCADO: gScope.ConsultaPadrao.item.dados}; \n        });\n    };\n\n    vm.ConsultaPadrao.onClear= function(){\n\n        vm.PERC_FATURAMENTO.VALOR = 0;\n        vm.PERC_FATURAMENTO.FLAG  = 0;\n\n        vm.PadraoItem = {};   \n\n        angular.forEach(vm.ListaItens, function(item, key) {\n            item.ConsultaModelo.disable(true);\n            item.ConsultaCor.disable(true);\n            item.ConsultaTamanho.disable(true);\n        });\n    };\n    \n    vm.DetalharFrete = function(){\n        $('#modal-frete').modal();\n    }\n\n    vm.LimparFrete = function(){\n        vm.Frete.PERCENTUAL = 0;\n\n        angular.forEach(vm.PadraoItem, function(item, key) {\n            if(item.FRETE == 1){\n                item.VALOR = item.OLD_FRETE;    \n            }\n        });\n\n        vm.ReprocessarCusto();\n    }\n\n    vm.ReprocessarCusto = function(){\n        angular.forEach(vm.ListaItens, function(item, key) {\n            if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                item.CALCULADO = 0;\n                item.calcularCusto();\n            }\n        });\n    }\n\n    vm.CalcularFrete = function() {\n        \n        var origem    = '';\n        var origem_id = '';\n\n        if( vm.ConsultaCliente.item.selected == true ) {\n                origem = 'SIMULADOR';\n                origem_id = vm.ConsultaCliente.selected.ID;\n            } else {\n                origem    = 'SIMULADOR_CIDADE';\n                origem_id = vm.ConsultaCidade.selected.ID;\n        }\n\n        var itens = [];\n\n        angular.forEach(vm.ListaItens, function(item, key) {\n            if(!(item.ConsultaModelo.selected == null) && !(item.ConsultaCor.selected == null) && !(item.ConsultaTamanho.selected == null)){\n                \n                var tamanhos = item.ConsultaTamanho.selected.LISTA   + '';\n                var replicas = item.ConsultaTamanho.selected.REPLICA + '';\n                \n                var res = tamanhos.split(\",\");\n                var rep = replicas.split(\"#@#\");\n\n                if(res.length > 1){\n                    angular.forEach(rep, function(iten, key) {\n                        \n                        var res = iten.split(\"#$#\");\n\n                        itens.push({\n                            MODELO_ID       : item.ConsultaModelo.selected.ID,\n                            COR_ID          : item.ConsultaCor.selected.ID,\n                            TAMANHO         : res[1],\n                            QUANTIDADE      : (item.Quantidade / rep.length),\n                            VALOR_UNITARIO  : item.PrecoVenda  \n                        });\n\n                    });\n                }else{\n                    itens.push({\n                        MODELO_ID       : item.ConsultaModelo.selected.ID,\n                        COR_ID          : item.ConsultaCor.selected.ID,\n                        TAMANHO         : item.ConsultaTamanho.selected.ID,\n                        QUANTIDADE      : item.Quantidade,\n                        VALOR_UNITARIO  : item.PrecoVenda  \n                    });\n                }\n\n            }\n        }); \n\n        var filtro = {\n            ORIGEM            : origem,\n            ORIGEM_ID         : origem_id,\n            TRANSPORTADORA_ID : vm.Consultatransportadora.selected.TRANSPORTADORA_ID,\n            ITENS             : itens,\n            RETURN            : true\n        };\n\n        return $q(function(resolve, reject){\n            $ajax.post('/_14020/api/frete/calcular',filtro).then(function(response){\n                \n                sanitizeJson(response);\n\n                vm.Frete.DADOS = response;\n\n                vm.Frete.CALCULADO = true;\n\n                vm.Frete.ORIGEM    = vm.Frete.DADOS.ORIGEM;\n                vm.Frete.ORIGEM_ID = vm.Frete.DADOS.ORIGEM_ID;\n\n                vm.Frete.PERCENTUAL = Number(response.VALOR_FINAL) / Number(response.VALOR_TOTAL);\n                vm.Frete.PERCENTUAL = vm.Frete.PERCENTUAL.toFixed(4);\n\n                vm.Frete.DADOS.COMPOSICOES = [\n                    {\n                        DESCRICAO : 'Dados da Carga',\n                        DADOS : response.DADOS_CARGA\n                    },\n                    {\n                        DESCRICAO : 'Composição dos Valores',\n                        DADOS : response.DADOS_COMPOSICAO\n                    }                            \n                ];\n\n                angular.forEach(vm.PadraoItem, function(item, key) {\n                    if(item.FRETE == 1){\n                        item.VALOR = 0;    \n                    }\n                });\n\n\n                vm.ReprocessarCusto();\n                \n                resolve(response);\n            },function(e){\n                reject(e);\n            });\n        });\n    }    \n\n    init();\n\n}   \n  "]}