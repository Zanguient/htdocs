{"version":3,"sources":["_22140.app.js","_22140.factory.familia.js","_22140.factory.gp.js","_22140.factory.up.js","_22140.factory.estacao.js","_22140.factory.filtro.js","_22140.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9tBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_22140.app.js","sourcesContent":["/**\n * _22010 - Registro de Produção\n */\n'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n        'gc-find',\n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils'\n\t])\n;","angular\n    .module('app')\n    .factory('Familia', Familia);\n    \n\n\tFamilia.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$q',\n        '$rootScope',\n        '$filter',\n        'gScope',\n        'gcCollection'\n    ];\n\nfunction Familia($ajax, $httpParamSerializer, $q, $rootScope, $filter, gScope, gcCollection) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Familia(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n        this.DADOS = [];\n        \n        gScope.Familia = this;\n    }\n    \n    \n    /**\n     * Private property\n     */\n    var url_base        = '/_22010/';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n    \n\n    /**\n     * Public method, assigned to prototype\n     */\n    Familia.prototype = {   \n        select : function (familia) {\n            \n            var bool = familia.SELECTED ? false : true;\n            \n            for ( var i in familia.GP ) {\n                \n                var gp = familia.GP[i];\n                \n                for ( var y in gp.ESTACAO ) {\n                    var estacao = gp.ESTACAO[y];\n                    \n                    gScope.Estacao.select(estacao,bool);\n                }\n            }\n        }\n    };\n\n    /**\n     * Private function\n     */\n    function fn (param)\n    {\n    }\n\n    /**\n     * Static property\n     * Using copy to prevent modifications to private property\n     */\n    Familia.possibleRoles = angular.copy(possibleRoles);\n\n    /**\n     * Static method, assigned to class\n     * Instance ('this') is not available in static context\n     */\n    Familia.build = function (data) {\n        \n        if (!checkRole(data.role)) {\n          return;\n        }\n        \n        return new Familia(data);\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Familia;\n};","angular\n    .module('app')\n    .factory('Gp', Gp);\n    \n\n\tGp.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$q',\n        '$rootScope',\n        '$filter',\n        'gScope',\n        'gcCollection'\n    ];\n\nfunction Gp($ajax, $httpParamSerializer, $q, $rootScope, $filter, gScope, gcCollection) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Gp(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n        this.DADOS = [];\n        this.GPS = [];\n        \n        gScope.Gp = this;\n    }\n    \n    \n    /**\n     * Private property\n     */\n    var url_base        = '/_22140/api/programacao/gp';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n    \n    \n    /**\n     * Variável que recebe os valores do talão\n     * @type type\n     */\n    var dados = {};\n\n    /**\n     * Valores para validar o status para iniciar um talão\n     * @type {json}\n     */\n    var status_parado = \n    {\n        status_talao       : [1], // 1 - Em aberto\n        status_programacao : [0,1] // 0 - Parado ; 1 - Iniciado/Parado\n    };\n\n    /**\n     * Valores para validar o status para pausar um talão\n     * @type {json}\n     */\n    var status_andamento =\n    {\n        status_talao       : [1], // 1 - Em aberto\n        status_programacao : [2] // 2 - Em Andamento\n    };\n\n    /**\n     * Coleta ou atualiza da variável dados do talão selecionado\n     * @returns {void}\n     */\n    var dadosTalao = function()\n    {\n        var f = gScope.Filtro;\n        var t = gScope.TalaoProduzir.SELECTED;\n        \n        var estabelecimento_id\t= f.ESTABELECIMENTO_ID;\n        var gp_id\t\t\t\t= f.GP_ID;\n        var up_id\t\t\t\t= f.UP_ID;\n        var estacao\t\t\t\t= f.ESTACAO;\n        var operador_id\t\t\t= $('#_operador-id').val();\n        var remessa_id\t\t\t= t.REMESSA_ID;\n        var remessa_talao_id\t= t.REMESSA_TALAO_ID;\n        var talao_id\t\t\t= t.ID;\n        var programacao_id\t\t= t.PROGRAMACAO_ID;\n        var tempo_realizado\t\t= t.TEMPO_REALIZADO_RELOGIO;\n\n        dados = {\n            estabelecimento_id\t: estabelecimento_id,\n            gp_id\t\t\t\t: gp_id,\n            up_id\t\t\t\t: up_id,\n            estacao\t\t\t\t: estacao,\n            operador_id\t\t\t: operador_id,\n            remessa_id\t\t\t: remessa_id,\n            remessa_talao_id\t: remessa_talao_id,\n            talao_id\t\t\t: talao_id,\n            programacao_id\t\t: programacao_id,\n            tempo_realizado\t\t: tempo_realizado,\n            justificativa_id    : gScope.Gp.API.JUSTIFICATIVA.SELECTED.ID\n        };\n    };\n    \n\n    /**\n     * Public method, assigned to prototype\n     */\n    Gp.prototype = {   \n        select : function (gp) {\n            var bool = gp.SELECTED ? false : true;\n            \n            for ( var i in gp.ESTACAO ) {\n                \n                var estacao = gp.ESTACAO[i];\n                \n                gScope.Estacao.select(estacao,bool);\n            }\n        }\n    };\n    \n\n    Gp.prototype.consultar = function (args) {\n        \n        var that = this;\n        \n        return $q(function(resolve){\n            $ajax.get(url_base).then(function(response){\n                \n                that.GPS = response;\n                \n            });    \n        });\n        \n    };       \n\n    Gp.prototype.calendarioAtualizar = function (args) {\n        \n        var that = this;\n        \n        var data = {\n            DATA : moment(that.DATA).format('YYYY.MM.DD'),\n            HORARIO : that.HORARIO == 'personalizado' ? that.HORARIO_PERSONALIZADO : that.HORARIO,\n            GPS : $filter('filter')(that.GPS, {CHECKED : '1'})\n        };\n        \n        return $q(function(resolve,reject){\n            $ajax.post(url_base+'/calendario/update',data).then(function(response){\n                resolve(response);\n            },function(erro){\n                reject(erro);\n            });    \n        });\n        \n    };       \n\n    /**\n     * Private function\n     */\n    \n    /**\n     * Realiza o registro de inicio do talão selecionado\n     * @param {json} param\n     * @returns {void}\n     */\n    function registraGp (param)\n    {\n        dadosTalao();\n\n        return $q(function(resolve, reject) {\n            execAjax1('POST',param.rota_ajax,dados,\n            function() {\n                resolve(true);\n            },\n            function() {\n                reject(false);\n            });\n        });\n    }\n\n    /**\n     * Realiza a validação do talão\n     * @param {json} param\n     * @returns {void}\n     */\n    function validaTalao (param)\n    {   \n        //Realiza a coleta dos dados do talão selecionado\n        dadosTalao();\n\n        //Realiza a cópia do dados do talão selecionado (mantem o original inalterado)\n        var dadosAjax = $.extend({}, dados);\n        dadosAjax.status_talao       = param.status_talao;\n        dadosAjax.status_programacao = param.status_programacao;\n\n        return $q(function(resolve) {\n            \n                $ajax.post('/_22010/talaoValido', JSON.stringify(dadosAjax), {contentType: 'application/json', progress : false})\n                    .then(function(){\n                        resolve(true);\n                    })\n                ;\n            }, \n            function(error) {\n\n//                new TalaoFiltrar().filtrar();\t//atualiza o status\n                reject(false);\n\n            }\n        );\n    }\n\n    /**\n     * Autenticar UP.\n     * @returns {Promise}\n     */\n    function autenticarUp () {\n\n        return $q(function(resolve, reject) {\n\n            var modal\t\t= $('#modal-autenticar-up');\n            var input_barra = $('#up-barra');\n\n            function consultar() {\n\n                //ajax\n                var type\t= 'POST',\n                    url\t\t= '/_22010/autenticarUp',\n                    data\t= {\n                        up_barra\t\t: $(input_barra).val(),\n                        up_selecionada\t: gScope.Filtro.UP_ID\n                    }\n                ;\n\n                return execAjax1(type, url, data);\n\n            }\n\n            function autenticar() {\n\n                $.when(consultar())\n                    .done(function() {\n                        $(modal).modal('hide');\n                        resolve(true);\n                    })\n                    .fail(function() {\n                        $(input_barra).val('').focus();\n                    })\n                ;\n            }\n\n            $(modal)\n                .modal('show')\n                .off('shown.bs.modal')\n                .on('shown.bs.modal', function () {\n                    $(input_barra).focus();\n                })\n                .off('hidden.bs.modal')\n                .on('hidden.bs.modal', function () {\n                    $(input_barra).val('');\n                })\n                .off('keydown', '#up-barra')\n                .on('keydown', '#up-barra', 'return', function () {\n                    autenticar();\n                })\n                .off('click', '#btn-confirmar-up')\n                .on('click', '#btn-confirmar-up', function () {\n                    autenticar();\n                })\n            ;\n\n        });\n\n    }\n\n\n    /**\n     * Static property\n     * Using copy to prevent modifications to private property\n     */\n    Gp.possibleRoles = angular.copy(possibleRoles);\n\n    /**\n     * Static method, assigned to class\n     * Instance ('this') is not available in static context\n     */\n    Gp.build = function (data) {\n        \n        if (!checkRole(data.role)) {\n          return;\n        }\n        \n        return new Gp(data);\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Gp;\n};","angular\n    .module('app')\n    .factory('Up', Up);\n    \n\n\tUp.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$q',\n        '$rootScope',\n        '$filter',\n        'gScope',\n        'gcCollection'\n    ];\n\nfunction Up($ajax, $httpParamSerializer, $q, $rootScope, $filter, gScope, gcCollection) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Up(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n        this.DADOS = [];\n        \n        gScope.Up = this;\n    }\n    \n    \n    /**\n     * Private property\n     */\n    var url_base        = '/_22010/';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n    \n    \n    /**\n     * Variável que recebe os valores do talão\n     * @type type\n     */\n    var dados = {};\n\n    /**\n     * Valores para validar o status para iniciar um talão\n     * @type {json}\n     */\n    var status_parado = \n    {\n        status_talao       : [1], // 1 - Em aberto\n        status_programacao : [0,1] // 0 - Parado ; 1 - Iniciado/Parado\n    };\n\n    /**\n     * Valores para validar o status para pausar um talão\n     * @type {json}\n     */\n    var status_andamento =\n    {\n        status_talao       : [1], // 1 - Em aberto\n        status_programacao : [2] // 2 - Em Andamento\n    };\n\n    /**\n     * Coleta ou atualiza da variável dados do talão selecionado\n     * @returns {void}\n     */\n    var dadosTalao = function()\n    {\n        var f = gScope.Filtro;\n        var t = gScope.TalaoProduzir.SELECTED;\n        \n        var estabelecimento_id\t= f.ESTABELECIMENTO_ID;\n        var gp_id\t\t\t\t= f.GP_ID;\n        var up_id\t\t\t\t= f.UP_ID;\n        var estacao\t\t\t\t= f.ESTACAO;\n        var operador_id\t\t\t= $('#_operador-id').val();\n        var remessa_id\t\t\t= t.REMESSA_ID;\n        var remessa_talao_id\t= t.REMESSA_TALAO_ID;\n        var talao_id\t\t\t= t.ID;\n        var programacao_id\t\t= t.PROGRAMACAO_ID;\n        var tempo_realizado\t\t= t.TEMPO_REALIZADO_RELOGIO;\n\n        dados = {\n            estabelecimento_id\t: estabelecimento_id,\n            gp_id\t\t\t\t: gp_id,\n            up_id\t\t\t\t: up_id,\n            estacao\t\t\t\t: estacao,\n            operador_id\t\t\t: operador_id,\n            remessa_id\t\t\t: remessa_id,\n            remessa_talao_id\t: remessa_talao_id,\n            talao_id\t\t\t: talao_id,\n            programacao_id\t\t: programacao_id,\n            tempo_realizado\t\t: tempo_realizado,\n            justificativa_id    : gScope.Up.API.JUSTIFICATIVA.SELECTED.ID\n        };\n    };\n    \n\n    /**\n     * Public method, assigned to prototype\n     */\n    Up.prototype = {   \n        iniciar : function (args) {\n            var that            = this;\n            \n\t\t\t/**\n\t\t\t * Verifica se a Estação está ocupada (em produção).\n\t\t\t * @returns {ajax}\n\t\t\t */\n            var verificaEstacaoOcupada = function()\n            {\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Consulta o estado da Estação.\n\t\t\t\t * @returns {ajax}\n\t\t\t\t */\n\t\t\t\tvar consultar = function()\n                {\n\t\t\t\t\tvar dados = {\n\t\t\t\t\t\testabelecimento_id : gScope.Filtro.ESTABELECIMENTO_ID,\n\t\t\t\t\t\tup_id              : gScope.Filtro.UP_ID,\n\t\t\t\t\t\testacao_id         : gScope.Filtro.ESTACAO\n\t\t\t\t\t};\n\n\t\t\t\t\treturn $ajax.post('/_22010/verificarEstacaoAtiva', JSON.stringify(dados), {contentType: 'application/json', progress : false});\t\n\t\t\t\t};\n                \n                return $q(function(resolve, reject) {\n                    consultar()\n                        .then(function(resposta) {\n\n                            //se a estação estiver em produção\n                            if ( resposta[0]['EM_PRODUCAO'].trim() === \"1\" ) {\n                                                             \n\n                                var talao_id\t\t= (typeof resposta[0]['TALAO_ID'   ] == 'string' ) ? resposta[0]['TALAO_ID'   ].trim() : resposta[0]['TALAO_ID'   ];\n                                var operador_id\t\t= (typeof resposta[0]['OPERADOR_ID'] == 'string' ) ? resposta[0]['OPERADOR_ID'].trim() : resposta[0]['OPERADOR_ID'];\n                                var operador_nome\t= pegarPalavra(resposta[0]['OPERADOR_NOME'], 0, 2);\n                                \n\n                                var idx = gScope.indexOfAttr(gScope.TalaoProduzir.DADOS,'ID',talao_id);\n                                gScope.TalaoProduzir.selectionar(gScope.TalaoProduzir.DADOS[idx],true);   \n                                \n                                //colocar operador na área de destaque\n                                $('#operador span.valor')\n                                    .text(operador_nome)\n                                ;\n                                $('#_operador-id')\n                                    .val(operador_id)\n                                ;\n\n                                showAlert('A Estação selecionada está em produção com o operador '+ operador_nome +'. O Talão em andamento será Retomado.');\n\n                                resolve(true);\n                            }\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t\t}\n\n                        })\n                    ;\n                });\n\t\t\t};\n            \n\t\t\t\t\t\n            /**\n             * Retorno da função\n             * @param {type} resolve\n             * @param {type} reject\n             * @returns {undefined}\n             */\n            return $q(function(resolve, reject) {\n                verificaEstacaoOcupada()\n                    .then(function(em_producao) {\n                        \n\t\t\t\t\t\t//se estiver em produção, só autentica na função pausar\n\t\t\t\t\t\tif (em_producao == true) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t//pausar\n\t\t\t\t\t\t\tthat.pausar(em_producao)\n\t\t\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t//iniciar (sem autenticar, pois a autenticação está em pausar)\n\t\t\t\t\t\t\t\t\tvalidaTalao(status_parado)\n\t\t\t\t\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t//Registra o início\n\t\t\t\t\t\t\t\t\t\t\tregistraUp({rota_ajax: '/_22010/acao/iniciar'})\n\t\t\t\t\t\t\t\t\t\t\t\t.then(function(){\n\n                                                        gScope.TalaoProduzir.current(true);\n\n\n                                                        resolve(true);\n\n\t\t\t\t\t\t\t\t\t\t\t\t}, \n\t\t\t\t\t\t\t\t\t\t\t\tfunction(error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\treject(false);\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\n\t\t\t\t\t\t}                        \n\t\t\t\t\t\telse {\n\n\t\t\t\t\t\t\t//iniciar\n\t\t\t\t\t\t\tvalidaTalao(status_parado)\n\t\t\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t//dados da autenticação\n\t\t\t\t\t\t\t\t\tvar dados_autenticacao = {\n\n\t\t\t\t\t\t\t\t\t\tmodal_show\t\t: true,\n\t\t\t\t\t\t\t\t\t\tverificar_up\t: gScope.Filtro.UP_ID,\n\t\t\t\t\t\t\t\t\t\tsuccess\t\t\t: function() {\n\n\t\t\t\t\t\t\t\t\t\t\t//Registra o início\n\t\t\t\t\t\t\t\t\t\t\tregistraUp({rota_ajax: '/_22010/acao/iniciar'})\n\t\t\t\t\t\t\t\t\t\t\t\t.then(function(){\n                                                    \n                                                        gScope.TalaoProduzir.current(true);\n\n                                                        resolve(true);\n\n\t\t\t\t\t\t\t\t\t\t\t\t}, \n\t\t\t\t\t\t\t\t\t\t\t\tfunction(error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\treject(false);\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t//se o talão está pausado\n\t\t\t\t\t\t\t\t\tif( gScope.TalaoProduzir.SELECTED.PROGRAMACAO_STATUS == 1 ) {\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t//verifica permissão ps227\n\t\t\t\t\t\t\t\t\t\tif( $('#ps227').val() == '1' ) {\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t//autenticar UP\n\t\t\t\t\t\t\t\t\t\t\tautenticarUp()\n\t\t\t\t\t\t\t\t\t\t\t\t.then(function() {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t//Autenticar operador\n\t\t\t\t\t\t\t\t\t\t\t\t\tautenticacao(dados_autenticacao);\n\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t//Autenticar operador\n\t\t\t\t\t\t\t\t\t\t\tautenticacao(dados_autenticacao);\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t//autenticar UP\n\t\t\t\t\t\t\t\t\t\tautenticarUp()\n\t\t\t\t\t\t\t\t\t\t\t.then(function() {\n\n\t\t\t\t\t\t\t\t\t\t\t\t//Autenticar operador\n\t\t\t\t\t\t\t\t\t\t\t\tautenticacao(dados_autenticacao);\n\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t}\n                    });\t\t\t\t\t\n            });\t\n        },\n        pausar : function (em_producao) {\n            var that = this;\n            return $q(function(resolve, reject) {\n                validaTalao(status_andamento)\n                    .then(function() {\n\n\t\t\t\t\t\tvar dados_autenticacao = {\n\t\t\t\t\t\t\tmodal_show : true,\n                            success    : function() \n                            {\t\t\t\n                                \n                                var registrar = function () {\n                                    //Registra a pausa\n                                    registraUp({rota_ajax: '/_22010/acao/pausar'})\n                                        .then(function(){\n\n                                            if (em_producao !== true) {\n                                                gScope.TalaoProduzir.current(true);\n                                                infoDestaqueLimpar();\n                                                showSuccess('Pausado com sucesso.');                  \n                                            } \n                                            resolve(true);\n\n                                        })\n                                    ;  \n                                };\n                                \n                                registrar();                                 \n                                                              \n                            }\n\t\t\t\t\t\t};\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t//Se estiver em produção, a pausa será seguida de um início, \n\t\t\t\t\t\t//sendo assim precisa verificar a UP.\n\t\t\t\t\t\tif( em_producao ) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdados_autenticacao.verificar_up = gScope.Filtro.UP_ID;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//verifica permissão ps227\n\t\t\t\t\t\t\tif( $('#ps227').val() == '1' ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t//Autenticar UP\n\t\t\t\t\t\t\t\tautenticarUp()\n\t\t\t\t\t\t\t\t\t.then(function() {\n\n\t\t\t\t\t\t\t\t\t\t//Autenticar operador\n\t\t\t\t\t\t\t\t\t\tautenticacao(dados_autenticacao);\n\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t//Autenticar operador\n\t\t\t\t\t\t\t\tautenticacao(dados_autenticacao);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//Autenticar operador\n\t\t\t\t\t\t\tautenticacao(dados_autenticacao);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n                    })\n                ;\n            });            \n        },\n        finalizar : function () {\n            return $q(function(resolve, reject) {\n                validaTalao(status_andamento)\n                    .then(function() {\n                        \n                        //Autenticar operador\n//                        autenticacao(\n//                        {\n//                            modal_show : true,\n//                            success    : function() \n//                            {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n                                //Registra a finalização\n                                registraUp({rota_ajax: '/_22010/acao/finalizar'})\n                                    .then(function(){\n\n                                            var id                 = gScope.TalaoProduzir.SELECTED.ID;\n                                            var operador_id        = $('#_operador-id').val();\n                                            var operador_descricao = $('#operador').find('.valor').text();\n\n                                            var dados = {\n                                                id                  : id,\n                                                operador_id         : operador_id,\n                                                operador_descricao  : operador_descricao\n                                            };\n\n                                            getEtiqueta(dados)\n                                                .then(function(result){\n\n                                                    postprint(result);\n                                                    infoDestaqueLimpar();\n                                                })\n                                                .catch(function(){\n\n                                                    infoDestaqueLimpar();\n                                                })\n                                            ;\n\n                                            //indicar que o talão não está iniciado\n                                            gScope.TalaoProduzir.EM_PRODUCAO = false;\n                                            gScope.TalaoProduzir.SELECTED    = null;\n                                            gScope.Filtro.consultar();\n                                            $(document).scrollTop(0);\n                                            showSuccess('Finalizado com sucesso.');\n\n                                            resolve(true);\n                                    })\n                                ;\n                                \n//                            }\n//                        });\n                    })\n                ;\n            });            \n        },\n        check : function (acao) {\n                        \n            var ret         = {\n                status    : true,\n                descricao : ''\n            };\n            \n            var em_producao = gScope.TalaoProduzir.EM_PRODUCAO || false;\n            var talao       = gScope.TalaoProduzir.SELECTED;\n            \n            switch(acao) {\n                case 'iniciar':\n                    \n                    // Se não estiver na tela de produção\n                    if ( gScope.Filtro.GUIA_ATIVA != 'TALAO_PRODUZIR' ) {\n                        ret.status = false;\n                    } else                 \n                    // Se não houver talao selecionado\n                    if ( talao == undefined ) {\n                        ret.status = false;\n                    } else                    \n                    // Se não houver estacao selecionada\n                    if ( gScope.Filtro.ESTACAO == '' ) {\n                        ret.status = false;\n                        ret.descricao = 'É necessário selecionar uma estação individual para iniciar um talão.';\n                    } else                    \n                    // Se estiver em produção \n                    if ( em_producao ) {\n                        ret.status = false;\n                    } else\n                    // Se houverem consumos não disponíveis\n                    if ( talao.STATUS_MP_CP == '0' ) {\n                        ret.status    = false;\n                        ret.descricao = 'Há consumos com materia prima indisponível';\n                    } else\n                    // Se a remessa estiver fora do prazo para produção\n                    if ( talao.REMESSA_TIPO == '1' ) {\n                        \n                        if ( gScope.Filtro.GP_REMESSA_DIAS >= 0 || $('#_pu212').val() == '0' ) {\n                            var remessas_normais = $filter('filter')(gScope.TalaoProduzir.DADOS,{REMESSA_TIPO : '1'});\n                            var remessas_normais = $filter('orderBy')(remessas_normais,['PROGRAMACAO_DATA', '+DATAHORA_INICIO', 'REMESSA_ID', 'REMESSA_TALAO_ID']);\n\n                            if ( $('#_pu212').val() == '0' ) {\n                                var idx = remessas_normais.indexOf(talao);\n                                \n                                if ( idx > 0 ) {\n                                    ret.status    = false;\n                                    ret.descricao = 'Usuário não possui permissão para quebrar sequenciamento de talões';\n                                }\n                            }\n\n                            if ( gScope.Filtro.GP_REMESSA_DIAS >= 0 ) {\n                                var data_base = remessas_normais[0] != undefined ? remessas_normais[0].REMESSA_DATA : null;\n\n\n                                var data_limite = moment(data_base).add(gScope.Filtro.GP_REMESSA_DIAS, 'days');\n\n                                if ( moment(talao.REMESSA_DATA) > data_limite ) {\n                                    ret.status    = false;\n                                    ret.descricao = 'Remessa fora do prazo permitido de ' + gScope.Filtro.GP_REMESSA_DIAS + ' dias. Produza remessas normais com data até ' + data_limite.format(\"DD/MM\");\n                                }\n                            }\n                        }\n                    }\n                    \n                    break;\n                case 'pausar':\n                    \n                    // Se não estiver na tela de produção\n                    if ( gScope.Filtro.GUIA_ATIVA != 'TALAO_PRODUZIR' ) {\n                        ret.status    = false;\n                    } else                 \n                    if ( talao == undefined ) {\n                        ret.status    = false;\n                        ret.descricao = 'Selecione um talão';\n                    } else                    \n                    // Se estiver em produção \n                    if ( !em_producao ) {\n                        ret.status    = false;\n                    }\n                \n                    break;\n                case 'finalizar':\n                    \n                    // Se não estiver na tela de produção\n                    if ( gScope.Filtro.GUIA_ATIVA != 'TALAO_PRODUZIR' ) {\n                        ret.status    = false;\n                    } else                 \n                    if ( talao == undefined ) {\n                        ret.status    = false;\n                        ret.descricao = 'Selecione um talão';\n                    } else                    \n                    // Se estiver em produção \n                    if ( !em_producao ) {\n                        ret.status    = false;\n                    }\n                \n                    break;\n                case 'imprimir':\n                    \n                    var talao_produzido = gScope.TalaoProduzido.SELECTED;\n                    \n                    \n                    // Se não estiver na tela de produção\n                    if ( gScope.Filtro.GUIA_ATIVA != 'TALAO_PRODUZIDO' ) {\n                        ret.status    = false;\n                    } else                 \n                    if ( talao_produzido == undefined ) {\n                        ret.status    = false;\n                        ret.descricao = 'Selecione um talão';\n                    }\n                    \n                    break;\n            }\n            \n            return ret;\n        },\n        pausarProducao : function () {\n            var that = this;\n            \n            this.API.JUSTIFICATIVA.registrar();\n        },\n        setData : function (data) {\n            angular.extend(this, data);\n        },\n        API : {\n            JUSTIFICATIVA : {\n                DADOS : [],\n                SELECTED : {},\n                consultar : function () {\n                    var that = this;\n                    return $q(function(resolve){\n\n                        $ajax.get('/_22010/api/justificativa').then(function(response){\n                            gcCollection.merge(that.DADOS, response.JUSTIFICATIVA, 'ID');\n                            resolve(true);\n                        });\n                    });\n                    \n                },\n                registrar : function () {\n                    var that = this;\n                    return $q(function(resolve){\n                        \n                        that.consultar().then(function(){\n                            \n                            if ( that.DADOS.length > 0 ) {\n                                $('#modal-parada-justificativa').modal('show');\n\n                                resolve(true);\n                            } else {\n                                that.SELECTED = {};\n                                gScope.Up.pausar().then(function(){\n\n                                    resolve(true);\n                                });\n                            }\n                        });\n                        \n                    });\n                    \n                },\n                selecionar : function ( item ) {     \n                    var that = this;\n                    return $q(function(resolve){\n                        \n                        that.SELECTED = item;\n                        \n                        gScope.Up.pausar().then(function(){\n                            $('#modal-parada-justificativa').modal('hide');\n                            that.SELECTED = {};\n                            resolve(true);\n                        });\n                        \n                    });                                       \n                }\n            }\n        }\n    };\n\n    /**\n     * Private function\n     */\n    \n    /**\n     * Realiza o registro de inicio do talão selecionado\n     * @param {json} param\n     * @returns {void}\n     */\n    function registraUp (param)\n    {\n        dadosTalao();\n\n        return $q(function(resolve, reject) {\n            execAjax1('POST',param.rota_ajax,dados,\n            function() {\n                resolve(true);\n            },\n            function() {\n                reject(false);\n            });\n        });\n    }\n\n    /**\n     * Realiza a validação do talão\n     * @param {json} param\n     * @returns {void}\n     */\n    function validaTalao (param)\n    {   \n        //Realiza a coleta dos dados do talão selecionado\n        dadosTalao();\n\n        //Realiza a cópia do dados do talão selecionado (mantem o original inalterado)\n        var dadosAjax = $.extend({}, dados);\n        dadosAjax.status_talao       = param.status_talao;\n        dadosAjax.status_programacao = param.status_programacao;\n\n        return $q(function(resolve) {\n            \n                $ajax.post('/_22010/talaoValido', JSON.stringify(dadosAjax), {contentType: 'application/json', progress : false})\n                    .then(function(){\n                        resolve(true);\n                    })\n                ;\n            }, \n            function(error) {\n\n//                new TalaoFiltrar().filtrar();\t//atualiza o status\n                reject(false);\n\n            }\n        );\n    }\n\n    /**\n     * Autenticar UP.\n     * @returns {Promise}\n     */\n    function autenticarUp () {\n\n        return $q(function(resolve, reject) {\n\n            var modal\t\t= $('#modal-autenticar-up');\n            var input_barra = $('#up-barra');\n\n            function consultar() {\n\n                //ajax\n                var type\t= 'POST',\n                    url\t\t= '/_22010/autenticarUp',\n                    data\t= {\n                        up_barra\t\t: $(input_barra).val(),\n                        up_selecionada\t: gScope.Filtro.UP_ID\n                    }\n                ;\n\n                return execAjax1(type, url, data);\n\n            }\n\n            function autenticar() {\n\n                $.when(consultar())\n                    .done(function() {\n                        $(modal).modal('hide');\n                        resolve(true);\n                    })\n                    .fail(function() {\n                        $(input_barra).val('').focus();\n                    })\n                ;\n            }\n\n            $(modal)\n                .modal('show')\n                .off('shown.bs.modal')\n                .on('shown.bs.modal', function () {\n                    $(input_barra).focus();\n                })\n                .off('hidden.bs.modal')\n                .on('hidden.bs.modal', function () {\n                    $(input_barra).val('');\n                })\n                .off('keydown', '#up-barra')\n                .on('keydown', '#up-barra', 'return', function () {\n                    autenticar();\n                })\n                .off('click', '#btn-confirmar-up')\n                .on('click', '#btn-confirmar-up', function () {\n                    autenticar();\n                })\n            ;\n\n        });\n\n    }\n\n\n    /**\n     * Static property\n     * Using copy to prevent modifications to private property\n     */\n    Up.possibleRoles = angular.copy(possibleRoles);\n\n    /**\n     * Static method, assigned to class\n     * Instance ('this') is not available in static context\n     */\n    Up.build = function (data) {\n        \n        if (!checkRole(data.role)) {\n          return;\n        }\n        \n        return new Up(data);\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Up;\n};","angular\n    .module('app')\n    .factory('Estacao', Estacao);\n    \n\n\tEstacao.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$q',\n        '$rootScope',\n        '$filter',\n        'gScope',\n        'gcCollection',\n        'gcObject'\n    ];\n\nfunction Estacao($ajax, $httpParamSerializer, $q, $rootScope, $filter, gScope, gcCollection, gcObject) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Estacao(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n        gScope.Estacao = this;\n        \n        this.DADOS = [];\n        this.SELECTEDS = [];\n        \n    }\n    \n    \n    /**\n     * Private property\n     */\n    var url_base        = '_22140/api/programacao-estacao';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n\n    /**\n     * Public method, assigned to prototype\n     */\n    Estacao.prototype = { \n        select : function(estacao, bool) {\n            var that = this;\n        \n            if ( bool != undefined ) {\n                if ( bool ) {\n                    that.SELECTEDS.push(estacao);\n                    estacao.SELECTED = true;\n                } else {\n                    that.SELECTEDS.splice(idx, 1);\n                    estacao.SELECTED = false;\n                }\n            } else {\n            \n                var idx = that.SELECTEDS.indexOf(estacao);\n                if ( idx >= 0 ) {\n                    that.SELECTEDS.splice(idx, 1);\n                    estacao.SELECTED = false;\n                } else {\n                    that.SELECTEDS.push(estacao);\n                    estacao.SELECTED = true;\n                }\n            }\n        },\n        reprocessar : function () {\n            \n            var args = {\n                data_return : true,\n                estacoes    : this.SELECTEDS,\n                data_hora   : moment(gScope.Filtro.DATAHORA).utcOffset(-180).format(),\n                agora       : gScope.Filtro.AGORA,\n                em_producao : gScope.Filtro.EM_PRODUCAO,\n                ordem_data_remessa : gScope.Filtro.ORDEM_DATA_REMESSA\n            };\n            \n            $ajax.post(url_base+'/post',args).then(function(response){\n                \n            });\n        },\n        setValues : function (values) {\n            \n            return $q(function(resolve){\n\n                gcCollection.merge(gScope.Estacao.DADOS, values, ['UP_ID','ESTACAO']);\n\n                var gps = gcCollection.groupBy(gScope.Estacao.DADOS,['FAMILIA_ID','FAMILIA_DESCRICAO','GP_ID','GP_DESCRICAO','UP_ID','UP_DESCRICAO'],'ESTACAO');\n\n                gcCollection.merge(gScope.Gp.DADOS, gps, 'GP_ID');\n\n                var familias = gcCollection.groupBy(gScope.Gp.DADOS, ['FAMILIA_ID','FAMILIA_DESCRICAO'],'GP');\n\n                gcCollection.merge(gScope.Familia.DADOS, familias, 'FAMILIA_ID');\n\n                for ( var i in gScope.Familia.DADOS ) {\n                    var item = gScope.Familia.DADOS[i];\n\n                    gcObject.calcField('SELECTED',item, function(itemScope) {\n\n                        var ret = false;\n                        for ( var y in itemScope.GP ) {\n                            var gp = itemScope.GP[y];\n\n                            if ( gp.SELECTED == true ) {\n                                ret = true;\n                                break;\n                            }\n                        }\n\n                        return ret;\n                    });\t \n                }\n\n                for ( var i in gScope.Gp.DADOS ) {\n                    var item = gScope.Gp.DADOS[i];\n\n                    gcObject.calcField('SELECTED',item, function(itemScope) {\n\n                        var ret = false;\n                        for ( var y in itemScope.ESTACAO ) {\n                            var estacao = itemScope.ESTACAO[y];\n\n                            if ( estacao.SELECTED == true ) {\n                                ret = true;\n                                break;\n                            }\n                        }\n\n                        return ret;\n                    });\t \n                }\n\n                console.log(gScope.Familia);\n                \n                resolve(true);\n            });\n        }\n    };\n\n    /**\n     * Private function\n     */\n    \n    /**\n     * Realiza o registro de inicio do talão selecionado\n     * @param {json} param\n     * @returns {void}\n     */\n    function registraEstacao (param)\n    {\n        dadosTalao();\n\n        return $q(function(resolve, reject) {\n            execAjax1('POST',param.rota_ajax,dados,\n            function() {\n                resolve(true);\n            },\n            function() {\n                reject(false);\n            });\n        });\n    }\n\n    /**\n     * Realiza a validação do talão\n     * @param {json} param\n     * @returns {void}\n     */\n    function validaTalao (param)\n    {   \n        //Realiza a coleta dos dados do talão selecionado\n        dadosTalao();\n\n        //Realiza a cópia do dados do talão selecionado (mantem o original inalterado)\n        var dadosAjax = $.extend({}, dados);\n        dadosAjax.status_talao       = param.status_talao;\n        dadosAjax.status_programacao = param.status_programacao;\n\n        return $q(function(resolve) {\n            \n                $ajax.post('/_22010/talaoValido', JSON.stringify(dadosAjax), {contentType: 'application/json', progress : false})\n                    .then(function(){\n                        resolve(true);\n                    })\n                ;\n            }, \n            function(error) {\n\n//                new TalaoFiltrar().filtrar();\t//atualiza o status\n                reject(false);\n\n            }\n        );\n    }\n\n    /**\n     * Autenticar UP.\n     * @returns {Promise}\n     */\n    function autenticarUp () {\n\n        return $q(function(resolve, reject) {\n\n            var modal\t\t= $('#modal-autenticar-up');\n            var input_barra = $('#up-barra');\n\n            function consultar() {\n\n                //ajax\n                var type\t= 'POST',\n                    url\t\t= '/_22010/autenticarUp',\n                    data\t= {\n                        up_barra\t\t: $(input_barra).val(),\n                        up_selecionada\t: gScope.Filtro.UP_ID\n                    }\n                ;\n\n                return execAjax1(type, url, data);\n\n            }\n\n            function autenticar() {\n\n                $.when(consultar())\n                    .done(function() {\n                        $(modal).modal('hide');\n                        resolve(true);\n                    })\n                    .fail(function() {\n                        $(input_barra).val('').focus();\n                    })\n                ;\n            }\n\n            $(modal)\n                .modal('show')\n                .off('shown.bs.modal')\n                .on('shown.bs.modal', function () {\n                    $(input_barra).focus();\n                })\n                .off('hidden.bs.modal')\n                .on('hidden.bs.modal', function () {\n                    $(input_barra).val('');\n                })\n                .off('keydown', '#up-barra')\n                .on('keydown', '#up-barra', 'return', function () {\n                    autenticar();\n                })\n                .off('click', '#btn-confirmar-up')\n                .on('click', '#btn-confirmar-up', function () {\n                    autenticar();\n                })\n            ;\n\n        });\n\n    }\n\n\n    /**\n     * Static property\n     * Using copy to prevent modifications to private property\n     */\n    Estacao.possibleRoles = angular.copy(possibleRoles);\n\n    /**\n     * Static method, assigned to class\n     * Instance ('this') is not available in static context\n     */\n    Estacao.build = function (data) {\n        \n        if (!checkRole(data.role)) {\n          return;\n        }\n        \n        return new Estacao(data);\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Estacao;\n};","\n        \nangular\n    .module('app')\n    .factory('Filtro', Filtro);\n    \n\n\tFiltro.$inject = [\n        '$ajax',\n        '$httpParamSerializer',\n        '$rootScope',\n        '$timeout',\n        '$q',\n        'gcCollection',\n        'gcObject',\n        'gScope'\n    ];\n\nfunction Filtro($ajax, $httpParamSerializer, $rootScope, $timeout, $q, gcCollection, gcObject, gScope) {\n\n    /**\n     * Constructor, with class name\n     */\n    function Filtro(data) {\n        if (data) {\n            this.setData(data);\n        }\n        \n        this.DADOS = [];\n        \n        gScope.Filtro = this;\n        \n        this.DATAHORA    = moment(Clock.DATETIME_SERVER).seconds(0).milliseconds(0).toDate();\n        this.AGORA       = true;\n        this.EM_PRODUCAO = false;\n    }\n    \n    \n    /**\n     * Private property\n     */\n    var url_base        = '_22140/api/programacao-estacao';\n    var possibleRoles   = ['admin', 'editor', 'guest'];\n\n    /**\n     * Public method, assigned to prototype\n     */\n    Filtro.prototype = {\n        submit : function() {\n            $timeout(function(){\n                $('[type=\"sumbit\"]').click();\n            });\n        },     \n        consultar : function (args) {\n            return $q(function(resolve){\n                $ajax.get(url_base).then(function(response){\n                    \n                    gScope.Estacao.setValues(response).then(function(){    \n                        resolve(response);\n                    });\n                });    \n            });\n        },\n        uriHistory : function() {\n            window.history.replaceState('', '', encodeURI(url_base + '/_22010?'+$httpParamSerializer(this)));\n        },\n        setData: function(data) {\n            angular.extend(this, data);\n        }\n    };\n\n    /**\n     * Private function\n     */\n    function checkRole(role) {\n      return possibleRoles.indexOf(role) !== -1;\n    }\n\n    /**\n     * Static property\n     * Using copy to prevent modifications to private property\n     */\n    Filtro.possibleRoles = angular.copy(possibleRoles);\n\n    /**\n     * Static method, assigned to class\n     * Instance ('this') is not available in static context\n     */\n    Filtro.build = function (data) {\n        \n        if (!checkRole(data.role)) {\n          return;\n        }\n        \n        return new Filtro(data);\n    };\n\n    /**\n     * Return the constructor function\n     */\n    return Filtro;\n};","angular\n    .module('app')\n    .value('gScope', {})\n    .controller('Ctrl', Ctrl);\n    \n    \n\tCtrl.$inject = [\n        '$scope',\n        '$timeout',\n        'gScope',\n        'gcCollection',\n        'Filtro', \n        'Familia', \n        'Gp', \n        'Up', \n        'Estacao'\n    ];\n\n\tfunction Ctrl( $scope, $timeout, gScope, gcCollection, Filtro, Familia, Gp, Up, Estacao ) {\n\n\t\tvar vm = this;\n\n\t\tvm.Filtro   = new Filtro();\n        vm.Familia  = new Familia();\n        vm.Gp       = new Gp();\n        vm.Up       = new Up();\n\t\tvm.Estacao  = new Estacao();\n                \n                \n                \n        /**\n         * Inicializações\n         */\n        function onInit() {\n            vm.Filtro.consultar();\n        }\n        \n        \n        /**\n         * Starta as inicializações\n         */\n        onInit();\n        \n        \n        \n        /***************** INICIO DO BLOCO DE WATCHES ******************/\n        \n        $scope.$on('bs-init', function(ngRepeatFinishedEvent) {\n            bootstrapInit();\n        });\n        \n                        \n        $timeout(function () {\n            $('.recebe-puxador')\n                .resizable({\n                    resize  : function( event, ui ) {\n                        $scope.$apply(function(){\n                            $(document).resize();\n                        });\n\n                    },\n                    handles  : 's',\n                    minHeight : 80\n                })\n            ;\n        }, 500);\n        \n\t\t\t\n        //Aumentar tabela com duplo clique no puxador\n        $(document)\n            .on('dblclick','.ui-resizable-s', function(e) {\n\n                var table = $(this).closest('.ui-resizable');\n\n                if ( $(table).data('original-size') == undefined || $(table).data('original-size') == 0 ) {\n                    $(table).data('original-size',$(table).height());\n                }  \n                \n                var bool = $(table).data('height-full') || false;\n                $(table).data('height-full', ! bool);\n                \n                if ( $(table).data('height-full') == true ) {\n        \n                    var datatable_scrollbody = $(table).find('.table-lc-body');;\n                    var tbody_height\t     = datatable_scrollbody.height(),\n                        window_height\t     = $(window).height(),\n                        vh_context\t\t     = window_height * 0.01,\t//converter px para vh - parte I\n                        tbody_height_vh      = tbody_height / vh_context //converter px para vh - parte II\n                    ;\n\n                    //Se a altura do tbody for maior que 70vh, tbody_height terá 70vh de altura, pois esse é o valor máximo permitido (altura da tela);\n                    //senão, a altura será a altura inicial + 34, que é a altura do cabeçalho da tabela.\n                    if (tbody_height_vh > 70) {\n\n                        var datatable_scroll     = $(table).find('.table-container');\n\n                        tbody_height = '70vh';\n\n                        //Posicionar scroll.\n                        //posição da tabela - altura do cabeçalho - altura da barra de ações - 50\n                        $(document)\n                            .scrollTop( datatable_scroll.offset().top - $('nav.navbar').outerHeight() - $('ul.acoes').outerHeight() - 50 )\n                        ;\n\n                    }\n                    else {\n                        tbody_height = tbody_height + 45;\n                    }\n                \n                    $(table)\n                        .height( tbody_height )\n                    ;\n                } else {\n                    $(table)\n                        .height( $(table).data('original-size') )\n                    ;                    \n                }\n            })\n        ;\n\t}   \n    "]}