{"version":3,"sources":["_13050.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_13050.js","sourcesContent":["/**\n * Script com funções de:\n * - Gerar pdf\n * */\n\n(function($) {\n\n    function addEventBtn(){\n        /**\n         * Autoriza ordem de compra\n         */\n        $('.autorizar-oc2')\n            .click(function(e) {\n\n                e.stopPropagation();\n\n                var id    = $(this).data('oc');\n                var index = $(this).data('index');\n                var that  = this;\n\n                var dados = {ID : id};\n\n                function success(retorno) {\n\n                    if(retorno.Q > 0){\n                        $(that).parent().parent().trigger('click');\n                        showAlert('ITENS COM PENDÊNCIAS DE APROVAÇÃO');\n                    }else{\n                        addConfirme('OC','Deseja realmente autorizar OC:'+id+'?',[obtn_ok,obtn_cancelar],\n                           [\n                               {ret:1,func:function(){\n\n                                    var dados = \n                                    {   id    : id,\n                                        tipo  : '1',\n                                        obs   : '',\n                                        itens : []\n                                    };\n                                    \n                                    $(this).button('loading');\n\n                                    function success() { \n\n                                        showSuccess('OC:'+id+' autorizada.');\n\n                                        $('tr[tabindex=' + index + ']').remove();\n                                        \n                                    }\n\n                                    execAjax1('POST','/_13050/autorizacao',dados,success);\n                               }},\n                               {ret:2,func:function(){\n                                \n                               }}\n                           ]    \n                        ); \n                    } \n\n                }\n\n                execAjax1('POST','/_13050/pendencias',dados,success);\n                \n            })\n        ;\n    } \n\n    /**\n     * Realiza filtros na OC\n     */\n    function filtroOc() {\n        \n        var qtd_por_pag   = 30;\n        var pagina_atual  = 1;\n        var pagina_inc    = 0;\n        var final_pag\t  = false;\n\n        /**\n         * Realiza a coleta dos dados<br/>\n         * Realiza a chamada ajax\n         */\n        function tratarDados() {\n\t\t\t\n\t\t\tif( final_pag ) {\n                pagina_atual = 1;\n                pagina_inc = 0;\n                return false;\n            }\n\n            var campo_pesquisa      = $('.btn-oc-filtro');\n            var campo_pendencia     = $('.filtro-pendencia');\n            var campo_pendentes     = $('.filtro-pendentes');\n            var campo_autorizadas   = $('.filtro-autorizadas');\n            var campo_reprovadas    = $('.filtro-reprovadas');\n            var campo_mes_inicial   = $('.filtro-mes-inicial');\n            var campo_ano_inicial   = $('.filtro-ano-inicial');\n            var campo_mes_final     = $('.filtro-mes-final');\n            var campo_ano_final     = $('.filtro-ano-final');\n\n            var pesquisa      = campo_pesquisa.val();\n            var pendencia     = campo_pendencia.is(\":checked\");\n            var pendentes     = campo_pendentes.is(\":checked\");\n            var autorizadas   = campo_autorizadas.is(\":checked\");\n            var reprovadas    = campo_reprovadas.is(\":checked\");\n            var mes_inicial   = campo_mes_inicial.val();\n            var ano_inicial   = campo_ano_inicial.val();\n            var mes_final     = campo_mes_final.val();\n            var ano_final     = campo_ano_final.val();\n            var data_inicial  = new Date(ano_inicial, mes_inicial-1,01);\n            var data_final    = lastDate(new Date(ano_final, mes_final-1,01));\n            var data_1        = data_inicial.getFullYear()+'.'+(data_inicial.getMonth()+1)+'.'+data_inicial.getDate();\n            var data_2        = data_final  .getFullYear()+'.'+(data_final  .getMonth()+1)+'.'+data_final  .getDate();\n            var dados;\n            \n            dados = {\n                'qtd_por_pagina': qtd_por_pag,\n                'pagina'        : pagina_inc,              \n                'filtro'        : pesquisa,\n                'pendencia'     : pendencia,\n                'pendentes'     : pendentes,\n                'autorizadas'   : autorizadas,\n                'reprovadas'    : reprovadas,\n                'data_1'        : data_1,\n                'data_2'        : data_2          \n            };   \n\n            function success(data) {\t\t\t\t\t\t\n                if(data) {\n                    var html = $('table.lista-obj tbody').html();\n                    $('table.lista-obj tbody').html(html + data);\n                    show();\n                    bootstrapInit();\n                    addEventBtn();\n\n                } else {\n                    final_pag = true;\n                }\n            }\n            function complete() {\n                $('.btn-oc-filtrar').button('reset'); \n            }\n            $('.btn-oc-filtrar').button('loading');\n            execAjax1('POST','/_13050/paginacaoScroll',dados,success,null,complete);\n        }\n\n        /**\n         * Realiza a parametrização inicial<br/>\n         * Realiza o acionamento da consulta\n         */\n        function acionarFiltro() {\n            \n            var campo_pesquisa = $('.btn-oc-filtro');\n            var btn_filtrar    = $('.btn-oc-filtrar');\n            var scroll_timer   = 0;\n\t\t\t\n            btn_filtrar.click(function(){\n\t\t\t\tfinal_pag\t  = false;\n\t\t\t\tpagina_atual  = 1;\n\t\t\t\tpagina_inc    = 0;\n                $('table.lista-obj tbody').empty();\n                tratarDados();\n            });\n            \n            campo_pesquisa.keyEnter(function(){\n\t\t\t\tfinal_pag\t  = false;\n\t\t\t\tpagina_atual  = 1;\n\t\t\t\tpagina_inc    = 0;\n                $('table.lista-obj tbody').empty();\n                tratarDados();\n            });\n            \n            //carregar página com scroll\n            $('.table-ec').scroll(function() {\n\t\t\t\t\n                if (popUpShowing) return false; \n                \n                var div = $(this);\n\n                clearTimeout(scroll_timer);\n\n                scroll_timer = setTimeout(function() {\n\t\t\t\t\t\n\t\t\t\t\t//final do scroll da tabela\n                    if( ( div.scrollTop() + div.height() ) >= div.children('table').height() ) {\n\n                        pagina_atual += 1;\n                        pagina_inc = pagina_atual * qtd_por_pag - qtd_por_pag;                        \n                        tratarDados();\n\t\t\t\t\t}\n                }, 200);\n            });\n\n            //carregar página com clique\n            $('.carregar-pagina').click(function() {\n\n                pagina_atual += 1;\n                pagina_inc = pagina_atual * qtd_por_pag - qtd_por_pag;                                        \n                tratarDados();\n            });            \n        }\n        \n        acionarFiltro();\n    }\n        \n    /**\n     * Carrega e configura tabela\n     * @returns {void}\n     */\n    function dataTable() {\n        $('.lista-obj')\n            .DataTable(table_default);\n    }  \n    \n    function show() {\n        \n        var param = {};\n        var selector;\n        \n        function acoes() {\n\n            /**\n             * Gerar PDF de Oc.\n             * @param {int} opcao 1 - Enviar | 2 - Imprimir\n             */\n            function gerarPdfOc(opcao) {\n\n                var status_res = 0;\n                var status_msg = '';\n                var url_ajx = '';\n\n                $('.alert-principal .texto')\n                    .empty()\n                    .parent()\n                    .hide();\n\n                if (opcao === 1) {\n                    $('.enviar-oc')\n                        .button('loading');\n\n                    url_ajx = '/_13050/enviarPdfOc';\n                }\n                else {\n                    $('.imprimir-oc')\n                        .button('loading');\n\n                    url_ajx = '/_13050/imprimirPdfOc';\n                }\n\t\t\t\t\n\t\t\t\t//ajax\n\t\t\t\tvar type\t\t= 'POST',\n                    url\t\t\t= url_ajx,\n                    data\t\t= $('form').serialize(),\n\t\t\t\t\tsuccess\t\t= function(resposta) {\n\n                        status_res = 0;\n                        status_msg = resposta;\n\n                    },\n\t\t\t\t\terror\t\t= function (xhr) {\n\n                        var msg = $(xhr.responseText)\n                                        .find('.msg-erro')\n                                        .html();\n\n                        if ( xhr.status === 500 ) {\n                            status_msg = msg;\n                        }\n\n                        status_res = 1;\n\n                    },\n                    complete\t= function() {\n\n                        //sucesso\n                        if (status_res === 0) {\n\n                            if (opcao === 1) {\n\n                                $('.alert-principal .texto')\n                                    .text('OC enviada com sucesso.')\n                                    .parent()\n                                    .removeClass('alert-danger')\n                                    .addClass('alert-success')\n                                    .slideDown();\n                            }\n                            else {\n                                \n                                printPdf(status_msg);\n\n                            }\n\n                        }\n                        //erro\n                        else if (status_res === 1) {\n\n                            $('.alert-principal')\n                                .removeClass('alert-success')\n                                .addClass('alert-danger');\n\n                            var excecao;\n\n                            if ( status_msg ) {\n                                excecao = status_msg.match(/exception 1 ...(.*) At trigger (.*)/i);\n                            }\n\n                            //se for exceção de trigger\n                            if ( excecao ) {\n\n                                $('.alert-principal .texto')\n                                    .html(excecao['1'])\n                                    .parent()\n                                    .slideDown();\n\n                            }\n                            else {\n\n                                $('.alert-principal .texto')\n                                    .html(status_msg)\n                                    .parent()\n                                    .slideDown();\n\n                            }\n                        }\n\n                        if (opcao === 1) {\n                            $('.enviar-oc')\n                                .button('reset');\n                        }\n                        else {\n                            $('.imprimir-oc')\n                                .button('reset');\n                        }\n\n                    }\n\t\t\t\t;\n\t\t\t\t\n\t\t\t\texecAjax1(type, url, data, success, error, complete, false);\n                \n            }\n\n            /**\n             * Excluir Pdf de Oc.\n             */\n            function excluirPdfOc() {\n\n                $('.pdf-fechar')\n                    .click(function() {\t\t\t\t\n                        execAjax1(\n                            'POST', \n                            '/_13050/excluirPdfOc', \n                            { 'url_temp': getUrlPDf() },\n                            function() {\n                                $('.pdf-ver').fadeOut();\n                            }\n                        );\n                    });\n            }\n\n\n\n            /**\n             * Autorizar Oc.\n             */\n            function autorizarOc() {\n\n                /**\n                 * Coleta todos os itens da ordem de compra que não deverão ser referência para as proximas compras de mesmo produto\n                 */\n                $('.check-item').click(function(){\n                    var checked = $(this).is(':checked');\n                    \n                    if ( checked ) {\n                        $(this).next('input').attr('disabled',true);\n                    } else {\n                        $(this).next('input').removeAttr('disabled');\n                    }\n                });\n                \n                /**\n                 * Autoriza ordem de compra\n                 */\n                $('.autorizar-oc')\n                    .click(function() {\n                        var obs = prompt('Confirma a AUTORIZAÇÃO desta Ordem de Compra?\\n\\nDigite uma observação (não obrigatório):');\n                        if (obs === null) return false;\n\n                        var id = $('#oc').val();\n                        var dados = \n                        {   id    : id,\n                            tipo  : '1',\n                            obs   : obs,\n                            itens : $('input[name=\"itens[]\"]').serializeArray()\n                        };\n                        \n                        $(this)\n                            .button('loading');\n\n                        function success() {    \n                            var tabindex = selector.attr('tabindex');\n                            tabindex++;\n                            $('tr[tabindex=' + tabindex + ']').focus();\n                            \n                            selector.popUpClose();   \n                            selector.remove();\n//                            window.location = $('form').attr('url-redirect');\n                        }\n\n                        function complete() {\n\n                            $('.autorizar-oc')\n                                .button('reset');\n                        }\n\n                        execAjax1('POST','/_13050/autorizacao',dados,success,null,complete);\n                    })\n                ;\n\n                \n                \n                /**\n                 * Reprova ordem de compra\n                 */\n                $('.negar-oc')\n                    .click(function() {\n                        var obs = prompt('Confirma a REPROVAÇÃO desta Ordem de Compra?\\n\\nDigite uma observação (não obrigatório):');\n                        if (obs === null) return false;\n\n                        var id = $('#oc').val();\n                        var dados = \n                        {   'id'    : id,\n                            'tipo'  : '2',\n                            'obs'   : obs\n                        };\n\n                        function success() {\n\n                            var tabindex = selector.attr('tabindex');\n                            tabindex++;\n                            $('tr[tabindex=' + tabindex + ']').focus();\n                            \n                            selector.popUpClose();   \n                            selector.remove();                             \n//                            window.location.reload();\n                        }\n\n                        execAjax1('POST','/_13050/autorizacao',dados,success);\n                    })\n                ;\t\t            \n            }\n\n\n\n            /**\n             * Ação para enviar e imprimir OC.\n             */\n            function iniciarGerarPdfOc() {\n\n                $('.enviar-oc')\n                    .click(function() {\n                        gerarPdfOc(1);\n                    });\n\n                $('.imprimir-oc')\n                    .click(function() {\n                        gerarPdfOc(2);\n                    });\n            }\n            \n            autorizarOc();        \n            iniciarGerarPdfOc();\n            excluirPdfOc();  \n        }\n                \n        /**\n         * Carrega e configura tabela de itens\n         * @returns {void}\n         */\n        function dataTableItens() {\n            var data_table = $.extend({}, table_default);\n                data_table.sScrollY = 'auto';           \n            $('.table-itens').DataTable(data_table);  \n        }           \n        \n        /**\n         * Carrega e configura tabela de itens\n         * @returns {void}\n         */\n        function dataTableAutorizacoes() {\n            var data_table = $.extend({}, table_default);\n                data_table.sScrollY = 'auto'; \n            $('.table-autorizacoes').DataTable(data_table);  \n        }           \n        \n        /**\n         * Realiza a chamada ajax\n         */\n        function carregarDados() {           \n            \n            function success(data) {\t\t\t\t\t\t\n                if(data) {\n                    $('div.modal-body').html(data);\n                    selector.popUp();\n                    bootstrapInit();\n                    dataTableItens();\n                    dataTableAutorizacoes();\n                    acoes();\n                }\n            }\n\n            execAjax1('GET','/_13050/show/'+param.id,null,success);\n        }\n        \n        function clickItem() {\n            $('tr[id]')\n                .click(function(){\n                    selector = $(this);\n                    param.id = selector.attr('id');\n                    carregarDados();\n                })\n            ;\n        }\n        clickItem();\n\t\tacoes();\n    }\n\n\t\n\t$(function() {\n\t\t\n        //dataTable();\n\t    limiteTextarea($('textarea.obs'), 200, $('span.contador span'));\n\t\tfiltroOc();\n        show();\n        addEventBtn();\n\t\n\t});\n})(jQuery);"]}