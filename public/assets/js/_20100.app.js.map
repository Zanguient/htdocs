{"version":3,"sources":["_20100.app.js","_20100.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_20100.app.js","sourcesContent":["/**\n * _11140 - Cadastro de paineis de Casos\n */\n'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils',\n\t\t'gc-find'\n\t])\n;","angular\r\n    .module('app')\r\n    .value('gScope', {\r\n        indexOfAttr : function(array,attr, value) {\r\n            for(var i in array) {\r\n                if(array[i][attr] === value) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        }\r\n    })\r\n    .controller('Ctrl', Ctrl);\r\n\r\n\tCtrl.$inject = [\r\n        '$ajax',\r\n        '$scope',\r\n        '$window',\r\n        '$timeout',\r\n        'gScope',\r\n        '$consulta',\r\n        '$httpParamSerializer',\r\n        'gcCollection'\r\n    ];\r\n\r\n\tfunction Ctrl($ajax, $scope, $window, $timeout, gScope, $consulta, $httpParamSerializer, gcCollection) {\r\n\r\n\t\tvar vm = this;\r\n\t\tvm.DADOS = [];\r\n        vm.DADOS.EXTRATO = [];\r\n        vm.DADOS.DETALHE = [];\r\n        vm.DADOS.RELATORIO = [];\r\n        vm.DETALHAR = false;\r\n        vm.TOTAL = {DEBITO : 0, CREDITO : 0, SALDO : 0};\r\n        vm.SALDO_ANTERIOR = 0;\r\n\r\n\t\tfunction dataInicio(){\r\n            var data = new Date();\r\n            var dia = data.getDate();\r\n            if (dia.toString().length == 1)\r\n              dia = \"0\"+dia;\r\n            var mes = data.getMonth()+1;\r\n            if (mes.toString().length == 1)\r\n              mes = \"0\"+mes;\r\n            var ano = data.getFullYear();  \r\n            return mes+\"/01/\"+ano;\r\n        }\r\n\r\n        function dataFim(){\r\n            var data = new Date();\r\n            var dia = data.getDate();\r\n            if (dia.toString().length == 1)\r\n              dia = \"0\"+dia;\r\n            var mes = data.getMonth()+1;\r\n            if (mes.toString().length == 1)\r\n              mes = \"0\"+mes;\r\n            var ano = data.getFullYear();  \r\n            return mes+\"/\"+dia+\"/\"+ano;\r\n        }\r\n\r\n        vm.TratarOrdem = function(filtro){\r\n            if(vm.ordem == filtro){\r\n                vm.ordem = '-'+filtro;\r\n            }else{\r\n                vm.ordem = filtro;\r\n            }\r\n        };\r\n\r\n        vm.DATA1 = moment(dataInicio()).toDate();\r\n        vm.DATA2 = moment(dataFim()).toDate();\r\n\r\n        vm.Consulta     = new $consulta();\r\n        gScope.Consulta = vm.Consulta;\r\n\r\n        vm.Consulta_Banco = vm.Consulta.getNew();\r\n\r\n        vm.Consulta_Banco.componente             = '.consulta_banco',\r\n        vm.Consulta_Banco.model                  = 'vm.Consulta_Banco',\r\n        vm.Consulta_Banco.option.label_descricao = 'Banco:',\r\n        vm.Consulta_Banco.option.obj_consulta    = '/_20100/ConsultarBanco',\r\n        vm.Consulta_Banco.option.tamanho_Input   = 'input-maior';\r\n        vm.Consulta_Banco.option.class           = 'consulta_banco_grup';\r\n        vm.Consulta_Banco.option.tamanho_tabela  = 350;\r\n\r\n        vm.Consulta_Banco.compile();\r\n\r\n        vm.Acoes = {\r\n            imprimir : function(){\r\n                var valido = true;\r\n\r\n                if(vm.Consulta_Banco.item.selected == false){\r\n                    showErro('Selecione um banco!');\r\n                    valido = false;\r\n                }\r\n\r\n                if(vm.DATA2 < vm.DATA1){\r\n                    showErro('Período invalido');\r\n                    valido = false;\r\n                }\r\n\r\n                if(valido == true){\r\n                    var user = $('#usuario-descricao').val();\r\n                    var filtro = 'Banco: ' + vm.Consulta_Banco.item.dados.DESCRICAO + ' Data:' + moment(vm.DATA1).format('L') +' a '+ moment(vm.DATA2).format('L');\r\n                    printHtml('container-registros', 'Relatório de Extrato de Caixa / Bancos', filtro, user, '1.0.0',1,'');\r\n                }\r\n\r\n            },\r\n            export1 : function(){\r\n                exportTableToCsv('extrato.csv', 'tabela-registros');\r\n            },\r\n            export2 : function(){\r\n                exportTableToXls('extrato.xls', 'tabela-registros');\r\n            },\r\n            filtrar : function(){\r\n                var valido = true;\r\n\r\n                if(vm.Consulta_Banco.item.selected == false){\r\n                    showErro('Selecione um banco!');\r\n                    valido = false;\r\n                }\r\n\r\n                if(vm.DATA2 < vm.DATA1){\r\n                    showErro('Período invalido');\r\n                    valido = false;\r\n                }\r\n\r\n                if(valido == true){\r\n                    this.exec();   \r\n                }\r\n\r\n            },\r\n            exec : function(){\r\n\r\n                var that  = this;\r\n\r\n                vm.DADOS.EXTRATO = [];\r\n                vm.DADOS.DETALHE = [];\r\n                vm.DADOS.RELATORIO = [];\r\n\r\n                var dados = {\r\n                    DATA1    : vm.DATA1,\r\n                    DATA2    : vm.DATA2,\r\n                    DETALHAR : vm.DETALHAR,\r\n                    BANCO    : vm.Consulta_Banco.item.dados\r\n                };\r\n\r\n                $ajax.post('/_20100/ConsultarExtrato',dados)\r\n                    .then(function(response) {\r\n\r\n                        var dataold = '';\r\n\r\n                        gcCollection.merge(vm.DADOS.EXTRATO   , response.EXTRATO   , 'CONTROLE');\r\n                        gcCollection.merge(vm.DADOS.DETALHE   , response.DETALHE   , 'CONTROLE');\r\n\r\n                        if(vm.DETALHAR == true){\r\n                            gcCollection.bind(vm.DADOS.EXTRATO    , vm.DADOS.DETALHE   , 'CONTROLE|CAIXABANCO_CONTROLE', 'DETALHES');\r\n                        }\r\n\r\n                        var cont = 0;\r\n                        angular.forEach(vm.DADOS.EXTRATO, function(value, key) {\r\n                            var notIn = true;\r\n\r\n                            if(cont == 0){\r\n                                vm.SALDO_ANTERIOR = value.SALDO_ANTERIOR;\r\n                            }\r\n\r\n                            if(dataold != value.DATA){\r\n\r\n                                angular.forEach(vm.DADOS.RELATORIO, function(v, k) {\r\n                                    if(v.DATA == value.DATA){\r\n                                        notIn = false;\r\n                                    }\r\n                                });\r\n\r\n                                if(notIn == true){\r\n                                    vm.DADOS.RELATORIO.push({DATA : value.DATA, DEBITO: 0, CREDITO: 0, SALDO: 0});\r\n                                }\r\n                            }\r\n\r\n                            dataold = value.DATA;\r\n\r\n                            angular.forEach(vm.DADOS.RELATORIO, function(v, k) {\r\n                                if(v.DATA == dataold){\r\n                                    v.DEBITO  = value.ACUMULADO_DEBITO_DIA; \r\n                                    v.CREDITO = value.ACUMULADO_CREDITO_DIA; \r\n                                    v.SALDO   = value.SALDO; \r\n\r\n                                    vm.TOTAL.DEBITO  = value.ACUMULADO_DEBITO; \r\n                                    vm.TOTAL.CREDITO = value.ACUMULADO_CREDITO; \r\n                                    vm.TOTAL.SALDO   = value.SALDO; \r\n                                }\r\n                            });\r\n\r\n                            \r\n                        });\r\n                        \r\n                        gcCollection.bind(vm.DADOS.RELATORIO  , vm.DADOS.EXTRATO   , 'DATA', 'EXTRATO');\r\n\r\n                        console.log(vm.DADOS);\r\n\r\n                        cont = cont + 1;\r\n\r\n                    }\r\n                );\r\n            }\r\n        }\r\n\t}   \r\n    "]}