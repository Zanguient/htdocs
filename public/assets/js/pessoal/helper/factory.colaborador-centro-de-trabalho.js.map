{"version":3,"sources":["factory.colaborador-centro-de-trabalho.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"factory.colaborador-centro-de-trabalho.js","sourcesContent":["(function(window, angular) {\n    'use strict';\n\n    angular\n        .module('gc-pessoal', ['gc-find'])\n        .factory('ColaboradorCentroDeTrabalho', ColaboradorCentroDeTrabalho);\n\n//    if (typeof module !== 'undefined' && module.exports) {\n//        module.exports = Pessoal.name;\n//    }\n\n\tColaboradorCentroDeTrabalho.$inject = [\n        '$ajax',\n        '$q',\n        '$rootScope',\n        '$compile',\n        '$timeout',\n        '$consulta'\n    ];\n\n\tfunction ColaboradorCentroDeTrabalho($ajax, $q, $rootScope, $compile,$timeout, $consulta) {\n\n        // Private variables.\n        var obj = null;\n        \n        var _model               = 'vm.ColaboradorCentroDeTrabalho';\n        var _button              = null;\n        var _args                = {};\n        var _data_call_component = '[gc-pessoal-colaborador-centro-de-trabalho]';\n        var _scope               = null;\n        var _ctrl                = null;\n        \n\t    /**\n\t     * Constructor, with class name\n\t     */\n\t    function ColaboradorCentroDeTrabalho(args) {\n            \n            obj = this; \n\n            // Public methods         \n            this.getView        = getView; \n            this.getCtrl        = getCtrl; \n            this.callComponent  = callComponent; \n            this.autenticar     = autenticar; \n            this.confirmar      = confirmar; \n            this.cancelar       = cancelar; \n            this.Colaborador    = Colaborador; \n            this.Modal          = Modal; \n                        \n            if ( args != undefined ) {\n                if ( args.model != undefined ) {\n                    _model = args.model;\n                }\n            }\n                        \n            _ctrl  = obj.getCtrl();\n            _scope =_ctrl.scope();\n                    \n            _scope.$watch(_model+'.Colaborador.AUTENTICADO',function(newValue){\n                if ( newValue ) {\n                    obj.CCTConsultaPerfil.disable(false);\n                obj.CCTConsultaUp.disable(false);\n                    $timeout(function(){\n                        obj.CCTConsultaPerfil.filtrar();\n                        obj.CCTConsultaPerfil.setFocusInput();     \n                    });\n                } else\n                if ( newValue == false ) {\n                    obj.Colaborador.SELECTED = {};\n                    obj.CCTConsultaPerfil.apagar();\n                    obj.CCTConsultaPerfil.disable(true);\n                    obj.CCTConsultaUp.disable(true);\n                }\n            });\n                    \n            _scope.$watch(_model+'.CCTConsultaUp.UP_CCUSTO',function(newValue){\n                if ( newValue != undefined && newValue.trim() != '' ) {\n                    obj.CONFIRMAR = true;\n                } else {\n                    obj.CONFIRMAR = false;                    \n                }\n            });\n            \n            obj.getView().then(function(){\n\n\n                obj.Consulta   = new $consulta();\n                \n                obj.CCTConsultaPerfil                             = obj.Consulta.getNew(true);\n                obj.CCTConsultaPerfil.componente                  = '.cct-consulta-perfil';\n                obj.CCTConsultaPerfil.model                       = _model+'.CCTConsultaPerfil';\n                obj.CCTConsultaPerfil.option.label_descricao      = 'Perfil do Grupo de Produção:';\n                obj.CCTConsultaPerfil.option.obj_consulta         = '/_11200/api/perfil';\n                obj.CCTConsultaPerfil.option.tamanho_input        = 'input-maior';\n                obj.CCTConsultaPerfil.option.tamanho_tabela       = 427;\n                obj.CCTConsultaPerfil.option.campos_tabela        = [['PERFIL_DESCRICAO', 'Descrição']];\n                obj.CCTConsultaPerfil.option.obj_ret              = ['PERFIL_DESCRICAO'];\n                obj.CCTConsultaPerfil.setDataRequest({TABELA: 'GP'});\n                obj.CCTConsultaPerfil.compile();    \n                obj.CCTConsultaPerfil.disable(true);\n                            \n                \n                obj.CCTConsultaUp                             = obj.Consulta.getNew(true);\n                obj.CCTConsultaUp.componente                  = '.cct-consulta-up';\n                obj.CCTConsultaUp.model                       = _model+'.CCTConsultaUp';\n                obj.CCTConsultaUp.option.label_descricao      = 'Up do Grupo de Produção:';\n                obj.CCTConsultaUp.option.obj_consulta         = '/_22030/api/up';\n                obj.CCTConsultaUp.option.tamanho_input        = 'input-maior';\n                obj.CCTConsultaUp.option.tamanho_tabela       = 427;\n                obj.CCTConsultaUp.option.campos_tabela        = [['UP_ID', 'Id'],['UP_DESCRICAO','Descrição']];\n                obj.CCTConsultaUp.option.obj_ret              = ['UP_ID','UP_DESCRICAO'];\n                obj.CCTConsultaUp.require                     = obj.CCTConsultaPerfil;\n                obj.CCTConsultaUp.vincular();\n                obj.CCTConsultaUp.setRequireRequest({GP_PERFIL: [obj.CCTConsultaPerfil, 'PERFIL_TABELA_ID']});\n                obj.CCTConsultaUp.compile();    \n                obj.CCTConsultaUp.disable(true);\n                            \n                \n                obj.callComponent(function(){\n                    obj.Modal.show();\n                });\n            });            \n\t    }\n        \n        /**\n         * Chama a view\n         */\n\t    function callComponent(callback){\n            $(document).on('click',_data_call_component,function(){\n                var button = $(this);\n                $rootScope.$apply(function(){\n                    \n                    _button = button;\n                    \n                    if ( button.attr('data-args') != undefined ) {\n                        _args = JSON.parse(button.attr('data-args'));\n                    } else {\n                        _args = {};\n                    }\n                    \n                    callback != undefined && callback();\n                });\n            });         \n            \n        };    \n        \n        \n        /**\n         * Retorna a view da factory\n         */\n        function autenticar() {\n            if ( !obj.Colaborador.AUTENDICADO ) {\n                obj.Colaborador.consultarBarras();\n            }\n        }\n        \n        function confirmar() {\n            \n            var dados = {\n                COLABORADOR_ID  : obj.Colaborador.SELECTED.COLABORADOR_ID,\n                CCUSTO_PRODUCAO : obj.CCTConsultaUp.UP_CCUSTO\n            };\n    \n            $ajax.post('/_23020/api/colaborador/centro-de-trabalho/update',dados).then(function(response){\n\n                obj.Colaborador.AUTENTICADO = false;\n                $timeout(function(){\n                    $('#centro-de-trabalho-colaborador-barras:focusable').focus();\n                });\n//                obj.Modal.hide();\n                \n            });\n        }\n        \n        function cancelar() {\n            addConfirme('<h4>Confirmação</h4>',\n                'Deseja realmente cancelar esta operação?',\n                [obtn_sim,obtn_nao],\n                [{ret:1,func:function(){\n                    $rootScope.$apply(function(){\n                        obj.Colaborador.AUTENTICADO = false;\n                        obj.Modal.hide();\n                    });\n                }}]     \n            );\n        }\n        \n        \n        \n\t    function getView(){\n            \n            return $q(function(resolve,reject){\n                $ajax.get('/pessoal/colaborador-centro-de-trabalho').then(function(html){\n                    \n                    var template = angular.element(html.replace(/ctrl/g, _model));\n                    \n                    _ctrl.append($compile(template)(_scope));               \n                    \n                    resolve(true);\n                },function(erro){\n                    reject(erro);\n                });            \n            });\n        };    \n\n        \n        function getCtrl(){\n                return $('#main').find('[ng-controller]').first();\n        };\n        \n        \n        var Colaborador = {\n            SELECTED : {},\n            BARRAS : '',\n            AUTENDICADO : false,\n            consultarBarras : function() {\n                var that = this;\n                $ajax.post('/_23020/api/colaboradores',{COLABORADOR_CRACHA: that.BARRAS}).then(function(response){\n                    if ( response.length == 1 ) {\n                        that.SELECTED = response[0];\n                        that.AUTENTICADO = true;                        \n                    } else {\n                        showErro('Código de barras do colaborador inválido.');\n                    }\n                    that.BARRAS = '';\n                },function(){\n                    that.BARRAS = '';\n                });\n            }\n        };\n        \n\n        var Modal = {\n            \n            _modal : function(){\n                return $('#modal-pessoal-colaborador-centro-de-trabalho');\n            },\n            show : function(shown,hidden) {\n\n                this._modal()\n                    .modal('show')\n                ;                         \n\n\n                this._modal()\n                    .one('shown.bs.modal', function(){\n\n                        $(this).find('input:focusable').first().focus();\n\n                        if ( shown ) {\n                            shown(); \n                        }\n                    })\n                ;    \n\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            \n                            if ( hidden ) {\n                                hidden();      \n                            }\n                        })\n                    ;        \n            },\n            hide : function(hidden) {\n\n                this._modal()\n                    .modal('hide')\n                ;\n\n                if ( hidden ) {\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            hidden ? hidden() : '';\n                        })\n                    ;                      \n                }\n            }\n        };     \n\n            \n\t    /**\n\t     * Return the constructor function\n\t     */\n\t    return ColaboradorCentroDeTrabalho;\n\t};\n   \n})(window, window.angular);"]}