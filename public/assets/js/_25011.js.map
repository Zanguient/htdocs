{"version":3,"sources":["_25011.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_25011.js","sourcesContent":["/**\n * _25011 - Formulários\n */\n;(function(angular) {\n\n\t/**\n\t * Controller.\n\t */\n\tvar ctrl = function($ajax, $filter, $timeout) {\n\n\t\tvar vm = this;\n\n\t\tvm.tipoTela\t\t\t= \"incluir\";\n\t\tvm.listaFormulario\t= [];\t// Lista de formulários cadastrados.\n\t\tvm.formulario\t\t= {};\t// Formulário a ser exibido.\n\t\tvm.pergunta \t\t= [];\t// Pergunta a ser exibida.\n\t\tvm.autenticacao\t\t= {};\t// Autenticação.\n\t\t\n\t\t/**\n\t\t * Listar formulários.\n\t\t */\n\t\tvm.listarFormulario = function() {\n            \n\t\t\t$ajax\n\t\t\t\t.post('/_25011/listar')\n\t\t\t\t.then(function(response) {\n\n\t\t\t\t\tvm.listaFormulario = response;\t\t\t\t\t\n\n\t\t\t\t})\n\t\t\t;\n\n\t\t};\n\n\t\t/**\n\t\t * Exibir formulário.\n\t\t */\n\t\tvm.exibirFormulario = function(formulario) {\n\t\t\t\n\t\t\tvar pergunta = []\n\t\t\t\tresposta = []\n\t\t\t;\n\t\t\t\n\t\t\tvm.tipoTela \t\t\t\t\t\t\t\t= (formulario.TIPO == 2) ? 'exibir' : 'alterar';\n\t\t\tvm.formulario.ID \t\t\t\t\t\t\t= formulario.ID;\n\t\t\tvm.formulario.TIPO \t\t\t\t\t\t\t= formulario.TIPO;\n\t\t\tvm.formulario.TITULO \t\t\t\t\t\t= formulario.TITULO;\n\t\t\tvm.formulario.DESCRICAO \t\t\t\t\t= formulario.DESCRICAO;\n\t\t\tvm.formulario.STATUS \t\t\t\t\t\t= formulario.STATUS.trim();\n\t\t\tvm.formulario.PERIODO_INI\t\t\t\t\t= moment(formulario.PERIODO_INI).format('DD/MM/YYYY');\n\t\t\tvm.formulario.PERIODO_FIM\t\t\t\t\t= moment(formulario.PERIODO_FIM).format('DD/MM/YYYY');\n\t\t\tvm.formulario.DESTINATARIO_TIPO\t\t\t\t= formulario.DESTINATARIO_TIPO.trim();\n\t\t\tvm.formulario.DESTINATARIO_STATUS_RESPOSTA\t= formulario.DESTINATARIO_STATUS_RESPOSTA.trim();\n\n\t\t\tvm.pergunta = [];\n\n\t\t\t// Perguntas.\n\t\t\tfor (var j in vm.listaFormulario.PERGUNTA) {\n\n\t\t\t\tpergunta \t\t\t\t\t\t= vm.listaFormulario.PERGUNTA[j];\n\t\t\t\tpergunta.ALTERNATIVA \t\t\t= [];\n\t\t\t\tpergunta.ALTERNATIVA_EXCLUIR \t= [];\n\t\t\t\tpergunta.RESPOSTA \t\t\t\t= [];\n\n\t\t\t\tif ( parseInt(pergunta.FORMULARIO_ID) == parseInt(formulario.ID) ) {\n\n\t\t\t\t\t// Serve apenas para exigir que a resposta tenha uma justificativa (VIEW).\n\t\t\t\t\tpergunta.JUSTIFICATIVA_OBRIGATORIA = 0;\n\n\t\t\t\t\t// Alternativas.\n\t\t\t\t\tfor (var k in vm.listaFormulario.ALTERNATIVA) {\n\n\t\t\t\t\t\talternativa = vm.listaFormulario.ALTERNATIVA[k];\n\n\t\t\t\t\t\tif ( ( parseInt(alternativa.FORMULARIO_ID) == parseInt(formulario.ID) ) \n\t\t\t\t\t\t  && ( parseInt(alternativa.FORMULARIO_PERGUNTA_ID) == parseInt(pergunta.ID) ) \n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tpergunta.ALTERNATIVA.push(alternativa);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Respostas.\n\t\t\t\t\tfor (var l in vm.listaFormulario.RESPOSTA) {\n\n\t\t\t\t\t\tresposta = vm.listaFormulario.RESPOSTA[l];\n\n\t\t\t\t\t\tif ( ( parseInt(resposta.FORMULARIO_ID) == parseInt(formulario.ID) ) \n\t\t\t\t\t\t  && ( parseInt(resposta.FORMULARIO_PERGUNTA_ID) == parseInt(pergunta.ID) ) \n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t//vm.tipoTela = 'exibir';\t\t//Usuário já respondeu.\n\t\t\t\t\t\t\tpergunta.RESPOSTA.push(resposta);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvm.pergunta.push(pergunta);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t$('#modal-create')\n\t\t\t\t.modal('show')\n\t\t\t\t.find('.modal-body')\n\t\t\t\t.animate({ scrollTop: 0 }, 'fast')\n\t\t\t;\n\n\t\t};\n\n\t\t/**\n\t\t * Limpar tela.\n\t\t */\n\t\tvm.limparTela = function() {\n\n\t\t\tvm.formulario\t\t= {};\n\t\t\tvm.pergunta \t\t= [];\n\t\t\tvm.autenticacao\t\t= {};\n\n\t\t};\n\n\t\t/**\n\t\t * Limpar campos.\n\t\t */\n\t\tvm.limparCampos = function() {\n\n\t\t\tvar perg = '';\n\n\t\t\tif (vm.autenticacao.AUTENTICADO)\n\t\t\t\tvm.tipoTela\t= 'exibir';\n\t\t\t\n\t\t\tvm.autenticacao = {};\n\n           \t// Limpar alternativas.\n\t\t\tfor(var i in vm.pergunta) {\n\n\t\t\t\tperg = vm.pergunta[i];\n\n\t\t\t\tperg.RESPOSTA[0].ALTERNATIVA_ESCOLHIDA_ID \t= '';\n\t\t\t\tperg.RESPOSTA[0].DESCRICAO \t\t\t\t\t= '';\n\n\t\t\t}\n\n\t\t};\n\n\t\t/**\n\t\t * Autenticação.\n\t\t */\n\t\tvm.autenticar = function() {\n\n\t\t\tvar dados = {\n\t\t\t\tCODIGO \t\t\t: vm.autenticacao.CODIGO,\n\t\t\t\tFORMULARIO_ID \t: vm.formulario.ID\n\t\t\t};\n\n\t\t\t$ajax\n\t\t\t\t.post('/_25011/autenticarColaborador', JSON.stringify(dados), {contentType: 'application/json'})\n\t\t\t\t.then(function(response) {\n\n\t\t\t\t\tvm.autenticacao.AUTENTICADO \t\t= response.AUTENTICADO;\n\t\t\t\t\tvm.autenticacao.COLABORADOR_ID\t \t= response.COLABORADOR_ID;\n\t\t\t\t\tvm.autenticacao.COLABORADOR_NOME \t= response.COLABORADOR_NOME;\n\t\t\t\t\tvm.autenticacao.COLABORADOR_CCUSTO\t= response.COLABORADOR_CCUSTO;\n\n\t\t\t\t\tif (vm.autenticacao.AUTENTICADO) \n\t\t\t\t\t\tvm.tipoTela = 'alterar';\n\n\t\t\t\t})\n\t\t\t;\n\n\t\t};\n\n\t\t/**\n\t\t * Atalhos para autenticação.\n\t\t */\n\t\tvm.atalhoAutenticar = function($event) {\n\n\t\t\tif ($event.keyCode == 13)\n\t\t\t\tvm.autenticar();\n\n\t\t};\n\n\t\t/**\n\t\t * Ações no sucesso ao gravar resposta.\n\t\t */\n\t\tvm.sucessoGravarResposta = function() {\n\n           \tshowSuccess('Formulário finalizado com sucesso.');\n\n           \t$('#modal-create').modal('hide');\n           \tvm.limparCampos();\n            vm.listarFormulario();\n\n\t\t};\n\n\t\t/**\n\t\t * Gravar resposta.\n\t\t */\n\t\tvm.gravarResposta = function() {\n\n\t\t\tvar dados \t= {\n\t\t            pergunta \t: vm.pergunta,\n\t\t            autenticacao: vm.autenticacao\n\t\t        },\n\t        \turl \t= '/_25011/gravarResposta'\n\t        ;\n\t    \n\t        $ajax\n\t        \t.post(url, JSON.stringify(dados), {contentType: 'application/json'})\n\t            .then(function(response) {  \n\n\t\t\t\t\tvm.sucessoGravarResposta();\n\n\t            })\n\t        ;\n\n\t    };\n\n\t\tvm.listarFormulario();\n\t};\n\n\t//Injetando Components ao Controller.\n\tctrl.$inject = ['$ajax', '$filter', '$timeout'];\n\n    angular\n    \t.module('app', ['vs-repeat', 'gc-ajax', 'gc-find', 'gc-transform'])\n    \t.controller('ctrl', ctrl)\n\t; \n    \n    // angular.bootstrap(document.getElementById('main'), ['app']);\n\n})(angular);"]}