{"version":3,"sources":["_20110.app.js","_20110.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_20110.app.js","sourcesContent":["/**\n * _11140 - Cadastro de paineis de Casos\n */\n'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils',\n\t\t'gc-find'\n\t])\n;","angular\r\n    .module('app')\r\n    .value('gScope', {\r\n        indexOfAttr : function(array,attr, value) {\r\n            for(var i in array) {\r\n                if(array[i][attr] === value) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        }\r\n    })\r\n    .controller('Ctrl', Ctrl);\r\n\r\n\tCtrl.$inject = [\r\n        '$ajax',\r\n        '$scope',\r\n        '$window',\r\n        '$timeout',\r\n        'gScope',\r\n        '$consulta',\r\n        '$httpParamSerializer',\r\n        'gcCollection'\r\n    ];\r\n\r\n\tfunction Ctrl($ajax, $scope, $window, $timeout, gScope, $consulta, $httpParamSerializer, gcCollection) {\r\n\r\n\t\tvar vm = this;\r\n\t\tvm.DADOS = [];\r\n        vm.DADOS.Bancos       = {};\r\n        vm.DADOS.Negociados   = {};\r\n        vm.DADOS.Provisoes    = {};\r\n        vm.DADOS.ContaPagar   = {};\r\n        vm.DADOS.ContaReceber = {};\r\n        vm.DADOS.OrdensCompra = {};\r\n        vm.DADOS.FLUXO        = [];\r\n\r\n        vm.DADOS.FLUXO_TOTAL = {\r\n            PAGAMENTO:0,\r\n            NEGOCIADO:0,\r\n            COMPRA:0,\r\n            RECEBIMENTO:0,\r\n            PAGAR:0,\r\n            RECEBER:0,\r\n            SALDODIA:0,\r\n            SALDO: 0,\r\n            SALDO_BANCO: 0\r\n        };     \r\n\r\n        vm.DETALHAR = false;\r\n        vm.TOTAL = {DEBITO : 0, CREDITO : 0, SALDO : 0};\r\n        vm.SALDO_ANTERIOR = 0;\r\n        vm.PERFIL = '';\r\n\r\n        vm.dataTodas = true;\r\n\r\n        vm.detalhar = {\r\n            compra      : false,\r\n            receber     : false,\r\n            bancos      : false,\r\n            pagar       : false,\r\n            provisoes   : false,\r\n            negociados  : false,\r\n            compra_d    : true,\r\n            receber_d   : true,\r\n            bancos_d    : true,\r\n            pagar_d     : true,\r\n            provisoes_d : true,\r\n            negociados_d: true\r\n        }\r\n\r\n\t\tfunction dataInicio(){\r\n            var data = new Date();\r\n            var dia = data.getDate();\r\n            if (dia.toString().length == 1)\r\n              dia = \"0\"+dia;\r\n            var mes = data.getMonth()+1;\r\n            if (mes.toString().length == 1)\r\n              mes = \"0\"+mes;\r\n            var ano = data.getFullYear();  \r\n            return mes+\"/01/\"+ano;\r\n        }\r\n\r\n        function dataFim(){\r\n            var data = new Date();\r\n            var dia = data.getDate();\r\n            if (dia.toString().length == 1)\r\n              dia = \"0\"+dia;\r\n            var mes = data.getMonth()+1;\r\n            if (mes.toString().length == 1)\r\n              mes = \"0\"+mes;\r\n            var ano = data.getFullYear();  \r\n            return mes+\"/\"+dia+\"/\"+ano;\r\n        }\r\n\r\n        vm.TratarOrdem = function(filtro){\r\n            if(vm.ordem == filtro){\r\n                vm.ordem = '-'+filtro;\r\n            }else{\r\n                vm.ordem = filtro;\r\n            }\r\n        };\r\n\r\n        vm.GerarDatas = function(dados, tipo){\r\n\r\n            var dataold = '';\r\n            var cont = 0;\r\n            var hoje = new Date();\r\n            var data = new Date(); \r\n\r\n            angular.forEach(dados, function(value, key) {\r\n                var notIn = true;\r\n\r\n                if(dataold != value.DATA_FLUXO2){\r\n\r\n                    angular.forEach(vm.DADOS.FLUXO , function(v, k) {\r\n                        if(v.DATA_FLUXO2 == value.DATA_FLUXO2){\r\n                            notIn = false;\r\n                        }\r\n                    });\r\n\r\n                    if(notIn == true){\r\n\r\n                        data = new Date(value.DATA_FLUXO); \r\n                        var FLAG = hoje > data;\r\n\r\n                        if(hoje == data){\r\n                            FLAG = false;\r\n                        }\r\n\r\n                        vm.DADOS.FLUXO.push({FLAG: FLAG, DIA_SEMANA: value.DIA_SEMANA, DATA_FLUXO2 : value.DATA_FLUXO2, DATA_FLUXO : value.DATA_FLUXO ,PAGAMENTO:0, NEGOCIADO: 0, COMPRA: 0, RECEBIMENTO: 0, PAGAR:0, RECEBER:0, SALDODIA:0, SALDO: 0});\r\n                    }\r\n                }\r\n\r\n                dataold = value.DATA_FLUXO2;\r\n\r\n                //vm.GerarDatas(vm.DADOS.Negociados   , 1);\r\n                //vm.GerarDatas(vm.DADOS.Provisoes    , 2);\r\n                //vm.GerarDatas(vm.DADOS.ContaPagar   , 3);\r\n                //vm.GerarDatas(vm.DADOS.ContaReceber , 4);\r\n                //vm.GerarDatas(vm.DADOS.OrdensCompra , 5);\r\n\r\n                angular.forEach(vm.DADOS.FLUXO , function(v, k) {\r\n                    \r\n                    if(value.DATA_FLUXO2 == v.DATA_FLUXO2){\r\n\r\n                        if(tipo == 1){\r\n                            v.NEGOCIADO = Number(v.NEGOCIADO) + Number(value.VALOR_SALDO);\r\n                        }\r\n                        if(tipo == 2){\r\n\r\n                            if(value.TIPO == 'C'){\r\n                                v.RECEBIMENTO = Number(v.RECEBIMENTO) + Number(value.VALOR_TOTAL);\r\n                                v.SALDODIA    = Number(v.SALDODIA)    - Number(value.VALOR_TOTAL);\r\n                                vm.DADOS.FLUXO_TOTAL.RECEBIMENTO      = Number(vm.DADOS.FLUXO_TOTAL.RECEBIMENTO) + Number(value.VALOR_TOTAL);\r\n                                vm.DADOS.FLUXO_TOTAL.RECEBIMENTO      = Number(vm.DADOS.FLUXO_TOTAL.RECEBIMENTO) - Number(value.VALOR_TOTAL);\r\n                            }else{\r\n                                v.PAGAMENTO = Number(v.PAGAMENTO) + Number(value.VALOR_TOTAL);\r\n                                v.SALDODIA  = Number(v.SALDODIA)  - Number(value.VALOR_TOTAL);\r\n                                vm.DADOS.FLUXO_TOTAL.PAGAMENTO    = Number(vm.DADOS.FLUXO_TOTAL.PAGAMENTO) + Number(value.VALOR_TOTAL);\r\n                                vm.DADOS.FLUXO_TOTAL.SALDODIA     = Number(vm.DADOS.FLUXO_TOTAL.SALDODIA)  - Number(value.VALOR_TOTAL);\r\n                            }\r\n\r\n                        }\r\n                        if(tipo == 3){\r\n                            v.PAGAR    = Number(v.PAGAR)    + Number(value.VALOR_SALDO);\r\n                            v.SALDODIA = Number(v.SALDODIA) - Number(value.VALOR_SALDO);\r\n                            vm.DADOS.FLUXO_TOTAL.PAGAR      = Number(vm.DADOS.FLUXO_TOTAL.PAGAR)    + Number(value.VALOR_SALDO);\r\n                            vm.DADOS.FLUXO_TOTAL.SALDODIA   = Number(vm.DADOS.FLUXO_TOTAL.SALDODIA) - Number(value.VALOR_SALDO);\r\n                        }\r\n                        if(tipo == 4){\r\n                            v.RECEBER  = Number(v.RECEBER)  + Number(value.VALOR_SALDO);\r\n                            v.SALDODIA = Number(v.SALDODIA) + Number(value.VALOR_SALDO);\r\n                            vm.DADOS.FLUXO_TOTAL.RECEBER    = Number(vm.DADOS.FLUXO_TOTAL.RECEBER)  + Number(value.VALOR_SALDO);\r\n                            vm.DADOS.FLUXO_TOTAL.SALDODIA   = Number(vm.DADOS.FLUXO_TOTAL.SALDODIA) + Number(value.VALOR_SALDO);\r\n                        }\r\n                        if(tipo == 5){\r\n                            v.COMPRA   = Number(v.COMPRA)   + Number(value.VALOR);\r\n                            v.SALDODIA = Number(v.SALDODIA) - Number(value.VALOR);\r\n                            vm.DADOS.FLUXO_TOTAL.COMPRA     = Number(vm.DADOS.FLUXO_TOTAL.COMPRA)   + Number(value.VALOR);\r\n                            vm.DADOS.FLUXO_TOTAL.SALDODIA   = Number(vm.DADOS.FLUXO_TOTAL.SALDODIA) - Number(value.VALOR);\r\n                        }\r\n\r\n                    }\r\n\r\n                });\r\n                \r\n            });\r\n\r\n        }\r\n\r\n        vm.DATA1 = moment(dataInicio()).toDate();\r\n        vm.DATA2 = moment(dataFim()).toDate();\r\n\r\n        /*\r\n        vm.Consulta     = new $consulta();\r\n        gScope.Consulta = vm.Consulta;\r\n\r\n        vm.Consulta_Banco = vm.Consulta.getNew();\r\n\r\n        vm.Consulta_Banco.componente             = '.consulta_banco',\r\n        vm.Consulta_Banco.model                  = 'vm.Consulta_Banco',\r\n        vm.Consulta_Banco.option.label_descricao = 'Banco:',\r\n        vm.Consulta_Banco.option.obj_consulta    = '/_20110/ConsultarBanco',\r\n        vm.Consulta_Banco.option.tamanho_Input   = 'input-maior';\r\n        vm.Consulta_Banco.option.class           = 'consulta_banco_grup';\r\n        vm.Consulta_Banco.option.tamanho_tabela  = 350;\r\n\r\n        vm.Consulta_Banco.compile();\r\n        */\r\n\r\n         vm.Consulta_Banco = {\r\n            item : {\r\n                selected : false,\r\n                dados    : {DESCRICAO: '', ID: 0}\r\n            }\r\n         };\r\n\r\n        vm.Acoes = {\r\n            imprimir : function(){\r\n                var valido = true;\r\n\r\n                if(valido == true){\r\n                    var user = $('#usuario-descricao').val();\r\n\r\n                    var banco = '';\r\n                    if(vm.Consulta_Banco.item.selected == true){\r\n                        banco = 'Banco:' + vm.Consulta_Banco.item.dados.DESCRICAO;\r\n                    }else{\r\n                        banco = 'Banco: Todos'    \r\n                    }\r\n\r\n                    var periodo = '';\r\n                    if( vm.dataTodas == true){\r\n                        periodo = 'Período: Todos';\r\n                    }else{\r\n                        periodo = 'Período:' + moment(vm.DATA1).format('L') +' a '+ moment(vm.DATA2).format('L');   \r\n                    }\r\n\r\n                    var filtro = banco + ' / ' + periodo;\r\n                    printHtml('container-registros', 'Relatório de Fluxo de Caixa', filtro, user, '1.0.0',1,'');\r\n                }\r\n\r\n            },\r\n            export1 : function(){\r\n                exportTableToCsv('extrato.csv', 'tabela-registros');\r\n            },\r\n            export2 : function(){\r\n                exportTableToXls('extrato.xls', 'tabela-registros');\r\n            },\r\n            filtrar : function(){\r\n                var valido = true;\r\n\r\n                if(vm.Consulta_Banco.item.selected == false){\r\n                    //showErro('Selecione um banco!');\r\n                    //valido = false;\r\n\r\n                    vm.Consulta_Banco.item.dados.ID = 0;\r\n                }\r\n\r\n                if(vm.DATA2 < vm.DATA1){\r\n                    showErro('Período invalido');\r\n                    valido = false;\r\n                }\r\n\r\n                if(valido == true){\r\n                    this.exec();   \r\n                }\r\n\r\n            },\r\n            exec : function(){\r\n\r\n                var that  = this;\r\n\r\n                vm.DADOS.EXTRATO = [];\r\n                vm.DADOS.DETALHE = [];\r\n                vm.DADOS.RELATORIO = [];\r\n\r\n                var dados = {\r\n                    DATA1    : vm.DATA1,\r\n                    DATA2    : vm.DATA2,\r\n                    DETALHAR : vm.DETALHAR,\r\n                    BANCO    : vm.Consulta_Banco.item.dados,\r\n                    DETALHES : vm.detalhar,\r\n                    TODOS    : vm.dataTodas\r\n                };\r\n\r\n                $ajax.post('/_20110/ConsultarFluxo',dados)\r\n                    .then(function(response) {\r\n\r\n                        //vm.DADOS = response;\r\n\r\n                        var dataold = '';\r\n\r\n                        vm.DADOS.Bancos = {};\r\n\r\n                        \r\n                        \r\n                        vm.DADOS.Negociados   = response.Negociados   ;\r\n                        vm.DADOS.Provisoes    = response.Provisoes    ;\r\n                        vm.DADOS.ContaPagar   = response.ContaPagar   ;\r\n                        vm.DADOS.ContaReceber = response.ContaReceber ;\r\n                        vm.DADOS.OrdensCompra = response.OrdensCompra ;\r\n                        vm.DADOS.FLUXO = [];\r\n\r\n                        vm.DADOS.FLUXO_TOTAL = {\r\n                            PAGAMENTO:0,\r\n                            NEGOCIADO:0,\r\n                            COMPRA:0,\r\n                            RECEBIMENTO:0,\r\n                            PAGAR:0,\r\n                            RECEBER:0,\r\n                            SALDODIA:0,\r\n                            SALDO: 0,\r\n                            SALDO_BANCO: 0\r\n                        }; \r\n\r\n\r\n                        if(vm.detalhar.negociados_d == true){vm.GerarDatas(vm.DADOS.Negociados   , 1);}\r\n                        if(vm.detalhar.provisoes_d  == true){vm.GerarDatas(vm.DADOS.Provisoes    , 2);}\r\n                        if(vm.detalhar.pagar_d      == true){vm.GerarDatas(vm.DADOS.ContaPagar   , 3);}\r\n                        if(vm.detalhar.receber_d    == true){vm.GerarDatas(vm.DADOS.ContaReceber , 4);}\r\n                        if(vm.detalhar.compra_d     == true){vm.GerarDatas(vm.DADOS.OrdensCompra , 5);}\r\n\r\n                        if(vm.detalhar.negociados == true){gcCollection.bind(vm.DADOS.FLUXO  , vm.DADOS.Negociados   , 'DATA_FLUXO2', 'Negociados'  );}\r\n                        if(vm.detalhar.provisoes  == true){gcCollection.bind(vm.DADOS.FLUXO  , vm.DADOS.Provisoes    , 'DATA_FLUXO2', 'Provisoes'   );}\r\n                        if(vm.detalhar.pagar      == true){gcCollection.bind(vm.DADOS.FLUXO  , vm.DADOS.ContaPagar   , 'DATA_FLUXO2', 'ContaPagar'  );}\r\n                        if(vm.detalhar.receber    == true){gcCollection.bind(vm.DADOS.FLUXO  , vm.DADOS.ContaReceber , 'DATA_FLUXO2', 'ContaReceber');}\r\n                        if(vm.detalhar.compra     == true){gcCollection.bind(vm.DADOS.FLUXO  , vm.DADOS.OrdensCompra , 'DATA_FLUXO2', 'OrdensCompra');}\r\n\r\n\r\n                        function compare(a,b) {\r\n                          return a.DATA_FLUXO < b.DATA_FLUXO ? -1 : a.DATA_FLUXO > b.DATA_FLUXO ? 1 : 0;\r\n                        }\r\n\r\n                        vm.DADOS.FLUXO.sort(compare);\r\n\r\n                        var saldo = 0;\r\n\r\n                        vm.DADOS.Bancos = [];\r\n\r\n                        if(vm.detalhar.bancos == true){\r\n                            vm.DADOS.Bancos = response.Bancos ;\r\n                        }else{\r\n                            if(vm.detalhar.bancos == false){\r\n                                vm.DADOS.Bancos.push({\r\n                                    NOME  : response.Bancos[response.Bancos.length -1].NOME,\r\n                                    SALDO : response.Bancos[response.Bancos.length -1].SALDO\r\n                                });\r\n                            }\r\n                        }\r\n\r\n                        angular.forEach(response.Bancos , function(v, k) {\r\n                            saldo = Number(v.SALDO);\r\n\r\n                            \r\n                        });\r\n\r\n                        vm.DADOS.FLUXO_TOTAL.SALDO_BANCO = saldo;\r\n\r\n                        angular.forEach(vm.DADOS.FLUXO , function(v, k) {\r\n                            saldo = Number(saldo) + Number(v.SALDODIA);\r\n                            v.SALDO = Number(saldo);\r\n                        });\r\n\r\n                        vm.DADOS.FLUXO_TOTAL.SALDO = saldo;\r\n                        \r\n\r\n                        console.log(vm.DADOS);\r\n\r\n                        /*\r\n                        var dataold = '';\r\n\r\n                        gcCollection.merge(vm.DADOS.EXTRATO   , response.EXTRATO   , 'CONTROLE');\r\n                        gcCollection.merge(vm.DADOS.DETALHE   , response.DETALHE   , 'CONTROLE');\r\n\r\n                        if(vm.DETALHAR == true){\r\n                            gcCollection.bind(vm.DADOS.EXTRATO    , vm.DADOS.DETALHE   , 'CONTROLE|CAIXABANCO_CONTROLE', 'DETALHES');\r\n                        }\r\n\r\n                        var cont = 0;\r\n                        angular.forEach(vm.DADOS.EXTRATO, function(value, key) {\r\n                            var notIn = true;\r\n\r\n                            if(cont == 0){\r\n                                vm.SALDO_ANTERIOR = value.SALDO_ANTERIOR;\r\n                            }\r\n\r\n                            if(dataold != value.DATA){\r\n\r\n                                angular.forEach(vm.DADOS.RELATORIO, function(v, k) {\r\n                                    if(v.DATA == value.DATA){\r\n                                        notIn = false;\r\n                                    }\r\n                                });\r\n\r\n                                if(notIn == true){\r\n                                    vm.DADOS.RELATORIO.push({DATA : value.DATA, DEBITO: 0, CREDITO: 0, SALDO: 0});\r\n                                }\r\n                            }\r\n\r\n                            dataold = value.DATA;\r\n\r\n                            angular.forEach(vm.DADOS.RELATORIO, function(v, k) {\r\n                                if(v.DATA == dataold){\r\n                                    v.DEBITO  = value.ACUMULADO_DEBITO_DIA; \r\n                                    v.CREDITO = value.ACUMULADO_CREDITO_DIA; \r\n                                    v.SALDO   = value.SALDO; \r\n\r\n                                    vm.TOTAL.DEBITO  = value.ACUMULADO_DEBITO; \r\n                                    vm.TOTAL.CREDITO = value.ACUMULADO_CREDITO; \r\n                                    vm.TOTAL.SALDO   = value.SALDO; \r\n                                }\r\n                            });\r\n\r\n                            \r\n                        });\r\n                        \r\n                        gcCollection.bind(vm.DADOS.RELATORIO  , vm.DADOS.EXTRATO   , 'DATA', 'EXTRATO');\r\n\r\n                        console.log(vm.DADOS);\r\n\r\n                        cont = cont + 1;\r\n                        */\r\n\r\n                    }\r\n                );\r\n            }\r\n        }\r\n\t}   \r\n    "]}