{"version":3,"sources":["PrintZebra.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PrintZebra.js","sourcesContent":["   \n    var available_printers = null;\n    var selected_category = null;\n    var default_printer = null;\n    var selected_printer = null;\n    var default_mode = true;\n    var impressoras = [];\n\n    function setup_web_print()\n    {\n        var OSName=\"Unknown OS\";\n        if (navigator.appVersion.indexOf(\"Win\")!=-1) OSName=\"Windows\";\n        if (navigator.appVersion.indexOf(\"Mac\")!=-1) OSName=\"MacOS\";\n        if (navigator.appVersion.indexOf(\"X11\")!=-1) OSName=\"UNIX\";\n        if (navigator.appVersion.indexOf(\"Linux\")!=-1) OSName=\"Linux\";\n        \n        showLoading(\"Carregando informações da impressora...\");\n        default_mode = false;\n        selected_printer = null;\n        available_printers = null;\n        selected_category = null;\n        default_printer = null;\n\n        BrowserPrint.getDefaultDevice('printer', function(printer)\n        {\n            default_printer = printer\n            if((printer != null) && (printer.connection != undefined))\n            {\n                selected_printer = printer;\n                var printer_details = $('#printer_details');\n                var selected_printer_div = $('#selected_printer');\n\n                selected_printer_div.text(\"Impressora: \" + printer.name);\n                hideLoading();\n                printer_details.show();\n                $('#print_form').show();\n\n            }\n            BrowserPrint.getLocalDevices(function(printers)\n                {\n                    available_printers = printers;\n                    var sel = $('.list-printers');\n                    var def_print = '';\n                    var printers_available = false;\n                    sel.innerHTML = \"\";\n                    \n                    \n                    if (printers != undefined)\n                    {\n                        for(var i = 0; i < printers.length; i++)\n                        {\n                                var fabs = impressoras;\n                                var cad = false;\n                                \n                                var opt = document.createElement(\"option\");\n                                \n                                fabs.forEach(function(fab){\n                                    \n                                    if(fab[0].toUpperCase() == printers[i].uid.toUpperCase()){\n                                        opt.innerHTML = fab[1];\n                                        opt.value = printers[i].uid;\n                                        sel.append(opt);\n                                        printers_available = true;\n                                        cad = true;\n                                        \n                                        if(fab[3] == 1){\n                                            $(opt).addClass('defaltprint');\n                                            def_print = printers[i].uid;\n                                            $(opt).prop('selected','selected');\n                                        }\n                                        \n                                    }\n                                });\n                                \n                                if(cad == false){\n                                    opt.innerHTML = printers[i].connection + \": \" + printers[i].uid;\n                                    opt.value = printers[i].uid;\n                                    sel.append(opt);\n                                    printers_available = true;\n                                    cad = true;\n                                }\n                        }\n                        \n                        $('.defaltprint').prop('selected','selected');\n\n                    }\n\n                    if(!printers_available)\n                    {\n                        showErrorMessage(\"Não foi possível encontrar uma impressora\");\n                        hideLoading();\n                        $('#print_form').hide();\n                        return;\n                    }\n                    else if(selected_printer == null)\n                    {\n                        default_mode = false;\n                        changePrinter();\n                        $('#print_form').show();\n                        hideLoading();\n                    }\n                }, undefined, 'printer');\n        }, \n        function(error_response)\n        {\n            showBrowserPrintNotFound();\n        });\n    };\n    \n    function showBrowserPrintNotFound()\n    {\n        showErrorMessage(\"Ocorreu um erro ao tentar se conectar a sua impressora Zebra.\");\n    };\n    \n    function putCodPrint(codigo)\n    {\n        \n        showLoading(\"Imprimindo...\");\n        checkPrinterStatus( function (text){\n            if (text == \"Ready to Print\")\n            {\n                selected_printer.send(codigo, printComplete, printerError);\n            }\n            else\n            {\n                printerError(text);\n            }\n        });\n    };\n    \n    function checkPrinterStatus(finishedFunction)\n    {\n        selected_printer.sendThenRead(\"~HQES\", \n                    function(text){\n                            var that = this;\n                            var statuses = new Array();\n                            var ok = false;\n                            var is_error = text.charAt(70);\n                            var media = text.charAt(88);\n                            var head = text.charAt(87);\n                            var pause = text.charAt(84);\n                            // check each flag that prevents printing\n                            if (is_error == '0')\n                            {\n                                ok = true;\n                                statuses.push(\"Ready to Print\");\n                            }\n                            if (media == '1')\n                                statuses.push(\"Paper out\");\n                            if (media == '2')\n                                statuses.push(\"Ribbon Out\");\n                            if (media == '4')\n                                statuses.push(\"Media Door Open\");\n                            if (media == '8')\n                                statuses.push(\"Cutter Fault\");\n                            if (head == '1')\n                                statuses.push(\"Printhead Overheating\");\n                            if (head == '2')\n                                statuses.push(\"Motor Overheating\");\n                            if (head == '4')\n                                statuses.push(\"Printhead Fault\");\n                            if (head == '8')\n                                statuses.push(\"Incorrect Printhead\");\n                            if (pause == '1')\n                                statuses.push(\"Printer Paused\");\n                            if ((!ok) && (statuses.Count == 0))\n                                statuses.push(\"Error: Unknown Error\");\n                            finishedFunction(statuses.join());\n                }, printerError);\n    };\n    function hidePrintForm()\n    {\n        $('#print_form').hide();\n    };\n    function showPrintForm()\n    {\n        $('#print_form').show();\n    };\n    function showLoading(text)\n    {\n        $('#loading_message').text(text);\n        $('#printer_data_loading').show();\n        hidePrintForm();\n        $('#printer_details').hide();\n        $('#printer_select').hide();\n    };\n    function printComplete()\n    {\n        hideLoading();\n        //alert (\"Fim da impressão\");\n        $('.modal.confirm').prev('.modal-backdrop.confirm').remove();\n        $('.modal.confirm').remove();\n    }\n    function hideLoading()\n    {\n        $('#printer_data_loading').hide();\n        if(default_mode == true)\n        {\n            showPrintForm();\n            $('#printer_details').show();\n        }\n        else\n        {\n            $('#printer_select').show();\n            showPrintForm();\n        }\n    };\n    function changePrinter()\n    {\n        default_mode = false;\n        selected_printer = null;\n        $('#printer_details').hide();\n        if(available_printers == null)\n        {\n            showLoading(\"Carregando impressora...\");\n            $('#print_form').hide();\n            setTimeout(changePrinter, 200);\n            return;\n        }\n        $('#printer_select').show();\n        onPrinterSelected();\n\n    }\n    function onPrinterSelected()\n    {\n        selected_printer = available_printers[$('.list-printers')[0].selectedIndex];\n    }\n    function showErrorMessage(text)\n    {\n        $('#main').hide();\n        $('#error_div').show();\n        $('#error_message').html(text);\n    }\n    function printerError(text)\n    {\n        showErrorMessage(\"Ocorreu um erro durante a impressão. Por favor, tente novamente.\" + text);\n    }\n    function trySetupAgain()\n    {\n        $('#main').show();\n        $('#error_div').hide();\n        setup_web_print();\n        changePrinter();\n    }\n    \n    function dialogPrint(codigo){\n        \n        addConfirme('Impressão',''\n        +'<div id=\"printer_data_loading\" style=\"display:none\"><span id=\"loading_message\">Carregando Detalhes da impressora...</span><br/>'\n        +'  <div class=\"progress\" style=\"width:100%\">'\n        +'    <div class=\"progress-bar progress-bar-striped active\"  role=\"progressbar\" aria-valuenow=\"100\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 100%\">'\n        +'    </div>'\n        +'  </div>'\n        +'</div>'\n        +''\n        +'<div id=\"printer_select\" style=\"display:none\">'\n        +'  Impressora: <select class=\"list-printers\"></select>'\n        +'</div>'\n        +''\n        +'<div id=\"error_div\" style=\"padding: 16px;display:none\"><div id=\"error_message\"></div>'\n        +'<button type=\"button\" class=\"btn btn-success\" onclick=\"trySetupAgain();\">Tentar novamente</button></div>'\n        +'<textarea style=\"display:none\" name=\"dados-post-print\" class=\"dados-post-print\" rows=\"5\" value=\"'+codigo+'\" cols=\"100\" required>'+codigo+'</textarea>',\n            [\n                {desc:'Imprimir',class:'btn-primary btn-confirm-sim',ret:'1',hotkey:'enter',glyphicon:'glyphicon-ok'},\n                {desc:'Cancelar',class:'btn-danger btn-confirm-can btn-voltar',ret:'2',hotkey:'esc',glyphicon:'glyphicon-ban-circle'}\n            ],\n            [\n                {ret:1,func:function(){\n                    var codigo = $('.dados-post-print').val();\n                    putCodPrint(codigo);\n                }},\n                {ret:2,func:function(){\n                    $('.modal.confirm').prev('.modal-backdrop.confirm').remove();\n                    $('.modal.confirm').remove();\n                }}\n            ],'N'    \n        );\n        \n        setTimeout(function(){\n            setup_web_print();\n            \n            $('#printer_select').on('change', onPrinterSelected);\n            \n            changePrinter();\n            \n        },200);\n        \n    }\n    /*\n    function postprint(codigo){\n        dialogPrint(codigo);\n    }\n    */\n(function ($) {\n    \n    var time;\n    var iniciado = 0;\n    \n    $( \".postprint\" ).on( \"click\", function(e) {\n    \n        var codigo = $('.codigo').val();\n        postprint(codigo);\n        \n    });\n    \n    $(document).ready(function(){\n        /*\n            function success(data) {\n                if(data) {\n                    impressoras = data;\n                } \n            }\n\n            function erro(xhr){\n                showErro(xhr);  \n            }\n\n            var dados = {\n                'codigo'  : ''\n            };\n\n            execAjax1('POST','/getPrints',dados,success,erro);\n        //*/\n    });\n    \n})(jQuery);"]}