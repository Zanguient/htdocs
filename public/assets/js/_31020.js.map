{"version":3,"sources":["_31020.app.js","_31020.factory.rateio-ccusto.js","_31020.factory.ccusto-absorcao.js","_31020.controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/bA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_31020.js","sourcesContent":["'use strict';\n\nangular\n\t.module('app', [\n\t\t'vs-repeat', \n        'gc-find',\n\t\t'gc-ajax',\n\t\t'gc-transform',\n\t\t'gc-form',\n\t\t'gc-utils'\n\t])\n;\n     ","(function(window, angular) {\n    'use strict';\n\n    angular\n        .module('app')\n        .factory('RateioCCusto', RateioCCusto);\n\n\tRateioCCusto.$inject = [\n        '$ajax',\n        '$q',\n        '$rootScope',\n        '$compile',\n        '$timeout',\n        '$consulta',\n        'gScope',\n        'gcCollection',\n        'gcObject'\n    ];\n\n\tfunction RateioCCusto($ajax, $q, $rootScope, $compile,$timeout, $consulta, gScope, gcCollection, gcObject) {\n\n        // Private variables.\n        var obj = null;\n        var selected = null;\n        \n        \n\t    /**\n\t     * Constructor, with class name\n\t     */\n\t    function RateioCCusto() {\n            \n            obj = this; \n\n            // Public methods         \n            this.consultar     = consultar;\n            this.merge         = merge;\n            \n            this.incluir        = incluir; \n            this.confirmar      = confirmar; \n            this.alterar        = alterar; \n            this.cancelar       = cancelar; \n            this.excluir        = excluir; \n          \n            this.processarOrdem = processarOrdem;\n            this.tipoChange = tipoChange;          \n            this.regraChange = regraChange;          \n            this.origemChange = origemChange;\n            this.grupoChange = grupoChange;\n          \n            this.Modal         = Modal; \n            \n            \n            this.INCLUINDO = false;\n            this.ALTERANDO = false;\n            this.DADOS = [];\n            this.DADOS_RENDER = [];\n\n            this.RATEAMENTO_GRUPOS = [];\n                    \n            this.CCUSTOS_MESES = [];\n            this.CCUSTOS_TIPOS_MESES = [];\n            this.CCUSTOS_TIPOS = [];\n            this.CCUSTOS = [];\n            \n            this.TOTAL_GERAL = 0;\n            this.SELECTEDS = [];\n            this.SELECTED = [];\n            this.SELECTED_BACKUP = [];\n            \n\t    }\n        \n        \n        \n\n        function consultar() {\n            \n            return $q(function(resolve, reject){\n                $ajax.get('/_31020/api/rateio/ccusto').then(function(response){\n                    \n                    obj.merge(response);\n                    \n                    resolve(response);\n                },function(e){\n                    reject(e);\n                });\n            });\n        }                \n        \n        /**\n         * Retorna a view da factory\n         */\n        function merge(response) {\n            \n            sanitizeJson(response);\n            \n            \n            gcCollection.merge(obj.DADOS, response, ['ID']);\n            \n            \n            var rateamento_grupos = gcCollection.groupBy(obj.DADOS,[\n                'RATEAMENTO_GRUPO',\n                'RATEAMENTO_GRUPO_DESCRICAO'\n            ],'CCUSTOS');\n            \n            \n            gcCollection.merge(obj.RATEAMENTO_GRUPOS, rateamento_grupos, ['RATEAMENTO_GRUPO']);\n            \n            if ( obj.RATEAMENTO_GRUPO == undefined && obj.RATEAMENTO_GRUPOS.length > 0 ) {\n                obj.RATEAMENTO_GRUPO = obj.RATEAMENTO_GRUPOS[0];\n            }\n            \n            \n            var item = null;\n            for ( var i in obj.DADOS ) {\n                item = obj.DADOS[i];\n                \n                item.CCUSTOS = undefined;\n                item.EXCLUIDO = false;\n            }\n            \n        }\n        \n        function incluir() {\n            \n            var abrangencia = 0;\n            var ordem       = 1;\n            \n            if ( obj.SELECTED != undefined && obj.SELECTED.ABRANGENCIA > 0 ) {\n                abrangencia = obj.SELECTED.ABRANGENCIA;\n                ordem       = obj.SELECTED.ORDEM -1;\n            }\n            \n            obj.SELECTED = {\n                ABRANGENCIA      : abrangencia,\n                ORDEM            : ordem,\n                REGRA_RATEAMENTO : 1,\n                VALOR_ORIGEM     : 1,\n                RATEAMENTO_GRUPO : 1,\n                EXCLUIDO         : false\n            };\n            \n            obj.regraChange(1);\n            obj.origemChange(1);\n            obj.grupoChange(1);\n            \n            gScope.Ctrl.ConsultaCcusto.apagar(true);\n            \n            obj.DADOS.push(obj.SELECTED);\n            \n            obj.INCLUINDO = true;\n            obj.ALTERANDO = true;\n            obj.Modal.show();\n\n//            obj.selectedReset();\n        }\n        \n        function confirmar() {\n       \n            obj.processarOrdem();\n            \n            var dados = {\n                FILTRO: {},\n                DADOS : obj.DADOS\n            };\n//    \n            $ajax.post('/_31020/api/rateio/ccusto/post',dados).then(function(response){\n\n                obj.merge(response.DATA_RETURN);\n                \n            });\n        }\n\n        function alterar() {\n            \n//            gScope.Ctrl.ImobilizadoItem.SELECTEDS = [];\n            \n            gScope.Ctrl.ConsultaCcusto.setDataRequest({});\n            \n            gScope.Ctrl.ConsultaCcusto.Input.value = obj.SELECTED.CCUSTO_MASK + ' - ' + obj.SELECTED.CCUSTO_DESCRICAO;\n            \n            gScope.Ctrl.ConsultaCcusto.Input.readonly             = true;\n            gScope.Ctrl.ConsultaCcusto.btn_apagar_filtro.visivel  = true;\n            gScope.Ctrl.ConsultaCcusto.btn_apagar_filtro.disabled = false;\n            gScope.Ctrl.ConsultaCcusto.btn_filtro.visivel         = false;            \n            \n            gScope.Ctrl.ConsultaCcusto.item.selected = true;            \n            \n            this.ALTERANDO = true;\n            this.INCLUINDO = false;\n            angular.copy(this.SELECTED, this.SELECTED_BACKUP);\n            \n            obj.Modal.show();\n        };        \n        \n        function cancelar() {\n            addConfirme('<h4>Confirmação</h4>',\n                'Deseja realmente cancelar esta operação?',\n                [obtn_sim,obtn_nao],\n                [{ret:1,func:function(){\n                    $rootScope.$apply(function(){\n                        \n                             \n                        \n                        if ( obj.ALTERANDO && !obj.INCLUINDO ) {\n                            angular.extend(obj.SELECTED, obj.SELECTED_BACKUP);  \n                            \n                            obj.Modal.hide();\n                        }\n                        \n                        obj.ALTERANDO = false;\n                        \n                        if ( obj.INCLUINDO ) {\n                            obj.INCLUINDO = false;\n                            \n                            var idx = obj.DADOS.indexOf(obj.SELECTED);\n                            \n                            obj.DADOS.splice(idx,1);                            \n                            \n//                            obj.selectedReset();\n                            obj.Modal.hide();\n                        }\n                    });\n                }}]     \n            );\n        }\n        \n        function excluir() {\n            addConfirme('<h4>Confirmação</h4>',\n                'Deseja realmente excluir este item?',\n                [obtn_sim,obtn_nao],\n                [{ret:1,func:function(){\n                    $rootScope.$apply(function(){\n                        \n                        obj.SELECTED.EXCLUIDO = true;\n                    });\n                }}]     \n            );\n        }\n        \n        \n        /**\n         * Retorna a view da factory\n         */\n        function renderChart(response) {\n\n\n            var obj = $('#chart_div');\n            var pai = $(obj).closest('#chart-google');\n\n            google.charts.load('current', {packages:[\"orgchart\"]});\n            google.charts.setOnLoadCallback(function() {\n                \n                var data = new google.visualization.DataTable();\n                data.addColumn('string', 'Name');\n                data.addColumn('string', 'Manager');\n                data.addColumn('string', 'ToolTip');\n\n                var dados = response;\n                var item = null;\n                \n                var chart_container = [];\n                var chart_item = [];\n                \n                for ( var i in dados ) {\n                    item = dados[i];\n                    \n                    chart_item = [\n                        {\n                            v:''+item.ID,\n                            f:item.CCUSTO_DESCRICAO,\n                            id: ''+item.ORDEM\n                        },\n                        ''+( (item.ORDEM - 1) > 0 ? item.ORDEM - 1 : ''),\n                        ''\n                    ];\n                    \n                    chart_container.push(chart_item);\n                }\n                \n                // For each orgchart box, provide the name, manager, and tooltip to show.\n                data.addRows(chart_container);\n\n                var chart = new google.visualization.OrgChart(document.getElementById('chart_div'));\n                chart.draw(data, {allowHtml:true});\n\n                setTimeout(function(){\n//\n//                    $('.img-loading').css('display','none');\n                    $(obj).replaceWith( $compile($(obj).html())($rootScope) );\n                    $(pai).append('<div style=\"width: 99%; height: 100%;\" id=\"chart_div\"></div>');\n\n                    $rootScope.$apply(function () {\n                        $rootScope.message = \"Timeout called!\";\n                    });\n\n                },400);\n            });\n                        \n            \n        }\n        \n        \n        function processarOrdem () {\n            \n            var item        = null; \n            var item_prev   = null;\n            var abrangencia = 0;\n            var ordem       = 0;\n            \n            for ( var i in obj.DADOS_RENDER ) {\n                item = obj.DADOS_RENDER[i];\n                item_prev = obj.DADOS_RENDER[parseInt(i)-1];\n                \n                \n                if ( item_prev == undefined || item_prev.ABRANGENCIA != item.ABRANGENCIA ) {\n                    item.ABRANGENCIA_CHANGE = true;\n                } else {\n                    item.ABRANGENCIA_CHANGE = false;\n                }\n            }\n            \n            for ( var i in obj.DADOS_RENDER ) {\n                item = obj.DADOS_RENDER[i];\n                \n                if ( item.ABRANGENCIA_CHANGE ) {\n                    abrangencia += 10;\n                    ordem        = 1;\n                }\n                \n                item.ABRANGENCIA = abrangencia;\n                item.ORDEM       = ordem;\n                \n                ordem++;\n            }\n        }\n        \n        function tipoChange(id) {\n            var idx = indexOfAttr(gScope.Ctrl.rateioTipos,'ID',id);\n            \n            if ( idx == -1 ) {\n                idx = 0;\n            }\n            obj.SELECTED.TIPO_ID        = gScope.Ctrl.rateioTipos[idx].ID;\n            obj.SELECTED.TIPO_DESCRICAO = gScope.Ctrl.rateioTipos[idx].DESCRICAO;\n        }          \n        \n        function regraChange(id) {\n            \n            switch (id) {\n                case 1:\n                obj.SELECTED.REGRA_RATEAMENTO_DESCRICAO = '01 - COLABORADORES';\n                break;\n                case 2:\n                obj.SELECTED.REGRA_RATEAMENTO_DESCRICAO = '02 - AREA';\n                break;\n                case 3:\n                obj.SELECTED.REGRA_RATEAMENTO_DESCRICAO = '03 - MÁQUINAS';\n                break;\n                case 4:\n                obj.SELECTED.REGRA_RATEAMENTO_DESCRICAO = '04 - FIXO';\n                break;\n            }\n        }\n        \n        function origemChange(id) {\n            \n            switch (id) {\n                case 1:\n                obj.SELECTED.VALOR_ORIGEM_DESCRICAO = '01 - SALÁRIOS';\n                break;\n                case 2:\n                obj.SELECTED.VALOR_ORIGEM_DESCRICAO = '02 - OUTROS';\n                break;\n            }\n        }\n        \n        function grupoChange(id) {\n            \n            switch (id) {\n                case 1:\n                obj.SELECTED.RATEAMENTO_GRUPO_DESCRICAO = '01 - CUSTO DE MÃO DE OBRA INDIRETA';\n                break;\n            }\n        }\n                \n        \n        var Modal = {\n            \n            _modal : function(){\n                return $('#modal-rateio-ccusto');\n            },\n            show : function(shown,hidden) {\n                \n                \n                gScope.Ctrl.CCustoAbsorcao.SELECTEDS = [];\n                if ( obj.SELECTED.CCUSTOS == undefined ) {\n                    gScope.Ctrl.CCustoAbsorcao.consultar();\n                }\n                                \n                this._modal()\n                    .modal('show')\n                ;                         \n\n\n                this._modal()\n                    .one('shown.bs.modal', function(){\n\n                        $(this).find('input:focusable').first().select();\n\n                        if ( shown ) {\n                            shown(); \n                        }\n                    })\n                ;    \n\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            \n                            if ( hidden ) {\n                                hidden();      \n                            }\n                        })\n                    ;        \n            },\n            hide : function(hidden) {\n\n                this._modal()\n                    .modal('hide')\n                ;\n\n                if ( hidden ) {\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            hidden ? hidden() : '';\n                        })\n                    ;                      \n                }\n            }\n        };     \n\n            \n\t    /**\n\t     * Return the constructor function\n\t     */\n\t    return RateioCCusto;\n\t};\n   \n})(window, window.angular);","(function(window, angular) {\n    'use strict';\n\n    angular\n        .module('app')\n        .factory('CCustoAbsorcao', CCustoAbsorcao);\n\n\tCCustoAbsorcao.$inject = [\n        '$ajax',\n        '$q',\n        '$rootScope',\n        '$compile',\n        '$timeout',\n        '$consulta',\n        'gScope',\n        'gcCollection',\n        'gcObject'\n    ];\n\n\tfunction CCustoAbsorcao($ajax, $q, $rootScope, $compile,$timeout, $consulta, gScope, gcCollection, gcObject) {\n\n        // Private variables.\n        var obj = null;\n        var selected = null;\n        \n        \n\t    /**\n\t     * Constructor, with class name\n\t     */\n\t    function CCustoAbsorcao() {\n            \n            obj = this; \n\n            // Public methods         \n            this.consultar     = consultar;\n            this.merge         = merge;\n            \n            this.incluir        = incluir; \n            this.confirmar      = confirmar; \n            this.alterar        = alterar; \n            this.cancelar       = cancelar; \n            this.excluir        = excluir; \n          \n            this.pick                    = pick; \n            this.unpick                  = unpick; \n            this.pickToggle              = pickToggle; \n            this.picked                  = picked; \n            this.pickReverse             = pickReverse; \n            this.pickAll                 = pickAll; \n            this.unpickAll               = unpickAll;           \n          \n            this.Modal         = Modal; \n            \n            \n            this.INCLUINDO = false;\n            this.ALTERANDO = false;\n            this.DADOS = [];\n            this.DADOS_RENDER = [];\n            this.MESES = [];\n            \n            this.GERAL_MESES = [];\n            this.GERAL = [];\n            \n            this.TIPOS_CCUSTOS = [];\n            \n            \n            this.TIPOS_MESES = [];\n            this.TIPOS = [];\n            this.TIPOS_CCUSTOS = [];\n            this.TIPOS_CCUSTOS_MESES = [];\n            \n            this.CCUSTOS_MESES = [];\n            this.CCUSTOS_TIPOS_MESES = [];\n            this.CCUSTOS_TIPOS = [];\n            this.CCUSTOS = [];\n            \n            this.TOTAL_GERAL = 0;\n            this.SELECTEDS = [];\n            this.SELECTED = [];\n            this.SELECTED_BACKUP = [];\n            \n\t    }\n        \n        \n        \n\n        function consultar() {\n            \n            return $q(function(resolve, reject){\n                $ajax.post('/_31020/api/ccusto/absorcao',{\n                    CCUSTO: gScope.Ctrl.RateioCCusto.SELECTED.CCUSTO + (gScope.Ctrl.RateioCCusto.SELECTED.HIERARQUIA == 1 ? '*' : '')\n                }).then(function(response){\n                    \n                    obj.merge(response);\n                    \n                    resolve(response);\n                },function(e){\n                    reject(e);\n                });\n            });\n        }                \n        \n        /**\n         * Retorna a view da factory\n         */\n        function merge(response) {\n            \n            sanitizeJson(response);\n            \n            \n            if ( gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS == undefined ) {\n                gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS = [];\n            }\n            \n            var dados = gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS;\n            \n            gcCollection.merge(dados, response, ['ID']);\n            \n            var item = null;\n            for ( var i in dados ) {\n                item = dados[i];\n                \n                item.EXCLUIDO = false;\n            }\n            \n            \n        }\n        \n        function incluir() {\n            \n            obj.SELECTED = {\n                CCUSTO_ABSORCAO  : gScope.Ctrl.RateioCCusto.SELECTED.CCUSTO + (gScope.Ctrl.RateioCCusto.SELECTED.HIERARQUIA == 1 ? '*' : ''),\n                PERC_ABSORCAO    : 0,\n                RATEAMENTO_GRUPO : 1,\n                EXCLUIDO         : false\n            };\n            \n            gScope.Ctrl.caConsultaCCusto.apagar(true);\n            \n            gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS.push(obj.SELECTED);\n            \n            obj.INCLUINDO = true;\n            obj.ALTERANDO = true;\n            obj.Modal.show();\n\n//            obj.selectedReset();\n        }\n        \n        function confirmar() {\n       \n            obj.processarOrdem();\n            \n            var dados = {\n                FILTRO: {},\n                DADOS : gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS\n            };\n//    \n            $ajax.post('/_31020/api/rateio/ccusto/post',dados).then(function(response){\n\n                obj.merge(response.DATA_RETURN);\n                \n            });\n        }\n\n        function alterar() {\n            \n//            gScope.Ctrl.ImobilizadoItem.SELECTEDS = [];\n            \n            gScope.Ctrl.ConsultaCcusto.setDataRequest({});\n            \n            gScope.Ctrl.ConsultaCcusto.Input.value = obj.SELECTED.CCUSTO_MASK + ' - ' + obj.SELECTED.CCUSTO_DESCRICAO;\n            \n            gScope.Ctrl.ConsultaCcusto.Input.readonly             = true;\n            gScope.Ctrl.ConsultaCcusto.btn_apagar_filtro.visivel  = true;\n            gScope.Ctrl.ConsultaCcusto.btn_apagar_filtro.disabled = false;\n            gScope.Ctrl.ConsultaCcusto.btn_filtro.visivel         = false;            \n            \n            gScope.Ctrl.ConsultaCcusto.item.selected = true;            \n            \n            this.ALTERANDO = true;\n            this.INCLUINDO = false;\n            angular.copy(this.SELECTED, this.SELECTED_BACKUP);\n            \n            obj.Modal.show();\n        };        \n        \n        function cancelar() {\n            addConfirme('<h4>Confirmação</h4>',\n                'Deseja realmente cancelar esta operação?',\n                [obtn_sim,obtn_nao],\n                [{ret:1,func:function(){\n                    $rootScope.$apply(function(){\n                        \n                             \n                        \n                        if ( obj.ALTERANDO && !obj.INCLUINDO ) {\n                            angular.extend(obj.SELECTED, obj.SELECTED_BACKUP);  \n                            \n                            obj.Modal.hide();\n                        }\n                        \n                        obj.ALTERANDO = false;\n                        \n                        if ( obj.INCLUINDO ) {\n                            obj.INCLUINDO = false;\n                            \n                            var idx = gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS.indexOf(obj.SELECTED);\n                            \n                            gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS.splice(idx,1);                            \n                            \n//                            obj.selectedReset();\n                            obj.Modal.hide();\n                        }\n                    });\n                }}]     \n            );\n        }\n        \n        function excluir() {\n            addConfirme('<h4>Confirmação</h4>',\n                'Deseja realmente excluir os itens selecionados?',\n                [obtn_sim,obtn_nao],\n                [{ret:1,func:function(){\n                    $rootScope.$apply(function(){\n                        \n                        var item = null;\n                        for ( var i in obj.SELECTEDS ) {\n                            item = obj.SELECTEDS[i];\n                            \n                            item.EXCLUIDO = true;\n                        }\n                    });\n                }}]     \n            );\n        }\n\n\n        function pick(item) {\n            \n            if ( !obj.picked(item) ) {\n                obj.SELECTEDS.push(item);\n            }\n        }\n        \n        function unpick(item) {\n            \n            if ( obj.picked(item) ) {\n                obj.SELECTEDS.splice(obj.SELECTEDS.indexOf(item),1);\n            }\n        }\n        \n        function pickToggle(item) {\n            \n            if ( !obj.picked(item) ) {\n                obj.SELECTEDS.push(item);\n            } else {\n                obj.SELECTEDS.splice(obj.SELECTEDS.indexOf(item),1);\n            }\n        }\n        \n        function pickReverse() {\n            var itens = gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS;\n            \n            for ( var i in itens ) {\n                obj.pickToggle(itens[i]);\n            }\n        }\n        \n        function picked(item) {\n            \n            var ret = true;\n            \n            if ( obj.SELECTEDS.indexOf(item) == -1 ) {\n                ret = false;\n            }\n            \n            return ret;\n        }\n        \n        function pickAll() {\n            var itens = gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS;\n            \n            for ( var i in itens ) {\n                obj.pick(itens[i]);\n            }\n        }\n        \n        function unpickAll() {\n            var itens = gScope.Ctrl.RateioCCusto.SELECTED.CCUSTOS;\n            \n            for ( var i in itens ) {\n                obj.unpick(itens[i]);\n            }\n        }\n        \n        function picked(item) {\n            \n            var ret = true;\n            \n            if ( obj.SELECTEDS.indexOf(item) == -1 ) {\n                ret = false;\n            }\n            \n            return ret;\n        }\n        \n        \n        var Modal = {\n            \n            _modal : function(){\n                return $('#modal-ccusto-absorcao');\n            },\n            show : function(shown,hidden) {\n\n                this._modal()\n                    .modal('show')\n                ;                         \n\n\n                this._modal()\n                    .one('shown.bs.modal', function(){\n\n                        $(this).find('input:focusable').first().select();\n\n                        if ( shown ) {\n                            shown(); \n                        }\n                    })\n                ;    \n\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            \n                            if ( hidden ) {\n                                hidden();      \n                            }\n                        })\n                    ;        \n            },\n            hide : function(hidden) {\n\n                this._modal()\n                    .modal('hide')\n                ;\n\n                if ( hidden ) {\n                    this._modal()\n                        .one('hidden.bs.modal', function(){\n                            hidden ? hidden() : '';\n                        })\n                    ;                      \n                }\n            }\n        };     \n\n            \n\t    /**\n\t     * Return the constructor function\n\t     */\n\t    return CCustoAbsorcao;\n\t};\n   \n})(window, window.angular);","angular\n    .module('app')\n    .value('gScope', {})\n    .controller('Ctrl', Ctrl);\n    \n    \n\tCtrl.$inject = [\n        '$scope',\n        '$timeout',\n        '$ajax',\n        'gScope',\n        '$consulta',\n        'Historico',\n        'RateioCCusto',\n        'CCustoAbsorcao'\n    ];\n\n\tfunction Ctrl( \n        $scope, \n        $timeout, \n        $ajax,\n        gScope, \n        $consulta,\n        Historico,\n        RateioCCusto,\n        CCustoAbsorcao\n    ) {\n\n\t\tvar vm     = this;\n        \n        gScope.Ctrl = this;\n        \n     \n        vm.Historico       = new Historico();\n        vm.RateioCCusto    = new RateioCCusto();\n        vm.CCustoAbsorcao = new CCustoAbsorcao();\n        vm.Consulta        = new $consulta();\n        \n        vm.RateioCCusto.consultar();\n        \n\n        vm.ConsultaCcusto                        = vm.Consulta.getNew(true);\n        vm.ConsultaCcusto.componente             = '.consulta-ccusto';\n        vm.ConsultaCcusto.model                  = 'vm.ConsultaCcusto';\n        vm.ConsultaCcusto.option.label_descricao = 'Centro de Custo:';\n        vm.ConsultaCcusto.option.obj_consulta    = '/_20030/api/ccusto';\n        vm.ConsultaCcusto.option.tamanho_input   = 'input-maior';\n        vm.ConsultaCcusto.option.campos_tabela   = [['MASK', 'C. Custo'],['DESCRICAO','Descrição']];\n        vm.ConsultaCcusto.option.obj_ret         = ['MASK', 'DESCRICAO'];\n        vm.ConsultaCcusto.compile();\n        \n        vm.ConsultaCcusto.onSelect = function() {\n            vm.RateioCCusto.SELECTED.CCUSTO           = vm.ConsultaCcusto.ID;\n            vm.RateioCCusto.SELECTED.CCUSTO_MASK      = vm.ConsultaCcusto.MASK;\n            vm.RateioCCusto.SELECTED.CCUSTO_DESCRICAO = vm.ConsultaCcusto.DESCRICAO;\n        };\n        \n        vm.ConsultaCcusto.onClear = function() {\n            vm.RateioCCusto.SELECTED.CCUSTO           = '';\n            vm.RateioCCusto.SELECTED.CCUSTO_MASK      = '';\n            vm.RateioCCusto.SELECTED.CCUSTO_DESCRICAO = '';\n        };\n\n        vm.caConsultaCCusto                        = vm.Consulta.getNew(true);\n        vm.caConsultaCCusto.componente             = '.ca-consulta-ccusto';\n        vm.caConsultaCCusto.model                  = 'vm.caConsultaCCusto';\n        vm.caConsultaCCusto.option.label_descricao = 'Centro de Custo:';\n        vm.caConsultaCCusto.option.obj_consulta    = '/_20030/api/ccusto';\n        vm.caConsultaCCusto.option.tamanho_input   = 'input-maior';\n        vm.caConsultaCCusto.option.campos_tabela   = [['MASK', 'C. Custo'],['DESCRICAO','Descrição']];\n        vm.caConsultaCCusto.option.obj_ret         = ['MASK', 'DESCRICAO'];\n        vm.caConsultaCCusto.compile();\n        \n        vm.caConsultaCCusto.onSelect = function() {\n            vm.CCustoAbsorcao.SELECTED.CCUSTO           = vm.caConsultaCCusto.ID;\n            vm.CCustoAbsorcao.SELECTED.CCUSTO_MASK      = vm.caConsultaCCusto.MASK;\n            vm.CCustoAbsorcao.SELECTED.CCUSTO_MASKA     = 'A'+vm.caConsultaCCusto.MASK;\n            vm.CCustoAbsorcao.SELECTED.CCUSTO_DESCRICAO = vm.caConsultaCCusto.DESCRICAO;\n        };\n        \n        vm.caConsultaCCusto.onClear = function() {\n            vm.CCustoAbsorcao.SELECTED.CCUSTO           = '';\n            vm.CCustoAbsorcao.SELECTED.CCUSTO_MASK      = '';\n            vm.CCustoAbsorcao.SELECTED.CCUSTO_MASKA     = '';\n            vm.CCustoAbsorcao.SELECTED.CCUSTO_DESCRICAO = '';\n        };\n\n\n\n         \n            \n        $ajax.get('/_31050/api/rateio/tipo').then(function(response){\n            sanitizeJson(response);\n            vm.rateioTipos = response;\n        });\n\n\t}   \n  "]}